

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>41. Machine Learning a Ramsey Plan &#8212; Advanced Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=bd0785fbb14d8d2bd4d9ae501d79ed8d3bc089ec" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=d6d86bce9979111653c4c495e33499e1796e172a"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-KZLV7PM9LL"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KZLV7PM9LL');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min", "col": "col", "Span": "span", "epsilon": "\\varepsilon", "EE": "\\mathbb{E}", "PP": "\\mathbb{P}", "RR": "\\mathbb{R}", "NN": "\\mathbb{N}", "ZZ": "\\mathbb{Z}", "aA": "\\mathcal{A}", "bB": "\\mathcal{B}", "cC": "\\mathcal{C}", "dD": "\\mathcal{D}", "eE": "\\mathcal{E}", "fF": "\\mathcal{F}", "gG": "\\mathcal{G}", "hH": "\\mathcal{H}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'calvo_machine_learn';</script>
    <link rel="canonical" href="https://python-advanced.quantecon.org/calvo_machine_learn.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="42. Time Inconsistency of Ramsey Plans" href="calvo.html" />
    <link rel="prev" title="40. Stackelberg Plans" href="dyn_stack.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Machine Learning a Ramsey Plan"/>
<meta name="twitter:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Machine Learning a Ramsey Plan" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python-advanced.quantecon.org/calvo_machine_learn.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Advanced Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=calvo_machine_learn>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">41.1. Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-model">41.2. The Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#model-components">41.3. Model Components</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-and-variables">41.4. Parameters and Variables</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#basic-objects">41.4.1. Basic Objects</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#timing-protocol">41.4.2. Timing protocol</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#approximation-and-truncation-parameter-t">41.5. Approximation and Truncation parameter <span class="math notranslate nohighlight">\(T\)</span></a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-gradient-descent-algorithm">41.6. A Gradient Descent Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#implementation">41.6.1. Implementation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#restricting-mu-t-bar-mu-for-all-t">41.6.2. Restricting  <span class="math notranslate nohighlight">\(\mu_t = \bar \mu\)</span> for all <span class="math notranslate nohighlight">\(t\)</span></a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-more-structured-ml-algorithm">41.7. A More Structured ML Algorithm</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-implementations">41.7.1. Two implementations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#continuation-values">41.8. Continuation Values</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-some-human-intelligence">41.9. Adding Some Human Intelligence</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-has-machine-learning-taught-us">41.10. What has Machine Learning Taught Us?</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Advanced Quantitative Economics with Python</a></p>

                        <p class="qe-page__header-subheading">Machine Learning a Ramsey Plan</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>Thomas J. Sargent</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>John Stachurski</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="machine-learning-a-ramsey-plan">
<h1><span class="section-number">41. </span>Machine Learning a Ramsey Plan<a class="headerlink" href="#machine-learning-a-ramsey-plan" title="Permalink to this heading">#</a></h1>
<section id="introduction">
<h2><span class="section-number">41.1. </span>Introduction<a class="headerlink" href="#introduction" title="Permalink to this heading">#</a></h2>
<p>This  lecture  uses what we call a <code class="docutils literal notranslate"><span class="pre">machine</span> <span class="pre">learning</span></code> approach to
compute a Ramsey plan  for  a version of a model of Calvo <span id="id1">[<a class="reference internal" href="zreferences.html#id140" title="Guillermo A. Calvo. On the time consistency of optimal policy in a monetary economy. Econometrica, 46(6):1411-1428, 1978.">Calvo, 1978</a>]</span>.</p>
<p>We use another approach to compute a  Ramsey plan for Calvo’s model  in another quantecon lecture
<a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>.</p>
<p>The <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a> lecture  uses  an analytic approach based on <code class="docutils literal notranslate"><span class="pre">dynamic</span> <span class="pre">programming</span> <span class="pre">squared</span></code> to guide computations.</p>
<p>Dynamic programming squared provides  information about the structure of  mathematical  objects in terms of which a Ramsey plan can be represented recursively.</p>
<p>Using that information  paves the way to computing a  Ramsey plan efficiently.</p>
<p>Included in the structural information  that dynamic programming squared provides  in quantecon lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>  are</p>
<ul class="simple">
<li><p>a <strong>state</strong> variable that confronts a continuation Ramsey planner, and</p></li>
<li><p>two <strong>Bellman equations</strong></p>
<ul>
<li><p>one that describes the behavior of the representative agent</p></li>
<li><p>another that describes  decision problems of a Ramsey planner and of a continuation Ramsey planner</p></li>
</ul>
</li>
</ul>
<p>In this lecture, we approach the Ramsey planner in a less sophisticated way that proceeds without knowing the mathematical  structure imparted by dynamic programming squared.</p>
<p>We simply choose a pair of infinite sequences of real numbers that maximizes a Ramsey planner’s objective function.</p>
<p>The pair  consists of</p>
<ul class="simple">
<li><p>a sequence <span class="math notranslate nohighlight">\(\vec \theta\)</span> of inflation rates</p></li>
<li><p>a sequence <span class="math notranslate nohighlight">\(\vec \mu\)</span> of money growh rates</p></li>
</ul>
<p>Because it fails to take advantage of the structure recognized by dynamic programming squared and, relative to the dynamic programming squared approach, proliferates parameters, we take the liberty of calling this a <strong>machine learning</strong> approach.</p>
<p>This is similar to what other machine learning algorithms also do.</p>
<p>Comparing the calculations in this lecture with those in our sister lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a> provides us
with a laboratory that can  help us  appreciate promises and limits of machine learning approaches
more generally.</p>
<p>In this lecture, we’ll actually deploy two machine learning approaches.</p>
<ul class="simple">
<li><p>the first is really lazy</p>
<ul>
<li><p>it  writes  a Python function that   computes the Ramsey planner’s objective as a function of a money growth rate sequence and  hands it over to a <code class="docutils literal notranslate"><span class="pre">gradient</span> <span class="pre">descent</span></code> optimizer</p></li>
</ul>
</li>
<li><p>the second is less lazy</p>
<ul>
<li><p>it exerts enough  mental effort required to express the Ramsey planner’s objective as an affine quadratic form in <span class="math notranslate nohighlight">\(\vec \mu\)</span>, computes first-order conditions for an optimum, arranges them into a system of simultaneous linear  equations for <span class="math notranslate nohighlight">\(\vec \mu\)</span> and then <span class="math notranslate nohighlight">\(\vec \theta\)</span>, then solves them.</p></li>
</ul>
</li>
</ul>
<p>Each of  these machine learning (ML) approaches  recovers the same  Ramsey plan that we compute  in  quantecon lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a> by using dynamic programming squared.</p>
<p>However,   the recursive structure of the Ramsey plan lies hidden within   some of the objects calculated  by our ML approaches.</p>
<p>To  ferret out that structure, we have to ask   the right questions.</p>
<p>We pose  some of  those questions at the end of this lecture and  answer them  by running  some  linear  regressions on components of <span class="math notranslate nohighlight">\(\vec \mu, \vec \theta,\)</span> and another vector that we’ll define later.</p>
<p>Human intelligence, not the <code class="docutils literal notranslate"><span class="pre">artificial</span> <span class="pre">intelligence</span></code> deployed in our machine learning approach, is a key input into choosing which regressions to run.</p>
</section>
<section id="the-model">
<h2><span class="section-number">41.2. </span>The Model<a class="headerlink" href="#the-model" title="Permalink to this heading">#</a></h2>
<p>We study a   linear-quadratic version of a model that Guillermo Calvo <span id="id2">[<a class="reference internal" href="zreferences.html#id140" title="Guillermo A. Calvo. On the time consistency of optimal policy in a monetary economy. Econometrica, 46(6):1411-1428, 1978.">Calvo, 1978</a>]</span> used to illustrate the <strong>time inconsistency</strong> of optimal government plans.</p>
<p>Calvo’s model focuses  on intertemporal tradeoffs between</p>
<ul class="simple">
<li><p>utility accruing from  a representative  agent’s anticipations of future  deflation that lower the agent’s  cost of holding real money balances and prompt him to  increase his   <em>liquidity</em>, as  measured by his   stock  of real money balances, and</p></li>
<li><p>social costs associated with the  distorting taxes that a government  levies  to acquire the paper money that it   destroys  in order to generate prospective deflation</p></li>
</ul>
<p>The model features</p>
<ul class="simple">
<li><p>rational expectations</p></li>
<li><p>costly government actions at all dates <span class="math notranslate nohighlight">\(t \geq 1\)</span> that increase the representative agent’s  utilities at dates before <span class="math notranslate nohighlight">\(t\)</span></p></li>
</ul>
<p>The model combines ideas from  papers by Cagan <span id="id3">[<a class="reference internal" href="zreferences.html#id79" title="Philip Cagan. The monetary dynamics of hyperinflation. In Milton Friedman, editor, Studies in the Quantity Theory of Money, pages 25–117. University of Chicago Press, Chicago, 1956.">Cagan, 1956</a>]</span>, <span id="id4">[<a class="reference internal" href="zreferences.html#id3" title="Thomas J Sargent and Neil Wallace. The stability of models of money and growth with perfect foresight. Econometrica: Journal of the Econometric Society, pages 1043–1048, 1973.">Sargent and Wallace, 1973</a>]</span>,  and  Calvo <span id="id5">[<a class="reference internal" href="zreferences.html#id140" title="Guillermo A. Calvo. On the time consistency of optimal policy in a monetary economy. Econometrica, 46(6):1411-1428, 1978.">Calvo, 1978</a>]</span>.</p>
</section>
<section id="model-components">
<h2><span class="section-number">41.3. </span>Model Components<a class="headerlink" href="#model-components" title="Permalink to this heading">#</a></h2>
<p>There is no uncertainty.</p>
<p>Let:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_t\)</span> be the log of the price level</p></li>
<li><p><span class="math notranslate nohighlight">\(m_t\)</span> be the log of nominal money balances</p></li>
<li><p><span class="math notranslate nohighlight">\(\theta_t = p_{t+1} - p_t\)</span> be the net rate of inflation between <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(t+1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\mu_t = m_{t+1} - m_t\)</span> be the net rate of growth of nominal balances</p></li>
</ul>
<p>The demand for real balances is governed by a perfect foresight
version of a Cagan <span id="id6">[<a class="reference internal" href="zreferences.html#id79" title="Philip Cagan. The monetary dynamics of hyperinflation. In Milton Friedman, editor, Studies in the Quantity Theory of Money, pages 25–117. University of Chicago Press, Chicago, 1956.">Cagan, 1956</a>]</span> demand function for real balances:</p>
<div class="math notranslate nohighlight" id="equation-eq-grad-old1">
<span class="eqno">(41.1)<a class="headerlink" href="#equation-eq-grad-old1" title="Permalink to this equation">#</a></span>\[m_t - p_t = -\alpha(p_{t+1} - p_t) \: , \: \alpha &gt; 0\]</div>
<p>for <span class="math notranslate nohighlight">\(t \geq 0\)</span>.</p>
<p>Equation <a class="reference internal" href="#equation-eq-grad-old1">(41.1)</a> asserts that the representative agent’s demand for real balances is inversely
related to the representative agent’s expected rate of inflation, which  equals
the actual rate of inflation because there is no uncertainty here.</p>
<p>(When there is no uncertainty, an assumption of <strong>rational expectations</strong>  becomes equivalent to  <strong>perfect foresight</strong>).</p>
<p>Subtracting the demand function <a class="reference internal" href="#equation-eq-grad-old1">(41.1)</a> at time <span class="math notranslate nohighlight">\(t\)</span> from the demand
function at <span class="math notranslate nohighlight">\(t+1\)</span> gives:</p>
<div class="math notranslate nohighlight">
\[
\mu_t - \theta_t = -\alpha \theta_{t+1} + \alpha \theta_t
\]</div>
<p>or</p>
<div class="math notranslate nohighlight" id="equation-eq-grad-old2">
<span class="eqno">(41.2)<a class="headerlink" href="#equation-eq-grad-old2" title="Permalink to this equation">#</a></span>\[\theta_t = \frac{\alpha}{1+\alpha} \theta_{t+1} + \frac{1}{1+\alpha} \mu_t\]</div>
<p>Because <span class="math notranslate nohighlight">\(\alpha &gt; 0\)</span>,  <span class="math notranslate nohighlight">\(0 &lt; \frac{\alpha}{1+\alpha} &lt; 1\)</span>.</p>
<div class="proof definition admonition" id="square-summable">
<p class="admonition-title"><span class="caption-number">Definition 41.1 </span></p>
<section class="definition-content" id="proof-content">
<p>For  scalar <span class="math notranslate nohighlight">\(b_t\)</span>, let <span class="math notranslate nohighlight">\(L^2\)</span> be the space of sequences
<span class="math notranslate nohighlight">\(\{b_t\}_{t=0}^\infty\)</span> that satisfy</p>
<div class="math notranslate nohighlight">
\[
\sum_{t=0}^\infty  b_t^2 &lt; +\infty
\]</div>
<p>We say that a sequence that belongs to <span class="math notranslate nohighlight">\(L^2\)</span> is <strong>square summable</strong>.</p>
</section>
</div><p>When we assume that the sequence <span class="math notranslate nohighlight">\(\vec \mu = \{\mu_t\}_{t=0}^\infty\)</span> is square summable and also require that the sequence <span class="math notranslate nohighlight">\(\vec \theta = \{\theta_t\}_{t=0}^\infty\)</span> is square summable,
the linear difference equation <a class="reference internal" href="#equation-eq-grad-old2">(41.2)</a> can be solved forward to get:</p>
<div class="math notranslate nohighlight" id="equation-eq-grad-old3">
<span class="eqno">(41.3)<a class="headerlink" href="#equation-eq-grad-old3" title="Permalink to this equation">#</a></span>\[\theta_t = \frac{1}{1+\alpha} \sum_{j=0}^\infty \left(\frac{\alpha}{1+\alpha}\right)^j \mu_{t+j}, \quad t \geq 0\]</div>
<p>The  government  values  a representative household’s utility of real balances at time <span class="math notranslate nohighlight">\(t\)</span> according to the utility function</p>
<div class="math notranslate nohighlight" id="equation-eq-grad-old5">
<span class="eqno">(41.4)<a class="headerlink" href="#equation-eq-grad-old5" title="Permalink to this equation">#</a></span>\[U(m_t - p_t) = u_0 + u_1 (m_t - p_t) - \frac{u_2}{2} (m_t - p_t)^2, \quad u_0 &gt; 0, u_1 &gt; 0, u_2 &gt; 0\]</div>
<p>The money demand function <a class="reference internal" href="#equation-eq-grad-old1">(41.1)</a> and the utility function <a class="reference internal" href="#equation-eq-grad-old5">(41.4)</a> imply that</p>
<div class="math notranslate nohighlight" id="equation-eq-grad-old5a">
<span class="eqno">(41.5)<a class="headerlink" href="#equation-eq-grad-old5a" title="Permalink to this equation">#</a></span>\[
U(-\alpha \theta_t) = u_0 + u_1 (-\alpha \theta_t) -\frac{u_2}{2}(-\alpha \theta_t)^2 . 
\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The “bliss level” of real balances is  <span class="math notranslate nohighlight">\(\frac{u_1}{u_2}\)</span>;  the inflation rate that attains
it is <span class="math notranslate nohighlight">\(-\frac{u_1}{u_2 \alpha}\)</span>.</p>
</div>
<p>Via equation <a class="reference internal" href="#equation-eq-grad-old3">(41.3)</a>, a government plan
<span class="math notranslate nohighlight">\(\vec \mu = \{\mu_t \}_{t=0}^\infty\)</span> leads to a
sequence of inflation rates
<span class="math notranslate nohighlight">\(\vec \theta = \{ \theta_t \}_{t=0}^\infty\)</span>.</p>
<p>We assume that the government incurs  social costs <span class="math notranslate nohighlight">\(\frac{c}{2} \mu_t^2\)</span> when it  changes the stock of nominal money
balances at rate <span class="math notranslate nohighlight">\(\mu_t\)</span>  at time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>Therefore, the one-period welfare function of a benevolent government
is</p>
<div class="math notranslate nohighlight">
\[
s(\theta_t,\mu_t) = U(-\alpha \theta_t) - \frac{c}{2} \mu_t^2  .
\]</div>
<p>The Ramsey planner’s criterion is</p>
<div class="math notranslate nohighlight" id="equation-eq-ramseyv">
<span class="eqno">(41.6)<a class="headerlink" href="#equation-eq-ramseyv" title="Permalink to this equation">#</a></span>\[
V = \sum_{t=0}^\infty \beta^t s(\theta_t, \mu_t) 
\]</div>
<p>where <span class="math notranslate nohighlight">\(\beta \in (0,1)\)</span> is a discount factor.</p>
<p>The Ramsey planner chooses
a vector of money growth rates <span class="math notranslate nohighlight">\(\vec \mu\)</span>
to maximize criterion <a class="reference internal" href="#equation-eq-ramseyv">(41.6)</a> subject to equations <a class="reference internal" href="#equation-eq-grad-old3">(41.3)</a> and that  restriction</p>
<div class="math notranslate nohighlight" id="equation-eq-thetainl2">
<span class="eqno">(41.7)<a class="headerlink" href="#equation-eq-thetainl2" title="Permalink to this equation">#</a></span>\[ 
\vec \theta \in L^2 
\]</div>
<p>Equations <a class="reference internal" href="#equation-eq-grad-old3">(41.3)</a> and <a class="reference internal" href="#equation-eq-thetainl2">(41.7)</a> imply that <span class="math notranslate nohighlight">\(\vec \theta\)</span> is a function
of <span class="math notranslate nohighlight">\(\vec \mu\)</span>.</p>
<p>In particular, the inflation rate <span class="math notranslate nohighlight">\(\theta_t\)</span> satisfies</p>
<div class="math notranslate nohighlight" id="equation-eq-inflation101">
<span class="eqno">(41.8)<a class="headerlink" href="#equation-eq-inflation101" title="Permalink to this equation">#</a></span>\[
\theta_t = (1-\lambda) \sum_{j=0}^\infty \lambda^j \mu_{t+j}, \quad t \geq 0
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
\lambda = \frac{\alpha}{1+\alpha} .
\]</div>
</section>
<section id="parameters-and-variables">
<h2><span class="section-number">41.4. </span>Parameters and Variables<a class="headerlink" href="#parameters-and-variables" title="Permalink to this heading">#</a></h2>
<p><strong>Parameters:</strong></p>
<ul class="simple">
<li><p>Demand for money parameter is <span class="math notranslate nohighlight">\(\alpha &gt; 0\)</span>; we set its default value <span class="math notranslate nohighlight">\(\alpha = 1\)</span></p>
<ul>
<li><p>Induced demand function for money parameter is  <span class="math notranslate nohighlight">\(\lambda = \frac{\alpha}{1+\alpha}\)</span></p></li>
</ul>
</li>
<li><p>Utility function parameters are   <span class="math notranslate nohighlight">\(u_0, u_1, u_2 \)</span> and <span class="math notranslate nohighlight">\(\beta \in (0,1)\)</span></p></li>
<li><p>Cost parameter of tax distortions associated with setting <span class="math notranslate nohighlight">\(\mu_t \neq 0\)</span> is <span class="math notranslate nohighlight">\(c\)</span></p></li>
<li><p>A horizon truncation parameter: a positive integer <span class="math notranslate nohighlight">\(T &gt;0\)</span></p></li>
</ul>
<p><strong>Variables:</strong></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\theta_t = p_{t+1} - p_t\)</span> where <span class="math notranslate nohighlight">\(p_t\)</span> is log of price level</p></li>
<li><p><span class="math notranslate nohighlight">\(\mu_t = m_{t+1} - m_t \)</span> where <span class="math notranslate nohighlight">\(m_t\)</span> is log of money supply</p></li>
</ul>
<section id="basic-objects">
<h3><span class="section-number">41.4.1. </span>Basic Objects<a class="headerlink" href="#basic-objects" title="Permalink to this heading">#</a></h3>
<p>To prepare the way for our calculations, we’ll remind ourselves of the  mathematical objects
in play.</p>
<ul class="simple">
<li><p>sequences of inflation rates and money creation rates:</p></li>
</ul>
<div class="math notranslate nohighlight">
\[
(\vec \theta, \vec \mu) = \{\theta_t, \mu_t\}_{t=0}^\infty
\]</div>
<ul class="simple">
<li><p>A planner’s value function</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq-ramseyvalue">
<span class="eqno">(41.9)<a class="headerlink" href="#equation-eq-ramseyvalue" title="Permalink to this equation">#</a></span>\[
V = \sum_{t=0}^\infty \beta^t (h_0 + h_1 \theta_t + h_2 \theta_t^2 -
\frac{c}{2} \mu_t^2 )
\]</div>
<p>where we set  <span class="math notranslate nohighlight">\(h_0, h_1, h_2\)</span>  to match</p>
<div class="math notranslate nohighlight">
\[
u_0 + u_1(-\alpha \theta_t) - \frac{u_2}{2} (-\alpha \theta_t)^2
\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[
h_0 + h_1 \theta_t + h_2 \theta_t^2 
\]</div>
<p>To make our parameters  match as we want, we   set</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
h_0 &amp; = u_0 \cr
h_1 &amp; = -\alpha u_1 \cr
h_2 &amp; = - \frac{u_2 \alpha^2}{2}
\end{aligned}
\]</div>
<p>A Ramsey planner chooses <span class="math notranslate nohighlight">\(\vec \mu\)</span> to maximize the government’s value function <a class="reference internal" href="#equation-eq-ramseyvalue">(41.9)</a>
subject to equations  <a class="reference internal" href="#equation-eq-inflation101">(41.8)</a>.</p>
<p>A  solution <span class="math notranslate nohighlight">\(\vec \mu\)</span> of this problem is called a <strong>Ramsey plan</strong>.</p>
</section>
<section id="timing-protocol">
<h3><span class="section-number">41.4.2. </span>Timing protocol<a class="headerlink" href="#timing-protocol" title="Permalink to this heading">#</a></h3>
<p>Following Calvo <span id="id7">[<a class="reference internal" href="zreferences.html#id140" title="Guillermo A. Calvo. On the time consistency of optimal policy in a monetary economy. Econometrica, 46(6):1411-1428, 1978.">Calvo, 1978</a>]</span>, we assume that the  government chooses the money growth  sequence <span class="math notranslate nohighlight">\(\vec \mu\)</span> once and for all at, or before, time <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>An optimal  government plan under this timing protocol is an example of what is  often called a <strong>Ramsey plan</strong>.</p>
<p>Notice that while the government is in effect choosing a bivariate <strong>time series</strong> <span class="math notranslate nohighlight">\((\vec mu, \vec \theta)\)</span>, the government’s problem is <strong>static</strong> in the sense that it chooses treats that time-series as a single object to be chosen at a single point in time.</p>
</section>
</section>
<section id="approximation-and-truncation-parameter-t">
<h2><span class="section-number">41.5. </span>Approximation and Truncation parameter <span class="math notranslate nohighlight">\(T\)</span><a class="headerlink" href="#approximation-and-truncation-parameter-t" title="Permalink to this heading">#</a></h2>
<p>We anticipate that under a Ramsey plan the sequences  <span class="math notranslate nohighlight">\(\{\theta_t\}\)</span> and <span class="math notranslate nohighlight">\(\{\mu_t\}\)</span>  both converge to stationary values.</p>
<p>Thus, we guess that
under the optimal policy
<span class="math notranslate nohighlight">\( \lim_{t \rightarrow + \infty} \mu_t = \bar \mu\)</span>.</p>
<p>Convergence of <span class="math notranslate nohighlight">\(\mu_t\)</span> to <span class="math notranslate nohighlight">\(\bar \mu\)</span> together with formula <a class="reference internal" href="#equation-eq-inflation101">(41.8)</a> for the inflation rate then implies that  <span class="math notranslate nohighlight">\( \lim_{t \rightarrow + \infty} \theta_t = \bar \mu\)</span> as well.</p>
<p>We’ll  guess a time <span class="math notranslate nohighlight">\(T\)</span> large enough that <span class="math notranslate nohighlight">\(\mu_t\)</span> has gotten
very close to the limit <span class="math notranslate nohighlight">\(\bar \mu\)</span>.</p>
<p>Then we’ll approximate <span class="math notranslate nohighlight">\(\vec \mu\)</span> by a truncated  vector
with the property that</p>
<div class="math notranslate nohighlight">
\[
\mu_t = \bar \mu \quad \forall t \geq T
\]</div>
<p>We’ll approximate <span class="math notranslate nohighlight">\(\vec \theta\)</span> with a truncated vector with the property that</p>
<div class="math notranslate nohighlight">
\[
\theta_t = \bar \theta \quad \forall t \geq T
\]</div>
<p><strong>Formula for truncated <span class="math notranslate nohighlight">\(\vec \theta\)</span></strong></p>
<p>In light of our approximation that <span class="math notranslate nohighlight">\(\mu_t = \bar \mu\)</span> for all <span class="math notranslate nohighlight">\(t \geq T\)</span>, we  seek a  function that takes</p>
<div class="math notranslate nohighlight">
\[
\tilde \mu = \begin{bmatrix}\mu_0 &amp; \mu_1 &amp; \cdots &amp; \mu_{T-1} &amp; \bar \mu
\end{bmatrix}
\]</div>
<p>as an input and  as an output gives</p>
<div class="math notranslate nohighlight">
\[
\tilde \theta = \begin{bmatrix}\theta_0 &amp; \theta_1 &amp; \cdots &amp; \theta_{T-1} &amp; \bar \theta
\end{bmatrix}
\]</div>
<p>where   <span class="math notranslate nohighlight">\(\bar \theta = \bar \mu\)</span> and <span class="math notranslate nohighlight">\(\theta_t\)</span> satisfies</p>
<div class="math notranslate nohighlight" id="equation-eq-thetaformula102">
<span class="eqno">(41.10)<a class="headerlink" href="#equation-eq-thetaformula102" title="Permalink to this equation">#</a></span>\[
\theta_t = (1-\lambda) \sum_{j=0}^{T-1-t} \lambda^j \mu_{t+j} + \lambda^{T-t} \bar \mu 
\]</div>
<p>for <span class="math notranslate nohighlight">\(t=0, 1, \ldots, T-1\)</span>.</p>
<p><strong>Formula  for <span class="math notranslate nohighlight">\(V\)</span></strong></p>
<p>Having specified a  truncated vector <span class="math notranslate nohighlight">\(\tilde \mu\)</span> and and having computed  <span class="math notranslate nohighlight">\(\tilde \theta\)</span>
by using formula <a class="reference internal" href="#equation-eq-thetaformula102">(41.10)</a>, we shall   write a Python  function that computes</p>
<div class="math notranslate nohighlight" id="equation-eq-valueformula101">
<span class="eqno">(41.11)<a class="headerlink" href="#equation-eq-valueformula101" title="Permalink to this equation">#</a></span>\[
\tilde V = \sum_{t=0}^\infty \beta^t (
h_0 + h_1 \tilde\theta_t + h_2 \tilde\theta_t^2 -
\frac{c}{2} \mu_t^2 )
\]</div>
<p>or more precisely</p>
<div class="math notranslate nohighlight">
\[ 
\tilde V = \sum_{t=0}^{T-1} \beta^t (h_0 + h_1 \tilde\theta_t + h_2 \tilde\theta_t^2 -
\frac{c}{2} \mu_t^2 ) + \frac{\beta^T}{1-\beta} (h_0 + h_1 \bar \mu + h_2 \bar \mu^2 - \frac{c}{2} \bar \mu^2 )
\]</div>
<p>where <span class="math notranslate nohighlight">\(\tilde \theta_t, \ t = 0, 1, \ldots , T-1\)</span> satisfies formula (1).</p>
</section>
<section id="a-gradient-descent-algorithm">
<h2><span class="section-number">41.6. </span>A Gradient Descent Algorithm<a class="headerlink" href="#a-gradient-descent-algorithm" title="Permalink to this heading">#</a></h2>
<p>We now describe  code that  maximizes the criterion function <a class="reference internal" href="#equation-eq-ramseyvalue">(41.9)</a> subject to equations <a class="reference internal" href="#equation-eq-inflation101">(41.8)</a> by choice of the truncated vector  <span class="math notranslate nohighlight">\(\tilde \mu\)</span>.</p>
<p>We use a brute force or <code class="docutils literal notranslate"><span class="pre">machine</span> <span class="pre">learning</span></code> approach that just hands our problem off to code that minimizes <span class="math notranslate nohighlight">\(V\)</span> with respect to the components of <span class="math notranslate nohighlight">\(\tilde \mu\)</span> by using gradient descent.</p>
<p>We hope that answers will agree with those found obtained by other more structured methods in this quantecon lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>.</p>
<section id="implementation">
<h3><span class="section-number">41.6.1. </span>Implementation<a class="headerlink" href="#implementation" title="Permalink to this heading">#</a></h3>
<p>We will implement the above in Python using JAX and Optax libraries.</p>
<p>We use the following imports in this lecture</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>quantecon
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>optax
<span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>--upgrade<span class="w"> </span>statsmodels
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: quantecon in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (0.7.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: numba&gt;=0.49.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (0.60.0)
Requirement already satisfied: numpy&gt;=1.17.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (1.26.4)
Requirement already satisfied: requests in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (2.32.3)
Requirement already satisfied: scipy&gt;=1.5.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (1.13.1)
Requirement already satisfied: sympy in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from quantecon) (1.13.2)
Requirement already satisfied: llvmlite&lt;0.44,&gt;=0.43.0dev0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from numba&gt;=0.49.0-&gt;quantecon) (0.43.0)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (3.3.2)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (2.2.3)
Requirement already satisfied: certifi&gt;=2017.4.17 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from requests-&gt;quantecon) (2024.8.30)
Requirement already satisfied: mpmath&lt;1.4,&gt;=1.1.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from sympy-&gt;quantecon) (1.3.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting optax
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Downloading optax-0.2.4-py3-none-any.whl.metadata (8.3 kB)
Collecting absl-py&gt;=0.7.1 (from optax)
  Downloading absl_py-2.1.0-py3-none-any.whl.metadata (2.3 kB)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting chex&gt;=0.1.87 (from optax)
  Downloading chex-0.1.87-py3-none-any.whl.metadata (17 kB)
Collecting jax&gt;=0.4.27 (from optax)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Downloading jax-0.4.35-py3-none-any.whl.metadata (22 kB)
Collecting jaxlib&gt;=0.4.27 (from optax)
  Downloading jaxlib-0.4.35-cp312-cp312-manylinux2014_x86_64.whl.metadata (983 bytes)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: numpy&gt;=1.18.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from optax) (1.26.4)
Collecting etils[epy] (from optax)
  Downloading etils-1.11.0-py3-none-any.whl.metadata (6.5 kB)
Requirement already satisfied: typing-extensions&gt;=4.2.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from chex&gt;=0.1.87-&gt;optax) (4.11.0)
Requirement already satisfied: toolz&gt;=0.9.0 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from chex&gt;=0.1.87-&gt;optax) (0.12.0)
Requirement already satisfied: setuptools in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from chex&gt;=0.1.87-&gt;optax) (75.1.0)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting ml-dtypes&gt;=0.4.0 (from jax&gt;=0.4.27-&gt;optax)
  Downloading ml_dtypes-0.5.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (21 kB)
Collecting opt-einsum (from jax&gt;=0.4.27-&gt;optax)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Downloading opt_einsum-3.4.0-py3-none-any.whl.metadata (6.3 kB)
Requirement already satisfied: scipy&gt;=1.10 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from jax&gt;=0.4.27-&gt;optax) (1.13.1)
Downloading optax-0.2.4-py3-none-any.whl (319 kB)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading absl_py-2.1.0-py3-none-any.whl (133 kB)
Downloading chex-0.1.87-py3-none-any.whl (99 kB)
Downloading jax-0.4.35-py3-none-any.whl (2.2 MB)
?25l   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">0.0/2.2 MB</span> <span class=" -Color -Color-Red">?</span> eta <span class=" -Color -Color-Cyan">-:--:--</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">2.2/2.2 MB</span> <span class=" -Color -Color-Red">87.4 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hDownloading jaxlib-0.4.35-cp312-cp312-manylinux2014_x86_64.whl (87.3 MB)
?25l   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">0.0/87.3 MB</span> <span class=" -Color -Color-Red">?</span> eta <span class=" -Color -Color-Cyan">-:--:--</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   ━━━━━━━━━━━━━━━━━━━━╸━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">45.4/87.3 MB</span> <span class=" -Color -Color-Red">226.6 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:01</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━╸ <span class=" -Color -Color-Green">87.3/87.3 MB</span> <span class=" -Color -Color-Red">241.1 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:01</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">87.3/87.3 MB</span> <span class=" -Color -Color-Red">159.8 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25hDownloading ml_dtypes-0.5.0-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (4.5 MB)
?25l   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">0.0/4.5 MB</span> <span class=" -Color -Color-Red">?</span> eta <span class=" -Color -Color-Cyan">-:--:--</span>
   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">4.5/4.5 MB</span> <span class=" -Color -Color-Red">174.7 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25h
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading etils-1.11.0-py3-none-any.whl (165 kB)
Downloading opt_einsum-3.4.0-py3-none-any.whl (71 kB)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Installing collected packages: opt-einsum, ml-dtypes, etils, absl-py, jaxlib, jax, chex, optax
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully installed absl-py-2.1.0 chex-0.1.87 etils-1.11.0 jax-0.4.35 jaxlib-0.4.35 ml-dtypes-0.5.0 opt-einsum-3.4.0 optax-0.2.4
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: statsmodels in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (0.14.2)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Collecting statsmodels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>  Downloading statsmodels-0.14.4-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl.metadata (9.2 kB)
Requirement already satisfied: numpy&lt;3,&gt;=1.22.3 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from statsmodels) (1.26.4)
Requirement already satisfied: scipy!=1.9.2,&gt;=1.8 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from statsmodels) (1.13.1)
Requirement already satisfied: pandas!=2.1.0,&gt;=1.4 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from statsmodels) (2.2.2)
Requirement already satisfied: patsy&gt;=0.5.6 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from statsmodels) (0.5.6)
Requirement already satisfied: packaging&gt;=21.3 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from statsmodels) (24.1)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from pandas!=2.1.0,&gt;=1.4-&gt;statsmodels) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from pandas!=2.1.0,&gt;=1.4-&gt;statsmodels) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from pandas!=2.1.0,&gt;=1.4-&gt;statsmodels) (2023.3)
Requirement already satisfied: six in /home/runner/miniconda3/envs/quantecon/lib/python3.12/site-packages (from patsy&gt;=0.5.6-&gt;statsmodels) (1.16.0)
Downloading statsmodels-0.14.4-cp312-cp312-manylinux_2_17_x86_64.manylinux2014_x86_64.whl (10.7 MB)
?25l   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">0.0/10.7 MB</span> <span class=" -Color -Color-Red">?</span> eta <span class=" -Color -Color-Cyan">-:--:--</span>
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ <span class=" -Color -Color-Green">10.7/10.7 MB</span> <span class=" -Color -Color-Red">140.7 MB/s</span> eta <span class=" -Color -Color-Cyan">0:00:00</span>
?25h
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Installing collected packages: statsmodels
  Attempting uninstall: statsmodels
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Found existing installation: statsmodels 0.14.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>    Uninstalling statsmodels-0.14.2:
      Successfully uninstalled statsmodels-0.14.2
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Successfully installed statsmodels-0.14.4
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">quantecon</span> <span class="kn">import</span> <span class="n">LQ</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">jit</span><span class="p">,</span> <span class="n">grad</span>
<span class="kn">import</span> <span class="nn">optax</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>We’ll eventually  want to compare the results we obtain  here to those that we obtain in  those obtained in this quantecon lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>.</p>
<p>To enable us to do that, we  copy the class <code class="docutils literal notranslate"><span class="pre">ChangLQ</span></code>  used in that lecture.</p>
<p>We hide the cell that copies the class, but readers can find details of the class in this quantecon lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ChangLQ</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to solve LQ Chang model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">α</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">θ_n</span><span class="o">=</span><span class="mi">200</span><span class="p">):</span>
        <span class="c1"># Record parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">u2</span> <span class="o">=</span> <span class="n">α</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">θ_n</span> <span class="o">=</span> <span class="n">β</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">θ_n</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setup_LQ_matrices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve_LQ_problem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_policy_functions</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">simulate_ramsey_plan</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_θ_range</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_value_and_policy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setup_LQ_matrices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># LQ Matrices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">R</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="bp">self</span><span class="o">.</span><span class="n">u0</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                            <span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> 
                             <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">u2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="mi">2</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="p">]])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="p">]])</span>

    <span class="k">def</span> <span class="nf">solve_LQ_problem</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Solve LQ Problem (Subproblem 1)</span>
        <span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Q</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">R</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">stationary_values</span><span class="p">()</span>

        <span class="c1"># Compute g0, g1, and g2 (41.16)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">g0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">g2</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> 
                                     <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        
        <span class="c1"># Compute b0 and b1 (41.17)</span>
        <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">b0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">b1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span>

        <span class="c1"># Compute d0 and d1 (41.18)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cl_mat</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">A</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">B</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">)</span>  <span class="c1"># Closed loop matrix</span>
        <span class="p">[[</span><span class="bp">self</span><span class="o">.</span><span class="n">d0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">d1</span><span class="p">]]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cl_mat</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>

        <span class="c1"># Solve Subproblem 2</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_R</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># Find the bliss level of θ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_B</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">compute_policy_functions</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Solve the Markov Perfect Equilibrium</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">μ_MPE</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">/</span> <span class="p">((</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> 
                                 <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="p">)</span>
                                 <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">u2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="o">**</span><span class="mi">2</span> 
                                 <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">u2</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_MPE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">μ_MPE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">μ_CR</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">α</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u2</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">α</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_CR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">μ_CR</span>

        <span class="c1"># Calculate value under MPE and CR economy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_θ</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">θ_array</span><span class="p">:</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">θ_array</span><span class="p">])</span> \
                                   <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="n">θ_array</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">V_θ</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">θ</span><span class="p">:</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">u0</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">u1</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">α</span> <span class="o">*</span> <span class="n">θ</span><span class="p">)</span>
                              <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">u2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">α</span> <span class="o">*</span> <span class="n">θ</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> 
                              <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">c</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">θ</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">J_MPE</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_θ</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">μ_MPE</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_CR</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">V_θ</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">μ_CR</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simulate_ramsey_plan</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Simulate Ramsey plan for large number of periods</span>
        <span class="n">θ_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)),</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">))))</span>
        <span class="n">μ_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">J_series</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="n">θ_series</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">θ_R</span>
        <span class="p">[</span><span class="n">μ_series</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">θ_series</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="n">J_series</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_θ</span><span class="p">(</span><span class="n">θ_series</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">):</span>
            <span class="n">θ_series</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cl_mat</span> <span class="o">@</span> <span class="n">θ_series</span><span class="p">[:,</span> <span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="p">[</span><span class="n">μ_series</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">@</span> <span class="n">θ_series</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>
            <span class="n">J_series</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_θ</span><span class="p">(</span><span class="n">θ_series</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">J_series</span> <span class="o">=</span> <span class="n">J_series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">μ_series</span> <span class="o">=</span> <span class="n">μ_series</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_series</span> <span class="o">=</span> <span class="n">θ_series</span>

    <span class="k">def</span> <span class="nf">compute_θ_range</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Find the range of θ in Ramsey plan</span>
        <span class="n">θ_LB</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">θ_series</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">θ_B</span><span class="p">)</span>
        <span class="n">θ_UB</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">θ_series</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]),</span> <span class="bp">self</span><span class="o">.</span><span class="n">θ_MPE</span><span class="p">)</span>
        <span class="n">θ_range</span> <span class="o">=</span> <span class="n">θ_UB</span> <span class="o">-</span> <span class="n">θ_LB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_LB</span> <span class="o">=</span> <span class="n">θ_LB</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">θ_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_UB</span> <span class="o">=</span> <span class="n">θ_UB</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="n">θ_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_range</span> <span class="o">=</span> <span class="n">θ_range</span>

    <span class="k">def</span> <span class="nf">compute_value_and_policy</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>        
        <span class="c1"># Create the θ_space</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">θ_LB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">θ_UB</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
        
        <span class="c1"># Find value function and policy functions over range of θ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">J_θ</span><span class="p">(</span><span class="n">θ</span><span class="p">)</span> <span class="k">for</span> <span class="n">θ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">θ_space</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">μ_space</span> <span class="o">=</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">θ_space</span><span class="p">))</span>
        <span class="n">x_prime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cl_mat</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">200</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">θ_space</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">θ_prime</span> <span class="o">=</span> <span class="n">x_prime</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">CR_space</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">V_θ</span><span class="p">(</span><span class="n">θ</span><span class="p">)</span> <span class="k">for</span> <span class="n">θ</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">θ_space</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">μ_space</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">μ_space</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span>
        
        <span class="c1"># Calculate J_range, J_LB, and J_UB</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J_space</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_LB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J_space</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_range</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">J_UB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">J_space</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.05</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">J_range</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>Now we compute the value of <span class="math notranslate nohighlight">\(V\)</span> under this setup, and compare it against those obtained in this section <a class="reference internal" href="calvo.html#compute-lq"><span class="std std-ref">Outcomes under Three Timing Protocols</span></a> of the sister quantecon lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Assume β=0.85, c=2, T=40.</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">clq</span> <span class="o">=</span> <span class="n">ChangLQ</span><span class="p">(</span><span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">compute_θ</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">α</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">λ</span> <span class="o">=</span> <span class="n">α</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">α</span><span class="p">)</span>
    <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">μ</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">μbar</span> <span class="o">=</span> <span class="n">μ</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Create an array of powers for λ</span>
    <span class="n">λ_powers</span> <span class="o">=</span> <span class="n">λ</span> <span class="o">**</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Compute the weighted sums for all t</span>
    <span class="n">weighted_sums</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
        <span class="p">[</span><span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">λ_powers</span><span class="p">[:</span><span class="n">T</span><span class="o">-</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">μ</span><span class="p">[</span><span class="n">t</span><span class="p">:</span><span class="n">T</span><span class="p">])</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="p">)])</span>
    
    <span class="c1"># Compute θ values except for the last element</span>
    <span class="n">θ</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">λ</span><span class="p">)</span> <span class="o">*</span> <span class="n">weighted_sums</span> <span class="o">+</span> <span class="n">λ</span><span class="o">**</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">))</span> <span class="o">*</span> <span class="n">μbar</span>
    
    <span class="c1"># Set the last element</span>
    <span class="n">θ</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span> <span class="n">μbar</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">θ</span>

<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">compute_hs</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">α</span><span class="p">):</span>
    <span class="n">h0</span> <span class="o">=</span> <span class="n">u0</span>
    <span class="n">h1</span> <span class="o">=</span> <span class="o">-</span><span class="n">u1</span> <span class="o">*</span> <span class="n">α</span>
    <span class="n">h2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">u2</span> <span class="o">*</span> <span class="n">α</span><span class="o">**</span><span class="mi">2</span>
    
    <span class="k">return</span> <span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span>
    
<span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">compute_V</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">α</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">θ</span> <span class="o">=</span> <span class="n">compute_θ</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">α</span><span class="p">)</span>
    
    <span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">compute_hs</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">α</span><span class="p">)</span>
    
    <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">μ</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    
    <span class="c1"># Compute sum except for the last element</span>
    <span class="n">V_sum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">β</span><span class="o">**</span><span class="n">t</span> <span class="o">*</span> <span class="p">(</span><span class="n">h0</span> <span class="o">+</span> <span class="n">h1</span> <span class="o">*</span> <span class="n">θ</span><span class="p">[:</span><span class="n">T</span><span class="p">]</span> <span class="o">+</span> <span class="n">h2</span> <span class="o">*</span> <span class="n">θ</span><span class="p">[:</span><span class="n">T</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">μ</span><span class="p">[:</span><span class="n">T</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
    
    <span class="c1"># Compute the final term</span>
    <span class="n">V_final</span> <span class="o">=</span> <span class="p">(</span><span class="n">β</span><span class="o">**</span><span class="n">T</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">h0</span> <span class="o">+</span> <span class="n">h1</span> <span class="o">*</span> <span class="n">μ</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">h2</span> <span class="o">*</span> <span class="n">μ</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">μ</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">V</span> <span class="o">=</span> <span class="n">V_sum</span> <span class="o">+</span> <span class="n">V_final</span>
    
    <span class="k">return</span> <span class="n">V</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V_val</span> <span class="o">=</span> <span class="n">compute_V</span><span class="p">(</span><span class="n">clq</span><span class="o">.</span><span class="n">μ_series</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># Check the result with the ChangLQ class in previous lecture</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;deviation = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">V_val</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">clq</span><span class="o">.</span><span class="n">J_series</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span> <span class="c1"># good!</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>deviation = 1.430511474609375e-06
</pre></div>
</div>
</div>
</div>
<p>Now we want to maximize the function <span class="math notranslate nohighlight">\(V\)</span> by choice of <span class="math notranslate nohighlight">\(\mu\)</span>.</p>
<p>We will use the <a class="reference external" href="https://optax.readthedocs.io/en/latest/api/optimizers.html#optax.adam"><code class="docutils literal notranslate"><span class="pre">optax.adam</span></code></a> from the <code class="docutils literal notranslate"><span class="pre">optax</span></code> library.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">adam_optimizer</span><span class="p">(</span><span class="n">grad_func</span><span class="p">,</span> <span class="n">init_params</span><span class="p">,</span> 
                   <span class="n">lr</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> 
                   <span class="n">max_iter</span><span class="o">=</span><span class="mi">10_000</span><span class="p">,</span> 
                   <span class="n">error_tol</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">):</span>

    <span class="c1"># Set initial parameters and optimizer</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">init_params</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">adam</span><span class="p">(</span><span class="n">learning_rate</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
    <span class="n">opt_state</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>

    <span class="c1"># Update parameters and gradients</span>
    <span class="nd">@jit</span>
    <span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">):</span>
        <span class="n">grads</span> <span class="o">=</span> <span class="n">grad_func</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
        <span class="n">updates</span><span class="p">,</span> <span class="n">opt_state</span> <span class="o">=</span> <span class="n">optimizer</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">grads</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">)</span>
        <span class="n">params</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">apply_updates</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">updates</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">params</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">,</span> <span class="n">grads</span>

    <span class="c1"># Gradient descent loop</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_iter</span><span class="p">):</span>
        <span class="n">params</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">,</span> <span class="n">grads</span> <span class="o">=</span> <span class="n">update</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">opt_state</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">grads</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">error_tol</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Converged after </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2"> iterations.&quot;</span><span class="p">)</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">100</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span> 
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Iteration </span><span class="si">{</span><span class="n">i</span><span class="si">}</span><span class="s2">, grad norm: </span><span class="si">{</span><span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">grads</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">params</span>
</pre></div>
</div>
</div>
</div>
<p>Here we use automatic differentiation functionality in JAX with <code class="docutils literal notranslate"><span class="pre">grad</span></code>.</p>
<div class="cell tag_scroll-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initial guess for μ</span>
<span class="n">μ_init</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="c1"># Maximization instead of minimization</span>
<span class="n">grad_V</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">μ</span><span class="p">:</span> <span class="o">-</span><span class="n">compute_V</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="c1"># Optimize μ</span>
<span class="n">optimized_μ</span> <span class="o">=</span> <span class="n">adam_optimizer</span><span class="p">(</span><span class="n">grad_V</span><span class="p">,</span> <span class="n">μ_init</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;optimized μ = </span><span class="se">\n</span><span class="si">{</span><span class="n">optimized_μ</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iteration 0, grad norm: 0.8627105951309204
Iteration 100, grad norm: 0.0033030672930181026
Iteration 200, grad norm: 1.701549808785785e-05
Converged after 277 iterations.
optimized μ = 
[-0.06450703 -0.09033976 -0.10068483 -0.10482766 -0.10648672 -0.10715112
 -0.10741719 -0.10752375 -0.10756642 -0.10758351 -0.10759035 -0.10759308
 -0.10759415 -0.10759459 -0.10759478 -0.10759482 -0.10759486 -0.10759486
 -0.10759486 -0.10759488 -0.10759487 -0.10759485 -0.10759488 -0.10759489
 -0.1075949  -0.10759487 -0.10759488 -0.10759488 -0.10759488 -0.10759489
 -0.10759491 -0.10759493 -0.10759494 -0.10759497 -0.10759497 -0.10759496
 -0.10759496 -0.10759495 -0.10759496 -0.10759499]
CPU times: user 782 ms, sys: 96.7 ms, total: 879 ms
Wall time: 643 ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;original μ = </span><span class="se">\n</span><span class="si">{</span><span class="n">clq</span><span class="o">.</span><span class="n">μ_series</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>original μ = 
[-0.06450708 -0.09033982 -0.10068489 -0.10482772 -0.10648677 -0.10715115
 -0.10741722 -0.10752377 -0.10756644 -0.10758352 -0.10759037 -0.10759311
 -0.1075942  -0.10759464 -0.10759482 -0.10759489 -0.10759492 -0.10759493
 -0.10759493 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494
 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494
 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494
 -0.10759494 -0.10759494 -0.10759494 -0.10759494]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;deviation = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">optimized_μ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">clq</span><span class="o">.</span><span class="n">μ_series</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>deviation = 2.9737057616330276e-07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_V</span><span class="p">(</span><span class="n">optimized_μ</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array(6.8357825, dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_V</span><span class="p">(</span><span class="n">clq</span><span class="o">.</span><span class="n">μ_series</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array(6.835783, dtype=float32)
</pre></div>
</div>
</div>
</div>
</section>
<section id="restricting-mu-t-bar-mu-for-all-t">
<h3><span class="section-number">41.6.2. </span>Restricting  <span class="math notranslate nohighlight">\(\mu_t = \bar \mu\)</span> for all <span class="math notranslate nohighlight">\(t\)</span><a class="headerlink" href="#restricting-mu-t-bar-mu-for-all-t" title="Permalink to this heading">#</a></h3>
<p>We take  a brief detour to solve a restricted version of  the Ramsey problem defined above.</p>
<p>First, recall that a Ramsey planner chooses <span class="math notranslate nohighlight">\(\vec \mu\)</span> to maximize the government’s value function <a class="reference internal" href="#equation-eq-ramseyvalue">(41.9)</a> subject to equations  <a class="reference internal" href="#equation-eq-inflation101">(41.8)</a>.</p>
<p>We now define a distinct problem in which the planner chooses <span class="math notranslate nohighlight">\(\vec \mu\)</span> to maximize the government’s value function <a class="reference internal" href="#equation-eq-ramseyvalue">(41.9)</a> subject to equation  <a class="reference internal" href="#equation-eq-inflation101">(41.8)</a> and
the additional restriction that  <span class="math notranslate nohighlight">\(\mu_t = \bar \mu\)</span> for all <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>The solution of this problem is a time-invariant <span class="math notranslate nohighlight">\(\mu_t\)</span> that this quantecon lecture  <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a> calls <span class="math notranslate nohighlight">\(\mu^{CR}\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initial guess for single μ</span>
<span class="n">μ_init</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># Maximization instead of minimization</span>
<span class="n">grad_V</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">μ</span><span class="p">:</span> <span class="o">-</span><span class="n">compute_V</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>

<span class="c1"># Optimize μ</span>
<span class="n">optimized_μ_CR</span> <span class="o">=</span> <span class="n">adam_optimizer</span><span class="p">(</span><span class="n">grad_V</span><span class="p">,</span> <span class="n">μ_init</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;optimized μ = </span><span class="se">\n</span><span class="si">{</span><span class="n">optimized_μ_CR</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iteration 0, grad norm: 3.333333969116211
Iteration 100, grad norm: 0.0049784183502197266
Iteration 200, grad norm: 6.771087646484375e-05
Converged after 282 iterations.
optimized μ = 
[-0.10000004]
</pre></div>
</div>
</div>
</div>
<p>Comparing it to <span class="math notranslate nohighlight">\(\mu^{CR}\)</span> in <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>, we again obtained very close answers.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">clq</span><span class="o">.</span><span class="n">μ_CR</span> <span class="o">-</span> <span class="n">optimized_μ_CR</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.7252903e-08
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V_CR</span> <span class="o">=</span> <span class="n">compute_V</span><span class="p">(</span><span class="n">optimized_μ_CR</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">V_CR</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array(6.8333354, dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_V</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">clq</span><span class="o">.</span><span class="n">μ_CR</span><span class="p">]),</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array(6.8333344, dtype=float32)
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="a-more-structured-ml-algorithm">
<h2><span class="section-number">41.7. </span>A More Structured ML Algorithm<a class="headerlink" href="#a-more-structured-ml-algorithm" title="Permalink to this heading">#</a></h2>
<p>By thinking  about the mathematical structure of the Ramsey problem and using some linear algebra, we can simplify the problem that we hand over to a <code class="docutils literal notranslate"><span class="pre">machine</span> <span class="pre">learning</span></code> algorithm.</p>
<p>We start by recalling that  the Ramsey problem that chooses  <span class="math notranslate nohighlight">\(\vec \mu\)</span> to maximize the government’s value function <a class="reference internal" href="#equation-eq-ramseyvalue">(41.9)</a>subject to equation  <a class="reference internal" href="#equation-eq-inflation101">(41.8)</a>.</p>
<p>This  turns out to be  an optimization  problem with a quadratic objective function and linear constraints.</p>
<p>First-order conditions for this problem are a set of simultaneous linear equations in <span class="math notranslate nohighlight">\(\vec \mu\)</span>.</p>
<p>If we trust that the second-order conditions for a maximum are also satisfied (they are in our problem),
we can compute the Ramsey plan by solving these equations for <span class="math notranslate nohighlight">\(\vec \mu\)</span>.</p>
<p>We’ll apply this approach here and compare answers with what we obtained above with the gradient descent approach.</p>
<p>To remind us of the setting, remember that we have assumed that</p>
<div class="math notranslate nohighlight">
\[ 
\mu_t = \mu_T \;  \forall t \geq T
\]</div>
<p>and that</p>
<div class="math notranslate nohighlight">
\[ 
\theta_t = \theta_T = \mu_T \ \forall t \geq T
\]</div>
<p>Again, define</p>
<div class="math notranslate nohighlight">
\[
\vec \theta = \begin{bmatrix} \theta_0 \cr
           \theta_1 \cr
           \vdots \cr
           \theta_{T-1} \cr
           \theta_T \end{bmatrix} , \quad
\vec \mu = \begin{bmatrix} \mu_0 \cr
           \mu_1 \cr
           \vdots \cr
           \mu_{T-1} \cr
           \mu_T \end{bmatrix}
\]</div>
<p>Write the  system of <span class="math notranslate nohighlight">\(T+1\)</span> equations <a class="reference internal" href="#equation-eq-thetaformula102">(41.10)</a>
that relate  <span class="math notranslate nohighlight">\(\vec \theta\)</span> to a choice of <span class="math notranslate nohighlight">\(\vec \mu\)</span>   as the single matrix equation</p>
<div class="math notranslate nohighlight">
\[
\frac{1}{(1 - \lambda)}
\begin{bmatrix} 1 &amp; -\lambda &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; 0 \cr
                0 &amp; 1 &amp; -\lambda &amp; 0 &amp; \cdots &amp; 0 &amp; 0 \cr
                0 &amp; 0 &amp; 1 &amp; -\lambda &amp; \cdots &amp; 0 &amp; 0 \cr
                \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; \vdots &amp; -\lambda &amp; 0 \cr
                0 &amp; 0 &amp; 0 &amp; 0 &amp; \cdots &amp; 1 &amp; -\lambda \cr
                0 &amp; 0 &amp; 0 &amp; 0 &amp; \cdots &amp; 0 &amp; 1-\lambda \end{bmatrix}
\begin{bmatrix} \theta_0 \cr \theta_1 \cr \theta_2 \cr \vdots \cr \theta_{T-1} \cr \theta_T 
\end{bmatrix} 
= \begin{bmatrix} 
\mu_0 \cr \mu_1 \cr \mu_2 \cr \vdots \cr \mu_{T-1} \cr \mu_T
\end{bmatrix}
\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[
A \vec \theta = \vec \mu
\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[
\vec \theta = B \vec \mu 
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[ 
B = A^{-1}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">construct_B</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
    <span class="n">λ</span> <span class="o">=</span> <span class="n">α</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">α</span><span class="p">)</span>
    
    <span class="n">A</span> <span class="o">=</span> <span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">λ</span><span class="o">*</span><span class="n">jnp</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">λ</span><span class="p">)</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">A</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">λ</span><span class="p">))</span>

    <span class="n">B</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">construct_B</span><span class="p">(</span><span class="n">α</span><span class="o">=</span><span class="n">clq</span><span class="o">.</span><span class="n">α</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;A = </span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">A</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>A = 
 [[ 2. -1.  0. ...  0.  0.  0.]
 [ 0.  2. -1. ...  0.  0.  0.]
 [ 0.  0.  2. ...  0.  0.  0.]
 ...
 [ 0.  0.  0. ...  2. -1.  0.]
 [ 0.  0.  0. ...  0.  2. -1.]
 [ 0.  0.  0. ...  0.  0.  1.]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute θ using optimized_μ</span>
<span class="n">θs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">compute_θ</span><span class="p">(</span><span class="n">optimized_μ</span><span class="p">))</span>
<span class="n">μs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimized_μ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">allclose</span><span class="p">(</span><span class="n">θs</span><span class="p">,</span> <span class="n">B</span> <span class="o">@</span> <span class="n">clq</span><span class="o">.</span><span class="n">μ_series</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<p>As before, the Ramsey planner’s criterion is</p>
<div class="math notranslate nohighlight">
\[
V = \sum_{t=0}^\infty \beta^t (h_0 + h_1 \theta_t + h_2 \theta_t^2 -
\frac{c}{2} \mu_t^2 )
\]</div>
<p>With our assumption above, criterion <span class="math notranslate nohighlight">\(V\)</span> can be rewritten as</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
V &amp; = \sum_{t=0}^{T-1} \beta^t (h_0 + h_1 \theta_t + h_2 \theta_t^2 -
\frac{c}{2} \mu_t^2 ) \cr 
&amp; + \frac{\beta^T}{1-\beta} (h_0 + h_1 \theta_T + h_2 \theta_T^2 -
\frac{c}{2} \mu_T^2 )
\end{aligned}
\]</div>
<p>To help us write <span class="math notranslate nohighlight">\(V\)</span> as a quadratic plus affine form, define</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\vec{\beta} = \begin{bmatrix} 1 \\ 
              \beta \\ \vdots \\ 
              \beta^{T-1} \\ 
              \frac{\beta^T}{1-\beta} \end{bmatrix}
\end{split}\]</div>
<p>Then we have:</p>
<div class="math notranslate nohighlight">
\[
h_1 \sum_{t=0}^\infty \beta^t \theta_t = h_1 \cdot \vec{\beta}^T \vec{\theta} = (h_1 \cdot B^T \vec{\beta})^T \vec{\mu} = g^T \vec{\mu}
\]</div>
<p>where <span class="math notranslate nohighlight">\(g = h_1 \cdot B^T \vec{\beta}\)</span> is a <span class="math notranslate nohighlight">\((T+1) \times 1\)</span> vector,</p>
<div class="math notranslate nohighlight">
\[
h_2 \sum_{t=0}^\infty \beta^t \theta_t^2 = \vec{\mu}^T (B^T (h_2 \cdot \vec{\beta} \cdot \mathbf{I}) B) \vec{\mu} = \vec{\mu}^T M \vec{\mu}
\]</div>
<p>where <span class="math notranslate nohighlight">\(M = B^T (h_2 \cdot \vec{\beta} \cdot \mathbf{I}) B\)</span> is a <span class="math notranslate nohighlight">\((T+1) \times (T+1)\)</span> matrix,</p>
<div class="math notranslate nohighlight">
\[
\frac{c}{2} \sum_{t=0}^\infty \beta^t \mu_t^2 =  \vec{\mu}^T (\frac{c}{2} \cdot \vec{\beta} \cdot \mathbf{I}) \vec{\mu} = \vec{\mu}^T F \vec{\mu}
\]</div>
<p>where <span class="math notranslate nohighlight">\(F = \frac{c}{2} \cdot \vec{\beta} \cdot \mathbf{I}\)</span> is a <span class="math notranslate nohighlight">\((T+1) \times (T+1)\)</span> matrix</p>
<p>It follows that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
J = V - h_0 &amp;= \sum_{t=0}^\infty \beta^t (h_1 \theta_t + h_2 \theta_t^2 - \frac{c}{2} \mu_t^2) \\
            &amp;= g^T \vec{\mu} + \vec{\mu}^T M \vec{\mu} - \vec{\mu}^T F \vec{\mu} \\ 
            &amp;= g^T \vec{\mu} + \vec{\mu}^T (M - F) \vec{\mu} \\
            &amp;= g^T \vec{\mu} + \vec{\mu}^T G \vec{\mu}
\end{aligned}
\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(G = M - F\)</span>.</p>
<p>To compute the optimal government plan we want to maximize <span class="math notranslate nohighlight">\(J\)</span> with respect to <span class="math notranslate nohighlight">\(\vec \mu\)</span>.</p>
<p>We use linear algebra formulas for differentiating linear and quadratic forms to compute the gradient of <span class="math notranslate nohighlight">\(J\)</span> with respect to <span class="math notranslate nohighlight">\(\vec \mu\)</span></p>
<div class="math notranslate nohighlight">
\[
\frac{\partial}{\partial \vec{\mu}} J = g + 2 G \vec{\mu}.
\]</div>
<p>Setting <span class="math notranslate nohighlight">\(\frac{\partial}{\partial \vec{\mu}} J = 0\)</span>, the maximizing <span class="math notranslate nohighlight">\(\mu\)</span> is</p>
<div class="math notranslate nohighlight">
\[
\vec \mu^R = -\frac{1}{2}G^{-1}  g
\]</div>
<p>The associated optimal inflation sequence is</p>
<div class="math notranslate nohighlight">
\[
\vec \theta^{R} = B \vec \mu^R
\]</div>
<section id="two-implementations">
<h3><span class="section-number">41.7.1. </span>Two implementations<a class="headerlink" href="#two-implementations" title="Permalink to this heading">#</a></h3>
<p>With the more structured approach, we can update our gradient descent exercise with <code class="docutils literal notranslate"><span class="pre">compute_J</span></code></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_J</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">α</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">μ</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    
    <span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">compute_hs</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">α</span><span class="p">)</span>
    <span class="n">λ</span> <span class="o">=</span> <span class="n">α</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">α</span><span class="p">)</span>
    
    <span class="n">_</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">construct_B</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">β_vec</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">β</span><span class="o">**</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">β</span><span class="o">**</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">β</span><span class="p">))])</span>
    
    <span class="n">θ</span> <span class="o">=</span> <span class="n">B</span> <span class="o">@</span> <span class="n">μ</span>
    <span class="n">βθ_sum</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">β_vec</span> <span class="o">*</span> <span class="n">h1</span><span class="p">)</span> <span class="o">*</span> <span class="n">θ</span><span class="p">)</span>
    <span class="n">βθ_square_sum</span> <span class="o">=</span> <span class="n">β_vec</span> <span class="o">*</span> <span class="n">h2</span> <span class="o">*</span> <span class="n">θ</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">θ</span>
    <span class="n">βμ_square_sum</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">c</span> <span class="o">*</span> <span class="n">β_vec</span> <span class="o">*</span> <span class="n">μ</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">μ</span>
    
    <span class="k">return</span> <span class="n">βθ_sum</span> <span class="o">+</span> <span class="n">βθ_square_sum</span> <span class="o">-</span> <span class="n">βμ_square_sum</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initial guess for μ</span>
<span class="n">μ_init</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="c1"># Maximization instead of minimization</span>
<span class="n">grad_J</span> <span class="o">=</span> <span class="n">jit</span><span class="p">(</span><span class="n">grad</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">μ</span><span class="p">:</span> <span class="o">-</span><span class="n">compute_J</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%time</span>

<span class="c1"># Optimize μ</span>
<span class="n">optimized_μ</span> <span class="o">=</span> <span class="n">adam_optimizer</span><span class="p">(</span><span class="n">grad_J</span><span class="p">,</span> <span class="n">μ_init</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;optimized μ = </span><span class="se">\n</span><span class="si">{</span><span class="n">optimized_μ</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Iteration 0, grad norm: 0.8627105951309204
Iteration 100, grad norm: 0.003303033299744129
Iteration 200, grad norm: 1.6926183889154345e-05
Converged after 280 iterations.
optimized μ = 
[-0.06450712 -0.09033988 -0.10068493 -0.10482774 -0.1064868  -0.1071512
 -0.10741723 -0.10752378 -0.10756644 -0.10758355 -0.10759039 -0.10759313
 -0.10759424 -0.10759471 -0.10759488 -0.10759497 -0.10759498 -0.10759498
 -0.10759498 -0.10759497 -0.10759494 -0.10759497 -0.10759496 -0.10759497
 -0.10759497 -0.10759498 -0.107595   -0.10759494 -0.10759496 -0.10759496
 -0.10759494 -0.10759493 -0.10759493 -0.10759494 -0.10759494 -0.10759495
 -0.10759497 -0.107595   -0.10759497 -0.10759495]
CPU times: user 360 ms, sys: 111 ms, total: 471 ms
Wall time: 196 ms
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;original μ = </span><span class="se">\n</span><span class="si">{</span><span class="n">clq</span><span class="o">.</span><span class="n">μ_series</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>original μ = 
[-0.06450708 -0.09033982 -0.10068489 -0.10482772 -0.10648677 -0.10715115
 -0.10741722 -0.10752377 -0.10756644 -0.10758352 -0.10759037 -0.10759311
 -0.1075942  -0.10759464 -0.10759482 -0.10759489 -0.10759492 -0.10759493
 -0.10759493 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494
 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494
 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494 -0.10759494
 -0.10759494 -0.10759494 -0.10759494 -0.10759494]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;deviation = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">optimized_μ</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">clq</span><span class="o">.</span><span class="n">μ_series</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>deviation = 2.3748542332668876e-07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">V_R</span> <span class="o">=</span> <span class="n">compute_V</span><span class="p">(</span><span class="n">optimized_μ</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">V_R</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array(6.8357825, dtype=float32)
</pre></div>
</div>
</div>
</div>
<p>We find that by exploiting more knowledge about  the structure of the problem, we can significantly speed up our computation.</p>
<p>We can also derive a closed-form solution for <span class="math notranslate nohighlight">\(\vec \mu\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_μ</span><span class="p">(</span><span class="n">β</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">α</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>    
    <span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">compute_hs</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">α</span><span class="p">)</span>
    
    <span class="n">_</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">construct_B</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">β_vec</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">β</span><span class="o">**</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">β</span><span class="o">**</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">β</span><span class="p">))])</span>
    
    <span class="n">g</span> <span class="o">=</span> <span class="n">h1</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">β_vec</span>
    <span class="n">M</span> <span class="o">=</span> <span class="n">B</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">h2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">β_vec</span><span class="p">))</span> <span class="o">@</span> <span class="n">B</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">β_vec</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">F</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span><span class="p">,</span> <span class="o">-</span><span class="n">g</span><span class="p">)</span>

<span class="n">μ_closed</span> <span class="o">=</span> <span class="n">compute_μ</span><span class="p">(</span><span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;closed-form μ = </span><span class="se">\n</span><span class="si">{</span><span class="n">μ_closed</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>closed-form μ = 
[-0.0645071  -0.09033982 -0.1006849  -0.1048277  -0.10648677 -0.10715113
 -0.10741723 -0.10752378 -0.10756643 -0.10758351 -0.10759034 -0.10759313
 -0.10759421 -0.10759464 -0.10759482 -0.1075949  -0.10759489 -0.10759492
 -0.10759492 -0.10759491 -0.10759495 -0.10759494 -0.10759495 -0.10759493
 -0.10759491 -0.10759491 -0.10759494 -0.10759491 -0.10759491 -0.10759495
 -0.10759498 -0.10759492 -0.10759494 -0.10759485 -0.10759497 -0.10759495
 -0.10759493 -0.10759494 -0.10759498 -0.10759494]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;deviation = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">μ_closed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">clq</span><span class="o">.</span><span class="n">μ_series</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>deviation = 1.47137171779832e-07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">compute_V</span><span class="p">(</span><span class="n">μ_closed</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array(6.835783, dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;deviation = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">B</span><span class="w"> </span><span class="o">@</span><span class="w"> </span><span class="n">μ_closed</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">θs</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>deviation = 2.6541223974163586e-07
</pre></div>
</div>
</div>
</div>
<p>We can check the gradient of the analytical solution against the <code class="docutils literal notranslate"><span class="pre">JAX</span></code> computed version</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_grad</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">α</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>    
    <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">μ</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    
    <span class="n">h0</span><span class="p">,</span> <span class="n">h1</span><span class="p">,</span> <span class="n">h2</span> <span class="o">=</span> <span class="n">compute_hs</span><span class="p">(</span><span class="n">u0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">α</span><span class="p">)</span>
    
    <span class="n">_</span><span class="p">,</span> <span class="n">B</span> <span class="o">=</span> <span class="n">construct_B</span><span class="p">(</span><span class="n">α</span><span class="p">,</span> <span class="n">T</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">β_vec</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">β</span><span class="o">**</span><span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">),</span>
                       <span class="p">(</span><span class="n">β</span><span class="o">**</span><span class="n">T</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">β</span><span class="p">))])</span>
    
    <span class="n">g</span> <span class="o">=</span> <span class="n">h1</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">β_vec</span>
    <span class="n">M</span> <span class="o">=</span> <span class="p">(</span><span class="n">h2</span> <span class="o">*</span> <span class="n">B</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">β_vec</span><span class="p">)</span> <span class="o">@</span> <span class="n">B</span><span class="p">)</span>
    <span class="n">F</span> <span class="o">=</span> <span class="n">c</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">β_vec</span><span class="p">)</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">M</span> <span class="o">-</span> <span class="n">F</span>
    <span class="k">return</span> <span class="n">g</span> <span class="o">+</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">G</span> <span class="o">@</span> <span class="n">μ</span><span class="p">)</span>

<span class="n">closed_grad</span> <span class="o">=</span> <span class="n">compute_grad</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">closed_grad</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array([-3.75      , -4.0625    , -3.8906252 , -3.5257816 , -3.1062894 ,
       -2.6950336 , -2.3181221 , -1.9840758 , -1.6933005 , -1.4427234 ,
       -1.2280239 , -1.0446749 , -0.8884009 , -0.7553544 , -0.64215815,
       -0.5458878 , -0.46403134, -0.39444   , -0.33528066, -0.28499195,
       -0.24224481, -0.20590894, -0.17502302, -0.14876978, -0.12645441,
       -0.10748631, -0.09136339, -0.0776589 , -0.06601007, -0.05610856,
       -0.04769228, -0.04053844, -0.03445768, -0.02928903, -0.02489567,
       -0.02116132, -0.01798713, -0.01528906, -0.0129957 , -0.07364222],      dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">grad_J</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Array([-3.75      , -4.0625    , -3.890625  , -3.5257816 , -3.1062894 ,
       -2.6950336 , -2.3181224 , -1.9840759 , -1.6933005 , -1.4427235 ,
       -1.228024  , -1.0446749 , -0.8884009 , -0.7553544 , -0.6421581 ,
       -0.54588777, -0.46403137, -0.39444   , -0.33528066, -0.28499192,
       -0.24224481, -0.20590894, -0.175023  , -0.14876977, -0.12645441,
       -0.10748631, -0.0913634 , -0.0776589 , -0.06601007, -0.05610857,
       -0.04769228, -0.04053844, -0.03445768, -0.02928903, -0.02489568,
       -0.02116132, -0.01798712, -0.01528906, -0.0129957 , -0.07364222],      dtype=float32)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;deviation = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">closed_grad</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="p">(</span><span class="o">-</span><span class="w"> </span><span class="n">grad_J</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">))))</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>deviation = 4.074267394571507e-07
</pre></div>
</div>
</div>
</div>
<p>Let’s  plot the Ramsey plan’s <span class="math notranslate nohighlight">\(\mu_t\)</span> and <span class="math notranslate nohighlight">\(\theta_t\)</span> for <span class="math notranslate nohighlight">\(t =0, \ldots, T\)</span>  against <span class="math notranslate nohighlight">\(t\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute θ using optimized_μ</span>
<span class="n">θs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">compute_θ</span><span class="p">(</span><span class="n">optimized_μ</span><span class="p">))</span>
<span class="n">μs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">optimized_μ</span><span class="p">)</span>

<span class="c1"># Plot the two sequences</span>
<span class="n">Ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">μs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mu_t$&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">θs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\theta_t$&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d8947c985ea623feb51742d77279ee2be190c02743e7c30244bc0c1b9faea89b.png" src="_images/d8947c985ea623feb51742d77279ee2be190c02743e7c30244bc0c1b9faea89b.png" />
</div>
</div>
<p>Note that while <span class="math notranslate nohighlight">\(\theta_t\)</span>  is less than <span class="math notranslate nohighlight">\(\mu_t\)</span>for low <span class="math notranslate nohighlight">\(t\)</span>’s, it eventually converges to
the  limit <span class="math notranslate nohighlight">\(\bar \mu\)</span> of  <span class="math notranslate nohighlight">\(\mu_t\)</span> as <span class="math notranslate nohighlight">\(t \rightarrow +\infty\)</span>.</p>
<p>This pattern reflects how formula <a class="reference internal" href="#equation-eq-grad-old3">(41.3)</a>  makes <span class="math notranslate nohighlight">\(\theta_t\)</span> be a weighted average of future <span class="math notranslate nohighlight">\(\mu_t\)</span>’s.</p>
</section>
</section>
<section id="continuation-values">
<h2><span class="section-number">41.8. </span>Continuation Values<a class="headerlink" href="#continuation-values" title="Permalink to this heading">#</a></h2>
<p>For subsquent analysis, it will be useful to  compute a sequence <span class="math notranslate nohighlight">\(\{v_t\}_{t=0}^T\)</span> of  what we’ll call <code class="docutils literal notranslate"><span class="pre">continuation</span> <span class="pre">values</span></code> along a Ramsey plan.</p>
<p>To do so, we’ll start at date <span class="math notranslate nohighlight">\(T\)</span> and compute</p>
<div class="math notranslate nohighlight">
\[
v_T = \frac{1}{1-\beta} s(\bar \mu, \bar \mu).
\]</div>
<p>Then starting from <span class="math notranslate nohighlight">\(t=T-1\)</span>, we’ll iterate backwards on the recursion</p>
<div class="math notranslate nohighlight">
\[
v_t = s(\theta_t, \mu_t) + \beta v_{t+1}
\]</div>
<p>for <span class="math notranslate nohighlight">\(t= T-1, T-2, \ldots, 0.\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Define function for s and U in section 41.3</span>
<span class="k">def</span> <span class="nf">s</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span> <span class="n">μ</span><span class="p">,</span> <span class="n">u0</span><span class="p">,</span> <span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="p">,</span> <span class="n">α</span><span class="p">,</span> <span class="n">c</span><span class="p">):</span>
    <span class="n">U</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">u0</span> <span class="o">+</span> <span class="n">u1</span> <span class="o">*</span> <span class="n">x</span> <span class="o">-</span> <span class="p">(</span><span class="n">u2</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">x</span><span class="o">**</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">U</span><span class="p">(</span><span class="o">-</span><span class="n">α</span><span class="o">*</span><span class="n">θ</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="n">c</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">μ</span><span class="o">**</span><span class="mi">2</span>

<span class="c1"># Calculate v_t sequence backward</span>
<span class="k">def</span> <span class="nf">compute_vt</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">u0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">α</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">T</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">μs</span><span class="p">)</span>
    <span class="n">θ</span> <span class="o">=</span> <span class="n">compute_θ</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">α</span><span class="p">)</span>
    
    <span class="n">v_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>
    <span class="n">μ_bar</span> <span class="o">=</span> <span class="n">μs</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Reduce parameters</span>
    <span class="n">s_p</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">θ</span><span class="p">,</span> <span class="n">μ</span><span class="p">:</span> <span class="n">s</span><span class="p">(</span><span class="n">θ</span><span class="p">,</span> <span class="n">μ</span><span class="p">,</span> 
                       <span class="n">u0</span><span class="o">=</span><span class="n">u0</span><span class="p">,</span> <span class="n">u1</span><span class="o">=</span><span class="n">u1</span><span class="p">,</span> <span class="n">u2</span><span class="o">=</span><span class="n">u2</span><span class="p">,</span> <span class="n">α</span><span class="o">=</span><span class="n">α</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">c</span><span class="p">)</span>
    
    <span class="c1"># Define v_T</span>
    <span class="n">v_t</span><span class="p">[</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">β</span><span class="p">))</span> <span class="o">*</span> <span class="n">s_p</span><span class="p">(</span><span class="n">μ_bar</span><span class="p">,</span> <span class="n">μ_bar</span><span class="p">)</span>
    
    <span class="c1"># Backward iteration</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">T</span><span class="o">-</span><span class="mi">1</span><span class="p">)):</span>
        <span class="n">v_t</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_p</span><span class="p">(</span><span class="n">θ</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">μ</span><span class="p">[</span><span class="n">t</span><span class="p">])</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">v_t</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
        
    <span class="k">return</span> <span class="n">v_t</span>

<span class="n">v_t</span> <span class="o">=</span> <span class="n">compute_vt</span><span class="p">(</span><span class="n">μs</span><span class="p">,</span> <span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The initial continuation  value <span class="math notranslate nohighlight">\(v_0\)</span> should equal the optimized value of the Ramsey planner’s criterion <span class="math notranslate nohighlight">\(V\)</span> defined
in equation <a class="reference internal" href="#equation-eq-ramseyv">(41.6)</a>.</p>
<p>Indeed, we find that the deviation is very small:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;deviation = </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">v_t</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">V_R</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>deviation = 4.76837158203125e-07
</pre></div>
</div>
</div>
</div>
<p>We can also verify approximate equality  by inspecting a graph of <span class="math notranslate nohighlight">\(v_t\)</span> against <span class="math notranslate nohighlight">\(t\)</span> for <span class="math notranslate nohighlight">\(t=0, \ldots, T\)</span> along with the value attained by a restricted Ramsey planner <span class="math notranslate nohighlight">\(V^{CR}\)</span> and the optimized value of the ordinary Ramsey planner <span class="math notranslate nohighlight">\(V^R\)</span></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Plot the scatter plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">Ts</span><span class="p">,</span> <span class="n">v_t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$v_t$&#39;</span><span class="p">)</span>

<span class="c1"># Plot horizontal lines</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">V_CR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">V_R</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># Add labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">Ts</span><span class="p">)</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">Ts</span><span class="p">)</span><span class="o">*</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">V_CR</span><span class="p">,</span> <span class="s1">&#39;$V^</span><span class="si">{CR}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> 
         <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">Ts</span><span class="p">)</span> <span class="o">+</span> <span class="nb">max</span><span class="p">(</span><span class="n">Ts</span><span class="p">)</span><span class="o">*</span><span class="mf">0.07</span><span class="p">,</span> <span class="n">V_R</span><span class="p">,</span> <span class="s1">&#39;$V^R$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> 
         <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$v_t$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<figure class="align-default" id="id8">
<img alt="_images/db60b95af40a9f06acaf60adbfc155cf6932e558b3c7e3b205547732b15db2fb.png" src="_images/db60b95af40a9f06acaf60adbfc155cf6932e558b3c7e3b205547732b15db2fb.png" />
<figcaption>
<p><span class="caption-number">Fig. 41.1 </span><span class="caption-text">Continuation values</span><a class="headerlink" href="#id8" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</div>
</div>
<p>Figure <a class="reference internal" href="#id8"><span class="std std-numref">Fig. 41.1</span></a> shows  interesting patterns:</p>
<ul class="simple">
<li><p>The sequence of continuation values <span class="math notranslate nohighlight">\(\{v_t\}_{t=0}^T\)</span> is monotonically decreasing</p></li>
<li><p>Evidently,  <span class="math notranslate nohighlight">\(v_0 &gt;  V^{CR} &gt; v_T\)</span> so that</p>
<ul>
<li><p>the value <span class="math notranslate nohighlight">\(v_0\)</span> of the ordinary Ramsey plan exceeds the value <span class="math notranslate nohighlight">\(V^{CR}\)</span> of the special Ramsey plan in which the planner is constrained to set <span class="math notranslate nohighlight">\(\mu_t = \mu^{CR}\)</span> for all <span class="math notranslate nohighlight">\(t\)</span>.</p></li>
<li><p>the continuation value <span class="math notranslate nohighlight">\(v_T\)</span> of the ordinary Ramsey plan for <span class="math notranslate nohighlight">\(t \geq T\)</span> is constant and is less than the value <span class="math notranslate nohighlight">\(V^{CR}\)</span> of the special Ramsey plan in which the planner is constrained to set <span class="math notranslate nohighlight">\(\mu_t = \mu^{CR}\)</span> for all <span class="math notranslate nohighlight">\(t\)</span></p></li>
</ul>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The continuation value <span class="math notranslate nohighlight">\(v_T\)</span> is what some researchers call the “value of a Ramsey plan under a
time-less perspective.” A more descriptive phrase is “the value of the worst continuation Ramsey plan.”</p>
</div>
</section>
<section id="adding-some-human-intelligence">
<h2><span class="section-number">41.9. </span>Adding Some Human Intelligence<a class="headerlink" href="#adding-some-human-intelligence" title="Permalink to this heading">#</a></h2>
<p>We have used our machine learning algorithms to compute a Ramsey plan.</p>
<p>By plotting it, we learned that the Ramsey planner makes  <span class="math notranslate nohighlight">\(\vec \mu\)</span> and <span class="math notranslate nohighlight">\(\vec \theta\)</span> both vary over time.</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\vec \theta\)</span> and <span class="math notranslate nohighlight">\(\vec \mu\)</span> both decline monotonically</p></li>
<li><p>both of them converge from above to the same constant <span class="math notranslate nohighlight">\(\vec \mu\)</span></p></li>
</ul>
<p>Hidden from view, there  is a recursive structure in the <span class="math notranslate nohighlight">\(\vec \mu, \vec \theta\)</span> chosen by the Ramsey planner that we want to bring out.</p>
<p>To do so, we’ll have to add some <strong>human intelligence</strong> to the <strong>artificial intelligence</strong> embodied in our machine learning approach.</p>
<p>To proceed, we’ll   compute  least squares linear regressions of some  components of <span class="math notranslate nohighlight">\(\vec \theta\)</span> and <span class="math notranslate nohighlight">\(\vec \mu\)</span> on others.</p>
<p>We hope that these regressions will reveal structure  hidden within the <span class="math notranslate nohighlight">\(\vec \mu^R, \vec \theta^R\)</span> sequences associated with a Ramsey plan.</p>
<p>It is worth pausing  to think about  roles being  played here by  <strong>human</strong> intelligence and <strong>artificial</strong> intelligence.</p>
<p>Artificial intelligence in the form of some Python code and  a computer  is running the regressions for us.</p>
<p>But we are free to  regress anything on anything else.</p>
<p>Human intelligence tells us what regressions to run.</p>
<p>Additional inputs of  human intelligence will be  required fully to appreciate what those regressions  reveal about the structure of a Ramsey plan.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When we eventually get around to trying to understand the regressions below, it will  worthwhile to study  the reasoning that let  Chang <span id="id9">[<a class="reference internal" href="zreferences.html#id216" title="Roberto Chang. Credible monetary policy in an infinite horizon model: recursive approaches. Journal of Economic Theory, 81(2):431–461, 1998.">Chang, 1998</a>]</span> to choose
<span class="math notranslate nohighlight">\(\theta_t\)</span> as his key state variable.</p>
</div>
<p>We begin by regressing <span class="math notranslate nohighlight">\(\mu_t\)</span> on a constant and <span class="math notranslate nohighlight">\(\theta_t\)</span>.</p>
<p>This might seem strange because, after all, equation <a class="reference internal" href="#equation-eq-grad-old3">(41.3)</a> asserts that inflation at time <span class="math notranslate nohighlight">\(t\)</span>  is determined <span class="math notranslate nohighlight">\(\{\mu_s\}_{s=t}^\infty\)</span></p>
<p>Nevertheless, we’ll run this regression anyway.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First regression: μ_t on a constant and θ_t</span>
<span class="n">X1_θ</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">θs</span><span class="p">)</span>
<span class="n">model1</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">μs</span><span class="p">,</span> <span class="n">X1_θ</span><span class="p">)</span>
<span class="n">results1</span> <span class="o">=</span> <span class="n">model1</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print regression summary</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Regression of μ_t on a constant and θ_t:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results1</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">slim</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Regression of μ_t on a constant and θ_t:
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       1.000
Model:                            OLS   Adj. R-squared:                  1.000
No. Observations:                  40   F-statistic:                 1.489e+13
Covariance Type:            nonrobust   Prob (F-statistic):          6.90e-222
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          0.0645   4.42e-08   1.46e+06      0.000       0.065       0.065
x1             1.5995   4.14e-07   3.86e+06      0.000       1.600       1.600
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>Our regression tells us that the affine function</p>
<div class="math notranslate nohighlight">
\[
\mu_t = .0645 + 1.5995 \theta_t
\]</div>
<p>fits perfectly  along the Ramsey outcome <span class="math notranslate nohighlight">\(\vec \mu, \vec \theta\)</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Of course, this means that a regression of <span class="math notranslate nohighlight">\(\theta_t\)</span> on <span class="math notranslate nohighlight">\(\mu_t\)</span> and a constant would also fit perfectly.</p>
</div>
<p>Let’s plot the regression line <span class="math notranslate nohighlight">\(\mu_t = .0645 + 1.5995 \theta_t\)</span>  and the points <span class="math notranslate nohighlight">\((\theta_t, \mu_t)\)</span> that lie on it for <span class="math notranslate nohighlight">\(t=0, \ldots, T\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">θs</span><span class="p">,</span> <span class="n">μs</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mu_t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">θs</span><span class="p">,</span> <span class="n">results1</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X1_θ</span><span class="p">),</span> <span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat \mu_t$&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta_t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\mu_t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:2: SyntaxWarning: invalid escape sequence &#39;\h&#39;
&lt;&gt;:2: SyntaxWarning: invalid escape sequence &#39;\h&#39;
/tmp/ipykernel_5764/68086905.py:2: SyntaxWarning: invalid escape sequence &#39;\h&#39;
  plt.plot(θs, results1.predict(X1_θ), &#39;grey&#39;, label=&#39;$\hat \mu_t$&#39;, linestyle=&#39;--&#39;)
</pre></div>
</div>
<img alt="_images/bde0fbfcbe01495decfb6cccd8a65349366a3620fd9d063d47c7bdff61e21b9c.png" src="_images/bde0fbfcbe01495decfb6cccd8a65349366a3620fd9d063d47c7bdff61e21b9c.png" />
</div>
</div>
<p>The  time <span class="math notranslate nohighlight">\(0\)</span> pair  <span class="math notranslate nohighlight">\((\theta_0, \mu_0)\)</span> appears as the point on the upper right.</p>
<p>Points <span class="math notranslate nohighlight">\((\theta_t, \mu_t)\)</span>  for succeeding times appear further and further to the lower left and eventually converge to <span class="math notranslate nohighlight">\((\bar \mu, \bar \mu)\)</span>.</p>
<p>Next, we’ll run a linear regression of <span class="math notranslate nohighlight">\(\theta_{t+1}\)</span> against <span class="math notranslate nohighlight">\(\theta_t\)</span> and a constant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Second regression: θ_{t+1} on a constant and θ_t</span>
<span class="n">θ_t</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">θs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># θ_t</span>
<span class="n">θ_t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">θs</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>  <span class="c1"># θ_{t+1}</span>
<span class="n">X2_θ</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">θ_t</span><span class="p">)</span>  <span class="c1"># Add a constant term for the intercept</span>
<span class="n">model2</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">θ_t1</span><span class="p">,</span> <span class="n">X2_θ</span><span class="p">)</span>
<span class="n">results2</span> <span class="o">=</span> <span class="n">model2</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="c1"># Print regression summary</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Regression of θ_{t+1} on a constant and θ_t:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results2</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">slim</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Regression of θ_{t+1} on a constant and θ_t:
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       1.000
Model:                            OLS   Adj. R-squared:                  1.000
No. Observations:                  39   F-statistic:                 7.775e+11
Covariance Type:            nonrobust   Prob (F-statistic):          1.41e-192
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const         -0.0645   4.84e-08  -1.33e+06      0.000      -0.065      -0.065
x1             0.4005   4.54e-07   8.82e+05      0.000       0.400       0.400
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
</pre></div>
</div>
</div>
</div>
<p>We find that the regression line fits perfectly and thus discover the affine relationship</p>
<div class="math notranslate nohighlight">
\[
\theta_{t+1} = - .0645 + .4005 \theta_t 
\]</div>
<p>that prevails along the Ramsey outcome for inflation.</p>
<p>Let’s plot <span class="math notranslate nohighlight">\(\theta_t\)</span> for <span class="math notranslate nohighlight">\(t =0, 1, \ldots, T\)</span> along the line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">θ_t</span><span class="p">,</span> <span class="n">θ_t1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\theta_{t+1}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">θ_t</span><span class="p">,</span> <span class="n">results2</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X2_θ</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat θ_{t+1}$&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta_t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta_{t+1}$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:2: SyntaxWarning: invalid escape sequence &#39;\h&#39;
&lt;&gt;:2: SyntaxWarning: invalid escape sequence &#39;\h&#39;
/tmp/ipykernel_5764/154331351.py:2: SyntaxWarning: invalid escape sequence &#39;\h&#39;
  plt.plot(θ_t, results2.predict(X2_θ), color=&#39;grey&#39;, label=&#39;$\hat θ_{t+1}$&#39;, linestyle=&#39;--&#39;)
</pre></div>
</div>
<img alt="_images/8a581ebc1b2ef50632e31fd4b964d7c1df6553dd314c00897c9e33446bb44b35.png" src="_images/8a581ebc1b2ef50632e31fd4b964d7c1df6553dd314c00897c9e33446bb44b35.png" />
</div>
</div>
<p>Points for succeeding times appear further and further to the lower left and eventually converge to
<span class="math notranslate nohighlight">\(\bar \mu, \bar \mu\)</span>.</p>
<p>Next we ask Python to  regress  continuation value <span class="math notranslate nohighlight">\(v_t\)</span> against a constant, <span class="math notranslate nohighlight">\(\theta_t\)</span>, and <span class="math notranslate nohighlight">\(\theta_t^2\)</span>.</p>
<div class="math notranslate nohighlight">
\[
v_t = g_0 + g_1 \theta_t + g_2 \theta_t^2 . 
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Third regression: v_t on a constant, θ_t and θ^2_t</span>
<span class="n">X3_θ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">θs</span><span class="p">,</span> <span class="n">θs</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="n">model3</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">v_t</span><span class="p">,</span> <span class="n">X3_θ</span><span class="p">)</span>
<span class="n">results3</span> <span class="o">=</span> <span class="n">model3</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>


<span class="c1"># Print regression summary</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Regression of v_t on a constant, θ_t and θ^2_t:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">results3</span><span class="o">.</span><span class="n">summary</span><span class="p">(</span><span class="n">slim</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Regression of v_t on a constant, θ_t and θ^2_t:
                            OLS Regression Results                            
==============================================================================
Dep. Variable:                      y   R-squared:                       1.000
Model:                            OLS   Adj. R-squared:                  1.000
No. Observations:                  40   F-statistic:                 5.474e+08
Covariance Type:            nonrobust   Prob (F-statistic):          6.09e-139
==============================================================================
                 coef    std err          t      P&gt;|t|      [0.025      0.975]
------------------------------------------------------------------------------
const          6.8052   5.91e-06   1.15e+06      0.000       6.805       6.805
x1            -0.7581      0.000  -6028.976      0.000      -0.758      -0.758
x2            -4.6996      0.001  -7131.888      0.000      -4.701      -4.698
==============================================================================

Notes:
[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.
[2] The condition number is large, 3.5e+04. This might indicate that there are
strong multicollinearity or other numerical problems.
</pre></div>
</div>
</div>
</div>
<p>The regression has an <span class="math notranslate nohighlight">\(R^2\)</span> equal to <span class="math notranslate nohighlight">\(1\)</span> and so fits perfectly.</p>
<p>However, notice the warning about the high condition number.</p>
<p>As indicated in the printout, this is a consequence of
<span class="math notranslate nohighlight">\(\theta_t\)</span> and <span class="math notranslate nohighlight">\(\theta_t^2\)</span> being  highly  correlated along the Ramsey plan.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">corrcoef</span><span class="p">(</span><span class="n">θs</span><span class="p">,</span> <span class="n">θs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[ 1.        , -0.99942156],
       [-0.99942156,  1.        ]])
</pre></div>
</div>
</div>
</div>
<p>Let’s  plot <span class="math notranslate nohighlight">\(v_t\)</span> against <span class="math notranslate nohighlight">\(\theta_t\)</span> along with the nonlinear regression line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">θ_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">θs</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">θs</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">X3_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">θ_grid</span><span class="p">)),</span> <span class="n">θ_grid</span><span class="p">,</span> <span class="n">θ_grid</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>

<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">θs</span><span class="p">,</span> <span class="n">v_t</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">θ_grid</span><span class="p">,</span> <span class="n">results3</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X3_grid</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> 
         <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat v_t$&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">V_CR</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">θ_grid</span><span class="p">)</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">θ_grid</span><span class="p">)</span><span class="o">*</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">V_CR</span><span class="p">,</span> <span class="s1">&#39;$V^</span><span class="si">{CR}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> 
         <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">clip_on</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\theta_</span><span class="si">{t}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$v_t$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:6: SyntaxWarning: invalid escape sequence &#39;\h&#39;
&lt;&gt;:6: SyntaxWarning: invalid escape sequence &#39;\h&#39;
/tmp/ipykernel_5764/203801373.py:6: SyntaxWarning: invalid escape sequence &#39;\h&#39;
  label=&#39;$\hat v_t$&#39;, linestyle=&#39;--&#39;)
</pre></div>
</div>
<img alt="_images/f621614de926498fd2fbbe7ef6bbbbe8b394220330bfae6119dd23c81aa8ea1c.png" src="_images/f621614de926498fd2fbbe7ef6bbbbe8b394220330bfae6119dd23c81aa8ea1c.png" />
</div>
</div>
<p>The highest continuation value <span class="math notranslate nohighlight">\(v_0\)</span> at  <span class="math notranslate nohighlight">\(t=0\)</span> appears at the peak of the function quadratic function
<span class="math notranslate nohighlight">\(g_0 + g_1 \theta_t + g_2 \theta_t^2\)</span>.</p>
<p>Subsequent values of <span class="math notranslate nohighlight">\(v_t\)</span> for <span class="math notranslate nohighlight">\(t \geq 1\)</span> appear to the lower left of the pair <span class="math notranslate nohighlight">\((\theta_0, v_0)\)</span> and converge  monotonically from above to <span class="math notranslate nohighlight">\(v_T\)</span> at time <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>The value <span class="math notranslate nohighlight">\(V^{CR}\)</span> attained by the Ramsey plan that is  restricted to be  a constant <span class="math notranslate nohighlight">\(\mu_t = \mu^{CR}\)</span> sequence appears as a horizontal line.</p>
<p>Evidently, continuation values <span class="math notranslate nohighlight">\(v_t &gt; V^{CR}\)</span> for <span class="math notranslate nohighlight">\(t=0, 1, 2\)</span> while <span class="math notranslate nohighlight">\(v_t &lt; V^{CR}\)</span> for <span class="math notranslate nohighlight">\(t \geq 3\)</span>.</p>
</section>
<section id="what-has-machine-learning-taught-us">
<h2><span class="section-number">41.10. </span>What has Machine Learning Taught Us?<a class="headerlink" href="#what-has-machine-learning-taught-us" title="Permalink to this heading">#</a></h2>
<p>Our regressions tells us that along the Ramsey outcome <span class="math notranslate nohighlight">\(\vec \mu^R, \vec \theta^R\)</span>, the linear function</p>
<div class="math notranslate nohighlight">
\[
\mu_t = .0645 + 1.5995 \theta_t
\]</div>
<p>fits perfectly and that so do the regression lines</p>
<div class="math notranslate nohighlight">
\[
\theta_{t+1} = - .0645 + .4005 \theta_t 
\]</div>
<div class="math notranslate nohighlight">
\[
v_t = 6.8052 - .7580 \theta_t - 4.6991 \theta_t^2. 
\]</div>
<p>Assembling these  regressions, we have discovered
run for our single Ramsey outcome path <span class="math notranslate nohighlight">\(\vec \mu^R, \vec \theta^R\)</span>
that along a Ramsey plan, the following relationships prevail:</p>
<div class="math notranslate nohighlight" id="equation-eq-old9101">
<span class="eqno">(41.12)<a class="headerlink" href="#equation-eq-old9101" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{aligned}
\theta_0 &amp; = \theta_0^R \\
\mu_t &amp;  = b_0 + b_1 \theta_t \\
\theta_{t+1} &amp; = d_0 + d_1 \theta_t  \\
\end{aligned}\end{split}\]</div>
<p>where the initial value <span class="math notranslate nohighlight">\(\theta_0^R\)</span> was computed along with other components of <span class="math notranslate nohighlight">\(\vec \mu^R, \vec \theta^R\)</span> when we computed the Ramsey plan, and where <span class="math notranslate nohighlight">\(b_0, b_1, d_0, d_1\)</span> are  parameters whose values we estimated with our regressions.</p>
<p>In addition, we learned that  continuation values are described by the quadratic function</p>
<div class="math notranslate nohighlight">
\[
v_t = g_0 + g_1 \theta_t + g_2 \theta_t^2
\]</div>
<p>We  discovered these relationships  by running some carefully chosen  regressions and staring at the results, noticing that the <span class="math notranslate nohighlight">\(R^2\)</span>’s of unity tell us that the fits are perfect.</p>
<p>We have learned much  about the structure of the Ramsey problem.</p>
<p>However, by using the methods and ideas that we have deployed in this lecture, it is challenging to say more.</p>
<p>There are many other linear regressions among components of <span class="math notranslate nohighlight">\(\vec \mu^R, \theta^R\)</span> that would also have given us perfect fits.</p>
<p>For example, we could have regressed <span class="math notranslate nohighlight">\(\theta_t\)</span> on <span class="math notranslate nohighlight">\(\mu_t\)</span> and obtained the same <span class="math notranslate nohighlight">\(R^2\)</span> value.</p>
<p>Actually, wouldn’t that  direction of fit have made  more sense?</p>
<p>After all, the Ramsey planner  chooses <span class="math notranslate nohighlight">\(\vec \mu\)</span>,  while <span class="math notranslate nohighlight">\(\vec \theta\)</span> is an  outcome that reflects the represenative agent’s response to the Ramsey planner’s  choice of <span class="math notranslate nohighlight">\(\vec \mu\)</span>.</p>
<p>Isn’t it more natural then to expect that we’d learn more about the structure of the Ramsey  problem from a regression of components of <span class="math notranslate nohighlight">\(\vec \theta\)</span> on components of <span class="math notranslate nohighlight">\(\vec \mu\)</span>?</p>
<p>To answer these  questions, we’ll have to  deploy more economic theory.</p>
<p>We do that in this quantecon lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>.</p>
<p>There, we’ll discover that system <a class="reference internal" href="#equation-eq-old9101">(41.12)</a> is actually a very good way to represent
a Ramsey plan because it reveals many things about its structure.</p>
<p>Indeed, in that lecture, we show how to compute the Ramsey plan using <strong>dynamic programming squared</strong> and provide a Python class <code class="docutils literal notranslate"><span class="pre">ChangLQ</span></code> that performs the calculations.</p>
<p>We have deployed <code class="docutils literal notranslate"><span class="pre">ChangLQ</span></code> earlier in this lecture to compute a baseline Ramsey plan to which we have compared outcomes from our application of the cruder machine learning approaches studied here.</p>
<p>Let’s use the code to compute the parameters <span class="math notranslate nohighlight">\(d_0, d_1\)</span> for the decision rule for <span class="math notranslate nohighlight">\(\mu_t\)</span>
and the parameters <span class="math notranslate nohighlight">\(d_0, d_1\)</span> in the updating rule for <span class="math notranslate nohighlight">\(\theta_{t+1}\)</span> in representation
<a class="reference internal" href="#equation-eq-old9101">(41.12)</a>.</p>
<p>First, we’ll again use <code class="docutils literal notranslate"><span class="pre">ChangLQ</span></code> to compute these objects (along with a number of others).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">clq</span> <span class="o">=</span> <span class="n">ChangLQ</span><span class="p">(</span><span class="n">β</span><span class="o">=</span><span class="mf">0.85</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Now let’s print out the decision rule for <span class="math notranslate nohighlight">\(\mu_t\)</span> uncovered by applying dynamic programming squared.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;decision rule for μ&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;-(b_0, b_1) = (</span><span class="si">{</span><span class="o">-</span><span class="n">clq</span><span class="o">.</span><span class="n">b0</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="o">-</span><span class="n">clq</span><span class="o">.</span><span class="n">b1</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>decision rule for μ
-(b_0, b_1) = (0.064507, 1.599536)
</pre></div>
</div>
</div>
</div>
<p>Now let’s print out the decision rule for <span class="math notranslate nohighlight">\(\theta_{t+1} \)</span> uncovered by applying dynamic programming squared.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;decision rule for θ(t+1) as function of θ(t)&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;(d_0, d_1) =  (</span><span class="si">{</span><span class="n">clq</span><span class="o">.</span><span class="n">d0</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">, </span><span class="si">{</span><span class="n">clq</span><span class="o">.</span><span class="n">d1</span><span class="si">:</span><span class="s1">.6f</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>decision rule for θ(t+1) as function of θ(t)
(d_0, d_1) =  (-0.064507, 0.400464)
</pre></div>
</div>
</div>
</div>
<p>Evidently, these agree with the relationships that we discovered by running regressions on the Ramsey outcomes <span class="math notranslate nohighlight">\(\vec \mu^R, \vec \theta^R\)</span> that we constructed with either of our machine learning algorithms.</p>
<p>We have set the stage for this quantecon lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>.</p>
<p>We close this lecture by giving a hint about an insight of Chang <span id="id10">[<a class="reference internal" href="zreferences.html#id216" title="Roberto Chang. Credible monetary policy in an infinite horizon model: recursive approaches. Journal of Economic Theory, 81(2):431–461, 1998.">Chang, 1998</a>]</span> that
underlies much of quantecon lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>.</p>
<p>Chang noticed how equation <a class="reference internal" href="#equation-eq-grad-old3">(41.3)</a> shows that an equivalence class of continuation money growth sequences <span class="math notranslate nohighlight">\(\{\mu_{t+j}\}_{j=0}^\infty\)</span> deliver the same <span class="math notranslate nohighlight">\(\theta_t\)</span>.</p>
<p>Consequently, equations <a class="reference internal" href="#equation-eq-grad-old1">(41.1)</a> and <a class="reference internal" href="#equation-eq-grad-old3">(41.3)</a> indicate that <span class="math notranslate nohighlight">\(\theta_t\)</span> intermediates how the government’s choices of <span class="math notranslate nohighlight">\(\mu_{t+j}, \ j=0, 1, \ldots\)</span> impinge on time <span class="math notranslate nohighlight">\(t\)</span>
real balances <span class="math notranslate nohighlight">\(m_t - p_t = -\alpha \theta_t\)</span>.</p>
<p>In lecture <a class="reference internal" href="calvo.html"><span class="doc">Time Inconsistency of Ramsey Plans</span></a>, we’ll see how  Chang <span id="id11">[<a class="reference internal" href="zreferences.html#id216" title="Roberto Chang. Credible monetary policy in an infinite horizon model: recursive approaches. Journal of Economic Theory, 81(2):431–461, 1998.">Chang, 1998</a>]</span> put  this
insight to work.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="orth_proj.html">
   1. Orthogonal Projections and Their Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stationary_densities.html">
   2. Continuous State Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="muth_kalman.html">
   3. Reverse Engineering a la Muth
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="discrete_dp.html">
   4. Discrete State Dynamic Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cons_news.html">
   5. Information and Consumption Smoothing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing.html">
   6. Consumption Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing_tax.html">
   7. Tax Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_jump_lq.html">
   8. Markov Jump Linear Quadratic Dynamic Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_1.html">
   9. How to Pay for a War: Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_2.html">
   10. How to Pay for a War: Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_3.html">
   11. How to Pay for a War: Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lqramsey.html">
   12. Optimal Taxation in an LQ Economy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arellano.html">
   13. Default Risk and Income Fluctuations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="matsuyama.html">
   14. Globalization and Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coase.html">
   15. Coase’s Theory of the Firm
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Linear Economies
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="hs_recursive_models.html">
   16. Recursive Models of Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="growth_in_dles.html">
   17. Growth in Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_asset_pricing_dles.html">
   18. Lucas Asset Pricing Using DLE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irfs_in_hall_model.html">
   19. IRFs in Hall Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="permanent_income_dles.html">
   20. Permanent Income Model using the DLE Class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rosen_schooling_model.html">
   21. Rosen Schooling Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cattle_cycles.html">
   22. Cattle Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hs_invertibility_example.html">
   23. Shock Non Invertibility
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Risk, Model Uncertainty, and Robustness
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="five_preferences.html">
   24. Risk and Model Uncertainty
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="entropy.html">
   25. Etymology of Entropy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="robustness.html">
   26. Robustness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rob_markov_perf.html">
   27. Robust Markov Perfect Equilibrium
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time Series Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arma.html">
   28. Covariance Stationary Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="estspec.html">
   29. Estimation of Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="additive_functionals.html">
   30. Additive and Multiplicative Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lu_tricks.html">
   31. Classical Control with Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classical_filtering.html">
   32. Classical Prediction and Filtering With Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="knowing_forecasts_of_others.html">
   33. Knowing the Forecasts of Others
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_model.html">
   34. Asset Pricing II: The Lucas Asset Pricing Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="asset_pricing_lph.html">
   35. Elementary Asset Pricing Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="black_litterman.html">
   36. Two Modifications of Mean-Variance Portfolio Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_complete_mkts.html">
   37. Irrelevance of Capital Structures with Complete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_incomplete_mkts.html">
   38. Equilibrium Capital Structures with Incomplete Markets
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Programming Squared
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="un_insure.html">
   39. Optimal Unemployment Insurance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dyn_stack.html">
   40. Stackelberg Plans
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   41. Machine Learning a Ramsey Plan
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo.html">
   42. Time Inconsistency of Ramsey Plans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo_abreu.html">
   43. Sustainable Plans for a Calvo Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="opt_tax_recur.html">
   44. Optimal Taxation with State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss.html">
   45. Optimal Taxation without State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss2.html">
   46. Fluctuating Interest Rates Deliver Fiscal Insurance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss3.html">
   47. Fiscal Risk and Government Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_ramsey.html">
   48. Competitive Equilibria of a Model of Chang
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_credible.html">
   49. Credible Government Policies in a Model of Chang
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   50. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   51. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   52. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/calvo_machine_learn.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li class="download-pdf" id="downloadButton"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-advanced.myst/blob/main/lectures/calvo_machine_learn.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-advanced.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="/_pdf/quantecon-python-advanced.pdf" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python-advanced.notebooks/blob/main/calvo_machine_learn.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python-advanced.notebooks" data-urlpath="tree/lecture-python-advanced.notebooks/calvo_machine_learn.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python-advanced.notebooks/blob/main/calvo_machine_learn.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "calvo_machine_learn";
                const repoURL = "https://github.com/QuantEcon/lecture-python-advanced.notebooks";
                const urlPath = "tree/lecture-python-advanced.notebooks/calvo_machine_learn.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>