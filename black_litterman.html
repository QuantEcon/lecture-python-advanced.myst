

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>37. Two Modifications of Mean-Variance Portfolio Theory &#8212; Advanced Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=bd0785fbb14d8d2bd4d9ae501d79ed8d3bc089ec" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=d6d86bce9979111653c4c495e33499e1796e172a"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-KZLV7PM9LL"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KZLV7PM9LL');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min", "col": "col", "Span": "span", "epsilon": "\\varepsilon", "EE": "\\mathbb{E}", "PP": "\\mathbb{P}", "RR": "\\mathbb{R}", "NN": "\\mathbb{N}", "ZZ": "\\mathbb{Z}", "aA": "\\mathcal{A}", "bB": "\\mathcal{B}", "cC": "\\mathcal{C}", "dD": "\\mathcal{D}", "eE": "\\mathcal{E}", "fF": "\\mathcal{F}", "gG": "\\mathcal{G}", "hH": "\\mathcal{H}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'black_litterman';</script>
    <link rel="canonical" href="https://python-advanced.quantecon.org/black_litterman.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="38. Irrelevance of Capital Structures with Complete Markets" href="BCG_complete_mkts.html" />
    <link rel="prev" title="36. Elementary Asset Pricing Theory" href="asset_pricing_lph.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Two Modifications of Mean-Variance Portfolio Theory"/>
<meta name="twitter:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Two Modifications of Mean-Variance Portfolio Theory" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python-advanced.quantecon.org/black_litterman.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Advanced Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=black_litterman>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">37.1. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-variance-portfolio-choice">37.2. Mean-Variance Portfolio Choice</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#estimating-mean-and-variance">37.3. Estimating  Mean and Variance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#black-litterman-starting-point">37.4. Black-Litterman Starting Point</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#details">37.5. Details</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-views">37.6. Adding Views</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#bayesian-interpretation">37.7. Bayesian Interpretation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#curve-decolletage">37.8. Curve Decolletage</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#black-litterman-recommendation-as-regularization">37.9. Black-Litterman Recommendation as Regularization</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-robust-control-operator">37.10. A Robust Control Operator</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#a-robust-mean-variance-portfolio-model">37.11. A Robust Mean-Variance Portfolio Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#appendix">37.12. Appendix</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#special-case-iid-sample">37.13. Special Case – IID Sample</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dependence-and-sampling-frequency">37.14. Dependence and Sampling Frequency</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#frequency-and-the-mean-estimator">37.15. Frequency and the Mean Estimator</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Advanced Quantitative Economics with Python</a></p>

                        <p class="qe-page__header-subheading">Two Modifications of Mean-Variance Portfolio Theory</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>Thomas J. Sargent</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>John Stachurski</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <div id="qe-notebook-header" align="right" style="text-align:right;">
        <a href="https://quantecon.org/" title="quantecon.org">
                <img style="width:250px;display:inline;" width="250px" src="https://assets.quantecon.org/img/qe-menubar-logo.svg" alt="QuantEcon">
        </a>
</div><section class="tex2jax_ignore mathjax_ignore" id="two-modifications-of-mean-variance-portfolio-theory">
<span id="index-0"></span><h1><span class="section-number">37. </span>Two Modifications of Mean-Variance Portfolio Theory<a class="headerlink" href="#two-modifications-of-mean-variance-portfolio-theory" title="Permalink to this heading">#</a></h1>
<section id="overview">
<h2><span class="section-number">37.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>This lecture describes extensions to the classical mean-variance portfolio theory summarized in our lecture <a class="reference external" href="https://python-advanced.quantecon.org/asset_pricing_lph.html">Elementary Asset Pricing Theory</a>.</p>
<p>The classic theory described there assumes that a decision maker completely trusts the statistical model that he posits to govern the joint distribution of returns on a list of available assets.</p>
<p>Both extensions described here put distrust of that statistical model into the mind of the decision maker.</p>
<p>One is a model of Black and Litterman <span id="id1">[<a class="reference internal" href="zreferences.html#id71" title="Fischer Black and Robert Litterman. Global portfolio optimization. Financial analysts journal, 48(5):28–43, 1992.">Black and Litterman, 1992</a>]</span> that imputes to the decision maker distrust of historically estimated mean returns but still complete trust of estimated covariances of returns.</p>
<p>The second model also imputes to the decision maker doubts about his  statistical model, but now by saying that, because of that distrust,  the decision maker uses a version of  robust control theory described in this lecture <a class="reference external" href="https://python-advanced.quantecon.org/robustness.html">Robustness</a>.</p>
<p>The famous <strong>Black-Litterman</strong> (1992) <span id="id2">[<a class="reference internal" href="zreferences.html#id71" title="Fischer Black and Robert Litterman. Global portfolio optimization. Financial analysts journal, 48(5):28–43, 1992.">Black and Litterman, 1992</a>]</span> portfolio choice model was motivated by the finding that with high frequency or
moderately high  frequency data, means are more difficult to estimate than
variances.</p>
<p>A model of <strong>robust portfolio choice</strong> that we’ll describe below also begins
from the same starting point.</p>
<p>To begin, we’ll take for granted that means are more difficult to
estimate that covariances and will focus on how Black and Litterman, on
the one hand, an robust control theorists, on the other, would recommend
modifying the <strong>mean-variance portfolio choice model</strong> to take that into
account.</p>
<p>At the end of this lecture, we shall use some rates of convergence
results and some simulations to verify how means are more difficult to
estimate than variances.</p>
<p>Among the ideas in play in this lecture will be</p>
<ul class="simple">
<li><p>Mean-variance portfolio theory</p></li>
<li><p>Bayesian approaches to estimating linear regressions</p></li>
<li><p>A risk-sensitivity operator and its connection to robust control
theory</p></li>
</ul>
<p>In summary, we’ll describe two ways to  modify the classic
mean-variance portfolio choice model in ways designed to make its
recommendations more plausible.</p>
<p>Both of the adjustments that we describe are designed to confront a
widely recognized embarrassment to mean-variance portfolio theory,
namely, that it usually implies taking very extreme long-short portfolio
positions.</p>
<p>The two approaches build on a common and widespread hunch –
that because it is much easier statistically to estimate covariances of
excess returns than it is to estimate their means, it makes sense to
adjust investors’ subjective beliefs about mean returns in order to render more plausible decisions.</p>
<p>Let’s start with some imports:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.stats</span> <span class="k">as</span> <span class="nn">stat</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">numba</span> <span class="kn">import</span> <span class="n">jit</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="mean-variance-portfolio-choice">
<h2><span class="section-number">37.2. </span>Mean-Variance Portfolio Choice<a class="headerlink" href="#mean-variance-portfolio-choice" title="Permalink to this heading">#</a></h2>
<p>A risk-free security earns one-period net return <span class="math notranslate nohighlight">\(r_f\)</span>.</p>
<p>An <span class="math notranslate nohighlight">\(n \times 1\)</span> vector of risky securities earns
an <span class="math notranslate nohighlight">\(n \times 1\)</span> vector <span class="math notranslate nohighlight">\(\vec r - r_f {\bf 1}\)</span> of <em>excess
returns</em>, where <span class="math notranslate nohighlight">\({\bf 1}\)</span> is an <span class="math notranslate nohighlight">\(n \times 1\)</span> vector of
ones.</p>
<p>The excess return vector is multivariate normal with mean <span class="math notranslate nohighlight">\(\mu\)</span>
and covariance matrix <span class="math notranslate nohighlight">\(\Sigma\)</span>, which we express either as</p>
<div class="math notranslate nohighlight">
\[
\vec r - r_f {\bf 1} \sim {\mathcal N}(\mu, \Sigma)
\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[
\vec r - r_f {\bf 1} = \mu + C \epsilon
\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon \sim {\mathcal N}(0, I)\)</span> is an <span class="math notranslate nohighlight">\(n \times 1\)</span>
random vector.</p>
<p>Let <span class="math notranslate nohighlight">\(w\)</span> be an <span class="math notranslate nohighlight">\(n \times 1\)</span>  vector of portfolio weights.</p>
<p>A portfolio consisting <span class="math notranslate nohighlight">\(w\)</span> earns returns</p>
<div class="math notranslate nohighlight">
\[
w' (\vec r - r_f {\bf 1}) \sim {\mathcal N}(w' \mu, w' \Sigma w )
\]</div>
<p>The <strong>mean-variance portfolio choice problem</strong> is to choose <span class="math notranslate nohighlight">\(w\)</span> to
maximize</p>
<div class="math notranslate nohighlight" id="equation-choice-problem">
<span class="eqno">(37.1)<a class="headerlink" href="#equation-choice-problem" title="Permalink to this equation">#</a></span>\[U(\mu,\Sigma;w) = w'\mu - \frac{\delta}{2} w' \Sigma w\]</div>
<p>where <span class="math notranslate nohighlight">\(\delta &gt; 0\)</span> is a risk-aversion parameter. The first-order
condition for maximizing <a class="reference internal" href="#equation-choice-problem">(37.1)</a> with respect to the vector <span class="math notranslate nohighlight">\(w\)</span> is</p>
<div class="math notranslate nohighlight">
\[
\mu = \delta \Sigma w
\]</div>
<p>which implies the following design of a risky portfolio:</p>
<div class="math notranslate nohighlight" id="equation-risky-portfolio">
<span class="eqno">(37.2)<a class="headerlink" href="#equation-risky-portfolio" title="Permalink to this equation">#</a></span>\[w = (\delta \Sigma)^{-1} \mu\]</div>
</section>
<section id="estimating-mean-and-variance">
<h2><span class="section-number">37.3. </span>Estimating  Mean and Variance<a class="headerlink" href="#estimating-mean-and-variance" title="Permalink to this heading">#</a></h2>
<p>The key inputs into the portfolio choice model <a class="reference internal" href="#equation-risky-portfolio">(37.2)</a> are</p>
<ul class="simple">
<li><p>estimates of the parameters <span class="math notranslate nohighlight">\(\mu, \Sigma\)</span> of the random excess
return vector<span class="math notranslate nohighlight">\((\vec r - r_f {\bf 1})\)</span></p></li>
<li><p>the risk-aversion parameter <span class="math notranslate nohighlight">\(\delta\)</span></p></li>
</ul>
<p>A standard way of estimating <span class="math notranslate nohighlight">\(\mu\)</span> is maximum-likelihood or least
squares; that amounts to estimating <span class="math notranslate nohighlight">\(\mu\)</span> by a sample mean of
excess returns and estimating <span class="math notranslate nohighlight">\(\Sigma\)</span> by a sample covariance
matrix.</p>
</section>
<section id="black-litterman-starting-point">
<h2><span class="section-number">37.4. </span>Black-Litterman Starting Point<a class="headerlink" href="#black-litterman-starting-point" title="Permalink to this heading">#</a></h2>
<p>When estimates of <span class="math notranslate nohighlight">\(\mu\)</span> and <span class="math notranslate nohighlight">\(\Sigma\)</span> from historical
sample means and covariances have been combined with <strong>plausible</strong> values
of the risk-aversion parameter <span class="math notranslate nohighlight">\(\delta\)</span> to compute an
optimal portfolio from formula <a class="reference internal" href="#equation-risky-portfolio">(37.2)</a>, a typical outcome has been
<span class="math notranslate nohighlight">\(w\)</span>’s with <strong>extreme long and short positions</strong>.</p>
<p>A common reaction to these outcomes is that they are so implausible that a portfolio
manager cannot recommend them to a customer.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">10</span>                                           <span class="c1"># Number of assets</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">200</span>                                          <span class="c1"># Sample size</span>

<span class="c1"># random market portfolio (sum is normalized to 1)</span>
<span class="n">w_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">w_m</span> <span class="o">=</span> <span class="n">w_m</span> <span class="o">/</span> <span class="p">(</span><span class="n">w_m</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="c1"># True risk premia and variance of excess return (constructed</span>
<span class="c1"># so that the Sharpe ratio is 1)</span>
<span class="n">μ</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span>  <span class="o">/</span><span class="mi">100</span>      <span class="c1"># Mean excess return (risk premium)</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>        <span class="c1"># Random matrix for the covariance matrix</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">S</span> <span class="o">@</span> <span class="n">S</span><span class="o">.</span><span class="n">T</span>           <span class="c1"># Turn the random matrix into symmetric psd</span>
<span class="c1"># Make sure that the Sharpe ratio is one</span>
<span class="n">Σ</span> <span class="o">=</span> <span class="n">V</span> <span class="o">*</span> <span class="p">(</span><span class="n">w_m</span> <span class="o">@</span> <span class="n">μ</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">w_m</span> <span class="o">@</span> <span class="n">V</span> <span class="o">@</span> <span class="n">w_m</span><span class="p">)</span>

<span class="c1"># Risk aversion of market portfolio holder</span>
<span class="n">δ</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">w_m</span> <span class="o">@</span> <span class="n">Σ</span> <span class="o">@</span> <span class="n">w_m</span><span class="p">)</span>

<span class="c1"># Generate a sample of excess returns</span>
<span class="n">excess_return</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">Σ</span><span class="p">)</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">excess_return</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="c1"># Estimate μ and Σ</span>
<span class="n">μ_est</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Σ_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">δ</span> <span class="o">*</span> <span class="n">Σ_est</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Mean-variance portfolio weights recommendation and the market portfolio&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$w$ (mean-variance)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">w_m</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$w_m$ (market portfolio)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w_m</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Assets&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09ef2c6c8937ab85539ff1bc7b859a57c4d35514c47c3827fd2817cd8dcfe65e.png" src="_images/09ef2c6c8937ab85539ff1bc7b859a57c4d35514c47c3827fd2817cd8dcfe65e.png" />
</div>
</div>
<p>Black and Litterman’s responded to this situation in the following way:</p>
<ul class="simple">
<li><p>They continue to accept <a class="reference internal" href="#equation-risky-portfolio">(37.2)</a> as a good model for choosing an optimal
portfolio <span class="math notranslate nohighlight">\(w\)</span>.</p></li>
<li><p>They want to continue to allow the customer to express his or her
risk tolerance by setting <span class="math notranslate nohighlight">\(\delta\)</span>.</p></li>
<li><p>Leaving <span class="math notranslate nohighlight">\(\Sigma\)</span> at its maximum-likelihood value, they push
<span class="math notranslate nohighlight">\(\mu\)</span> away from its maximum-likelihood value in a way designed to make
portfolio choices that are more plausible in terms of conforming to
what most people actually do.</p></li>
</ul>
<p>In particular, given <span class="math notranslate nohighlight">\(\Sigma\)</span> and a plausible value
of <span class="math notranslate nohighlight">\(\delta\)</span>, Black and Litterman reverse engineered a vector
<span class="math notranslate nohighlight">\(\mu_{BL}\)</span> of mean excess returns that makes the <span class="math notranslate nohighlight">\(w\)</span>
implied by formula <a class="reference internal" href="#equation-risky-portfolio">(37.2)</a> equal the <strong>actual</strong> market portfolio
<span class="math notranslate nohighlight">\(w_m\)</span>, so that</p>
<div class="math notranslate nohighlight">
\[
w_m = (\delta \Sigma)^{-1} \mu_{BL}
\]</div>
</section>
<section id="details">
<h2><span class="section-number">37.5. </span>Details<a class="headerlink" href="#details" title="Permalink to this heading">#</a></h2>
<p>Let’s define</p>
<div class="math notranslate nohighlight">
\[
w_m' \mu \equiv ( r_m - r_f)
\]</div>
<p>as the (scalar) excess return on the market portfolio <span class="math notranslate nohighlight">\(w_m\)</span>.</p>
<p>Define</p>
<div class="math notranslate nohighlight">
\[
\sigma^2 = w_m' \Sigma w_m
\]</div>
<p>as the variance of the excess return on the market portfolio
<span class="math notranslate nohighlight">\(w_m\)</span>.</p>
<p>Define</p>
<div class="math notranslate nohighlight">
\[
{\bf SR}_m = \frac{ r_m - r_f}{\sigma}
\]</div>
<p>as the <strong>Sharpe-ratio</strong> on the market portfolio <span class="math notranslate nohighlight">\(w_m\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(\delta_m\)</span> be the value of the risk aversion parameter that
induces an investor to hold the market portfolio in light of the optimal
portfolio choice rule <a class="reference internal" href="#equation-risky-portfolio">(37.2)</a>.</p>
<p>Evidently, portfolio rule <a class="reference internal" href="#equation-risky-portfolio">(37.2)</a> then implies that
<span class="math notranslate nohighlight">\(r_m - r_f = \delta_m \sigma^2\)</span> or</p>
<div class="math notranslate nohighlight">
\[
\delta_m = \frac{r_m - r_f}{\sigma^2}
\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[
\delta_m = \frac{{\bf SR}_m}{\sigma}
\]</div>
<p>Following the Black-Litterman philosophy, our first step will be to back
a value of <span class="math notranslate nohighlight">\(\delta_m\)</span> from</p>
<ul class="simple">
<li><p>an estimate of the Sharpe-ratio, and</p></li>
<li><p>our maximum likelihood estimate of <span class="math notranslate nohighlight">\(\sigma\)</span> drawn from our
estimates or <span class="math notranslate nohighlight">\(w_m\)</span> and <span class="math notranslate nohighlight">\(\Sigma\)</span></p></li>
</ul>
<p>The second key Black-Litterman step is then to use this value of
<span class="math notranslate nohighlight">\(\delta\)</span> together with the maximum likelihood estimate of
<span class="math notranslate nohighlight">\(\Sigma\)</span> to deduce a <span class="math notranslate nohighlight">\(\mu_{\bf BL}\)</span> that verifies
portfolio rule <a class="reference internal" href="#equation-risky-portfolio">(37.2)</a> at the market portfolio <span class="math notranslate nohighlight">\(w = w_m\)</span></p>
<div class="math notranslate nohighlight">
\[
\mu_m = \delta_m \Sigma w_m
\]</div>
<p>The starting point of the Black-Litterman portfolio choice model is thus
a pair <span class="math notranslate nohighlight">\((\delta_m, \mu_m)\)</span> that tells the customer to hold the
market portfolio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Observed mean excess market return</span>
<span class="n">r_m</span> <span class="o">=</span> <span class="n">w_m</span> <span class="o">@</span> <span class="n">μ_est</span>

<span class="c1"># Estimated variance of the market portfolio</span>
<span class="n">σ_m</span> <span class="o">=</span> <span class="n">w_m</span> <span class="o">@</span> <span class="n">Σ_est</span> <span class="o">@</span> <span class="n">w_m</span>

<span class="c1"># Sharpe-ratio</span>
<span class="n">sr_m</span> <span class="o">=</span> <span class="n">r_m</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">σ_m</span><span class="p">)</span>

<span class="c1"># Risk aversion of market portfolio holder</span>
<span class="n">d_m</span> <span class="o">=</span> <span class="n">r_m</span> <span class="o">/</span> <span class="n">σ_m</span>

<span class="c1"># Derive &quot;view&quot; which would induce the market portfolio</span>
<span class="n">μ_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">d_m</span> <span class="o">*</span> <span class="n">Σ_est</span> <span class="o">@</span> <span class="n">w_m</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Difference between $\hat{\mu}$ (estimate) and $\mu_</span><span class="si">{BL}</span><span class="s1">$ (market implied)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\hat{\mu}$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mu_</span><span class="si">{BL}</span><span class="s1">$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Assets&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;&gt;:19: SyntaxWarning: invalid escape sequence &#39;\h&#39;
&lt;&gt;:20: SyntaxWarning: invalid escape sequence &#39;\m&#39;
&lt;&gt;:19: SyntaxWarning: invalid escape sequence &#39;\h&#39;
&lt;&gt;:20: SyntaxWarning: invalid escape sequence &#39;\m&#39;
/tmp/ipykernel_5704/3330849901.py:19: SyntaxWarning: invalid escape sequence &#39;\h&#39;
  ax.plot(x, μ_est, &#39;o&#39;, c=&#39;k&#39;, label=&#39;$\hat{\mu}$&#39;)
/tmp/ipykernel_5704/3330849901.py:20: SyntaxWarning: invalid escape sequence &#39;\m&#39;
  ax.plot(x, μ_m, &#39;o&#39;, c=&#39;r&#39;, label=&#39;$\mu_{BL}$&#39;)
</pre></div>
</div>
<img alt="_images/3e205a23a991c2bb81a3a26b3c7dbe7eaa19ad58d66526e84fbf20e5f28663bb.png" src="_images/3e205a23a991c2bb81a3a26b3c7dbe7eaa19ad58d66526e84fbf20e5f28663bb.png" />
</div>
</div>
</section>
<section id="adding-views">
<h2><span class="section-number">37.6. </span>Adding Views<a class="headerlink" href="#adding-views" title="Permalink to this heading">#</a></h2>
<p>Black and Litterman start with a baseline customer who asserts that he
or she shares the <strong>market’s views</strong>, which means that he or she
believes that excess returns are governed by</p>
<div class="math notranslate nohighlight" id="equation-excess-returns">
<span class="eqno">(37.3)<a class="headerlink" href="#equation-excess-returns" title="Permalink to this equation">#</a></span>\[\vec r - r_f {\bf 1} \sim {\mathcal N}( \mu_{BL}, \Sigma)\]</div>
<p>Black and Litterman would advise that customer to hold the market
portfolio of risky securities.</p>
<p>Black and Litterman then imagine a consumer who would like to express a
view that differs from the market’s.</p>
<p>The consumer wants appropriately to
mix his view with the market’s before using <a class="reference internal" href="#equation-risky-portfolio">(37.2)</a> to choose a portfolio.</p>
<p>Suppose that the customer’s view is expressed by a hunch that rather
than <a class="reference internal" href="#equation-excess-returns">(37.3)</a>, excess returns are governed by</p>
<div class="math notranslate nohighlight">
\[
\vec r - r_f {\bf 1} \sim {\mathcal N}( \hat \mu, \tau \Sigma)
\]</div>
<p>where <span class="math notranslate nohighlight">\(\tau &gt; 0\)</span> is a scalar parameter that determines how the
decision maker wants to mix his view <span class="math notranslate nohighlight">\(\hat \mu\)</span> with the market’s
view <span class="math notranslate nohighlight">\(\mu_{\bf BL}\)</span>.</p>
<p>Black and Litterman would then use a formula like the following one to
mix the views <span class="math notranslate nohighlight">\(\hat \mu\)</span> and <span class="math notranslate nohighlight">\(\mu_{\bf BL}\)</span></p>
<div class="math notranslate nohighlight" id="equation-mix-views">
<span class="eqno">(37.4)<a class="headerlink" href="#equation-mix-views" title="Permalink to this equation">#</a></span>\[\tilde \mu = (\Sigma^{-1} + (\tau \Sigma)^{-1})^{-1} (\Sigma^{-1} \mu_{BL}  + (\tau \Sigma)^{-1} \hat \mu)\]</div>
<p>Black and Litterman would then advise the customer to hold the portfolio
associated with these views implied by rule <a class="reference internal" href="#equation-risky-portfolio">(37.2)</a>:</p>
<div class="math notranslate nohighlight">
\[
\tilde w = (\delta \Sigma)^{-1} \tilde \mu
\]</div>
<p>This portfolio <span class="math notranslate nohighlight">\(\tilde w\)</span> will deviate from the
portfolio <span class="math notranslate nohighlight">\(w_{BL}\)</span> in amounts that depend on the mixing parameter
<span class="math notranslate nohighlight">\(\tau\)</span>.</p>
<p>If <span class="math notranslate nohighlight">\(\hat \mu\)</span> is the maximum likelihood estimator
and <span class="math notranslate nohighlight">\(\tau\)</span> is chosen heavily to weight this view, then the
customer’s portfolio will involve big short-long positions.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">black_litterman</span><span class="p">(</span><span class="n">λ</span><span class="p">,</span> <span class="n">μ1</span><span class="p">,</span> <span class="n">μ2</span><span class="p">,</span> <span class="n">Σ1</span><span class="p">,</span> <span class="n">Σ2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This function calculates the Black-Litterman mixture</span>
<span class="sd">    mean excess return and covariance matrix</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">Σ1_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Σ1</span><span class="p">)</span>
    <span class="n">Σ2_inv</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Σ2</span><span class="p">)</span>

    <span class="n">μ_tilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">Σ1_inv</span> <span class="o">+</span> <span class="n">λ</span> <span class="o">*</span> <span class="n">Σ2_inv</span><span class="p">,</span>
                              <span class="n">Σ1_inv</span> <span class="o">@</span> <span class="n">μ1</span> <span class="o">+</span> <span class="n">λ</span> <span class="o">*</span> <span class="n">Σ2_inv</span> <span class="o">@</span> <span class="n">μ2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">μ_tilde</span>

<span class="n">τ</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">μ_tilde</span> <span class="o">=</span> <span class="n">black_litterman</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="n">Σ_est</span><span class="p">,</span> <span class="n">τ</span> <span class="o">*</span> <span class="n">Σ_est</span><span class="p">)</span>

<span class="c1"># The Black-Litterman recommendation for the portfolio weights</span>
<span class="n">w_tilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">δ</span> <span class="o">*</span> <span class="n">Σ_est</span><span class="p">,</span> <span class="n">μ_tilde</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">BL_plot</span><span class="p">(</span><span class="n">τ</span><span class="p">):</span>
    <span class="n">μ_tilde</span> <span class="o">=</span> <span class="n">black_litterman</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="n">Σ_est</span><span class="p">,</span> <span class="n">τ</span> <span class="o">*</span> <span class="n">Σ_est</span><span class="p">)</span>
    <span class="n">w_tilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">δ</span> <span class="o">*</span> <span class="n">Σ_est</span><span class="p">,</span> <span class="n">μ_tilde</span><span class="p">)</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\hat{\mu}$ (subj view)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\mu_</span><span class="si">{BL}</span><span class="s1">$ (market)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">μ_tilde</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\tilde{\mu}$ (mixture)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Assets&#39;</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Relationship between $\hat{\mu}$, $\mu_</span><span class="si">{BL}</span><span class="s1">$, and  $ \tilde{\mu}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Black-Litterman portfolio weight recommendation&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$w$ (mean-variance)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">w_m</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$w_</span><span class="si">{m}</span><span class="s1">$ (market, BL)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="n">w_tilde</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span>
               <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$\tilde</span><span class="si">{w}</span><span class="s1">$ (mixture)&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">vlines</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">N</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">w_m</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;Assets&#39;</span><span class="p">,</span>
              <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Black-Litterman portfolio weight recommendation&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_ticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">N</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">numpoints</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">BL_plot</span><span class="p">(</span><span class="n">τ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5bcd243942cfd9a4ea8ace91550d06a71ecb9cb33094f158d3ddeef6542e3f03.png" src="_images/5bcd243942cfd9a4ea8ace91550d06a71ecb9cb33094f158d3ddeef6542e3f03.png" />
</div>
</div>
</section>
<section id="bayesian-interpretation">
<h2><span class="section-number">37.7. </span>Bayesian Interpretation<a class="headerlink" href="#bayesian-interpretation" title="Permalink to this heading">#</a></h2>
<p>Consider the following Bayesian interpretation of the Black-Litterman
recommendation.</p>
<p>The prior belief over the mean excess returns is consistent with the
market portfolio and is given by</p>
<div class="math notranslate nohighlight">
\[
\mu \sim \mathcal{N}(\mu_{BL}, \Sigma)
\]</div>
<p>Given a particular realization of the mean excess returns
<span class="math notranslate nohighlight">\(\mu\)</span> one observes the average excess returns <span class="math notranslate nohighlight">\(\hat \mu\)</span>
on the market according to the distribution</p>
<div class="math notranslate nohighlight">
\[
\hat \mu \mid \mu, \Sigma \sim \mathcal{N}(\mu, \tau\Sigma)
\]</div>
<p>where <span class="math notranslate nohighlight">\(\tau\)</span> is typically small capturing the idea that the
variation in the mean is smaller than the variation of the individual
random variable.</p>
<p>Given the realized excess returns one should then update the prior over
the mean excess returns according to Bayes rule.</p>
<p>The corresponding
posterior over mean excess returns is normally distributed with mean</p>
<div class="math notranslate nohighlight">
\[
(\Sigma^{-1} + (\tau \Sigma)^{-1})^{-1} (\Sigma^{-1}\mu_{BL}   + (\tau \Sigma)^{-1} \hat \mu)
\]</div>
<p>The covariance matrix is</p>
<div class="math notranslate nohighlight">
\[
(\Sigma^{-1} + (\tau \Sigma)^{-1})^{-1}
\]</div>
<p>Hence, the Black-Litterman recommendation is consistent with the Bayes
update of the prior over the mean excess returns in light of the
realized average excess returns on the market.</p>
</section>
<section id="curve-decolletage">
<h2><span class="section-number">37.8. </span>Curve Decolletage<a class="headerlink" href="#curve-decolletage" title="Permalink to this heading">#</a></h2>
<p>Consider two independent “competing” views on the excess market returns</p>
<div class="math notranslate nohighlight">
\[
\vec r_e  \sim {\mathcal N}( \mu_{BL}, \Sigma)
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\vec r_e \sim {\mathcal N}( \hat{\mu}, \tau\Sigma)
\]</div>
<p>A special feature of the multivariate normal random variable
<span class="math notranslate nohighlight">\(Z\)</span> is that its density function depends only on the (Euclidiean)
length of its realization <span class="math notranslate nohighlight">\(z\)</span>.</p>
<p>Formally, let the
<span class="math notranslate nohighlight">\(k\)</span>-dimensional random vector be</p>
<div class="math notranslate nohighlight">
\[
Z\sim \mathcal{N}(\mu, \Sigma)
\]</div>
<p>then</p>
<div class="math notranslate nohighlight">
\[
\bar{Z} \equiv \Sigma(Z-\mu)\sim \mathcal{N}(\mathbf{0}, I)
\]</div>
<p>and so the points where the density takes the same value can be
described by the ellipse</p>
<div class="math notranslate nohighlight" id="equation-ellipse">
<span class="eqno">(37.5)<a class="headerlink" href="#equation-ellipse" title="Permalink to this equation">#</a></span>\[\bar z \cdot \bar z =  (z - \mu)'\Sigma^{-1}(z - \mu) = \bar d\]</div>
<p>where <span class="math notranslate nohighlight">\(\bar d\in\mathbb{R}_+\)</span> denotes the (transformation) of a
particular density value.</p>
<p>The curves defined by equation <a class="reference internal" href="#equation-ellipse">(37.5)</a> can be
labeled as iso-likelihood ellipses</p>
<blockquote>
<div><p><strong>Remark:</strong> More generally there is a class of density functions
that possesses this feature, i.e.</p>
<div class="math notranslate nohighlight">
\[
  \exists g: \mathbb{R}_+ \mapsto \mathbb{R}_+ \ \ \text{ and } \ \ c \geq 0,
  \ \ \text{s.t.  the density } \ \ f \ \ \text{of} \ \ Z  \ \
  \text{ has the form } \quad f(z) = c g(z\cdot z)
  \]</div>
<p>This property is called <strong>spherical symmetry</strong> (see p 81. in Leamer
(1978) <span id="id3">[<a class="reference internal" href="zreferences.html#id70" title="Edward E Leamer. Specification searches: Ad hoc inference with nonexperimental data. Volume 53. John Wiley &amp; Sons Incorporated, 1978.">Leamer, 1978</a>]</span>).</p>
</div></blockquote>
<p>In our specific example, we can use the pair
<span class="math notranslate nohighlight">\((\bar d_1, \bar d_2)\)</span> as being two “likelihood” values for which
the corresponding iso-likelihood ellipses in the excess return space are
given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
(\vec r_e - \mu_{BL})'\Sigma^{-1}(\vec r_e - \mu_{BL}) &amp;= \bar d_1 \\
(\vec r_e - \hat \mu)'\left(\tau \Sigma\right)^{-1}(\vec r_e - \hat \mu) &amp;= \bar d_2
\end{aligned}
\end{split}\]</div>
<p>Notice that for particular <span class="math notranslate nohighlight">\(\bar d_1\)</span> and <span class="math notranslate nohighlight">\(\bar d_2\)</span> values
the two ellipses have a tangency point.</p>
<p>These tangency points, indexed
by the pairs <span class="math notranslate nohighlight">\((\bar d_1, \bar d_2)\)</span>, characterize points
<span class="math notranslate nohighlight">\(\vec r_e\)</span> from which there exists no deviation where one can
increase the likelihood of one view without decreasing the likelihood of
the other view.</p>
<p>The pairs <span class="math notranslate nohighlight">\((\bar d_1, \bar d_2)\)</span> for which there
is such a point outlines a curve in the excess return space. This curve
is reminiscent of the Pareto curve in an Edgeworth-box setting.</p>
<p>Dickey (1975) <span id="id4">[<a class="reference internal" href="zreferences.html#id63" title="J Dickey. Bayesian alternatives to the f-test and least-squares estimate in the normal linear model. In S.E. Fienberg and A. Zellner, editors, Studies in Bayesian econometrics and statistics, pages 515-554. North-Holland, Amsterdam, 1975.">Dickey, 1975</a>]</span> calls it a <em>curve decolletage</em>.</p>
<p>Leamer (1978) <span id="id5">[<a class="reference internal" href="zreferences.html#id70" title="Edward E Leamer. Specification searches: Ad hoc inference with nonexperimental data. Volume 53. John Wiley &amp; Sons Incorporated, 1978.">Leamer, 1978</a>]</span> calls it an <em>information contract curve</em> and
describes it by the following program: maximize the likelihood of one
view, say the Black-Litterman recommendation while keeping the
likelihood of the other view at least at a prespecified constant
<span class="math notranslate nohighlight">\(\bar d_2\)</span></p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
 \bar d_1(\bar d_2) &amp;\equiv \max_{\vec r_e} \ \ (\vec r_e - \mu_{BL})'\Sigma^{-1}(\vec r_e - \mu_{BL}) \\
\text{subject to }  \quad  &amp;(\vec r_e - \hat\mu)'(\tau\Sigma)^{-1}(\vec r_e - \hat \mu) \geq \bar d_2
\end{aligned}
\end{split}\]</div>
<p>Denoting the multiplier on the constraint by <span class="math notranslate nohighlight">\(\lambda\)</span>, the
first-order condition is</p>
<div class="math notranslate nohighlight">
\[
2(\vec r_e - \mu_{BL} )'\Sigma^{-1} + \lambda 2(\vec r_e - \hat\mu)'(\tau\Sigma)^{-1} = \mathbf{0}
\]</div>
<p>which defines the <em>information contract curve</em> between
<span class="math notranslate nohighlight">\(\mu_{BL}\)</span> and <span class="math notranslate nohighlight">\(\hat \mu\)</span></p>
<div class="math notranslate nohighlight" id="equation-info-curve">
<span class="eqno">(37.6)<a class="headerlink" href="#equation-info-curve" title="Permalink to this equation">#</a></span>\[\vec r_e = (\Sigma^{-1} + \lambda (\tau \Sigma)^{-1})^{-1} (\Sigma^{-1} \mu_{BL} + \lambda (\tau \Sigma)^{-1}\hat \mu )\]</div>
<p>Note that if <span class="math notranslate nohighlight">\(\lambda = 1\)</span>, <a class="reference internal" href="#equation-info-curve">(37.6)</a> is equivalent with <a class="reference internal" href="#equation-mix-views">(37.4)</a> and it
identifies one point on the information contract curve.</p>
<p>Furthermore, because <span class="math notranslate nohighlight">\(\lambda\)</span> is a function of the minimum likelihood
<span class="math notranslate nohighlight">\(\bar d_2\)</span> on the RHS of the constraint, by varying
<span class="math notranslate nohighlight">\(\bar d_2\)</span> (or <span class="math notranslate nohighlight">\(\lambda\)</span> ), we can trace out the whole curve
as the figure below illustrates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">1987102</span><span class="p">)</span>

<span class="n">N</span> <span class="o">=</span> <span class="mi">2</span>                                           <span class="c1"># Number of assets</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">200</span>                                         <span class="c1"># Sample size</span>
<span class="n">τ</span> <span class="o">=</span> <span class="mf">0.8</span>

<span class="c1"># Random market portfolio (sum is normalized to 1)</span>
<span class="n">w_m</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">rand</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">w_m</span> <span class="o">=</span> <span class="n">w_m</span> <span class="o">/</span> <span class="p">(</span><span class="n">w_m</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

<span class="n">μ</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">)</span> <span class="o">+</span> <span class="mi">5</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span>
<span class="n">S</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">)</span>
<span class="n">V</span> <span class="o">=</span> <span class="n">S</span> <span class="o">@</span> <span class="n">S</span><span class="o">.</span><span class="n">T</span>
<span class="n">Σ</span> <span class="o">=</span> <span class="n">V</span> <span class="o">*</span> <span class="p">(</span><span class="n">w_m</span> <span class="o">@</span> <span class="n">μ</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="n">w_m</span> <span class="o">@</span> <span class="n">V</span> <span class="o">@</span> <span class="n">w_m</span><span class="p">)</span>

<span class="n">excess_return</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">Σ</span><span class="p">)</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">excess_return</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">T</span><span class="p">)</span>

<span class="n">μ_est</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">Σ_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>

<span class="n">σ_m</span> <span class="o">=</span> <span class="n">w_m</span> <span class="o">@</span> <span class="n">Σ_est</span> <span class="o">@</span> <span class="n">w_m</span>
<span class="n">d_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">w_m</span> <span class="o">@</span> <span class="n">μ_est</span><span class="p">)</span> <span class="o">/</span> <span class="n">σ_m</span>
<span class="n">μ_m</span> <span class="o">=</span> <span class="p">(</span><span class="n">d_m</span> <span class="o">*</span> <span class="n">Σ_est</span> <span class="o">@</span> <span class="n">w_m</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">N_r1</span><span class="p">,</span> <span class="n">N_r2</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">100</span>
<span class="n">r1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">.1</span><span class="p">,</span> <span class="n">N_r1</span><span class="p">)</span>
<span class="n">r2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">.15</span><span class="p">,</span> <span class="n">N_r2</span><span class="p">)</span>

<span class="n">λ_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">.001</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">black_litterman</span><span class="p">(</span><span class="n">λ</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="n">Σ_est</span><span class="p">,</span>
                                    <span class="n">τ</span> <span class="o">*</span> <span class="n">Σ_est</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">λ</span> <span class="ow">in</span> <span class="n">λ_grid</span><span class="p">])</span>

<span class="n">λ</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decolletage</span><span class="p">(</span><span class="n">λ</span><span class="p">):</span>
    <span class="n">dist_r_BL</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">μ_m</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">Σ_est</span><span class="p">)</span>
    <span class="n">dist_r_hat</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">μ_est</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">τ</span> <span class="o">*</span> <span class="n">Σ_est</span><span class="p">)</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Z_BL</span> <span class="o">=</span> <span class="n">dist_r_BL</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">XY</span><span class="p">)</span> 
    <span class="n">Z_hat</span> <span class="o">=</span> <span class="n">dist_r_hat</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">XY</span><span class="p">)</span>

    <span class="n">μ_tilde</span> <span class="o">=</span> <span class="n">black_litterman</span><span class="p">(</span><span class="n">λ</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="n">Σ_est</span><span class="p">,</span> <span class="n">τ</span> <span class="o">*</span> <span class="n">Σ_est</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z_hat</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span><span class="mf">.4</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z_BL</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span><span class="mf">.4</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z_BL</span><span class="p">,</span> <span class="p">[</span><span class="n">dist_r_BL</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">μ_tilde</span><span class="p">)],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z_hat</span><span class="p">,</span> <span class="p">[</span><span class="n">dist_r_hat</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">μ_tilde</span><span class="p">)],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">μ_est</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">μ_est</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">μ_m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">μ_m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">μ_tilde</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">μ_tilde</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">curve</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">curve</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Excess return on the first asset, $r_{e, 1}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Excess return on the second asset, $r_{e, 2}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">μ_est</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.003</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="sa">r</span><span class="s1">&#39;$\hat{\mu}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">μ_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.003</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mu_</span><span class="si">{BL}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">decolletage</span><span class="p">(</span><span class="n">λ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8e292225319d01eed3fd3b875b25f07a61803cba28ae05dc4e5a3b7c0300727d.png" src="_images/8e292225319d01eed3fd3b875b25f07a61803cba28ae05dc4e5a3b7c0300727d.png" />
</div>
</div>
<p>Note that the line that connects the two points
<span class="math notranslate nohighlight">\(\hat \mu\)</span> and <span class="math notranslate nohighlight">\(\mu_{BL}\)</span> is linear, which comes from the
fact that the covariance matrices of the two competing distributions
(views) are proportional to each other.</p>
<p>To illustrate the fact that this is not necessarily the case, consider
another example using the same parameter values, except that the “second
view” constituting the constraint has covariance matrix
<span class="math notranslate nohighlight">\(\tau I\)</span> instead of <span class="math notranslate nohighlight">\(\tau \Sigma\)</span>.</p>
<p>This leads to the
following figure, on which the curve connecting <span class="math notranslate nohighlight">\(\hat \mu\)</span>
and <span class="math notranslate nohighlight">\(\mu_{BL}\)</span> are bending</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">λ_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">.001</span><span class="p">,</span> <span class="mi">20000</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
<span class="n">curve</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">black_litterman</span><span class="p">(</span><span class="n">λ</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="n">Σ_est</span><span class="p">,</span>
                                    <span class="n">τ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span> <span class="k">for</span> <span class="n">λ</span> <span class="ow">in</span> <span class="n">λ_grid</span><span class="p">])</span>
<span class="n">λ</span> <span class="o">=</span> <span class="mi">200</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decolletage</span><span class="p">(</span><span class="n">λ</span><span class="p">):</span>
    <span class="n">dist_r_BL</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">μ_m</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">Σ_est</span><span class="p">)</span>
    <span class="n">dist_r_hat</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="n">multivariate_normal</span><span class="p">(</span><span class="n">μ_est</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(),</span> <span class="n">τ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">))</span>

    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">)</span>
    <span class="n">XY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">stack</span><span class="p">((</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">Z_BL</span> <span class="o">=</span> <span class="n">dist_r_BL</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">XY</span><span class="p">)</span> 
    <span class="n">Z_hat</span> <span class="o">=</span> <span class="n">dist_r_hat</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">XY</span><span class="p">)</span>

    <span class="n">μ_tilde</span> <span class="o">=</span> <span class="n">black_litterman</span><span class="p">(</span><span class="n">λ</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">,</span> <span class="n">Σ_est</span><span class="p">,</span> <span class="n">τ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">N</span><span class="p">))</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z_hat</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.4</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z_BL</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.4</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z_BL</span><span class="p">,</span> <span class="p">[</span><span class="n">dist_r_BL</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">μ_tilde</span><span class="p">)],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">contour</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">Z_hat</span><span class="p">,</span> <span class="p">[</span><span class="n">dist_r_hat</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">μ_tilde</span><span class="p">)],</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;viridis&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.9</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">μ_est</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">μ_est</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">μ_m</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">μ_m</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">μ_tilde</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">μ_tilde</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">20</span><span class="o">*</span><span class="mi">3</span><span class="p">)</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">curve</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">curve</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Excess return on the first asset, $r_{e, 1}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Excess return on the second asset, $r_{e, 2}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">μ_est</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.003</span><span class="p">,</span> <span class="n">μ_est</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="sa">r</span><span class="s1">&#39;$\hat{\mu}$&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">μ_m</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.003</span><span class="p">,</span> <span class="n">μ_m</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.005</span><span class="p">,</span> <span class="sa">r</span><span class="s1">&#39;$\mu_</span><span class="si">{BL}</span><span class="s1">$&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">decolletage</span><span class="p">(</span><span class="n">λ</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dfda41dd4dc7e25e85ea06f65c5e635df54c99f43db9de07bedf7d11f9020fb5.png" src="_images/dfda41dd4dc7e25e85ea06f65c5e635df54c99f43db9de07bedf7d11f9020fb5.png" />
</div>
</div>
</section>
<section id="black-litterman-recommendation-as-regularization">
<h2><span class="section-number">37.9. </span>Black-Litterman Recommendation as Regularization<a class="headerlink" href="#black-litterman-recommendation-as-regularization" title="Permalink to this heading">#</a></h2>
<p>First, consider the OLS regression</p>
<div class="math notranslate nohighlight">
\[
\min_{\beta} \Vert X\beta - y \Vert^2
\]</div>
<p>which yields the solution</p>
<div class="math notranslate nohighlight">
\[
\hat{\beta}_{OLS} = (X'X)^{-1}X'y
\]</div>
<p>A common performance measure of estimators is the <em>mean squared error
(MSE)</em>.</p>
<p>An estimator is “good” if its MSE is relatively small. Suppose
that <span class="math notranslate nohighlight">\(\beta_0\)</span> is the “true” value of the coefficient, then the MSE
of the OLS estimator is</p>
<div class="math notranslate nohighlight">
\[
\text{mse}(\hat \beta_{OLS}, \beta_0) := \mathbb E \Vert \hat \beta_{OLS} - \beta_0\Vert^2 =
\underbrace{\mathbb E \Vert \hat \beta_{OLS} - \mathbb E
\beta_{OLS}\Vert^2}_{\text{variance}} +
\underbrace{\Vert \mathbb E \hat\beta_{OLS} - \beta_0\Vert^2}_{\text{bias}}
\]</div>
<p>From this decomposition, one can see that in order for the MSE to be
small, both the bias and the variance terms must be small.</p>
<p>For example,
consider the case when <span class="math notranslate nohighlight">\(X\)</span> is a <span class="math notranslate nohighlight">\(T\)</span>-vector of ones (where
<span class="math notranslate nohighlight">\(T\)</span> is the sample size), so <span class="math notranslate nohighlight">\(\hat\beta_{OLS}\)</span> is simply the
sample average, while <span class="math notranslate nohighlight">\(\beta_0\in \mathbb{R}\)</span> is defined by the
true mean of <span class="math notranslate nohighlight">\(y\)</span>.</p>
<p>In this example the MSE is</p>
<div class="math notranslate nohighlight">
\[
\text{mse}(\hat \beta_{OLS}, \beta_0) = \underbrace{\frac{1}{T^2}
\mathbb E \left(\sum_{t=1}^{T} (y_{t}- \beta_0)\right)^2 }_{\text{variance}} +
\underbrace{0}_{\text{bias}}
\]</div>
<p>However, because there is a trade-off between the estimator’s bias and
variance, there are cases when by permitting a small bias we can
substantially reduce the variance so overall the MSE gets smaller.</p>
<p>A typical scenario when this proves to be useful is when the number of
coefficients to be estimated is large relative to the sample size.</p>
<p>In these cases, one approach to handle the bias-variance trade-off is the
so called <em>Tikhonov regularization</em>.</p>
<p>A general form with regularization matrix <span class="math notranslate nohighlight">\(\Gamma\)</span> can be written as</p>
<div class="math notranslate nohighlight">
\[
\min_{\beta} \Big\{ \Vert X\beta - y \Vert^2 + \Vert \Gamma (\beta - \tilde \beta) \Vert^2 \Big\}
\]</div>
<p>which yields the solution</p>
<div class="math notranslate nohighlight">
\[
\hat{\beta}_{Reg} = (X'X + \Gamma'\Gamma)^{-1}(X'y + \Gamma'\Gamma\tilde \beta)
\]</div>
<p>Substituting the value of <span class="math notranslate nohighlight">\(\hat{\beta}_{OLS}\)</span> yields</p>
<div class="math notranslate nohighlight">
\[
\hat{\beta}_{Reg} = (X'X + \Gamma'\Gamma)^{-1}(X'X\hat{\beta}_{OLS} + \Gamma'\Gamma\tilde \beta)
\]</div>
<p>Often, the regularization matrix takes the form
<span class="math notranslate nohighlight">\(\Gamma = \lambda I\)</span> with <span class="math notranslate nohighlight">\(\lambda&gt;0\)</span>
and <span class="math notranslate nohighlight">\(\tilde \beta = \mathbf{0}\)</span>.</p>
<p>Then the Tikhonov regularization is equivalent to what is called <em>ridge regression</em> in statistics.</p>
<p>To illustrate how this estimator addresses the bias-variance trade-off,
we compute the MSE of the ridge estimator</p>
<div class="math notranslate nohighlight">
\[
\text{mse}(\hat \beta_{\text{ridge}}, \beta_0) = \underbrace{\frac{1}{(T+\lambda)^2}
\mathbb E \left(\sum_{t=1}^{T} (y_{t}- \beta_0)\right)^2 }_{\text{variance}} +
\underbrace{\left(\frac{\lambda}{T+\lambda}\right)^2 \beta_0^2}_{\text{bias}}
\]</div>
<p>The ridge regression shrinks the coefficients of the estimated vector
towards zero relative to the OLS estimates thus reducing the variance
term at the cost of introducing a “small” bias.</p>
<p>However, there is nothing special about the zero vector.</p>
<p>When <span class="math notranslate nohighlight">\(\tilde \beta \neq \mathbf{0}\)</span> shrinkage occurs in the direction
of <span class="math notranslate nohighlight">\(\tilde \beta\)</span>.</p>
<p>Now, we can give a regularization interpretation of the Black-Litterman
portfolio recommendation.</p>
<p>To this end, first  simplify the equation <a class="reference internal" href="#equation-mix-views">(37.4)</a> that characterizes the Black-Litterman recommendation</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\tilde \mu &amp;= (\Sigma^{-1} + (\tau \Sigma)^{-1})^{-1} (\Sigma^{-1}\mu_{BL}  + (\tau \Sigma)^{-1}\hat \mu) \\
&amp;= (1 + \tau^{-1})^{-1}\Sigma \Sigma^{-1} (\mu_{BL}  + \tau ^{-1}\hat \mu) \\
&amp;= (1 + \tau^{-1})^{-1} ( \mu_{BL}  + \tau ^{-1}\hat \mu)
\end{aligned}
\end{split}\]</div>
<p>In our case, <span class="math notranslate nohighlight">\(\hat \mu\)</span> is the estimated mean excess returns of
securities. This could be written as a vector autoregression where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(y\)</span> is the stacked vector of observed excess returns of size
<span class="math notranslate nohighlight">\((N T\times 1)\)</span> – <span class="math notranslate nohighlight">\(N\)</span> securities and <span class="math notranslate nohighlight">\(T\)</span>
observations.</p></li>
<li><p><span class="math notranslate nohighlight">\(X = \sqrt{T^{-1}}(I_{N} \otimes \iota_T)\)</span> where <span class="math notranslate nohighlight">\(I_N\)</span>
is the identity matrix and <span class="math notranslate nohighlight">\(\iota_T\)</span> is a column vector of
ones.</p></li>
</ul>
<p>Correspondingly, the OLS regression of <span class="math notranslate nohighlight">\(y\)</span> on <span class="math notranslate nohighlight">\(X\)</span> would
yield the mean excess returns as coefficients.</p>
<p>With <span class="math notranslate nohighlight">\(\Gamma = \sqrt{\tau T^{-1}}(I_{N} \otimes \iota_T)\)</span> we can
write the regularized version of the mean excess return estimation</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\hat{\beta}_{Reg} &amp;= (X'X + \Gamma'\Gamma)^{-1}(X'X\hat{\beta}_{OLS} + \Gamma'\Gamma\tilde \beta) \\
&amp;= (1 + \tau)^{-1}X'X (X'X)^{-1} (\hat \beta_{OLS}  + \tau \tilde \beta) \\
&amp;= (1 + \tau)^{-1} (\hat \beta_{OLS}  + \tau \tilde \beta) \\
&amp;= (1 + \tau^{-1})^{-1} ( \tau^{-1}\hat \beta_{OLS}  +  \tilde \beta)
\end{aligned}
\end{split}\]</div>
<p>Given that
<span class="math notranslate nohighlight">\(\hat \beta_{OLS} = \hat \mu\)</span> and <span class="math notranslate nohighlight">\(\tilde \beta = \mu_{BL}\)</span>
in the Black-Litterman model, we have the following interpretation of the
model’s recommendation.</p>
<p>The estimated (personal) view of the mean excess returns,
<span class="math notranslate nohighlight">\(\hat{\mu}\)</span> that would lead to extreme short-long positions are
“shrunk” towards the conservative market view, <span class="math notranslate nohighlight">\(\mu_{BL}\)</span>, that
leads to the more conservative market portfolio.</p>
<p>So the Black-Litterman procedure results in a recommendation that is a
compromise between the conservative market portfolio and the more
extreme portfolio that is implied by estimated “personal” views.</p>
</section>
<section id="a-robust-control-operator">
<h2><span class="section-number">37.10. </span>A Robust Control Operator<a class="headerlink" href="#a-robust-control-operator" title="Permalink to this heading">#</a></h2>
<p>The Black-Litterman approach is partly inspired by the econometric
insight that it is easier to estimate covariances of excess returns than
the means.</p>
<p>That is what gave Black and Litterman license to adjust
investors’ perception of mean excess returns while not tampering with
the covariance matrix of excess returns.</p>
<p>The robust control theory is another approach that also hinges on
adjusting mean excess returns but not covariances.</p>
<p>Associated with a robust control problem is what Hansen and Sargent <span id="id6">[<a class="reference internal" href="zreferences.html#id62" title="Lars Peter Hansen and Thomas J. Sargent. Robust control and model uncertainty. American Economic Review, 91(2):60-66, 2001.">Hansen and Sargent, 2001</a>]</span>, <span id="id7">[<a class="reference internal" href="zreferences.html#id160" title="L P Hansen and T J Sargent. Robustness. Princeton University Press, 2008.">Hansen and Sargent, 2008</a>]</span> call
a <span class="math notranslate nohighlight">\({\sf T}\)</span> operator.</p>
<p>Let’s define the <span class="math notranslate nohighlight">\({\sf T}\)</span> operator as it applies to the problem
at hand.</p>
<p>Let <span class="math notranslate nohighlight">\(x\)</span> be an <span class="math notranslate nohighlight">\(n \times 1\)</span> Gaussian random vector with mean
vector <span class="math notranslate nohighlight">\(\mu\)</span> and covariance matrix <span class="math notranslate nohighlight">\(\Sigma = C C'\)</span>. This
means that <span class="math notranslate nohighlight">\(x\)</span> can be represented as</p>
<div class="math notranslate nohighlight">
\[
x = \mu + C \epsilon
\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon \sim {\mathcal N}(0,I)\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(\phi(\epsilon)\)</span> denote the associated standardized Gaussian
density.</p>
<p>Let <span class="math notranslate nohighlight">\(m(\epsilon,\mu)\)</span> be a <strong>likelihood ratio</strong>, meaning that it
satisfies</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(m(\epsilon, \mu) &gt; 0\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\int m(\epsilon,\mu) \phi(\epsilon) d \epsilon =1\)</span></p></li>
</ul>
<p>That is, <span class="math notranslate nohighlight">\(m(\epsilon, \mu)\)</span> is a non-negative random variable with
mean 1.</p>
<p>Multiplying <span class="math notranslate nohighlight">\(\phi(\epsilon)\)</span>
by the likelihood ratio <span class="math notranslate nohighlight">\(m(\epsilon, \mu)\)</span> produces a distorted distribution for
<span class="math notranslate nohighlight">\(\epsilon\)</span>, namely</p>
<div class="math notranslate nohighlight">
\[
\tilde \phi(\epsilon) = m(\epsilon,\mu) \phi(\epsilon)
\]</div>
<p>The next concept that we need is the <strong>entropy</strong> of the distorted
distribution <span class="math notranslate nohighlight">\(\tilde \phi\)</span> with respect to <span class="math notranslate nohighlight">\(\phi\)</span>.</p>
<p><strong>Entropy</strong> is defined as</p>
<div class="math notranslate nohighlight">
\[
{\rm ent} = \int \log m(\epsilon,\mu) m(\epsilon,\mu) \phi(\epsilon) d \epsilon
\]</div>
<p>or</p>
<div class="math notranslate nohighlight">
\[
{\rm ent} = \int \log m(\epsilon,\mu) \tilde \phi(\epsilon) d \epsilon
\]</div>
<p>That is, relative entropy is the expected value of the likelihood ratio
<span class="math notranslate nohighlight">\(m\)</span> where the expectation is taken with respect to the twisted
density <span class="math notranslate nohighlight">\(\tilde \phi\)</span>.</p>
<p>Relative entropy is non-negative. It is a measure of the discrepancy
between two probability distributions.</p>
<p>As such, it plays an important
role in governing the behavior of statistical tests designed to
discriminate one probability distribution from another.</p>
<p>We are ready to define the <span class="math notranslate nohighlight">\({\sf T}\)</span> operator.</p>
<p>Let <span class="math notranslate nohighlight">\(V(x)\)</span> be a value function.</p>
<p>Define</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned} {\sf T}\left(V(x)\right) &amp; = \min_{m(\epsilon,\mu)} \int m(\epsilon,\mu)[V(\mu + C \epsilon) + \theta \log m(\epsilon,\mu) ] \phi(\epsilon) d \epsilon \cr
                        &amp; = - \log \theta \int \exp \left( \frac{- V(\mu + C \epsilon)}{\theta} \right) \phi(\epsilon) d \epsilon \end{aligned}
\]</div>
<p>This asserts that <span class="math notranslate nohighlight">\({\sf T}\)</span> is an indirect utility function for a
minimization problem in which an <strong>adversary</strong> chooses a distorted
probability distribution <span class="math notranslate nohighlight">\(\tilde \phi\)</span> to lower expected utility,
subject to a penalty term that gets bigger the larger is relative
entropy.</p>
<p>Here the penalty parameter</p>
<div class="math notranslate nohighlight">
\[
\theta \in [\underline \theta, +\infty]
\]</div>
<p>is a robustness parameter when it is <span class="math notranslate nohighlight">\(+\infty\)</span>, there is no scope for the minimizing agent to distort the distribution,
so no robustness to alternative distributions is acquired.</p>
<p>As <span class="math notranslate nohighlight">\(\theta\)</span> is lowered, more robustness is achieved.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <span class="math notranslate nohighlight">\({\sf T}\)</span> operator is sometimes called a
<em>risk-sensitivity</em> operator.</p>
</div>
<p>We shall apply <span class="math notranslate nohighlight">\({\sf T}\)</span> to the special case of a linear value
function <span class="math notranslate nohighlight">\(w'(\vec r - r_f 1)\)</span>
where <span class="math notranslate nohighlight">\(\vec r - r_f 1 \sim {\mathcal N}(\mu,\Sigma)\)</span> or
<span class="math notranslate nohighlight">\(\vec r - r_f {\bf 1} = \mu + C \epsilon\)</span> and
<span class="math notranslate nohighlight">\(\epsilon \sim {\mathcal N}(0,I)\)</span>.</p>
<p>The associated worst-case distribution of <span class="math notranslate nohighlight">\(\epsilon\)</span> is Gaussian
with mean <span class="math notranslate nohighlight">\(v =-\theta^{-1} C' w\)</span> and covariance matrix <span class="math notranslate nohighlight">\(I\)</span></p>
<p>(When the value function is affine, the worst-case distribution distorts
the mean vector of <span class="math notranslate nohighlight">\(\epsilon\)</span> but not the covariance matrix
of <span class="math notranslate nohighlight">\(\epsilon\)</span>).</p>
<p>For utility function argument <span class="math notranslate nohighlight">\(w'(\vec r - r_f 1)\)</span></p>
<div class="math notranslate nohighlight">
\[
{\sf T} ( \vec r - r_f {\bf 1}) = w' \mu + \zeta - \frac{1}{2 \theta} w' \Sigma w
\]</div>
<p>and entropy is</p>
<div class="math notranslate nohighlight">
\[
\frac{v'v}{2} = \frac{1}{2\theta^2}  w' C C' w
\]</div>
</section>
<section id="a-robust-mean-variance-portfolio-model">
<h2><span class="section-number">37.11. </span>A Robust Mean-Variance Portfolio Model<a class="headerlink" href="#a-robust-mean-variance-portfolio-model" title="Permalink to this heading">#</a></h2>
<p>According to criterion <a class="reference internal" href="#equation-choice-problem">(37.1)</a>, the mean-variance portfolio choice problem
chooses <span class="math notranslate nohighlight">\(w\)</span> to maximize</p>
<div class="math notranslate nohighlight">
\[
E [w ( \vec r - r_f {\bf 1})]] - {\rm var} [ w ( \vec r - r_f {\bf 1}) ]
\]</div>
<p>which equals</p>
<div class="math notranslate nohighlight">
\[
w'\mu - \frac{\delta}{2} w' \Sigma w
\]</div>
<p>A robust decision maker can be modeled as replacing the mean return
<span class="math notranslate nohighlight">\(E [w ( \vec r - r_f {\bf 1})]\)</span> with the risk-sensitive criterion</p>
<div class="math notranslate nohighlight">
\[
{\sf T} [w ( \vec r - r_f {\bf 1})] = w' \mu - \frac{1}{2 \theta} w' \Sigma w
\]</div>
<p>that comes from replacing the mean <span class="math notranslate nohighlight">\(\mu\)</span> of <span class="math notranslate nohighlight">\(\vec r - r\_f {\bf 1}\)</span> with the worst-case mean</p>
<div class="math notranslate nohighlight">
\[
\mu - \theta^{-1} \Sigma w
\]</div>
<p>Notice how the worst-case mean vector depends on the portfolio
<span class="math notranslate nohighlight">\(w\)</span>.</p>
<p>The operator <span class="math notranslate nohighlight">\({\sf T}\)</span> is the indirect utility function that
emerges from solving a problem in which an agent who chooses
probabilities does so in order to minimize the expected utility of a
maximizing agent (in our case, the maximizing agent chooses portfolio
weights <span class="math notranslate nohighlight">\(w\)</span>).</p>
<p>The robust version of the mean-variance portfolio choice problem is then
to choose a portfolio <span class="math notranslate nohighlight">\(w\)</span> that maximizes</p>
<div class="math notranslate nohighlight">
\[
{\sf T} [w ( \vec r - r_f {\bf 1})] - \frac{\delta}{2} w' \Sigma w
\]</div>
<p>or</p>
<div class="math notranslate nohighlight" id="equation-robust-mean-variance">
<span class="eqno">(37.7)<a class="headerlink" href="#equation-robust-mean-variance" title="Permalink to this equation">#</a></span>\[w' (\mu - \theta^{-1} \Sigma w ) - \frac{\delta}{2} w' \Sigma w\]</div>
<p>The minimizer of <a class="reference internal" href="#equation-robust-mean-variance">(37.7)</a> is</p>
<div class="math notranslate nohighlight">
\[
w_{\rm rob} = \frac{1}{\delta + \gamma } \Sigma^{-1} \mu
\]</div>
<p>where <span class="math notranslate nohighlight">\(\gamma \equiv \theta^{-1}\)</span> is sometimes called the
risk-sensitivity parameter.</p>
<p>An increase in the risk-sensitivity parameter <span class="math notranslate nohighlight">\(\gamma\)</span> shrinks the
portfolio weights toward zero in the same way that an increase in risk
aversion does.</p>
</section>
<section id="appendix">
<h2><span class="section-number">37.12. </span>Appendix<a class="headerlink" href="#appendix" title="Permalink to this heading">#</a></h2>
<p>We want to illustrate the “folk theorem” that with high or moderate
frequency data, it is more difficult to estimate means than variances.</p>
<p>In order to operationalize this statement, we take two analog
estimators:</p>
<ul class="simple">
<li><p>sample average: <span class="math notranslate nohighlight">\(\bar X_N = \frac{1}{N}\sum_{i=1}^{N} X_i\)</span></p></li>
<li><p>sample variance:
<span class="math notranslate nohighlight">\(S_N = \frac{1}{N-1}\sum_{t=1}^{N} (X_i - \bar X_N)^2\)</span></p></li>
</ul>
<p>to estimate the unconditional mean and unconditional variance of the
random variable <span class="math notranslate nohighlight">\(X\)</span>, respectively.</p>
<p>To measure the “difficulty of estimation”, we use <em>mean squared error</em>
(MSE), that is the average squared difference between the estimator and
the true value.</p>
<p>Assuming that the process <span class="math notranslate nohighlight">\(\{X_i\}\)</span>is ergodic,
both analog estimators are known to converge to their true values as the
sample size <span class="math notranslate nohighlight">\(N\)</span> goes to infinity.</p>
<p>More precisely
for all <span class="math notranslate nohighlight">\(\varepsilon &gt; 0\)</span></p>
<div class="math notranslate nohighlight">
\[
\lim_{N\to \infty} \ \ P\left\{ \left |\bar X_N - \mathbb E X \right| &gt; \varepsilon \right\} = 0 \quad \quad
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\lim_{N\to \infty} \ \ P \left\{ \left| S_N - \mathbb V X \right| &gt; \varepsilon \right\} = 0
\]</div>
<p>A necessary condition for these convergence results is that the
associated MSEs vanish as <span class="math notranslate nohighlight">\(N\)</span> goes to infinity, or in other words,</p>
<div class="math notranslate nohighlight">
\[
\text{MSE}(\bar X_N, \mathbb E X) = o(1) \quad \quad  \text{and} \quad \quad \text{MSE}(S_N, \mathbb V X) = o(1)
\]</div>
<p>Even if the MSEs converge to zero, the associated rates might be
different. Looking at the limit of the <em>relative MSE</em> (as the sample
size grows to infinity)</p>
<div class="math notranslate nohighlight">
\[
\frac{\text{MSE}(S_N, \mathbb V X)}{\text{MSE}(\bar X_N, \mathbb E X)} = \frac{o(1)}{o(1)} \underset{N \to \infty}{\to} B
\]</div>
<p>can inform us about the relative (asymptotic) rates.</p>
<p>We will show that in general, with dependent data, the limit
<span class="math notranslate nohighlight">\(B\)</span> depends on the sampling frequency.</p>
<p>In particular, we find
that the rate of convergence of the variance estimator is less sensitive
to increased sampling frequency than the rate of convergence of the mean
estimator.</p>
<p>Hence, we can expect the relative asymptotic
rate, <span class="math notranslate nohighlight">\(B\)</span>, to get smaller with higher frequency data,
illustrating that “it is more difficult to estimate means than
variances”.</p>
<p>That is, we need significantly more data to obtain a given
precision of the mean estimate than for our variance estimate.</p>
</section>
<section id="special-case-iid-sample">
<h2><span class="section-number">37.13. </span>Special Case – IID Sample<a class="headerlink" href="#special-case-iid-sample" title="Permalink to this heading">#</a></h2>
<p>We start our analysis with the benchmark case of IID data.</p>
<p>Consider a
sample of size <span class="math notranslate nohighlight">\(N\)</span> generated by the following IID process,</p>
<div class="math notranslate nohighlight">
\[
X_i \sim \mathcal{N}(\mu, \sigma^2)
\]</div>
<p>Taking <span class="math notranslate nohighlight">\(\bar X_N\)</span> to estimate the mean, the MSE is</p>
<div class="math notranslate nohighlight">
\[
\text{MSE}(\bar X_N, \mu) = \frac{\sigma^2}{N}
\]</div>
<p>Taking <span class="math notranslate nohighlight">\(S_N\)</span> to estimate the variance, the MSE is</p>
<div class="math notranslate nohighlight">
\[
\text{MSE}(S_N, \sigma^2) = \frac{2\sigma^4}{N-1}
\]</div>
<p>Both estimators are unbiased and hence the MSEs reflect the
corresponding variances of the estimators.</p>
<p>Furthermore, both MSEs are
<span class="math notranslate nohighlight">\(o(1)\)</span> with a (multiplicative) factor of difference in their rates
of convergence:</p>
<div class="math notranslate nohighlight">
\[
\frac{\text{MSE}(S_N, \sigma^2)}{\text{MSE}(\bar X_N, \mu)} = \frac{N2\sigma^2}{N-1} \quad \underset{N \to \infty}{\to} \quad 2\sigma^2
\]</div>
<p>We are interested in how this (asymptotic) relative rate of convergence
changes as increasing sampling frequency puts dependence into the data.</p>
</section>
<section id="dependence-and-sampling-frequency">
<h2><span class="section-number">37.14. </span>Dependence and Sampling Frequency<a class="headerlink" href="#dependence-and-sampling-frequency" title="Permalink to this heading">#</a></h2>
<p>To investigate how sampling frequency affects relative rates of
convergence, we assume that the data are generated by a mean-reverting
continuous time process of the form</p>
<div class="math notranslate nohighlight">
\[
dX_t = -\kappa (X_t -\mu)dt + \sigma dW_t\quad\quad
\]</div>
<p>where <span class="math notranslate nohighlight">\(\mu\)</span>is the unconditional mean, <span class="math notranslate nohighlight">\(\kappa &gt; 0\)</span> is a
persistence parameter, and <span class="math notranslate nohighlight">\(\{W_t\}\)</span> is a standardized Brownian
motion.</p>
<p>Observations arising from this system in particular discrete periods
<span class="math notranslate nohighlight">\(\mathcal T(h) \equiv \{nh : n \in \mathbb Z \}\)</span>with<span class="math notranslate nohighlight">\(h&gt;0\)</span>
can be described by the following process</p>
<div class="math notranslate nohighlight">
\[
X_{t+1} = (1 - \exp(-\kappa h))\mu + \exp(-\kappa h)X_t + \epsilon_{t, h}
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
\epsilon_{t, h} \sim \mathcal{N}(0, \Sigma_h) \quad \text{with}\quad \Sigma_h = \frac{\sigma^2(1-\exp(-2\kappa h))}{2\kappa}
\]</div>
<p>We call <span class="math notranslate nohighlight">\(h\)</span> the <em>frequency</em> parameter, whereas <span class="math notranslate nohighlight">\(n\)</span>
represents the number of <em>lags</em> between observations.</p>
<p>Hence, the effective distance between two observations <span class="math notranslate nohighlight">\(X_t\)</span> and
<span class="math notranslate nohighlight">\(X_{t+n}\)</span> in the discrete time notation is equal
to <span class="math notranslate nohighlight">\(h\cdot n\)</span> in terms of the underlying continuous time process.</p>
<p>Straightforward calculations show that the autocorrelation function for
the stochastic process <span class="math notranslate nohighlight">\(\{X_{t}\}_{t\in \mathcal T(h)}\)</span> is</p>
<div class="math notranslate nohighlight">
\[
\Gamma_h(n) \equiv \text{corr}(X_{t + h n}, X_t) = \exp(-\kappa h n)
\]</div>
<p>and the auto-covariance function is</p>
<div class="math notranslate nohighlight">
\[
\gamma_h(n) \equiv \text{cov}(X_{t + h n}, X_t) = \frac{\exp(-\kappa h n)\sigma^2}{2\kappa} .
\]</div>
<p>It follows that if <span class="math notranslate nohighlight">\(n=0\)</span>, the unconditional variance is given
by <span class="math notranslate nohighlight">\(\gamma_h(0) = \frac{\sigma^2}{2\kappa}\)</span> irrespective of the
sampling frequency.</p>
<p>The following figure illustrates how the dependence between the
observations is related to the sampling frequency</p>
<ul class="simple">
<li><p>For any given <span class="math notranslate nohighlight">\(h\)</span>, the autocorrelation converges to zero as we increase the distance – <span class="math notranslate nohighlight">\(n\)</span>– between the observations. This represents the “weak dependence” of the <span class="math notranslate nohighlight">\(X\)</span> process.</p></li>
<li><p>Moreover, for a fixed lag length, <span class="math notranslate nohighlight">\(n\)</span>, the dependence vanishes as the sampling frequency goes to infinity. In fact, letting <span class="math notranslate nohighlight">\(h\)</span> go to <span class="math notranslate nohighlight">\(\infty\)</span> gives back the case of IID data.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">μ</span> <span class="o">=</span> <span class="mf">.0</span>
<span class="n">κ</span> <span class="o">=</span> <span class="mf">.1</span>
<span class="n">σ</span> <span class="o">=</span> <span class="mf">.5</span>
<span class="n">var_uncond</span> <span class="o">=</span> <span class="n">σ</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">κ</span><span class="p">)</span>

<span class="n">n_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">autocorr_h1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">κ</span> <span class="o">*</span> <span class="n">n_grid</span> <span class="o">*</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">autocorr_h2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">κ</span> <span class="o">*</span> <span class="n">n_grid</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
<span class="n">autocorr_h5</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">κ</span> <span class="o">*</span> <span class="n">n_grid</span> <span class="o">*</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">autocorr_h1000</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">κ</span> <span class="o">*</span> <span class="n">n_grid</span> <span class="o">*</span> <span class="mf">1e8</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_grid</span><span class="p">,</span> <span class="n">autocorr_h1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$h=1$&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_grid</span><span class="p">,</span> <span class="n">autocorr_h2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$h=2$&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_grid</span><span class="p">,</span> <span class="n">autocorr_h5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$h=5$&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">n_grid</span><span class="p">,</span> <span class="n">autocorr_h1000</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;&quot;$h=\infty$&quot;&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkgreen&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Autocorrelation functions, $\Gamma_h(n)$&#39;</span><span class="p">,</span>
       <span class="n">xlabel</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;Lags between observations, $n$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d28f3526d6e7a0b842662a4c45f33a775f2917fd858f63e2cced88eb726909c6.png" src="_images/d28f3526d6e7a0b842662a4c45f33a775f2917fd858f63e2cced88eb726909c6.png" />
</div>
</div>
</section>
<section id="frequency-and-the-mean-estimator">
<h2><span class="section-number">37.15. </span>Frequency and the Mean Estimator<a class="headerlink" href="#frequency-and-the-mean-estimator" title="Permalink to this heading">#</a></h2>
<p>Consider again the AR(1) process generated by discrete sampling with
frequency <span class="math notranslate nohighlight">\(h\)</span>. Assume that we have a sample of size <span class="math notranslate nohighlight">\(N\)</span> and
we would like to estimate the unconditional mean – in our case the true
mean is <span class="math notranslate nohighlight">\(\mu\)</span>.</p>
<p>Again, the sample average is an unbiased estimator of the unconditional
mean</p>
<div class="math notranslate nohighlight">
\[
\mathbb{E}[\bar X_N] = \frac{1}{N}\sum_{i = 1}^N \mathbb{E}[X_i] = \mathbb{E}[X_0] = \mu
\]</div>
<p>The variance of the sample mean is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\mathbb{V}\left(\bar X_N\right) &amp;= \mathbb{V}\left(\frac{1}{N}\sum_{i = 1}^N X_i\right) \\
&amp;= \frac{1}{N^2} \left(\sum_{i = 1}^N \mathbb{V}(X_i) + 2 \sum_{i = 1}^{N-1} \sum_{s = i+1}^N \text{cov}(X_i, X_s) \right) \\
&amp;= \frac{1}{N^2} \left( N \gamma(0) + 2 \sum_{i=1}^{N-1} i \cdot \gamma\left(h\cdot (N - i)\right) \right) \\
&amp;= \frac{1}{N^2} \left( N \frac{\sigma^2}{2\kappa} + 2 \sum_{i=1}^{N-1} i \cdot \exp(-\kappa h (N - i)) \frac{\sigma^2}{2\kappa} \right)
\end{aligned}
\end{split}\]</div>
<p>It is explicit in the above equation that time dependence in the data
inflates the variance of the mean estimator through the covariance
terms.</p>
<p>Moreover, as we can see, a higher sampling frequency—smaller
<span class="math notranslate nohighlight">\(h\)</span>—makes all the covariance terms larger, everything else being
fixed.</p>
<p>This implies a relatively slower rate of convergence of the
sample average for high-frequency data.</p>
<p>Intuitively, stronger dependence across observations for high-frequency data reduces the
“information content” of each observation relative to the IID case.</p>
<p>We can upper bound the variance term in the following way</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\mathbb{V}(\bar X_N) &amp;= \frac{1}{N^2} \left( N \sigma^2 + 2 \sum_{i=1}^{N-1} i \cdot \exp(-\kappa h (N - i)) \sigma^2 \right) \\
&amp;\leq \frac{\sigma^2}{2\kappa N} \left(1 + 2 \sum_{i=1}^{N-1} \cdot \exp(-\kappa h (i)) \right) \\
&amp;= \underbrace{\frac{\sigma^2}{2\kappa N}}_{\text{IID  case}} \left(1 + 2 \frac{1 - \exp(-\kappa h)^{N-1}}{1 - \exp(-\kappa h)} \right)
\end{aligned}
\end{split}\]</div>
<p>Asymptotically, the term <span class="math notranslate nohighlight">\(\exp(-\kappa h)^{N-1}\)</span> vanishes and the
dependence in the data inflates the benchmark IID variance by a factor
of</p>
<div class="math notranslate nohighlight">
\[
\left(1 + 2 \frac{1}{1 - \exp(-\kappa h)} \right)
\]</div>
<p>This long run factor is larger the higher is the frequency (the smaller
is <span class="math notranslate nohighlight">\(h\)</span>).</p>
<p>Therefore, we expect the asymptotic relative MSEs, <span class="math notranslate nohighlight">\(B\)</span>, to change
with time-dependent data. We just saw that the mean estimator’s rate is
roughly changing by a factor of</p>
<div class="math notranslate nohighlight">
\[
\left(1 + 2 \frac{1}{1 - \exp(-\kappa h)} \right)
\]</div>
<p>Unfortunately, the variance estimator’s MSE is harder to derive.</p>
<p>Nonetheless, we can approximate it by using (large sample) simulations,
thus getting an idea about how the asymptotic relative MSEs changes in
the sampling frequency <span class="math notranslate nohighlight">\(h\)</span> relative to the IID case that we
compute in closed form.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nd">@jit</span>
<span class="k">def</span> <span class="nf">sample_generator</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">):</span>
    <span class="n">ϕ</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">κ</span> <span class="o">*</span> <span class="n">h</span><span class="p">))</span> <span class="o">*</span> <span class="n">μ</span>
    <span class="n">ρ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">κ</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">σ</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">κ</span> <span class="o">*</span> <span class="n">h</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">κ</span><span class="p">)</span>

    <span class="n">mean_uncond</span> <span class="o">=</span> <span class="n">μ</span>
    <span class="n">std_uncond</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">σ</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">κ</span><span class="p">))</span>

    <span class="n">ε_path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">s</span><span class="p">),</span> <span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>

    <span class="n">y_path</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">M</span><span class="p">,</span> <span class="n">N</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">y_path</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean_uncond</span><span class="p">,</span> <span class="n">std_uncond</span><span class="p">,</span> <span class="n">M</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">y_path</span><span class="p">[:,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ϕ</span> <span class="o">+</span> <span class="n">ρ</span> <span class="o">*</span> <span class="n">y_path</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="n">ε_path</span><span class="p">[:,</span> <span class="n">i</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">y_path</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Generate large sample for different frequencies</span>
<span class="n">N_app</span><span class="p">,</span> <span class="n">M_app</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">,</span> <span class="mi">30000</span>        <span class="c1"># Sample size, number of simulations</span>
<span class="n">h_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">.1</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>

<span class="n">var_est_store</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">mean_est_store</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">h_grid</span><span class="p">:</span>
    <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">h</span><span class="p">)</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">sample_generator</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">N_app</span><span class="p">,</span> <span class="n">M_app</span><span class="p">)</span>
    <span class="n">mean_est_store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">var_est_store</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">var_est_store</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">var_est_store</span><span class="p">)</span>
<span class="n">mean_est_store</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mean_est_store</span><span class="p">)</span>

<span class="c1"># Save mse of estimators</span>
<span class="n">mse_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">mean_est_store</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">mean_est_store</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">μ</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">mse_var</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">var_est_store</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> \
          <span class="o">+</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">var_est_store</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">var_uncond</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>

<span class="n">benchmark_rate</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">var_uncond</span>       <span class="c1"># IID case</span>

<span class="c1"># Relative MSE for large samples</span>
<span class="n">rate_h</span> <span class="o">=</span> <span class="n">mse_var</span> <span class="o">/</span> <span class="n">mse_mean</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">h_grid</span><span class="p">,</span> <span class="n">rate_h</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;large sample relative MSE, $B(h)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">benchmark_rate</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;IID benchmark&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Relative MSE for large samples as a function of sampling </span><span class="se">\</span>
<span class="s1">              frequency </span><span class="se">\n</span><span class="s1"> MSE($S_N$) relative to MSE($</span><span class="se">\\</span><span class="s1">bar X_N$)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Sampling frequency, $h$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/122d026c92afa1f360096098b2c28d8cb765eb8cb4c0ce311f5dab252d33681d.png" src="_images/122d026c92afa1f360096098b2c28d8cb765eb8cb4c0ce311f5dab252d33681d.png" />
</div>
</div>
<p>The above figure illustrates the relationship between the asymptotic
relative MSEs and the sampling frequency</p>
<ul class="simple">
<li><p>We can see that with low-frequency data – large values of <span class="math notranslate nohighlight">\(h\)</span>
– the ratio of asymptotic rates approaches the IID case.</p></li>
<li><p>As <span class="math notranslate nohighlight">\(h\)</span> gets smaller – the higher the frequency – the relative
performance of the variance estimator is better in the sense that the
ratio of asymptotic rates gets smaller. That is, as the time
dependence gets more pronounced, the rate of convergence of the mean
estimator’s MSE deteriorates more than that of the variance
estimator.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="orth_proj.html">
   1. Orthogonal Projections and Their Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stationary_densities.html">
   2. Continuous State Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="muth_kalman.html">
   3. Reverse Engineering a la Muth
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="discrete_dp.html">
   4. Discrete State Dynamic Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cons_news.html">
   5. Information and Consumption Smoothing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing.html">
   6. Consumption Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing_tax.html">
   7. Tax Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_jump_lq.html">
   8. Markov Jump Linear Quadratic Dynamic Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_1.html">
   9. How to Pay for a War: Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_2.html">
   10. How to Pay for a War: Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_3.html">
   11. How to Pay for a War: Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lqramsey.html">
   12. Optimal Taxation in an LQ Economy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arellano.html">
   13. Default Risk and Income Fluctuations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="matsuyama.html">
   14. Globalization and Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coase.html">
   15. Coase’s Theory of the Firm
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="match_transport.html">
   16. Composite Sorting
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Linear Economies
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="hs_recursive_models.html">
   17. Recursive Models of Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="growth_in_dles.html">
   18. Growth in Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_asset_pricing_dles.html">
   19. Lucas Asset Pricing Using DLE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irfs_in_hall_model.html">
   20. IRFs in Hall Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="permanent_income_dles.html">
   21. Permanent Income Model using the DLE Class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rosen_schooling_model.html">
   22. Rosen Schooling Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cattle_cycles.html">
   23. Cattle Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hs_invertibility_example.html">
   24. Shock Non Invertibility
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Risk, Model Uncertainty, and Robustness
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="five_preferences.html">
   25. Risk and Model Uncertainty
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="entropy.html">
   26. Etymology of Entropy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="robustness.html">
   27. Robustness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rob_markov_perf.html">
   28. Robust Markov Perfect Equilibrium
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time Series Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arma.html">
   29. Covariance Stationary Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="estspec.html">
   30. Estimation of Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="additive_functionals.html">
   31. Additive and Multiplicative Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lu_tricks.html">
   32. Classical Control with Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classical_filtering.html">
   33. Classical Prediction and Filtering With Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="knowing_forecasts_of_others.html">
   34. Knowing the Forecasts of Others
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_model.html">
   35. Asset Pricing II: The Lucas Asset Pricing Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="asset_pricing_lph.html">
   36. Elementary Asset Pricing Theory
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   37. Two Modifications of Mean-Variance Portfolio Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_complete_mkts.html">
   38. Irrelevance of Capital Structures with Complete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_incomplete_mkts.html">
   39. Equilibrium Capital Structures with Incomplete Markets
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Programming Squared
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="un_insure.html">
   40. Optimal Unemployment Insurance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dyn_stack.html">
   41. Stackelberg Plans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo_machine_learn.html">
   42. Machine Learning a Ramsey Plan
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo.html">
   43. Time Inconsistency of Ramsey Plans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo_abreu.html">
   44. Sustainable Plans for a Calvo Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="opt_tax_recur.html">
   45. Optimal Taxation with State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss.html">
   46. Optimal Taxation without State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss2.html">
   47. Fluctuating Interest Rates Deliver Fiscal Insurance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss3.html">
   48. Fiscal Risk and Government Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_ramsey.html">
   49. Competitive Equilibria of a Model of Chang
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_credible.html">
   50. Credible Government Policies in a Model of Chang
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   51. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   52. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   53. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/black_litterman.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li class="download-pdf" id="downloadButton"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-advanced.myst/blob/main/lectures/black_litterman.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-advanced.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="/_pdf/quantecon-python-advanced.pdf" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python-advanced.notebooks/blob/main/black_litterman.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python-advanced.notebooks" data-urlpath="tree/lecture-python-advanced.notebooks/black_litterman.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python-advanced.notebooks/blob/main/black_litterman.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "black_litterman";
                const repoURL = "https://github.com/QuantEcon/lecture-python-advanced.notebooks";
                const urlPath = "tree/lecture-python-advanced.notebooks/black_litterman.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>