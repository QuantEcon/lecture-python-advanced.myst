
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>40. Optimal Taxation without State-Contingent Debt &#8212; Advanced Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    <script>
        MathJax = {
          loader: {load: ['[tex]/boldsymbol']},
          tex: {
            packages: {'[+]': ['boldsymbol']},
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            processEscapes: true,
            macros: {
                "argmax" : "arg\\,max",
                "argmin" : "arg\\,min"
            }
          },
          svg: {
            fontCache: 'global',
            scale: 0.92,
            displayAlign: "center",
          },
        };
    </script>
    
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="_static/quantecon-book-theme.48c7e3a8f180f886af6ac238ed81cfdf.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">


    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script src="_static/quantecon-book-theme.f77f720613e25edc6a92ce4459c6ecdc.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-svg.js"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"argmax": "arg\\,max", "argmin": "arg\\,min"}}, "tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://python-advanced.quantecon.org/amss.html" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="41. Fluctuating Interest Rates Deliver Fiscal Insurance" href="amss2.html" />
    <link rel="prev" title="39. Optimal Taxation with State-Contingent Debt" href="opt_tax_recur.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Optimal Taxation without State-Contingent Debt"/>
<meta name="twitter:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Optimal Taxation without State-Contingent Debt" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python-advanced.quantecon.org/amss.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Advanced Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="wrapper">

        <div class="main">

            <div class="page" id=amss>

                <div class="page__toc">

                    <div class="inner">

                        
                        <div class="page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   40.1. Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#competitive-equilibrium-with-distorting-taxes">
   40.2. Competitive Equilibrium with Distorting Taxes
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#risk-free-one-period-debt-only">
     40.2.1. Risk-free One-Period Debt Only
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#comparison-with-lucas-stokey-economy">
     40.2.2. Comparison with Lucas-Stokey Economy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#ramsey-problem-without-state-contingent-debt">
     40.2.3. Ramsey Problem Without State-contingent Debt
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#lagrangian-formulation">
       40.2.3.1. Lagrangian Formulation
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#some-calculations">
     40.2.4. Some Calculations
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#recursive-version-of-amss-model">
   40.3. Recursive Version of AMSS Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#recasting-state-variables">
     40.3.1. Recasting State Variables
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#measurability-constraints">
     40.3.2. Measurability Constraints
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#two-bellman-equations">
     40.3.3. Two Bellman Equations
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#martingale-supercedes-state-variable-degeneracy">
     40.3.4. Martingale Supercedes State-Variable Degeneracy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#absence-of-state-variable-degeneracy">
     40.3.5. Absence of State Variable Degeneracy
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#digression-on-non-negative-transfers">
     40.3.6. Digression on Non-negative Transfers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#code">
     40.3.7. Code
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#examples">
   40.4. Examples
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#anticipated-one-period-war">
     40.4.1. Anticipated One-Period War
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#perpetual-war-alert">
       40.4.1.1. Perpetual War Alert
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
</ul>

                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="page__header">

                    <div class="page__header-copy">

                        <p class="page__header-heading"><a href="intro.html">Advanced Quantitative Economics with Python</a></p>

                        <p class="page__header-subheading">Optimal Taxation without State-Contingent Debt</p>

                    </div>

                    <p class="page__header-authors">Thomas J. Sargent & John Stachurski</p>

                </div> <!-- .page__header -->



                
                <main class="page__content" role="main">
                    
                    <div>
                        
  <div id="qe-notebook-header" align="right" style="text-align:right;">
        <a href="https://quantecon.org/" title="quantecon.org">
                <img style="width:250px;display:inline;" width="250px" src="https://assets.quantecon.org/img/qe-menubar-logo.svg" alt="QuantEcon">
        </a>
</div><div class="section" id="optimal-taxation-without-state-contingent-debt">
<h1><a class="toc-backref" href="#id10"><span class="section-number">40. </span>Optimal Taxation without State-Contingent Debt</a><a class="headerlink" href="#optimal-taxation-without-state-contingent-debt" title="Permalink to this headline">¶</a></h1>
<div class="contents topic" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#optimal-taxation-without-state-contingent-debt" id="id10">Optimal Taxation without State-Contingent Debt</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id11">Overview</a></p></li>
<li><p><a class="reference internal" href="#competitive-equilibrium-with-distorting-taxes" id="id12">Competitive Equilibrium with Distorting Taxes</a></p></li>
<li><p><a class="reference internal" href="#recursive-version-of-amss-model" id="id13">Recursive Version of AMSS Model</a></p></li>
<li><p><a class="reference internal" href="#examples" id="id14">Examples</a></p></li>
</ul>
</li>
</ul>
</div>
<p>In addition to what’s in Anaconda, this lecture will need the following libraries:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install --upgrade quantecon
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already up-to-date: quantecon in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (0.5.0)
Requirement already satisfied, skipping upgrade: numba&gt;=0.38 in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from quantecon) (0.50.1)
Requirement already satisfied, skipping upgrade: sympy in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from quantecon) (1.6.1)
Requirement already satisfied, skipping upgrade: scipy&gt;=1.0.0 in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from quantecon) (1.5.0)
Requirement already satisfied, skipping upgrade: numpy in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from quantecon) (1.18.5)
Requirement already satisfied, skipping upgrade: requests in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from quantecon) (2.24.0)
Requirement already satisfied, skipping upgrade: llvmlite&lt;0.34,&gt;=0.33.0.dev0 in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from numba&gt;=0.38-&gt;quantecon) (0.33.0+1.g022ab0f)
Requirement already satisfied, skipping upgrade: setuptools in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from numba&gt;=0.38-&gt;quantecon) (49.2.0.post20200714)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied, skipping upgrade: mpmath&gt;=0.19 in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from sympy-&gt;quantecon) (1.1.0)
Requirement already satisfied, skipping upgrade: chardet&lt;4,&gt;=3.0.2 in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from requests-&gt;quantecon) (3.0.4)
Requirement already satisfied, skipping upgrade: certifi&gt;=2017.4.17 in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from requests-&gt;quantecon) (2021.5.30)
Requirement already satisfied, skipping upgrade: urllib3!=1.25.0,!=1.25.1,&lt;1.26,&gt;=1.21.1 in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from requests-&gt;quantecon) (1.25.9)
Requirement already satisfied, skipping upgrade: idna&lt;3,&gt;=2.5 in /usr/share/miniconda3/envs/quantecon/lib/python3.8/site-packages (from requests-&gt;quantecon) (2.10)
</pre></div>
</div>
</div>
</div>
<div class="section" id="overview">
<h2><a class="toc-backref" href="#id11"><span class="section-number">40.1. </span>Overview</a><a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>Let’s start with following imports:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">root</span><span class="p">,</span> <span class="n">fmin_slsqp</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>
<span class="kn">from</span> <span class="nn">quantecon</span> <span class="kn">import</span> <span class="n">MarkovChain</span>
</pre></div>
</div>
</div>
</div>
<p>In <a class="reference internal" href="opt_tax_recur.html"><span class="doc">an earlier lecture</span></a>, we described a model of
optimal taxation with state-contingent debt due to
Robert E. Lucas, Jr.,  and Nancy Stokey  <span id="id1">[<a class="reference internal" href="zreferences.html#id156"><span>LS83</span></a>]</span>.</p>
<p>Aiyagari, Marcet, Sargent, and Seppälä <span id="id2">[<a class="reference internal" href="zreferences.html#id110"><span>AMSSeppala02</span></a>]</span>  (hereafter, AMSS)
studied optimal taxation in a model without state-contingent debt.</p>
<p>In this lecture, we</p>
<ul class="simple">
<li><p>describe assumptions and equilibrium concepts</p></li>
<li><p>solve the model</p></li>
<li><p>implement the model numerically</p></li>
<li><p>conduct some policy experiments</p></li>
<li><p>compare outcomes with those in a corresponding complete-markets model</p></li>
</ul>
<p>We begin with an introduction to the model.</p>
</div>
<div class="section" id="competitive-equilibrium-with-distorting-taxes">
<h2><a class="toc-backref" href="#id12"><span class="section-number">40.2. </span>Competitive Equilibrium with Distorting Taxes</a><a class="headerlink" href="#competitive-equilibrium-with-distorting-taxes" title="Permalink to this headline">¶</a></h2>
<p>Many but not all features of the economy are identical to those of <a class="reference internal" href="opt_tax_recur.html"><span class="doc">the Lucas-Stokey economy</span></a>.</p>
<p>Let’s start with things that are identical.</p>
<p>For <span class="math notranslate nohighlight">\(t \geq 0\)</span>, a history of the state is represented by <span class="math notranslate nohighlight">\(s^t = [s_t, s_{t-1}, \ldots, s_0]\)</span>.</p>
<p>Government purchases <span class="math notranslate nohighlight">\(g(s)\)</span> are an exact time-invariant function of <span class="math notranslate nohighlight">\(s\)</span>.</p>
<p>Let <span class="math notranslate nohighlight">\(c_t(s^t)\)</span>,  <span class="math notranslate nohighlight">\(\ell_t(s^t)\)</span>, and <span class="math notranslate nohighlight">\(n_t(s^t)\)</span> denote consumption,
leisure, and labor supply, respectively, at history <span class="math notranslate nohighlight">\(s^t\)</span> at time <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>Each period a representative  household is endowed with one unit of time that can be divided between  leisure
<span class="math notranslate nohighlight">\(\ell_t\)</span> and labor <span class="math notranslate nohighlight">\(n_t\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-feas1-amss">
<span class="eqno">(40.1)<a class="headerlink" href="#equation-feas1-amss" title="Permalink to this equation">¶</a></span>\[n_t(s^t) + \ell_t(s^t) = 1\]</div>
<p>Output equals <span class="math notranslate nohighlight">\(n_t(s^t)\)</span> and can be divided between consumption <span class="math notranslate nohighlight">\(c_t(s^t)\)</span> and <span class="math notranslate nohighlight">\(g(s_t)\)</span></p>
<div class="math notranslate nohighlight" id="equation-tss-techr-amss">
<span class="eqno">(40.2)<a class="headerlink" href="#equation-tss-techr-amss" title="Permalink to this equation">¶</a></span>\[c_t(s^t) + g(s_t) = n_t(s^t)\]</div>
<p>Output is not storable.</p>
<p>The technology pins down a pre-tax wage rate to unity for all <span class="math notranslate nohighlight">\(t, s^t\)</span>.</p>
<p>A representative  household’s preferences over <span class="math notranslate nohighlight">\(\{c_t(s^t), \ell_t(s^t)\}_{t=0}^\infty\)</span> are ordered by</p>
<div class="math notranslate nohighlight" id="equation-ts-prefr-amss">
<span class="eqno">(40.3)<a class="headerlink" href="#equation-ts-prefr-amss" title="Permalink to this equation">¶</a></span>\[\sum_{t=0}^\infty \sum_{s^t} \beta^t \pi_t(s^t) u[c_t(s^t), \ell_t(s^t)]\]</div>
<p>where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\pi_t(s^t)\)</span> is a joint probability distribution over the sequence <span class="math notranslate nohighlight">\(s^t\)</span>, and</p></li>
<li><p>the utility function <span class="math notranslate nohighlight">\(u\)</span> is  increasing, strictly concave, and three times  continuously differentiable in both arguments.</p></li>
</ul>
<p>The government imposes a flat rate tax <span class="math notranslate nohighlight">\(\tau_t(s^t)\)</span> on labor income at time <span class="math notranslate nohighlight">\(t\)</span>, history <span class="math notranslate nohighlight">\(s^t\)</span>.</p>
<p>Lucas and Stokey assumed that there are complete markets in one-period Arrow securities; also see <a class="reference internal" href="smoothing.html"><span class="doc">smoothing models</span></a>.</p>
<p>It is at this point that AMSS <span id="id3">[<a class="reference internal" href="zreferences.html#id110"><span>AMSSeppala02</span></a>]</span> modify the Lucas and Stokey economy.</p>
<p>AMSS allow the government to issue only one-period risk-free debt each period.</p>
<p>Ruling out complete markets in this way is a step in the direction of making total tax collections behave more like that prescribed in Robert Barro (1979) <span id="id4">[<a class="reference internal" href="zreferences.html#id116"><span>Bar79</span></a>]</span> than they do in Lucas and Stokey (1983) <span id="id5">[<a class="reference internal" href="zreferences.html#id156"><span>LS83</span></a>]</span>.</p>
<div class="section" id="risk-free-one-period-debt-only">
<h3><span class="section-number">40.2.1. </span>Risk-free One-Period Debt Only<a class="headerlink" href="#risk-free-one-period-debt-only" title="Permalink to this headline">¶</a></h3>
<p>In period <span class="math notranslate nohighlight">\(t\)</span> and history <span class="math notranslate nohighlight">\(s^t\)</span>, let</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(b_{t+1}(s^t)\)</span> be the amount of the time <span class="math notranslate nohighlight">\(t+1\)</span> consumption good that at time <span class="math notranslate nohighlight">\(t\)</span>, history <span class="math notranslate nohighlight">\(s^t\)</span> the government promised to pay</p></li>
<li><p><span class="math notranslate nohighlight">\(R_t(s^t)\)</span> be the gross interest rate on  risk-free one-period debt between periods <span class="math notranslate nohighlight">\(t\)</span> and <span class="math notranslate nohighlight">\(t+1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(T_t(s^t)\)</span> be a non-negative lump-sum <em>transfer</em> to the representative household <a class="footnote-reference brackets" href="#fn-a" id="id6">1</a></p></li>
</ul>
<p>That <span class="math notranslate nohighlight">\(b_{t+1}(s^t)\)</span> is the same for all realizations of <span class="math notranslate nohighlight">\(s_{t+1}\)</span> captures its <em>risk-free</em> character.</p>
<p>The market value at time <span class="math notranslate nohighlight">\(t\)</span> of government debt maturing at time <span class="math notranslate nohighlight">\(t+1\)</span> equals <span class="math notranslate nohighlight">\(b_{t+1}(s^t)\)</span> divided by <span class="math notranslate nohighlight">\(R_t(s^t)\)</span>.</p>
<p>The government’s budget constraint in period <span class="math notranslate nohighlight">\(t\)</span> at history <span class="math notranslate nohighlight">\(s^t\)</span> is</p>
<div class="math notranslate nohighlight" id="equation-ts-gov-wo">
<span class="eqno">(40.4)<a class="headerlink" href="#equation-ts-gov-wo" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
b_t(s^{t-1})
    &amp; =    \tau^n_t(s^t) n_t(s^t) - g(s_t) - T_t(s^t) +
                   {b_{t+1}(s^t) \over R_t(s^t )}
    \\
    &amp; \equiv z_t(s^t) + {b_{t+1}(s^t) \over R_t(s^t )},
\end{aligned}\end{split}\]</div>
<p>where <span class="math notranslate nohighlight">\(z_t(s^t)\)</span> is the net-of-interest government surplus.</p>
<p>To rule out Ponzi schemes, we assume that the government is subject to a <strong>natural debt limit</strong> (to be discussed in a forthcoming lecture).</p>
<p>The consumption Euler equation for a representative household able to trade only one-period risk-free debt
with one-period gross interest rate <span class="math notranslate nohighlight">\(R_t(s^t)\)</span> is</p>
<div class="math notranslate nohighlight">
\[
{1 \over R_t(s^t)}
= \sum_{s^{t+1}\vert s^t} \beta  \pi_{t+1}(s^{t+1} | s^t)
                        { u_c(s^{t+1}) \over u_c(s^{t}) }
\]</div>
<p>Substituting this expression into the government’s budget constraint <a class="reference internal" href="#equation-ts-gov-wo">(40.4)</a>
yields:</p>
<div class="math notranslate nohighlight" id="equation-ts-gov-wo2">
<span class="eqno">(40.5)<a class="headerlink" href="#equation-ts-gov-wo2" title="Permalink to this equation">¶</a></span>\[b_t(s^{t-1}) =  z_t(s^t) + \beta  \sum_{s^{t+1}\vert s^t}  \pi_{t+1}(s^{t+1} | s^t)
                       { u_c(s^{t+1}) \over u_c(s^{t}) } \; b_{t+1}(s^t)\]</div>
<p>Components of <span class="math notranslate nohighlight">\(z_t(s^t)\)</span> on the right side depend on <span class="math notranslate nohighlight">\(s^t\)</span>, but the left side is required to depend only
on <span class="math notranslate nohighlight">\(s^{t-1}\)</span> .</p>
<p><strong>This is what it means for one-period government debt to be risk-free</strong>.</p>
<p>Therefore, the right side of equation <a class="reference internal" href="#equation-ts-gov-wo2">(40.5)</a> also has to depend only on <span class="math notranslate nohighlight">\(s^{t-1}\)</span>.</p>
<p>This requirement will give rise to <strong>measurability constraints</strong> on the Ramsey allocation to be discussed soon.</p>
<p>If we replace <span class="math notranslate nohighlight">\(b_{t+1}(s^t)\)</span> on the right side of equation <a class="reference internal" href="#equation-ts-gov-wo2">(40.5)</a> by the right
side of next period’s budget constraint (associated with a
particular realization <span class="math notranslate nohighlight">\(s_{t}\)</span>) we get</p>
<div class="math notranslate nohighlight">
\[
b_t(s^{t-1}) =  z_t(s^t) + \sum_{s^{t+1}\vert s^t} \beta  \pi_{t+1}(s^{t+1} | s^t)
                       { u_c(s^{t+1}) \over u_c(s^{t}) }
\, \left[z_{t+1}(s^{t+1}) + {b_{t+2}(s^{t+1}) \over R_{t+1}(s^{t+1})}\right]
\]</div>
<p>After making similar repeated substitutions for all future occurrences of
government indebtedness, and by invoking a natural debt limit, we
arrive at:</p>
<div class="math notranslate nohighlight" id="equation-ts-gov-wo3">
<span class="eqno">(40.6)<a class="headerlink" href="#equation-ts-gov-wo3" title="Permalink to this equation">¶</a></span>\[\begin{aligned}
b_t(s^{t-1})
    &amp;=  \sum_{j=0}^\infty \sum_{s^{t+j} | s^t} \beta^j  \pi_{t+j}(s^{t+j} | s^t)
              { u_c(s^{t+j}) \over u_c(s^{t}) } \;z_{t+j}(s^{t+j})
        \end{aligned}\]</div>
<p>Notice how the conditioning sets in equation <a class="reference internal" href="#equation-ts-gov-wo3">(40.6)</a> differ: they are <span class="math notranslate nohighlight">\(s^{t-1}\)</span> on the left side and
<span class="math notranslate nohighlight">\(s^t\)</span> on the right side.</p>
<p>Now let’s</p>
<ul class="simple">
<li><p>substitute the resource constraint into the net-of-interest government surplus, and</p></li>
<li><p>use the household’s first-order condition <span class="math notranslate nohighlight">\(1-\tau^n_t(s^t)= u_{\ell}(s^t) /u_c(s^t)\)</span> to eliminate the labor tax rate</p></li>
</ul>
<p>so that we can express the net-of-interest government surplus <span class="math notranslate nohighlight">\(z_t(s^t)\)</span> as</p>
<div class="math notranslate nohighlight" id="equation-amss-44-2">
<span class="eqno">(40.7)<a class="headerlink" href="#equation-amss-44-2" title="Permalink to this equation">¶</a></span>\[z_t(s^t)
    = \left[1 - {u_{\ell}(s^t) \over u_c(s^t)}\right] \left[c_t(s^t)+g(s_t)\right]
        -g(s_t) - T_t(s^t)\,.\]</div>
<p>If we substitute  appropriate versions of the right side of <a class="reference internal" href="#equation-amss-44-2">(40.7)</a> for <span class="math notranslate nohighlight">\(z_{t+j}(s^{t+j})\)</span> into equation <a class="reference internal" href="#equation-ts-gov-wo3">(40.6)</a>,
we obtain a sequence of <em>implementability constraints</em> on a Ramsey allocation in an AMSS economy.</p>
<p>Expression <a class="reference internal" href="#equation-ts-gov-wo3">(40.6)</a> at time <span class="math notranslate nohighlight">\(t=0\)</span> and initial state <span class="math notranslate nohighlight">\(s^0\)</span>
was also  an <em>implementability constraint</em> on a Ramsey allocation in a Lucas-Stokey economy:</p>
<div class="math notranslate nohighlight" id="equation-ts-gov-wo4">
<span class="eqno">(40.8)<a class="headerlink" href="#equation-ts-gov-wo4" title="Permalink to this equation">¶</a></span>\[b_0(s^{-1}) = \mathbb E_0 \sum_{j=0}^\infty \beta^j
               { u_c(s^{j}) \over u_c(s^{0}) } \;z_j(s^{j})\]</div>
<p>Indeed, it was the <em>only</em> implementability constraint there.</p>
<p>But now we also have a large number of additional implementability constraints</p>
<div class="math notranslate nohighlight" id="equation-ts-gov-wo4a">
<span class="eqno">(40.9)<a class="headerlink" href="#equation-ts-gov-wo4a" title="Permalink to this equation">¶</a></span>\[b_t(s^{t-1}) =  \mathbb E_t \sum_{j=0}^\infty \beta^j
              { u_c(s^{t+j}) \over u_c(s^{t}) } \;z_{t+j}(s^{t+j})\]</div>
<p>Equation <a class="reference internal" href="#equation-ts-gov-wo4a">(40.9)</a> must hold for each <span class="math notranslate nohighlight">\(s^t\)</span> for each <span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
</div>
<div class="section" id="comparison-with-lucas-stokey-economy">
<h3><span class="section-number">40.2.2. </span>Comparison with Lucas-Stokey Economy<a class="headerlink" href="#comparison-with-lucas-stokey-economy" title="Permalink to this headline">¶</a></h3>
<p>The expression on the right side of <a class="reference internal" href="#equation-ts-gov-wo4a">(40.9)</a> in the Lucas-Stokey (1983) economy would  equal the present value of a continuation stream of government net-of-interest surpluses evaluated at what would be competitive equilibrium Arrow-Debreu prices at date <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>In the Lucas-Stokey economy, that present value is measurable with respect to <span class="math notranslate nohighlight">\(s^t\)</span>.</p>
<p>In the AMSS economy, the restriction that government debt be risk-free imposes that that same present value must be measurable with respect to <span class="math notranslate nohighlight">\(s^{t-1}\)</span>.</p>
<p>In a language used in the literature on incomplete markets models, it can be said that the AMSS model requires that at each <span class="math notranslate nohighlight">\((t, s^t)\)</span> what would be the present value of continuation government net-of-interest surpluses in the Lucas-Stokey model must belong to  the <strong>marketable subspace</strong> of the AMSS model.</p>
</div>
<div class="section" id="ramsey-problem-without-state-contingent-debt">
<h3><span class="section-number">40.2.3. </span>Ramsey Problem Without State-contingent Debt<a class="headerlink" href="#ramsey-problem-without-state-contingent-debt" title="Permalink to this headline">¶</a></h3>
<p>After we have substituted the resource constraint into the utility function, we can express the Ramsey problem as being to choose an allocation that solves</p>
<div class="math notranslate nohighlight">
\[
\max_{\{c_t(s^t),b_{t+1}(s^t)\}}
\mathbb E_0 \sum_{t=0}^\infty \beta^t
                        u\left(c_t(s^t),1-c_t(s^t)-g(s_t)\right)
\]</div>
<p>where the maximization is subject to</p>
<div class="math notranslate nohighlight" id="equation-amss-44">
<span class="eqno">(40.10)<a class="headerlink" href="#equation-amss-44" title="Permalink to this equation">¶</a></span>\[\mathbb E_{0} \sum_{j=0}^\infty \beta^j
      { u_c(s^{j}) \over u_c(s^{0}) } \;z_j(s^{j}) \geq b_0(s^{-1})\]</div>
<p>and</p>
<div class="math notranslate nohighlight" id="equation-amss-46">
<span class="eqno">(40.11)<a class="headerlink" href="#equation-amss-46" title="Permalink to this equation">¶</a></span>\[\mathbb E_{t} \sum_{j=0}^\infty \beta^j
    { u_c(s^{t+j}) \over u_c(s^{t}) } \;
    z_{t+j}(s^{t+j}) = b_t(s^{t-1})
      \quad \forall \, t,  s^t\]</div>
<p>given <span class="math notranslate nohighlight">\(b_0(s^{-1})\)</span>.</p>
<div class="section" id="lagrangian-formulation">
<h4><span class="section-number">40.2.3.1. </span>Lagrangian Formulation<a class="headerlink" href="#lagrangian-formulation" title="Permalink to this headline">¶</a></h4>
<p>Let <span class="math notranslate nohighlight">\(\gamma_0(s^0)\)</span> be a non-negative Lagrange multiplier on constraint <a class="reference internal" href="#equation-amss-44">(40.10)</a>.</p>
<p>As in the Lucas-Stokey economy, this multiplier is strictly positive when the government must resort to
distortionary taxation; otherwise it equals zero.</p>
<p>A consequence of the assumption that there are no markets in state-contingent securities  and that a market exists only in a risk-free security is that we have to attach a stochastic process <span class="math notranslate nohighlight">\(\{\gamma_t(s^t)\}_{t=1}^\infty\)</span> of
Lagrange multipliers to the implementability constraints <a class="reference internal" href="#equation-amss-46">(40.11)</a>.</p>
<p>Depending on how the constraints  bind, these multipliers can be positive or negative:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
   \gamma_t(s^t)
   &amp;\;\geq\; (\leq)\;\, 0 \quad \text{if the constraint binds in the following direction }
   \\
   &amp; \mathbb E_{t} \sum_{j=0}^\infty \beta^j
    { u_c(s^{t+j}) \over u_c(s^{t}) } \;z_{t+j}(s^{t+j}) \;\geq \;(\leq)\;\, b_t(s^{t-1})
\end{aligned}
\end{split}\]</div>
<p>A negative multiplier <span class="math notranslate nohighlight">\(\gamma_t(s^t)&lt;0\)</span> means that if we could
relax constraint <a class="reference internal" href="#equation-amss-46">(40.11)</a>, we would like to <em>increase</em> the beginning-of-period
indebtedness for that particular realization of history <span class="math notranslate nohighlight">\(s^t\)</span>.</p>
<p>That would let us reduce the beginning-of-period indebtedness for some other history <a class="footnote-reference brackets" href="#fn-b" id="id7">2</a>.</p>
<p>These features flow from  the fact that the government cannot use state-contingent debt and therefore cannot allocate its indebtedness  efficiently across future states.</p>
</div>
</div>
<div class="section" id="some-calculations">
<h3><span class="section-number">40.2.4. </span>Some Calculations<a class="headerlink" href="#some-calculations" title="Permalink to this headline">¶</a></h3>
<p>It is helpful to apply two transformations to the Lagrangian.</p>
<p>Multiply constraint <a class="reference internal" href="#equation-amss-44">(40.10)</a> by <span class="math notranslate nohighlight">\(u_c(s^0)\)</span> and the constraints <a class="reference internal" href="#equation-amss-46">(40.11)</a> by <span class="math notranslate nohighlight">\(\beta^t u_c(s^{t})\)</span>.</p>
<p>Then a Lagrangian for the Ramsey problem can  be represented as</p>
<div class="math notranslate nohighlight" id="equation-amss-lagr-a">
<span class="eqno">(40.12)<a class="headerlink" href="#equation-amss-lagr-a" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
   J &amp;= \mathbb E_{0} \sum_{t=0}^\infty \beta^t
                        \biggl\{ u\left(c_t(s^t), 1-c_t(s^t)-g(s_t)\right)\\
   &amp;  \qquad + \gamma_t(s^t) \Bigl[ \mathbb E_{t} \sum_{j=0}^\infty \beta^j
         u_c(s^{t+j}) \,z_{t+j}(s^{t+j}) - u_c(s^{t}) \,b_t(s^{t-1}) \biggr\}
         \\
   &amp;= \mathbb E_{0} \sum_{t=0}^\infty \beta^t
                         \biggl\{ u\left(c_t(s^t), 1-c_t(s^t)-g(s_t)\right)
        \\
   &amp;  \qquad + \Psi_t(s^t)\, u_c(s^{t}) \,z_t(s^{t}) -
                   \gamma_t(s^t)\, u_c(s^{t}) \, b_t(s^{t-1})  \biggr\}
\end{aligned}\end{split}\]</div>
<p>where</p>
<div class="math notranslate nohighlight" id="equation-amss-lagr">
<span class="eqno">(40.13)<a class="headerlink" href="#equation-amss-lagr" title="Permalink to this equation">¶</a></span>\[\Psi_t(s^t)=\Psi_{t-1}(s^{t-1})+\gamma_t(s^t)
 \quad \text{and} \quad
\Psi_{-1}(s^{-1})=0\]</div>
<p>In <a class="reference internal" href="#equation-amss-lagr-a">(40.12)</a>,  the second equality uses  the law of iterated expectations
and Abel’s summation formula (also called <em>summation by parts</em>, see
<a class="reference external" href="https://en.wikipedia.org/wiki/Abel%27s_summation_formula">this page</a>).</p>
<p>First-order conditions with respect
to <span class="math notranslate nohighlight">\(c_t(s^t)\)</span> can be expressed as</p>
<div class="math notranslate nohighlight" id="equation-amss-foc-a">
<span class="eqno">(40.14)<a class="headerlink" href="#equation-amss-foc-a" title="Permalink to this equation">¶</a></span>\[\begin{split}\begin{aligned}
  u_c(s^t)-u_{\ell}(s^t) &amp;+ \Psi_t(s^t)\left\{ \left[
    u_{cc}(s^t) - u_{c\ell}(s^{t})\right]z_t(s^{t}) +
    u_{c}(s^{t})\,z_c(s^{t}) \right\}
    \\
    &amp; \hspace{35mm} - \gamma_t(s^t)\left[
    u_{cc}(s^{t}) - u_{c\ell}(s^{t})\right]b_t(s^{t-1}) =0
\end{aligned}\end{split}\]</div>
<p>and with respect to <span class="math notranslate nohighlight">\(b_t(s^t)\)</span> as</p>
<div class="math notranslate nohighlight" id="equation-amss-foc-b">
<span class="eqno">(40.15)<a class="headerlink" href="#equation-amss-foc-b" title="Permalink to this equation">¶</a></span>\[\mathbb E_{t} \left[\gamma_{t+1}(s^{t+1})\,u_c(s^{t+1})\right] = 0\]</div>
<p>If we substitute <span class="math notranslate nohighlight">\(z_t(s^t)\)</span> from <a class="reference internal" href="#equation-amss-44-2">(40.7)</a> and its derivative
<span class="math notranslate nohighlight">\(z_c(s^t)\)</span> into the first-order condition <a class="reference internal" href="#equation-amss-foc-a">(40.14)</a>, we  find  two
differences from the corresponding condition for the optimal allocation
in a Lucas-Stokey economy with state-contingent government debt.</p>
<ol class="simple">
<li><p>The term involving <span class="math notranslate nohighlight">\(b_t(s^{t-1})\)</span> in the first-order condition
<a class="reference internal" href="#equation-amss-foc-a">(40.14)</a> does not appear in the corresponding expression
for the Lucas-Stokey economy.</p>
<ul class="simple">
<li><p>This term reflects the constraint that
beginning-of-period government indebtedness must be the same across all
realizations of next period’s state, a constraint that would  not be present if
government debt could be state-contingent.</p></li>
</ul>
</li>
<li><p>The Lagrange multiplier <span class="math notranslate nohighlight">\(\Psi_t(s^t)\)</span> in the first-order condition
<a class="reference internal" href="#equation-amss-foc-a">(40.14)</a> may change over time in response to realizations of the state,
while the multiplier <span class="math notranslate nohighlight">\(\Phi\)</span> in the Lucas-Stokey economy is time-invariant.</p></li>
</ol>
<p>We need some code from  <a class="reference internal" href="opt_tax_recur.html"><span class="doc">an earlier lecture</span></a>
on optimal taxation with state-contingent debt  sequential allocation implementation:</p>
<div class="cell tag_output_scroll docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">root</span>
<span class="kn">from</span> <span class="nn">quantecon</span> <span class="kn">import</span> <span class="n">MarkovChain</span>


<span class="k">class</span> <span class="nc">SequentialAllocation</span><span class="p">:</span>

    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Class that takes CESutility or BGPutility object as input returns</span>
<span class="sd">    planner&#39;s allocation as a function of the multiplier on the</span>
<span class="sd">    implementability constraint μ.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>

        <span class="c1"># Initialize from model object attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">Θ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">π</span><span class="p">)</span>  <span class="c1"># Number of states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model</span> <span class="o">=</span> <span class="n">model</span>

        <span class="c1"># Find the first best allocation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">find_first_best</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">find_first_best</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find the first best allocation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
        <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span>

        <span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="n">S</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Θ</span> <span class="o">*</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">Θ</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">])</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">))</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find first best&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="n">S</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">S</span><span class="p">:]</span>

        <span class="c1"># Multiplier on the resource constraint</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ΞFB</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cFB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">zFB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="bp">self</span><span class="o">.</span><span class="n">cFB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ΞFB</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">time1_allocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">μ</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Computes optimal allocation for time t &gt;= 1 for a given μ</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
        <span class="n">Uc</span><span class="p">,</span> <span class="n">Ucc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">Unn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Ucc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Unn</span>

        <span class="k">def</span> <span class="nf">FOC</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="n">S</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">]</span>
            <span class="n">Ξ</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">:]</span>
            <span class="c1"># FOC of c</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ucc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="n">Ξ</span><span class="p">,</span>
                              <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Unn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> \
                              <span class="o">+</span> <span class="n">Θ</span> <span class="o">*</span> <span class="n">Ξ</span><span class="p">,</span>  <span class="c1"># FOC of n</span>
                              <span class="n">Θ</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">])</span>

        <span class="c1"># Find the root of the first-order condition</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">FOC</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zFB</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find LS allocation.&#39;</span><span class="p">)</span>
        <span class="n">z</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">:]</span>

        <span class="c1"># Compute x</span>
        <span class="n">I</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="n">I</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Ξ</span>

    <span class="k">def</span> <span class="nf">time0_allocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds the optimal allocation given initial government debt B_ and</span>
<span class="sd">        state s_0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">β</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span>
        <span class="n">Uc</span><span class="p">,</span> <span class="n">Ucc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">Unn</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Ucc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Unn</span>

        <span class="c1"># First order conditions of planner&#39;s problem</span>
        <span class="k">def</span> <span class="nf">FOC</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">μ</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="n">z</span>
            <span class="n">xprime</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time1_allocation</span><span class="p">(</span><span class="n">μ</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">B_</span><span class="p">)</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">π</span><span class="p">[</span><span class="n">s_0</span><span class="p">]</span>
                                            <span class="o">@</span> <span class="n">xprime</span><span class="p">,</span>
                              <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ucc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
                                            <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">B_</span><span class="p">)</span> <span class="o">+</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">-</span> <span class="n">Ξ</span><span class="p">,</span>
                              <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">-</span> <span class="n">μ</span> <span class="o">*</span> <span class="p">(</span><span class="n">Unn</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span>
                                            <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span> <span class="o">+</span> <span class="n">Θ</span><span class="p">[</span><span class="n">s_0</span><span class="p">]</span> <span class="o">*</span> <span class="n">Ξ</span><span class="p">,</span>
                              <span class="p">(</span><span class="n">Θ</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">)[</span><span class="n">s_0</span><span class="p">]])</span>

        <span class="c1"># Find root</span>
        <span class="n">res</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">FOC</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span>
            <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cFB</span><span class="p">[</span><span class="n">s_0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span><span class="p">[</span><span class="n">s_0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">ΞFB</span><span class="p">[</span><span class="n">s_0</span><span class="p">]]))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find time 0 LS allocation.&#39;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>

    <span class="k">def</span> <span class="nf">time1_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">μ</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find the value associated with multiplier μ</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time1_allocation</span><span class="p">(</span><span class="n">μ</span><span class="p">)</span>
        <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
        <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="n">U</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">V</span>

    <span class="k">def</span> <span class="nf">Τ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Computes Τ given c, n</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span>  <span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Un</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Θ</span> <span class="o">*</span> <span class="n">Uc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sHist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Simulates planners policies for T periods</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">π</span><span class="p">,</span> <span class="n">β</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span>
        <span class="n">Uc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span>

        <span class="k">if</span> <span class="n">sHist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sHist</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">s_0</span><span class="p">)</span>

        <span class="n">cHist</span><span class="p">,</span> <span class="n">nHist</span><span class="p">,</span> <span class="n">Bhist</span><span class="p">,</span> <span class="n">ΤHist</span><span class="p">,</span> <span class="n">μHist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
        <span class="n">RHist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">T</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

        <span class="c1"># Time 0</span>
        <span class="n">μ</span><span class="p">,</span> <span class="n">cHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time0_allocation</span><span class="p">(</span><span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">)</span>
        <span class="n">ΤHist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Τ</span><span class="p">(</span><span class="n">cHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">s_0</span><span class="p">]</span>
        <span class="n">Bhist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">B_</span>
        <span class="n">μHist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">μ</span>

        <span class="c1"># Time 1 onward</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">Ξ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time1_allocation</span><span class="p">(</span><span class="n">μ</span><span class="p">)</span>
            <span class="n">Τ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Τ</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">u_c</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">s</span> <span class="o">=</span> <span class="n">sHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">Eu_c</span> <span class="o">=</span> <span class="n">π</span><span class="p">[</span><span class="n">sHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">@</span> <span class="n">u_c</span>
            <span class="n">cHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">Bhist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">ΤHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">/</span> <span class="n">u_c</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> \
                                                     <span class="n">Τ</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
            <span class="n">RHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">cHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">β</span> <span class="o">*</span> <span class="n">Eu_c</span><span class="p">)</span>
            <span class="n">μHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">μ</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cHist</span><span class="p">,</span> <span class="n">nHist</span><span class="p">,</span> <span class="n">Bhist</span><span class="p">,</span> <span class="n">ΤHist</span><span class="p">,</span> <span class="n">sHist</span><span class="p">,</span> <span class="n">μHist</span><span class="p">,</span> <span class="n">RHist</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>To analyze the AMSS model, we find it useful to adopt a recursive formulation
using techniques like those in our lectures on <a class="reference internal" href="dyn_stack.html"><span class="doc">dynamic Stackelberg models</span></a> and <a class="reference internal" href="opt_tax_recur.html"><span class="doc">optimal taxation with state-contingent debt</span></a>.</p>
</div>
</div>
<div class="section" id="recursive-version-of-amss-model">
<h2><a class="toc-backref" href="#id13"><span class="section-number">40.3. </span>Recursive Version of AMSS Model</a><a class="headerlink" href="#recursive-version-of-amss-model" title="Permalink to this headline">¶</a></h2>
<p>We now describe a recursive formulation of the AMSS economy.</p>
<p>We have noted that from the point of view of the Ramsey planner, the restriction
to one-period risk-free securities</p>
<ul class="simple">
<li><p>leaves intact the single implementability constraint on allocations
<a class="reference internal" href="#equation-ts-gov-wo4">(40.8)</a> from the Lucas-Stokey economy, but</p></li>
<li><p>adds measurability constraints <a class="reference internal" href="#equation-ts-gov-wo3">(40.6)</a> on functions of tails of
allocations at each time and history</p></li>
</ul>
<p>We now explore how these constraints alter  Bellman equations for a time
<span class="math notranslate nohighlight">\(0\)</span> Ramsey planner and for time <span class="math notranslate nohighlight">\(t \geq 1\)</span>, history <span class="math notranslate nohighlight">\(s^t\)</span>
continuation Ramsey planners.</p>
<div class="section" id="recasting-state-variables">
<h3><span class="section-number">40.3.1. </span>Recasting State Variables<a class="headerlink" href="#recasting-state-variables" title="Permalink to this headline">¶</a></h3>
<p>In the AMSS setting, the government faces a sequence of budget constraints</p>
<div class="math notranslate nohighlight">
\[
\tau_t(s^t) n_t(s^t) + T_t(s^t) +  b_{t+1}(s^t)/ R_t (s^t) =  g_t + b_t(s^{t-1})
\]</div>
<p>where <span class="math notranslate nohighlight">\(R_t(s^t)\)</span> is the gross risk-free rate of interest between <span class="math notranslate nohighlight">\(t\)</span>
and <span class="math notranslate nohighlight">\(t+1\)</span> at history <span class="math notranslate nohighlight">\(s^t\)</span> and <span class="math notranslate nohighlight">\(T_t(s^t)\)</span> are non-negative transfers.</p>
<p>Throughout this lecture, we shall set transfers to zero (for some issues about the limiting behavior of debt, this is  possibly an important  difference from AMSS <span id="id8">[<a class="reference internal" href="zreferences.html#id110"><span>AMSSeppala02</span></a>]</span>, who restricted transfers
to be non-negative).</p>
<p>In this case, the household faces a sequence of budget constraints</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp1">
<span class="eqno">(40.16)<a class="headerlink" href="#equation-eqn-amssapp1" title="Permalink to this equation">¶</a></span>\[b_t(s^{t-1}) + (1-\tau_t(s^t)) n_t(s^t) = c_t(s^t) + b_{t+1}(s^t)/R_t(s^t)\]</div>
<p>The household’s first-order conditions are <span class="math notranslate nohighlight">\(u_{c,t} = \beta R_t \mathbb E_t u_{c,t+1}\)</span>
and <span class="math notranslate nohighlight">\((1-\tau_t) u_{c,t} = u_{l,t}\)</span>.</p>
<p>Using these to eliminate <span class="math notranslate nohighlight">\(R_t\)</span> and <span class="math notranslate nohighlight">\(\tau_t\)</span> from  budget constraint
<a class="reference internal" href="#equation-eqn-amssapp1">(40.16)</a> gives</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp2a">
<span class="eqno">(40.17)<a class="headerlink" href="#equation-eqn-amssapp2a" title="Permalink to this equation">¶</a></span>\[b_t(s^{t-1}) + \frac{u_{l,t}(s^t)}{u_{c,t}(s^t)} n_t(s^t)
= c_t(s^t) + {\frac{\beta (\mathbb E_t u_{c,t+1}) b_{t+1}(s^t)}{u_{c,t}(s^t)}}\]</div>
<p>or</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp2">
<span class="eqno">(40.18)<a class="headerlink" href="#equation-eqn-amssapp2" title="Permalink to this equation">¶</a></span>\[u_{c,t}(s^t) b_t(s^{t-1}) + u_{l,t}(s^t) n_t(s^t)
= u_{c,t}(s^t) c_t(s^t) + \beta (\mathbb E_t u_{c,t+1}) b_{t+1}(s^t)\]</div>
<p>Now define</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp3">
<span class="eqno">(40.19)<a class="headerlink" href="#equation-eqn-amssapp3" title="Permalink to this equation">¶</a></span>\[x_t \equiv \beta b_{t+1}(s^t) \mathbb E_t u_{c,t+1} = u_{c,t} (s^t) {\frac{b_{t+1}(s^t)}{R_t(s^t)}}\]</div>
<p>and represent the household’s budget constraint at time <span class="math notranslate nohighlight">\(t\)</span>,
history <span class="math notranslate nohighlight">\(s^t\)</span> as</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp4">
<span class="eqno">(40.20)<a class="headerlink" href="#equation-eqn-amssapp4" title="Permalink to this equation">¶</a></span>\[{\frac{u_{c,t} x_{t-1}}{\beta \mathbb E_{t-1} u_{c,t}}} = u_{c,t} c_t - u_{l,t} n_t + x_t\]</div>
<p>for <span class="math notranslate nohighlight">\(t \geq 1\)</span>.</p>
</div>
<div class="section" id="measurability-constraints">
<h3><span class="section-number">40.3.2. </span>Measurability Constraints<a class="headerlink" href="#measurability-constraints" title="Permalink to this headline">¶</a></h3>
<p>Write equation <a class="reference internal" href="#equation-eqn-amssapp2">(40.18)</a> as</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp2b">
<span class="eqno">(40.21)<a class="headerlink" href="#equation-eqn-amssapp2b" title="Permalink to this equation">¶</a></span>\[b_t(s^{t-1})  = c_t(s^t) -  { \frac{u_{l,t}(s^t)}{u_{c,t}(s^t)}} n_t(s^t) +
{\frac{\beta (\mathbb E_t u_{c,t+1}) b_{t+1}(s^t)}{u_{c,t}}}\]</div>
<p>The right side of equation <a class="reference internal" href="#equation-eqn-amssapp2b">(40.21)</a> expresses the time <span class="math notranslate nohighlight">\(t\)</span> value of government debt
in terms of a linear combination of terms whose individual components
are measurable with respect to <span class="math notranslate nohighlight">\(s^t\)</span>.</p>
<p>The sum  of terms on the right side  of equation <a class="reference internal" href="#equation-eqn-amssapp2b">(40.21)</a> must equal
<span class="math notranslate nohighlight">\(b_t(s^{t-1})\)</span>.</p>
<p>That implies that it has to be <em>measurable</em> with respect to <span class="math notranslate nohighlight">\(s^{t-1}\)</span>.</p>
<p>Equations <a class="reference internal" href="#equation-eqn-amssapp2b">(40.21)</a> are the <em>measurability constraints</em> that the AMSS model adds to the single time <span class="math notranslate nohighlight">\(0\)</span> implementation
constraint imposed in the Lucas and Stokey model.</p>
</div>
<div class="section" id="two-bellman-equations">
<h3><span class="section-number">40.3.3. </span>Two Bellman Equations<a class="headerlink" href="#two-bellman-equations" title="Permalink to this headline">¶</a></h3>
<p>Let <span class="math notranslate nohighlight">\(\Pi(s|s_-)\)</span> be a Markov transition matrix whose entries tell probabilities of moving from state <span class="math notranslate nohighlight">\(s_-\)</span> to state <span class="math notranslate nohighlight">\(s\)</span> in one period.</p>
<p>Let</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(V(x_-, s_-)\)</span> be the continuation value of a continuation
Ramsey plan at <span class="math notranslate nohighlight">\(x_{t-1} = x_-, s_{t-1} =s_-\)</span> for <span class="math notranslate nohighlight">\(t \geq 1\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(W(b, s)\)</span> be the value of the Ramsey plan at time <span class="math notranslate nohighlight">\(0\)</span> at
<span class="math notranslate nohighlight">\(b_0=b\)</span> and <span class="math notranslate nohighlight">\(s_0 = s\)</span></p></li>
</ul>
<p>We distinguish between two types of planners:</p>
<p>For <span class="math notranslate nohighlight">\(t \geq 1\)</span>, the value function for a <strong>continuation Ramsey planner</strong>
satisfies the Bellman equation</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp5">
<span class="eqno">(40.22)<a class="headerlink" href="#equation-eqn-amssapp5" title="Permalink to this equation">¶</a></span>\[V(x_-,s_-) = \max_{\{n(s), x(s)\}} \sum_s \Pi(s|s_-) \left[ u(n(s) -
g(s), 1-n(s)) + \beta V(x(s),s) \right]\]</div>
<p>subject to the following collection of implementability constraints, one
for each <span class="math notranslate nohighlight">\(s \in {\cal S}\)</span>:</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp6">
<span class="eqno">(40.23)<a class="headerlink" href="#equation-eqn-amssapp6" title="Permalink to this equation">¶</a></span>\[{\frac{u_c(s) x_- }{\beta \sum_{\tilde s} \Pi(\tilde s|s_-) u_c(\tilde s) }}
= u_c(s) (n(s) - g(s)) - u_l(s) n(s) + x(s)\]</div>
<p>A continuation Ramsey planner at <span class="math notranslate nohighlight">\(t \geq 1\)</span> takes
<span class="math notranslate nohighlight">\((x_{t-1}, s_{t-1}) = (x_-, s_-)\)</span> as given and before
<span class="math notranslate nohighlight">\(s\)</span> is realized chooses
<span class="math notranslate nohighlight">\((n_t(s_t), x_t(s_t)) = (n(s), x(s))\)</span> for <span class="math notranslate nohighlight">\(s \in  {\cal S}\)</span>.</p>
<p>The <strong>Ramsey planner</strong> takes <span class="math notranslate nohighlight">\((b_0, s_0)\)</span> as given and chooses <span class="math notranslate nohighlight">\((n_0, x_0)\)</span>.</p>
<p>The value function <span class="math notranslate nohighlight">\(W(b_0, s_0)\)</span>   for the time <span class="math notranslate nohighlight">\(t=0\)</span> Ramsey planner
satisfies the Bellman equation</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp100">
<span class="eqno">(40.24)<a class="headerlink" href="#equation-eqn-amssapp100" title="Permalink to this equation">¶</a></span>\[W(b_0, s_0) = \max_{n_0, x_0} u(n_0 - g_0, 1-n_0) + \beta V(x_0,s_0)\]</div>
<p>where maximization is subject to</p>
<div class="math notranslate nohighlight" id="equation-eqn-ammssapp101">
<span class="eqno">(40.25)<a class="headerlink" href="#equation-eqn-ammssapp101" title="Permalink to this equation">¶</a></span>\[u_{c,0} b_0 = u_{c,0} (n_0-g_0) - u_{l,0} n_0 + x_0\]</div>
</div>
<div class="section" id="martingale-supercedes-state-variable-degeneracy">
<h3><span class="section-number">40.3.4. </span>Martingale Supercedes State-Variable Degeneracy<a class="headerlink" href="#martingale-supercedes-state-variable-degeneracy" title="Permalink to this headline">¶</a></h3>
<p>Let <span class="math notranslate nohighlight">\(\mu(s|s_-) \Pi(s|s_-)\)</span> be a Lagrange multiplier on the constraint <a class="reference internal" href="#equation-eqn-amssapp6">(40.23)</a>
for state <span class="math notranslate nohighlight">\(s\)</span>.</p>
<p>After forming an appropriate Lagrangian, we find that the continuation Ramsey planner’s first-order
condition with respect to <span class="math notranslate nohighlight">\(x(s)\)</span> is</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp7">
<span class="eqno">(40.26)<a class="headerlink" href="#equation-eqn-amssapp7" title="Permalink to this equation">¶</a></span>\[\beta V_x(x(s),s) = \mu(s|s_-)\]</div>
<p>Applying an envelope theorem to Bellman equation <a class="reference internal" href="#equation-eqn-amssapp5">(40.22)</a> gives</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp8">
<span class="eqno">(40.27)<a class="headerlink" href="#equation-eqn-amssapp8" title="Permalink to this equation">¶</a></span>\[V_x(x_-,s_-) = \sum_s \Pi(s|s_-) \mu(s|s_-) {\frac{u_c(s)}{\beta \sum_{\tilde s}
\Pi(\tilde s|s_-) u_c(\tilde s) }}\]</div>
<p>Equations <a class="reference internal" href="#equation-eqn-amssapp7">(40.26)</a> and <a class="reference internal" href="#equation-eqn-amssapp8">(40.27)</a> imply that</p>
<div class="math notranslate nohighlight" id="equation-eqn-amssapp9">
<span class="eqno">(40.28)<a class="headerlink" href="#equation-eqn-amssapp9" title="Permalink to this equation">¶</a></span>\[V_x(x_-, s_-) = \sum_{s} \left( \Pi(s|s_-) {\frac{u_c(s)}{\sum_{\tilde s}
\Pi(\tilde s| s_-) u_c(\tilde s)}} \right) V_x(x, s)\]</div>
<p>Equation <a class="reference internal" href="#equation-eqn-amssapp9">(40.28)</a> states that <span class="math notranslate nohighlight">\(V_x(x, s)\)</span> is a <em>risk-adjusted martingale</em>.</p>
<p>Saying that <span class="math notranslate nohighlight">\(V_x(x, s)\)</span> is a risk-adjusted martingale  means  that
<span class="math notranslate nohighlight">\(V_x(x, s)\)</span>  is a martingale with respect to the probability distribution
over <span class="math notranslate nohighlight">\(s^t\)</span> sequences that are generated by the <em>twisted</em> transition probability matrix:</p>
<div class="math notranslate nohighlight">
\[
\check \Pi(s|s_-) \equiv \Pi(s|s_-) {\frac{u_c(s)}{\sum_{\tilde s}
\Pi(\tilde s| s_-) u_c(\tilde s)}}
\]</div>
<p><strong>Exercise</strong>: Please verify that <span class="math notranslate nohighlight">\(\check \Pi(s|s_-)\)</span> is a valid Markov
transition density, i.e., that its elements are all non-negative and
that for each <span class="math notranslate nohighlight">\(s_-\)</span>, the sum over <span class="math notranslate nohighlight">\(s\)</span> equals unity.</p>
</div>
<div class="section" id="absence-of-state-variable-degeneracy">
<h3><span class="section-number">40.3.5. </span>Absence of State Variable Degeneracy<a class="headerlink" href="#absence-of-state-variable-degeneracy" title="Permalink to this headline">¶</a></h3>
<p>Along a Ramsey plan, the state variable <span class="math notranslate nohighlight">\(x_t = x_t(s^t, b_0)\)</span>
becomes a function of the history <span class="math notranslate nohighlight">\(s^t\)</span> and initial
government debt <span class="math notranslate nohighlight">\(b_0\)</span>.</p>
<p>In <a class="reference internal" href="opt_tax_recur.html"><span class="doc">Lucas-Stokey model</span></a>, we
found that</p>
<ul class="simple">
<li><p>a counterpart to <span class="math notranslate nohighlight">\(V_x(x,s)\)</span> is time-invariant and equal to
the Lagrange multiplier on the Lucas-Stokey implementability constraint</p></li>
<li><p>time invariance of <span class="math notranslate nohighlight">\(V_x(x,s)\)</span>  is the source of a key
feature of the Lucas-Stokey model, namely, <strong>state variable degeneracy</strong> in which <span class="math notranslate nohighlight">\(x_t\)</span> is an exact time-invariant function of <span class="math notranslate nohighlight">\(s_t\)</span>.</p></li>
</ul>
<p>That <span class="math notranslate nohighlight">\(V_x(x,s)\)</span> varies over time according to a twisted martingale
means that there is no state-variable degeneracy in the AMSS model.</p>
<p>In the AMSS model, both <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(s\)</span> are needed to describe the state.</p>
<p>This property of the AMSS model  transmits a twisted martingale
component to consumption, employment, and the tax rate.</p>
</div>
<div class="section" id="digression-on-non-negative-transfers">
<h3><span class="section-number">40.3.6. </span>Digression on Non-negative Transfers<a class="headerlink" href="#digression-on-non-negative-transfers" title="Permalink to this headline">¶</a></h3>
<p>Throughout this lecture, we have imposed that transfers <span class="math notranslate nohighlight">\(T_t = 0\)</span>.</p>
<p>AMSS <span id="id9">[<a class="reference internal" href="zreferences.html#id110"><span>AMSSeppala02</span></a>]</span> instead imposed a nonnegativity
constraint <span class="math notranslate nohighlight">\(T_t\geq 0\)</span> on transfers.</p>
<p>They also considered a special case of quasi-linear preferences,
<span class="math notranslate nohighlight">\(u(c,l)= c + H(l)\)</span>.</p>
<p>In this case, <span class="math notranslate nohighlight">\(V_x(x,s)\leq 0\)</span> is a non-positive martingale.</p>
<p>By the <em>martingale convergence theorem</em>  <span class="math notranslate nohighlight">\(V_x(x,s)\)</span> converges almost surely.</p>
<p>Furthermore, when the Markov chain <span class="math notranslate nohighlight">\(\Pi(s| s_-)\)</span> and the government
expenditure function <span class="math notranslate nohighlight">\(g(s)\)</span> are such that <span class="math notranslate nohighlight">\(g_t\)</span> is perpetually
random, <span class="math notranslate nohighlight">\(V_x(x, s)\)</span> almost surely converges to zero.</p>
<p>For quasi-linear preferences, the first-order condition for maximizing <a class="reference internal" href="#equation-eqn-amssapp5">(40.22)</a> subject to  <a class="reference internal" href="#equation-eqn-amssapp6">(40.23)</a> with respect to <span class="math notranslate nohighlight">\(n(s)\)</span> becomes</p>
<div class="math notranslate nohighlight">
\[
(1-\mu(s|s_-) ) (1 - u_l(s)) + \mu(s|s_-) n(s) u_{ll}(s) =0
\]</div>
<p>When <span class="math notranslate nohighlight">\(\mu(s|s_-) = \beta V_x(x(s),x)\)</span> converges to zero, in the limit
<span class="math notranslate nohighlight">\(u_l(s)= 1 =u_c(s)\)</span>, so that <span class="math notranslate nohighlight">\(\tau(x(s),s) =0\)</span>.</p>
<p>Thus, in the limit, if <span class="math notranslate nohighlight">\(g_t\)</span> is perpetually random,  the government
accumulates sufficient assets to finance all expenditures from earnings on those
assets, returning any excess revenues to the household as non-negative lump-sum transfers.</p>
</div>
<div class="section" id="code">
<h3><span class="section-number">40.3.7. </span>Code<a class="headerlink" href="#code" title="Permalink to this headline">¶</a></h3>
<p>The recursive formulation is implemented as follows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">fmin_slsqp</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">root</span>
<span class="kn">from</span> <span class="nn">quantecon</span> <span class="kn">import</span> <span class="n">MarkovChain</span>


<span class="k">class</span> <span class="nc">RecursiveAllocationAMSS</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">μgrid</span><span class="p">,</span> <span class="n">tol_diff</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mc</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">MarkovChain</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">π</span><span class="p">)</span>  <span class="c1"># Number of states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">μgrid</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">μgrid</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tol_diff</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">tol_diff</span><span class="p">,</span> <span class="n">tol</span>

        <span class="c1"># Find the first best allocation</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">solve_time1_bellman</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">time_0</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1"># Bellman equation now solves time 0 problem</span>

    <span class="k">def</span> <span class="nf">solve_time1_bellman</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Solve the time  1 Bellman equation for calibration model and</span>
<span class="sd">        initial grid μgrid0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">μgrid0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">μgrid</span>
        <span class="n">π</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">π</span>
        <span class="n">S</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">π</span><span class="p">)</span>

        <span class="c1"># First get initial fit from Lucas Stokey solution.</span>
        <span class="c1"># Need to change things to be ex ante</span>
        <span class="n">pp</span> <span class="o">=</span> <span class="n">SequentialAllocation</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">interp</span> <span class="o">=</span> <span class="n">interpolator_factory</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">incomplete_allocation</span><span class="p">(</span><span class="n">μ_</span><span class="p">,</span> <span class="n">s_</span><span class="p">):</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">pp</span><span class="o">.</span><span class="n">time1_value</span><span class="p">(</span><span class="n">μ_</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">π</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span> <span class="o">@</span> <span class="n">x</span><span class="p">,</span> <span class="n">π</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span> <span class="o">@</span> <span class="n">V</span>
        <span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">Vf</span><span class="p">,</span> <span class="n">xprimef</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">μ</span><span class="p">:</span> <span class="n">incomplete_allocation</span><span class="p">(</span><span class="n">μ</span><span class="p">,</span> <span class="n">s_</span><span class="p">),</span> <span class="n">μgrid0</span><span class="p">))</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">c</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
            <span class="n">x</span><span class="p">,</span> <span class="n">V</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">V</span><span class="p">)</span>
            <span class="n">xprimes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">x</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span><span class="p">)</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
            <span class="n">nf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
            <span class="n">Vf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">V</span><span class="p">))</span>
            <span class="n">xgrid</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">xprimef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">xprimes</span><span class="p">))</span>
        <span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xprimef</span> <span class="o">=</span> <span class="n">fun_vstack</span><span class="p">(</span><span class="n">cf</span><span class="p">),</span> <span class="n">fun_vstack</span><span class="p">(</span><span class="n">nf</span><span class="p">),</span> <span class="n">fun_vstack</span><span class="p">(</span><span class="n">xprimef</span><span class="p">)</span>
        <span class="n">Vf</span> <span class="o">=</span> <span class="n">fun_hstack</span><span class="p">(</span><span class="n">Vf</span><span class="p">)</span>
        <span class="n">policies</span> <span class="o">=</span> <span class="p">[</span><span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xprimef</span><span class="p">]</span>

        <span class="c1"># Create xgrid</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">xbar</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">x</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">min</span><span class="p">()]</span>
        <span class="n">xgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xbar</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xbar</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">μgrid0</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">xgrid</span> <span class="o">=</span> <span class="n">xgrid</span>

        <span class="c1"># Now iterate on Bellman equation</span>
        <span class="n">T</span> <span class="o">=</span> <span class="n">BellmanEquation</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">policies</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">)</span>
        <span class="n">diff</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="n">diff</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">tol_diff</span><span class="p">:</span>
            <span class="n">PF</span> <span class="o">=</span> <span class="n">T</span><span class="p">(</span><span class="n">Vf</span><span class="p">)</span>

            <span class="n">Vfnew</span><span class="p">,</span> <span class="n">policies</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_policy_function</span><span class="p">(</span><span class="n">PF</span><span class="p">)</span>
            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">((</span><span class="n">Vf</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)</span> <span class="o">-</span> <span class="n">Vfnew</span><span class="p">(</span><span class="n">xgrid</span><span class="p">))</span> <span class="o">/</span> <span class="n">Vf</span><span class="p">(</span><span class="n">xgrid</span><span class="p">))</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
            <span class="n">Vf</span> <span class="o">=</span> <span class="n">Vfnew</span>

        <span class="c1"># Store value function policies and Bellman Equations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Vf</span> <span class="o">=</span> <span class="n">Vf</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">policies</span> <span class="o">=</span> <span class="n">policies</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">T</span> <span class="o">=</span> <span class="n">T</span>

    <span class="k">def</span> <span class="nf">fit_policy_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">PF</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fits the policy functions</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">xgrid</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">xgrid</span>
        <span class="n">interp</span> <span class="o">=</span> <span class="n">interpolator_factory</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xprimef</span><span class="p">,</span> <span class="n">Tf</span><span class="p">,</span> <span class="n">Vf</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
            <span class="n">PFvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">PF</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s_</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">xgrid</span><span class="p">])</span><span class="o">.</span><span class="n">T</span>
            <span class="n">Vf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">PFvec</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]))</span>
            <span class="n">cf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">PFvec</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span> <span class="o">+</span> <span class="n">S</span><span class="p">]))</span>
            <span class="n">nf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">PFvec</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="n">S</span><span class="p">:</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">]))</span>
            <span class="n">xprimef</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">PFvec</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">:</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">S</span><span class="p">]))</span>
            <span class="n">Tf</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">PFvec</span><span class="p">[</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">S</span><span class="p">:]))</span>
        <span class="n">policies</span> <span class="o">=</span> <span class="n">fun_vstack</span><span class="p">(</span><span class="n">cf</span><span class="p">),</span> <span class="n">fun_vstack</span><span class="p">(</span>
            <span class="n">nf</span><span class="p">),</span> <span class="n">fun_vstack</span><span class="p">(</span><span class="n">xprimef</span><span class="p">),</span> <span class="n">fun_vstack</span><span class="p">(</span><span class="n">Tf</span><span class="p">)</span>
        <span class="n">Vf</span> <span class="o">=</span> <span class="n">fun_hstack</span><span class="p">(</span><span class="n">Vf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">Vf</span><span class="p">,</span> <span class="n">policies</span>

    <span class="k">def</span> <span class="nf">Τ</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Computes Τ given c and n</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>

        <span class="k">return</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Un</span> <span class="o">/</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Θ</span> <span class="o">*</span> <span class="n">Uc</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">time0_allocation</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds the optimal allocation given initial government debt B_ and</span>
<span class="sd">        state s_0</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">PF</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">T</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">Vf</span><span class="p">)</span>
        <span class="n">z0</span> <span class="o">=</span> <span class="n">PF</span><span class="p">(</span><span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">)</span>
        <span class="n">c0</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">xprime0</span><span class="p">,</span> <span class="n">T0</span> <span class="o">=</span> <span class="n">z0</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
        <span class="k">return</span> <span class="n">c0</span><span class="p">,</span> <span class="n">n0</span><span class="p">,</span> <span class="n">xprime0</span><span class="p">,</span> <span class="n">T0</span>

    <span class="k">def</span> <span class="nf">simulate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sHist</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Simulates planners policies for T periods</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">π</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span>
        <span class="n">Uc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span>
        <span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xprimef</span><span class="p">,</span> <span class="n">Tf</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies</span>

        <span class="k">if</span> <span class="n">sHist</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">sHist</span> <span class="o">=</span> <span class="n">simulate_markov</span><span class="p">(</span><span class="n">π</span><span class="p">,</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>

        <span class="n">cHist</span><span class="p">,</span> <span class="n">nHist</span><span class="p">,</span> <span class="n">Bhist</span><span class="p">,</span> <span class="n">xHist</span><span class="p">,</span> <span class="n">ΤHist</span><span class="p">,</span> <span class="n">THist</span><span class="p">,</span> <span class="n">μHist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">7</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
        <span class="c1"># Time 0</span>
        <span class="n">cHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">THist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time0_allocation</span><span class="p">(</span><span class="n">B_</span><span class="p">,</span> <span class="n">s_0</span><span class="p">)</span>
        <span class="n">ΤHist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Τ</span><span class="p">(</span><span class="n">cHist</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">s_0</span><span class="p">]</span>
        <span class="n">Bhist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">B_</span>
        <span class="n">μHist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vf</span><span class="p">[</span><span class="n">s_0</span><span class="p">](</span><span class="n">xHist</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Time 1 onward</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
            <span class="n">s_</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s</span> <span class="o">=</span> <span class="n">sHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">xHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">],</span> <span class="n">sHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">xprime</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">cf</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span> <span class="p">:](</span><span class="n">x</span><span class="p">),</span> <span class="n">nf</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span> <span class="p">:](</span>
                <span class="n">x</span><span class="p">),</span> <span class="n">xprimef</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span> <span class="p">:](</span><span class="n">x</span><span class="p">),</span> <span class="n">Tf</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span> <span class="p">:](</span><span class="n">x</span><span class="p">)</span>

            <span class="n">Τ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Τ</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)[</span><span class="n">s</span><span class="p">]</span>
            <span class="n">u_c</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">Eu_c</span> <span class="o">=</span> <span class="n">π</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span> <span class="p">:]</span> <span class="o">@</span> <span class="n">u_c</span>

            <span class="n">μHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Vf</span><span class="p">[</span><span class="n">s</span><span class="p">](</span><span class="n">xprime</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

            <span class="n">cHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">nHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">Bhist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">ΤHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">c</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">n</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">x</span> <span class="o">/</span> <span class="n">Eu_c</span><span class="p">,</span> <span class="n">Τ</span>
            <span class="n">xHist</span><span class="p">[</span><span class="n">t</span><span class="p">],</span> <span class="n">THist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">xprime</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">cHist</span><span class="p">,</span> <span class="n">nHist</span><span class="p">,</span> <span class="n">Bhist</span><span class="p">,</span> <span class="n">ΤHist</span><span class="p">,</span> <span class="n">THist</span><span class="p">,</span> <span class="n">μHist</span><span class="p">,</span> <span class="n">sHist</span><span class="p">,</span> <span class="n">xHist</span><span class="p">])</span>


<span class="k">class</span> <span class="nc">BellmanEquation</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Bellman equation for the continuation of the Lucas-Stokey Problem</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">policies0</span><span class="p">,</span> <span class="n">tol</span><span class="p">,</span> <span class="n">maxiter</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">G</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">π</span><span class="p">)</span>  <span class="c1"># Number of states</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">tol</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">tol</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxiter</span> <span class="o">=</span> <span class="n">maxiter</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xbar</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">xgrid</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">time_0</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">z0</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cf</span><span class="p">,</span> <span class="n">nf</span><span class="p">,</span> <span class="n">xprimef</span> <span class="o">=</span> <span class="n">policies0</span>

        <span class="k">for</span> <span class="n">s_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">xgrid</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">z0</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">s_</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">cf</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span> <span class="p">:](</span><span class="n">x</span><span class="p">),</span>
                                            <span class="n">nf</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span> <span class="p">:](</span><span class="n">x</span><span class="p">),</span>
                                            <span class="n">xprimef</span><span class="p">[</span><span class="n">s_</span><span class="p">,</span> <span class="p">:](</span><span class="n">x</span><span class="p">),</span>
                                            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">)])</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">find_first_best</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">find_first_best</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Find the first best allocation</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span>
        <span class="n">S</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>

        <span class="k">def</span> <span class="nf">res</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">c</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="n">S</span><span class="p">]</span>
            <span class="n">n</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="p">:]</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">Θ</span> <span class="o">*</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">),</span> <span class="n">Θ</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">])</span>

        <span class="n">res</span> <span class="o">=</span> <span class="n">root</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="s1">&#39;Could not find first best&#39;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">cFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="n">S</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="n">S</span><span class="p">:]</span>
        <span class="n">IFB</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cFB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">cFB</span> <span class="o">+</span> \
            <span class="n">Un</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cFB</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">xFB</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="n">S</span><span class="p">)</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="n">IFB</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">zFB</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">zFB</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span>
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">cFB</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">nFB</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">@</span> <span class="bp">self</span><span class="o">.</span><span class="n">xFB</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">Vf</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Given continuation value function next period return value function this</span>
<span class="sd">        period return T(V) and optimal policies</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_0</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">PF</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_policies_time1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">Vf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">def</span> <span class="nf">PF</span><span class="p">(</span><span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">):</span> <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_policies_time0</span><span class="p">(</span><span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">Vf</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">PF</span>

    <span class="k">def</span> <span class="nf">get_policies_time1</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">s_</span><span class="p">,</span> <span class="n">Vf</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds the optimal policies </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">S</span><span class="p">,</span> <span class="n">π</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">S</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">U</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span>

        <span class="k">def</span> <span class="nf">objf</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">xprime</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">:</span><span class="mi">3</span> <span class="o">*</span> <span class="n">S</span><span class="p">]</span>

            <span class="n">Vprime</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">S</span><span class="p">):</span>
                <span class="n">Vprime</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">Vf</span><span class="p">[</span><span class="n">s</span><span class="p">](</span><span class="n">xprime</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>

            <span class="k">return</span> <span class="o">-</span><span class="n">π</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span> <span class="o">@</span> <span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">Vprime</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">objf_prime</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>

            <span class="n">epsilon</span> <span class="o">=</span> <span class="mf">1e-7</span>
            <span class="n">x0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asfarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">f0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">objf</span><span class="p">(</span><span class="n">x0</span><span class="p">))</span>
            <span class="n">jac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">f0</span><span class="p">)])</span>
            <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">))</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">x0</span><span class="p">)):</span>
                <span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">epsilon</span>
                <span class="n">jac</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">objf</span><span class="p">(</span><span class="n">x0</span><span class="o">+</span><span class="n">dx</span><span class="p">)</span> <span class="o">-</span> <span class="n">f0</span><span class="p">)</span><span class="o">/</span><span class="n">epsilon</span>
                <span class="n">dx</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span>

            <span class="k">return</span> <span class="n">jac</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

        <span class="k">def</span> <span class="nf">cons</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">xprime</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">S</span><span class="p">:</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S</span><span class="p">:</span><span class="mi">3</span> <span class="o">*</span> <span class="n">S</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="mi">3</span> <span class="o">*</span> <span class="n">S</span><span class="p">:]</span>
            <span class="n">u_c</span> <span class="o">=</span> <span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
            <span class="n">Eu_c</span> <span class="o">=</span> <span class="n">π</span><span class="p">[</span><span class="n">s_</span><span class="p">]</span> <span class="o">@</span> <span class="n">u_c</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span>
                <span class="n">x</span> <span class="o">*</span> <span class="n">u_c</span> <span class="o">/</span> <span class="n">Eu_c</span> <span class="o">-</span> <span class="n">u_c</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">β</span> <span class="o">*</span> <span class="n">xprime</span><span class="p">,</span>
                <span class="n">Θ</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">transfers</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> \
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xbar</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)]</span> <span class="o">*</span> <span class="n">S</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">100</span><span class="p">)]</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> \
                <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">xbar</span><span class="p">]</span> <span class="o">*</span> <span class="n">S</span> <span class="o">+</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)]</span> <span class="o">*</span> <span class="n">S</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">imode</span><span class="p">,</span> <span class="n">smode</span> <span class="o">=</span> <span class="n">fmin_slsqp</span><span class="p">(</span><span class="n">objf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">z0</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">s_</span><span class="p">],</span>
                                              <span class="n">f_eqcons</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span>
                                              <span class="n">fprime</span><span class="o">=</span><span class="n">objf_prime</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">iprint</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">acc</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">tol</span><span class="p">,</span> <span class="nb">iter</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">maxiter</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">imode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">smode</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">z0</span><span class="p">[</span><span class="n">x</span><span class="p">,</span> <span class="n">s_</span><span class="p">]</span> <span class="o">=</span> <span class="n">out</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="o">-</span><span class="n">fx</span><span class="p">,</span> <span class="n">out</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">get_policies_time0</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B_</span><span class="p">,</span> <span class="n">s0</span><span class="p">,</span> <span class="n">Vf</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Finds the optimal policies </span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">model</span><span class="p">,</span> <span class="n">β</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">G</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span>
        <span class="n">U</span><span class="p">,</span> <span class="n">Uc</span><span class="p">,</span> <span class="n">Un</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">U</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Uc</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">Un</span>

        <span class="k">def</span> <span class="nf">objf</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">xprime</span> <span class="o">=</span> <span class="n">z</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

            <span class="k">return</span> <span class="o">-</span><span class="p">(</span><span class="n">U</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">Vf</span><span class="p">[</span><span class="n">s0</span><span class="p">](</span><span class="n">xprime</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">cons</span><span class="p">(</span><span class="n">z</span><span class="p">):</span>
            <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">xprime</span><span class="p">,</span> <span class="n">T</span> <span class="o">=</span> <span class="n">z</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span>
                <span class="o">-</span><span class="n">Uc</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">c</span> <span class="o">-</span> <span class="n">B_</span> <span class="o">-</span> <span class="n">T</span><span class="p">)</span> <span class="o">-</span> <span class="n">Un</span><span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">β</span> <span class="o">*</span> <span class="n">xprime</span><span class="p">,</span>
                <span class="p">(</span><span class="n">Θ</span> <span class="o">*</span> <span class="n">n</span> <span class="o">-</span> <span class="n">c</span> <span class="o">-</span> <span class="n">G</span><span class="p">)[</span><span class="n">s0</span><span class="p">]])</span>

        <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">transfers</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">xbar</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">)]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">xbar</span><span class="p">,</span> <span class="p">(</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">)]</span>
        <span class="n">out</span><span class="p">,</span> <span class="n">fx</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">imode</span><span class="p">,</span> <span class="n">smode</span> <span class="o">=</span> <span class="n">fmin_slsqp</span><span class="p">(</span><span class="n">objf</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zFB</span><span class="p">[</span><span class="n">s0</span><span class="p">],</span> <span class="n">f_eqcons</span><span class="o">=</span><span class="n">cons</span><span class="p">,</span>
                                              <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">,</span> <span class="n">full_output</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                                              <span class="n">iprint</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">imode</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span><span class="n">smode</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="o">-</span><span class="n">fx</span><span class="p">,</span> <span class="n">out</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="examples">
<h2><a class="toc-backref" href="#id14"><span class="section-number">40.4. </span>Examples</a><a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>We now turn to some examples.</p>
<p>We will first build some useful functions for solving the model</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">UnivariateSpline</span>


<span class="k">class</span> <span class="nc">interpolate_wrapper</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">F</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">F</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">interpolate_wrapper</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">[</span><span class="n">index</span><span class="p">]))</span>

    <span class="k">def</span> <span class="nf">reshape</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span>

    <span class="k">def</span> <span class="nf">transpose</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__len__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xvec</span><span class="p">):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">atleast_1d</span><span class="p">(</span><span class="n">xvec</span><span class="p">)</span>
        <span class="n">shape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">fhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>
            <span class="k">return</span> <span class="n">fhat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fhat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">f</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">flatten</span><span class="p">()])</span>
            <span class="k">return</span> <span class="n">fhat</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">shape</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">))))</span>


<span class="k">class</span> <span class="nc">interpolator_factory</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">s</span> <span class="o">=</span> <span class="n">k</span><span class="p">,</span> <span class="n">s</span>

    <span class="k">def</span> <span class="fm">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">xgrid</span><span class="p">,</span> <span class="n">Fs</span><span class="p">):</span>
        <span class="n">shape</span><span class="p">,</span> <span class="n">m</span> <span class="o">=</span> <span class="n">Fs</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">Fs</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">Fs</span> <span class="o">=</span> <span class="n">Fs</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">m</span><span class="p">))</span>
        <span class="n">F</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">xgrid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">xgrid</span><span class="p">)</span>  <span class="c1"># Sort xgrid</span>
        <span class="k">for</span> <span class="n">Fhat</span> <span class="ow">in</span> <span class="n">Fs</span><span class="p">:</span>
            <span class="n">F</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">UnivariateSpline</span><span class="p">(</span><span class="n">xgrid</span><span class="p">,</span> <span class="n">Fhat</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">k</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">s</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">interpolate_wrapper</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">fun_vstack</span><span class="p">(</span><span class="n">fun_list</span><span class="p">):</span>

    <span class="n">Fs</span> <span class="o">=</span> <span class="p">[</span><span class="n">IW</span><span class="o">.</span><span class="n">F</span> <span class="k">for</span> <span class="n">IW</span> <span class="ow">in</span> <span class="n">fun_list</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">interpolate_wrapper</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">(</span><span class="n">Fs</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">fun_hstack</span><span class="p">(</span><span class="n">fun_list</span><span class="p">):</span>

    <span class="n">Fs</span> <span class="o">=</span> <span class="p">[</span><span class="n">IW</span><span class="o">.</span><span class="n">F</span> <span class="k">for</span> <span class="n">IW</span> <span class="ow">in</span> <span class="n">fun_list</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">interpolate_wrapper</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">(</span><span class="n">Fs</span><span class="p">))</span>


<span class="k">def</span> <span class="nf">simulate_markov</span><span class="p">(</span><span class="n">π</span><span class="p">,</span> <span class="n">s_0</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>

    <span class="n">sHist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">T</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">sHist</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">s_0</span>
    <span class="n">S</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">π</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">T</span><span class="p">):</span>
        <span class="n">sHist</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">S</span><span class="p">),</span> <span class="n">p</span><span class="o">=</span><span class="n">π</span><span class="p">[</span><span class="n">sHist</span><span class="p">[</span><span class="n">t</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]])</span>

    <span class="k">return</span> <span class="n">sHist</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="anticipated-one-period-war">
<h3><span class="section-number">40.4.1. </span>Anticipated One-Period War<a class="headerlink" href="#anticipated-one-period-war" title="Permalink to this headline">¶</a></h3>
<p>In our lecture on <a class="reference internal" href="opt_tax_recur.html"><span class="doc">optimal taxation with state-contingent debt</span></a>
we studied how the government manages uncertainty in a simple setting.</p>
<p>As in that lecture, we assume the one-period utility function</p>
<div class="math notranslate nohighlight">
\[
u(c,n) = {\frac{c^{1-\sigma}}{1-\sigma}} - {\frac{n^{1+\gamma}}{1+\gamma}}
\]</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>For convenience in  matching our computer code, we have expressed
utility as a function of <span class="math notranslate nohighlight">\(n\)</span> rather than leisure <span class="math notranslate nohighlight">\(l\)</span>.</p>
</div>
<p>We first consider a government expenditure process that we  studied earlier in a lecture on
<a class="reference internal" href="opt_tax_recur.html"><span class="doc">optimal taxation with state-contingent debt</span></a>.</p>
<p>Government expenditures are known for sure in all periods except one.</p>
<ul class="simple">
<li><p>For <span class="math notranslate nohighlight">\(t&lt;3\)</span> or <span class="math notranslate nohighlight">\(t &gt; 3\)</span> we assume that <span class="math notranslate nohighlight">\(g_t = g_l = 0.1\)</span>.</p></li>
<li><p>At <span class="math notranslate nohighlight">\(t = 3\)</span> a war occurs with probability 0.5.</p>
<ul>
<li><p>If there is war, <span class="math notranslate nohighlight">\(g_3 = g_h = 0.2\)</span>.</p></li>
<li><p>If there is no war <span class="math notranslate nohighlight">\(g_3 = g_l = 0.1\)</span>.</p></li>
</ul>
</li>
</ul>
<p>A useful trick is to define  components of the state vector as the following six
<span class="math notranslate nohighlight">\((t,g)\)</span> pairs:</p>
<div class="math notranslate nohighlight">
\[
(0,g_l), (1,g_l), (2,g_l), (3,g_l), (3,g_h), (t\geq 4,g_l)
\]</div>
<p>We think of these 6 states as corresponding to <span class="math notranslate nohighlight">\(s=1,2,3,4,5,6\)</span>.</p>
<p>The transition matrix is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P = \begin{pmatrix}
  0 &amp; 1 &amp; 0 &amp; 0   &amp; 0   &amp; 0\\
  0 &amp; 0 &amp; 1 &amp; 0   &amp; 0   &amp; 0\\
  0 &amp; 0 &amp; 0 &amp; 0.5 &amp; 0.5 &amp; 0\\
  0 &amp; 0 &amp; 0 &amp; 0   &amp; 0   &amp; 1\\
  0 &amp; 0 &amp; 0 &amp; 0   &amp; 0   &amp; 1\\
  0 &amp; 0 &amp; 0 &amp; 0   &amp; 0   &amp; 1
\end{pmatrix}
\end{split}\]</div>
<p>The government expenditure at  each state is</p>
<div class="math notranslate nohighlight">
\[\begin{split}
g = \left(\begin{matrix} 0.1\\0.1\\0.1\\0.1\\0.2\\0.1 \end{matrix}\right)
\end{split}\]</div>
<p>We assume the same utility parameters as in the <a class="reference internal" href="opt_tax_recur.html"><span class="doc">Lucas-Stokey economy</span></a>.</p>
<p>This utility function is implemented in the following class.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="k">class</span> <span class="nc">CRRAutility</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">β</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                 <span class="n">σ</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">γ</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">π</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                 <span class="n">G</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>
                 <span class="n">Θ</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                 <span class="n">transfers</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">σ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">γ</span> <span class="o">=</span> <span class="n">β</span><span class="p">,</span> <span class="n">σ</span><span class="p">,</span> <span class="n">γ</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">π</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfers</span> <span class="o">=</span> <span class="n">π</span><span class="p">,</span> <span class="n">G</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">transfers</span>

    <span class="c1"># Utility function</span>
    <span class="k">def</span> <span class="nf">U</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="n">σ</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">σ</span>
        <span class="k">if</span> <span class="n">σ</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="p">(</span><span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">σ</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">σ</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">U</span> <span class="o">-</span> <span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">γ</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">γ</span><span class="p">)</span>

    <span class="c1"># Derivatives of utility function</span>
    <span class="k">def</span> <span class="nf">Uc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">σ</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Ucc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">σ</span> <span class="o">*</span> <span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">σ</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Un</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">n</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">γ</span>

    <span class="k">def</span> <span class="nf">Unn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">γ</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">γ</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following figure plots  Ramsey plans under complete and incomplete
markets for both possible realizations of the state at time <span class="math notranslate nohighlight">\(t=3\)</span>.</p>
<p>Ramsey outcomes and  policies when  the government has  access to state-contingent debt are
represented by black lines and  by red lines when there is only a risk-free bond.</p>
<p>Paths with circles are histories in which there is peace, while those with
triangle denote war.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initialize μgrid for value function iteration</span>
<span class="n">μ_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.7</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>

<span class="n">time_example</span> <span class="o">=</span> <span class="n">CRRAutility</span><span class="p">()</span>

<span class="n">time_example</span><span class="o">.</span><span class="n">π</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span>  <span class="mi">0</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">],</span>
                           <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>   <span class="mi">0</span><span class="p">,</span>  <span class="mi">1</span><span class="p">]])</span>

<span class="n">time_example</span><span class="o">.</span><span class="n">G</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
<span class="n">time_example</span><span class="o">.</span><span class="n">Θ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">)</span>  <span class="c1"># Θ can in principle be random</span>

<span class="n">time_example</span><span class="o">.</span><span class="n">transfers</span> <span class="o">=</span> <span class="kc">True</span>             <span class="c1"># Government can use transfers</span>
<span class="c1"># Solve sequential problem</span>
<span class="n">time_sequential</span> <span class="o">=</span> <span class="n">SequentialAllocation</span><span class="p">(</span><span class="n">time_example</span><span class="p">)</span>
<span class="c1"># Solve recursive problem</span>
<span class="n">time_bellman</span> <span class="o">=</span> <span class="n">RecursiveAllocationAMSS</span><span class="p">(</span><span class="n">time_example</span><span class="p">,</span> <span class="n">μ_grid</span><span class="p">)</span>

<span class="n">sHist_h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>
<span class="n">sHist_l</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">])</span>

<span class="n">sim_seq_h</span> <span class="o">=</span> <span class="n">time_sequential</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">sHist_h</span><span class="p">)</span>
<span class="n">sim_bel_h</span> <span class="o">=</span> <span class="n">time_bellman</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">sHist_h</span><span class="p">)</span>
<span class="n">sim_seq_l</span> <span class="o">=</span> <span class="n">time_sequential</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">sHist_l</span><span class="p">)</span>
<span class="n">sim_bel_l</span> <span class="o">=</span> <span class="n">time_bellman</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="n">sHist_l</span><span class="p">)</span>

<span class="c1"># Government spending paths</span>
<span class="n">sim_seq_l</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist_l</span><span class="p">]</span>
<span class="n">sim_seq_h</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist_h</span><span class="p">]</span>
<span class="n">sim_bel_l</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist_l</span><span class="p">]</span>
<span class="n">sim_bel_h</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist_h</span><span class="p">]</span>

<span class="c1"># Output paths</span>
<span class="n">sim_seq_l</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist_l</span><span class="p">]</span> <span class="o">*</span> <span class="n">sim_seq_l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sim_seq_h</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist_h</span><span class="p">]</span> <span class="o">*</span> <span class="n">sim_seq_h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sim_bel_l</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist_l</span><span class="p">]</span> <span class="o">*</span> <span class="n">sim_bel_l</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sim_bel_h</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">time_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist_h</span><span class="p">]</span> <span class="o">*</span> <span class="n">sim_bel_h</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>


<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Consumption&#39;</span><span class="p">,</span> <span class="s1">&#39;Labor Supply&#39;</span><span class="p">,</span> <span class="s1">&#39;Government Debt&#39;</span><span class="p">,</span>
          <span class="s1">&#39;Tax Rate&#39;</span><span class="p">,</span> <span class="s1">&#39;Government Spending&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">sim_l</span><span class="p">,</span> <span class="n">sim_h</span><span class="p">,</span> <span class="n">bel_l</span><span class="p">,</span> <span class="n">bel_h</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">titles</span><span class="p">,</span>
                                                 <span class="n">sim_seq_l</span><span class="p">,</span> <span class="n">sim_seq_h</span><span class="p">,</span>
                                                 <span class="n">sim_bel_l</span><span class="p">,</span> <span class="n">sim_bel_h</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">sim_l</span><span class="p">,</span> <span class="s1">&#39;-ok&#39;</span><span class="p">,</span> <span class="n">sim_h</span><span class="p">,</span> <span class="s1">&#39;-^k&#39;</span><span class="p">,</span> <span class="n">bel_l</span><span class="p">,</span> <span class="s1">&#39;-or&#39;</span><span class="p">,</span> <span class="n">bel_h</span><span class="p">,</span> <span class="s1">&#39;-^r&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-6-39f35cd207b8&gt;:24: RuntimeWarning: divide by zero encountered in reciprocal
  U = (c**(1 - σ) - 1) / (1 - σ)
&lt;ipython-input-6-39f35cd207b8&gt;:29: RuntimeWarning: divide by zero encountered in power
  return c**(-self.σ)
&lt;ipython-input-4-03a0772b8d2d&gt;:249: RuntimeWarning: invalid value encountered in true_divide
  x * u_c / Eu_c - u_c * (c - T) - Un(c, n) * n - β * xprime,
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-4-03a0772b8d2d&gt;:228: RuntimeWarning: invalid value encountered in matmul
  return -π[s_] @ (U(c, n) + β * Vprime)
&lt;ipython-input-4-03a0772b8d2d&gt;:247: RuntimeWarning: invalid value encountered in matmul
  Eu_c = π[s_] @ u_c
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-4-03a0772b8d2d&gt;:249: RuntimeWarning: invalid value encountered in multiply
  x * u_c / Eu_c - u_c * (c - T) - Un(c, n) * n - β * xprime,
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.6030706261423773
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.119037360746817
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.09884262284542447
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.08356475407094938
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.07151359703677923
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.061745876031069985
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.05367337935754222
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.046903178313989775
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.04116139502909332
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.03624763004275183
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.03201282735794993
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.028341083097816442
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.025141875602940435
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.022342641223072876
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0198851639345408
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.017720878016059975
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.015810031888999678
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.014118987266669767
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.012619937121068167
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.011288516100708388
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.010104287167724465
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00904956818645456
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.008109315193308774
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.007270001479631742
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0065203013619047545
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.005850043954804741
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.005250383151642868
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.004713551490239407
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.004232692977888879
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0038017894024217473
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.003415466445075699
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0030689407066740726
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0027580523276111717
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0024790085297236616
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00222850604087004
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.002003533493809852
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0018014912314098495
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.001619965635394229
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0014568480828949253
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0013102720410597475
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0011785205403835445
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0010600794593784537
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0009535927120159006
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0008578713388843061
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0007717527143432079
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0006943420237480938
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0006246892419779627
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0005620650721875823
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00050571472648787
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00045504098262734785
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00040946542862113985
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00036842432543158517
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00033152772960924967
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00029833807533566895
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0002684799564396325
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00024157736794961046
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0002173993502282978
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00019564599426965363
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.000176073193946152
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00015845299793682539
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00014260409930579891
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00012831556659378054
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00011547668265184808
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00010392607264405236
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.353195050439063e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.417827491776674e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.576074406703808e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.818557262305323e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.136828596025324e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.5225483897325795e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.9703594240819585e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.4734050916067555e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.02615585454253e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.6236354269003134e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.26136916549113e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.9353406348951783e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.6402662356418403e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.3762520455195428e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.1386839739329452e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.924799185674155e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.732367532209578e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.5591864668828884e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.4033206025258824e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.2630482395166065e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.1368026612062228e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0231773226362706e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.209103479737345e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.288660850374456e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.460224703864519e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.714596780037907e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.04349831148575e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.439478626187387e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.895832079719631e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.406523522386409e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.9661212275908945e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.5697365384393476e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.212969502802646e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.890740198430114e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.6018877168998145e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.3418978733112467e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.107886630922685e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.8972581493926937e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.7076759846450462e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.5370371638646977e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.383448851656797e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.2452073517946832e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.1207792059374484e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.008784180991781e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.079799589969529e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.172483544675036e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.355829106211184e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.620777369540083e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.959174555295693e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.363681645687899e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.827692900957038e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.3452626237850647e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.911039199614766e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.520205742956182e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.1684266714996703e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.851799596734004e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.5668120617883436e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.3103025598413478e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.0794254947303998e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.871619578413216e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.6845794717163797e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.5162301644615093e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.3647039863392715e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.2283198949636531e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.1055648016751587e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.950768306720806e-08
</pre></div>
</div>
<img alt="_images/amss_13_133.png" src="_images/amss_13_133.png" />
</div>
</div>
<p>How a Ramsey planner responds to  war depends on the structure of the asset market.</p>
<p>If it is able to trade state-contingent debt, then at time <span class="math notranslate nohighlight">\(t=2\)</span></p>
<ul class="simple">
<li><p>the government <strong>purchases</strong> an Arrow security that pays off when <span class="math notranslate nohighlight">\(g_3 = g_h\)</span></p></li>
<li><p>the government <strong>sells</strong> an Arrow security that  pays off when <span class="math notranslate nohighlight">\(g_3 = g_l\)</span></p></li>
<li><p>the Ramsey planner designs these purchases and sales  designed so  that, regardless of whether or not there is a war at <span class="math notranslate nohighlight">\(t=3\)</span>, the government  begins  period <span class="math notranslate nohighlight">\(t=4\)</span> with the <em>same</em> government debt</p></li>
</ul>
<p>This pattern facilities smoothing tax rates across  states.</p>
<p>The government without state-contingent debt cannot do this.</p>
<p>Instead, it must enter   time <span class="math notranslate nohighlight">\(t=3\)</span> with the same level of debt falling due whether there is peace or war at <span class="math notranslate nohighlight">\(t=3\)</span>.</p>
<p>The risk-free rate between time <span class="math notranslate nohighlight">\(2\)</span> and time <span class="math notranslate nohighlight">\(3\)</span> is unusually <strong>low</strong> because at time <span class="math notranslate nohighlight">\(2\)</span> consumption at time <span class="math notranslate nohighlight">\(3\)</span> is expected to be unusually <strong>low</strong>.</p>
<p>A <strong>low</strong> risk-free rate of return on government debt between time <span class="math notranslate nohighlight">\(2\)</span> and time <span class="math notranslate nohighlight">\(3\)</span> allows the government to enter period <span class="math notranslate nohighlight">\(3\)</span> with <strong>lower</strong> government debt than it entered period <span class="math notranslate nohighlight">\(2\)</span>.</p>
<p>To finance a war at time <span class="math notranslate nohighlight">\(3\)</span> it raises taxes and issues more debt to carry into perpetual peace that begins in period <span class="math notranslate nohighlight">\(4\)</span>.</p>
<p>To service the additional debt burden, it raises taxes in all future periods.</p>
<p>The absence of state-contingent debt leads to an important difference in the
optimal tax policy.</p>
<p>When the Ramsey planner has access to state-contingent debt, the optimal tax
policy is history independent</p>
<ul class="simple">
<li><p>the tax rate is a function  of the current level of government spending only,
given the Lagrange multiplier on the implementability constraint</p></li>
</ul>
<p>Without state-contingent debt, the optimal tax rate is history dependent.</p>
<ul class="simple">
<li><p>A war at time <span class="math notranslate nohighlight">\(t=3\)</span> causes a permanent <strong>increase</strong> in the tax rate.</p></li>
<li><p>Peace at time <span class="math notranslate nohighlight">\(t=3\)</span> causes a permanent <strong>reduction</strong> in the tax rate.</p></li>
</ul>
<div class="section" id="perpetual-war-alert">
<h4><span class="section-number">40.4.1.1. </span>Perpetual War Alert<a class="headerlink" href="#perpetual-war-alert" title="Permalink to this headline">¶</a></h4>
<p>History dependence occurs more dramatically in a case in which the government
perpetually faces the prospect  of war.</p>
<p>This case was studied in the final example of the lecture on
<a class="reference internal" href="opt_tax_recur.html"><span class="doc">optimal taxation with state-contingent debt</span></a>.</p>
<p>There, each period the government faces a constant probability, <span class="math notranslate nohighlight">\(0.5\)</span>, of war.</p>
<p>In addition, this example features the following preferences</p>
<div class="math notranslate nohighlight">
\[
u(c,n) = \log(c) + 0.69 \log(1-n)
\]</div>
<p>In accordance, we will re-define our utility function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="k">class</span> <span class="nc">LogUtility</span><span class="p">:</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">β</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
                 <span class="n">ψ</span><span class="o">=</span><span class="mf">0.69</span><span class="p">,</span>
                 <span class="n">π</span><span class="o">=</span><span class="mf">0.5</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">)),</span>
                 <span class="n">G</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">]),</span>
                 <span class="n">Θ</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span>
                 <span class="n">transfers</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">β</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ψ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">π</span> <span class="o">=</span> <span class="n">β</span><span class="p">,</span> <span class="n">ψ</span><span class="p">,</span> <span class="n">π</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">Θ</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">transfers</span> <span class="o">=</span> <span class="n">G</span><span class="p">,</span> <span class="n">Θ</span><span class="p">,</span> <span class="n">transfers</span>

    <span class="c1"># Utility function</span>
    <span class="k">def</span> <span class="nf">U</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">ψ</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>

    <span class="c1"># Derivatives of utility function</span>
    <span class="k">def</span> <span class="nf">Uc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">c</span>

    <span class="k">def</span> <span class="nf">Ucc</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">c</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Un</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ψ</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">Unn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">n</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">ψ</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
</pre></div>
</div>
</div>
</div>
<p>With these preferences, Ramsey tax rates will vary even in the Lucas-Stokey
model with state-contingent debt.</p>
<p>The figure below plots optimal tax policies for both the economy with
state-contingent debt (circles) and the economy with only a risk-free bond
(triangles).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">log_example</span> <span class="o">=</span> <span class="n">LogUtility</span><span class="p">()</span>
<span class="n">log_example</span><span class="o">.</span><span class="n">transfers</span> <span class="o">=</span> <span class="kc">True</span>                    <span class="c1"># Government can use transfers</span>
<span class="n">log_sequential</span> <span class="o">=</span> <span class="n">SequentialAllocation</span><span class="p">(</span><span class="n">log_example</span><span class="p">)</span>  <span class="c1"># Solve sequential problem</span>
<span class="n">log_bellman</span> <span class="o">=</span> <span class="n">RecursiveAllocationAMSS</span><span class="p">(</span><span class="n">log_example</span><span class="p">,</span> <span class="n">μ_grid</span><span class="p">)</span>

<span class="n">T</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">sHist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span>
                  <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># Simulate</span>
<span class="n">sim_seq</span> <span class="o">=</span> <span class="n">log_sequential</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sHist</span><span class="p">)</span>
<span class="n">sim_bel</span> <span class="o">=</span> <span class="n">log_bellman</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sHist</span><span class="p">)</span>

<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Consumption&#39;</span><span class="p">,</span> <span class="s1">&#39;Labor Supply&#39;</span><span class="p">,</span> <span class="s1">&#39;Government Debt&#39;</span><span class="p">,</span>
          <span class="s1">&#39;Tax Rate&#39;</span><span class="p">,</span> <span class="s1">&#39;Government Spending&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>

<span class="c1"># Government spending paths</span>
<span class="n">sim_seq</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist</span><span class="p">]</span>
<span class="n">sim_bel</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist</span><span class="p">]</span>

<span class="c1"># Output paths</span>
<span class="n">sim_seq</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist</span><span class="p">]</span> <span class="o">*</span> <span class="n">sim_seq</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sim_bel</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist</span><span class="p">]</span> <span class="o">*</span> <span class="n">sim_bel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">bel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">titles</span><span class="p">,</span> <span class="n">sim_seq</span><span class="p">,</span> <span class="n">sim_bel</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s1">&#39;-ok&#39;</span><span class="p">,</span> <span class="n">bel</span><span class="p">,</span> <span class="s1">&#39;-^b&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Complete Markets&#39;</span><span class="p">,</span> <span class="s1">&#39;Incomplete Markets&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-8-0cc001bf9680&gt;:18: RuntimeWarning: invalid value encountered in log
  return np.log(c) + self.ψ * np.log(1 - n)
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-8-0cc001bf9680&gt;:18: RuntimeWarning: divide by zero encountered in log
  return np.log(c) + self.ψ * np.log(1 - n)
&lt;ipython-input-8-0cc001bf9680&gt;:22: RuntimeWarning: divide by zero encountered in true_divide
  return 1 / c
&lt;ipython-input-4-03a0772b8d2d&gt;:249: RuntimeWarning: invalid value encountered in true_divide
  x * u_c / Eu_c - u_c * (c - T) - Un(c, n) * n - β * xprime,
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;ipython-input-4-03a0772b8d2d&gt;:249: RuntimeWarning: invalid value encountered in multiply
  x * u_c / Eu_c - u_c * (c - T) - Un(c, n) * n - β * xprime,
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.09446484302831852
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.05970940007126749
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.009422474129786623
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.008381147732749755
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.007462885945072678
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0066504800913171095
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0059315769552825085
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.005293673637597443
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.004727195442970038
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.004222838148378802
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.003774443617264619
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.003374916623552161
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.003018468405014365
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0027009777222623626
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0024170199999151904
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0021639337877327443
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0019373544023084711
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.001735148009778677
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0015540671820026889
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.001392256372194142
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.001247332348171503
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0011176984653442708
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0010015767779378206
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0008976300969636929
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0008045019079373913
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0007210964485182089
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0006463564416537973
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0005793977844259002
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0005193831514304564
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00046560605625907734
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00041739820258160956
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00037419859115101547
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0003354571714870619
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00030074679953907813
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0002696125932599305
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00024171614689146972
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00021669307960175223
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00019427142122149614
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00017416077245204664
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00015613396285848622
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00013997010056521913
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00012548480457363705
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00011249109088860491
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.00010084488627235754
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.040253860248785e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.104281298356912e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.265094611587277e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.512901342833164e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.8385005261012747e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.233276812651015e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.6913619163782775e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.205433440345834e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.769833529197426e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.3793374517978316e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.029253841496564e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.7152715056001786e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.433984524776732e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.1817535559535635e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.9556081539946135e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.752979166771251e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.5710074520131714e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.4082582730788853e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.262274204384824e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.1314462623765407e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0141461596558824e-05
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.090163602466033e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.147738859195441e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.302999066428424e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.5458725514497e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.867094695733755e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.258825575742533e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.713379866793032e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.2247219783852554e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.7865019395394922e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.3938295534089547e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.0416205371902886e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.726111638824466e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.443095933040781e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.1897478360367666e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.9625310408444306e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.75905309177141e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.5766335523889878e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.413139656420867e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.2666407314203265e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.1353134023252027e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0167940012939796e-06
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.116370317707893e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>8.17111157119753e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.324201080172669e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.565096428919056e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.884232232463482e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.275385666378574e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.728319824962333e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>4.2384489261349604e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.798772435698214e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.405116268208333e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3.051896569478866e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.735606518033616e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.4518337420338297e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.197742624450077e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.969707553693821e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.76562566161499e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.5824206315855775e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.418449304736164e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.2712916173872486e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.1395546057781559e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0213439513379077e-07
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>9.155308931406927e-08
</pre></div>
</div>
<img alt="_images/amss_17_111.png" src="_images/amss_17_111.png" />
</div>
</div>
<p>When the government experiences a prolonged period of peace, it is able to reduce
government debt and set persistently lower tax rates.</p>
<p>However, the government  finances a long war by borrowing and raising taxes.</p>
<p>This results in a drift away from  policies with state-contingent debt that
depends on the history of shocks.</p>
<p>This is even more evident in the following figure that plots the evolution of
the two policies over 200 periods.</p>
<p>This outcome reflects the presence of a force for <strong>precautionary saving</strong> that the incomplete markets structure imparts to the Ramsey plan.</p>
<p>In <a class="reference internal" href="amss2.html"><span class="doc">this subsequent lecture</span></a> and  <a class="reference internal" href="amss3.html"><span class="doc">this subsequent lecture</span></a>, some ultimate consequences of that force are explored.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">T</span> <span class="o">=</span> <span class="mi">200</span>  <span class="c1"># Set T to 200 periods</span>
<span class="n">sim_seq_long</span> <span class="o">=</span> <span class="n">log_sequential</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">)</span>
<span class="n">sHist_long</span> <span class="o">=</span> <span class="n">sim_seq_long</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
<span class="n">sim_bel_long</span> <span class="o">=</span> <span class="n">log_bellman</span><span class="o">.</span><span class="n">simulate</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">sHist_long</span><span class="p">)</span>

<span class="n">titles</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Consumption&#39;</span><span class="p">,</span> <span class="s1">&#39;Labor Supply&#39;</span><span class="p">,</span> <span class="s1">&#39;Government Debt&#39;</span><span class="p">,</span>
          <span class="s1">&#39;Tax Rate&#39;</span><span class="p">,</span> <span class="s1">&#39;Government Spending&#39;</span><span class="p">,</span> <span class="s1">&#39;Output&#39;</span><span class="p">]</span>

<span class="c1"># Government spending paths</span>
<span class="n">sim_seq_long</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist_long</span><span class="p">]</span>
<span class="n">sim_bel_long</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_example</span><span class="o">.</span><span class="n">G</span><span class="p">[</span><span class="n">sHist_long</span><span class="p">]</span>

<span class="c1"># Output paths</span>
<span class="n">sim_seq_long</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist_long</span><span class="p">]</span> <span class="o">*</span> <span class="n">sim_seq_long</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">sim_bel_long</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">log_example</span><span class="o">.</span><span class="n">Θ</span><span class="p">[</span><span class="n">sHist_long</span><span class="p">]</span> <span class="o">*</span> <span class="n">sim_bel_long</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>

<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">bel</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axes</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">titles</span><span class="p">,</span> <span class="n">sim_seq_long</span><span class="p">,</span> \
        <span class="n">sim_bel_long</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="s1">&#39;-k&#39;</span><span class="p">,</span> <span class="n">bel</span><span class="p">,</span> <span class="s1">&#39;-.b&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="s1">&#39;Complete Markets&#39;</span><span class="p">,</span><span class="s1">&#39;Incomplete Markets&#39;</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/amss_19_0.png" src="_images/amss_19_0.png" />
</div>
</div>
<hr class="footnotes docutils" />
<dl class="footnote brackets">
<dt class="label" id="fn-a"><span class="brackets"><a class="fn-backref" href="#id6">1</a></span></dt>
<dd><p>In an allocation that solves the Ramsey problem and that levies distorting
taxes on labor, why would the government ever want to hand revenues back
to the private sector? It would not in an economy with state-contingent debt, since
any such allocation could be improved by lowering distortionary taxes
rather than handing out lump-sum transfers. But, without state-contingent
debt there can be circumstances when a government would like to make
lump-sum transfers to the private sector.</p>
</dd>
<dt class="label" id="fn-b"><span class="brackets"><a class="fn-backref" href="#id7">2</a></span></dt>
<dd><p>From the first-order conditions for the Ramsey
problem, there exists another realization <span class="math notranslate nohighlight">\(\tilde s^t\)</span> with
the same history up until the previous period, i.e., <span class="math notranslate nohighlight">\(\tilde s^{t-1}=
s^{t-1}\)</span>, but where the multiplier on constraint <a class="reference internal" href="#equation-amss-46">(40.11)</a> takes  a positive value, so
<span class="math notranslate nohighlight">\(\gamma_t(\tilde s^t)&gt;0\)</span>.</p>
</dd>
</dl>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            
            <div class="sidebar bd-sidebar inactive" id="site-navigation">

                <div class="sidebar__header">


                    Contents

                </div>

                <nav class="sidebar__nav" id="sidebar-nav" aria-label="Main navigation">
                    <p class="caption">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="orth_proj.html">
   1. Orthogonal Projections and Their Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stationary_densities.html">
   2. Continuous State Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="muth_kalman.html">
   3. Reverse Engineering a la Muth
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="discrete_dp.html">
   4. Discrete State Dynamic Programming
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cons_news.html">
   5. Information and Consumption Smoothing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing.html">
   6. Consumption Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing_tax.html">
   7. Tax Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="robustness.html">
   8. Robustness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_jump_lq.html">
   9. Markov Jump Linear Quadratic Dynamic Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_1.html">
   10. How to Pay for a War: Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_2.html">
   11. How to Pay for a War: Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_3.html">
   12. How to Pay for a War: Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lqramsey.html">
   13. Optimal Taxation in an LQ Economy
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="rob_markov_perf.html">
   14. Robust Markov Perfect Equilibrium
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="arellano.html">
   15. Default Risk and Income Fluctuations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="matsuyama.html">
   16. Globalization and Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coase.html">
   17. Coase’s Theory of the Firm
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Dynamic Linear Economies
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="hs_recursive_models.html">
   18. Recursive Models of Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="growth_in_dles.html">
   19. Growth in Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_asset_pricing_dles.html">
   20. Lucas Asset Pricing Using DLE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irfs_in_hall_model.html">
   21. IRFs in Hall Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="permanent_income_dles.html">
   22. Permanent Income Model using the DLE Class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rosen_schooling_model.html">
   23. Rosen Schooling Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cattle_cycles.html">
   24. Cattle Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hs_invertibility_example.html">
   25. Shock Non Invertibility
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Classic Linear Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="von_neumann_model.html">
   26. Von Neumann Growth Model (and a Generalization)
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Time Series Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arma.html">
   27. Covariance Stationary Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="estspec.html">
   28. Estimation of Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="additive_functionals.html">
   29. Additive and Multiplicative Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lu_tricks.html">
   30. Classical Control with Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classical_filtering.html">
   31. Classical Prediction and Filtering With Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="knowing_forecasts_of_others.html">
   32. Knowing the Forecasts of Others
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_model.html">
   33. Asset Pricing II: The Lucas Asset Pricing Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="black_litterman.html">
   34. Two Modifications of Mean-Variance Portfolio Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_complete_mkts.html">
   35. Irrelevance of Capital Structure with Complete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_incomplete_mkts.html">
   36. Equilibrium Capital Structures with Incomplete Markets
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Dynamic Programming Squared
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="dyn_stack.html">
   37. Stackelberg Plans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo.html">
   38. Ramsey Plans, Time Inconsistency, Sustainable Plans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="opt_tax_recur.html">
   39. Optimal Taxation with State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   40. Optimal Taxation without State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss2.html">
   41. Fluctuating Interest Rates Deliver Fiscal Insurance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss3.html">
   42. Fiscal Risk and Government Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_ramsey.html">
   43. Competitive Equilibria of a Model of Chang
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_credible.html">
   44. Credible Government Policies in a Model of Chang
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   45. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   46. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   47. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="toolbar">

            <div class="toolbar__inner">

                <ul class="toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                    <!-- <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off">
                            <i data-feather="search"></i>
                        </form>
                    </li> -->
                </ul>

                <ul class="toolbar__links">
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/amss.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li data-tippy-content="Download PDF" onClick="window.print()"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-advanced.myst/tree/master/lectures/amss.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="" download><p style="color: white;">Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://mybinder.org/v2/gh/QuantEcon/lecture-python-advanced.notebooks/master?urlpath=tree/amss.ipynb">BinderHub</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python-advanced.notebooks" data-urlpath="tree/lecture-python-advanced.notebooks/amss.ipynb" data-branch=master>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://mybinder.org/v2/gh/QuantEcon/lecture-python-advanced.notebooks/master?urlpath=tree/amss.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "amss";
                const repoURL = "https://github.com/QuantEcon/lecture-python-advanced.notebooks";
                const urlPath = "tree/lecture-python-advanced.notebooks/amss.ipynb";
                const branch = "master"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
    
<script async="" src="https://www.google-analytics.com/analytics.js"></script>
<script>
                        window.ga = window.ga || function () {
                            (ga.q = ga.q || []).push(arguments) };
                        ga.l = +new Date;
                        ga('create', 'UA-54984338-11', 'auto');
                        ga('set', 'anonymizeIp', true);
                        ga('send', 'pageview');
                    </script>

  </body>
</html>