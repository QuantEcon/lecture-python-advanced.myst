

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>40. Stackelberg Plans &#8212; Advanced Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/quantecon-book-theme.279dae03c5caae754d20501e3fa00bbf.css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script src="_static/quantecon-book-theme.15b0c36fffe88f468997fa7b698991d3.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-KZLV7PM9LL"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KZLV7PM9LL');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min", "col": "col", "Span": "span", "epsilon": "\\varepsilon", "EE": "\\mathbb{E}", "PP": "\\mathbb{P}", "RR": "\\mathbb{R}", "NN": "\\mathbb{N}", "ZZ": "\\mathbb{Z}", "aA": "\\mathcal{A}", "bB": "\\mathcal{B}", "cC": "\\mathcal{C}", "dD": "\\mathcal{D}", "eE": "\\mathcal{E}", "fF": "\\mathcal{F}", "gG": "\\mathcal{G}", "hH": "\\mathcal{H}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'dyn_stack';</script>
    <link rel="canonical" href="https://python-advanced.quantecon.org/dyn_stack.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="41. Ramsey Plans, Time Inconsistency, Sustainable Plans" href="calvo.html" />
    <link rel="prev" title="39. Optimal Unemployment Insurance" href="un_insure.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Stackelberg Plans"/>
<meta name="twitter:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Stackelberg Plans" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python-advanced.quantecon.org/dyn_stack.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Advanced Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=dyn_stack>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">40.1. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#duopoly">40.2. Duopoly</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#stackelberg-leader-and-follower">40.2.1. Stackelberg Leader and Follower</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#statement-of-leaders-and-followers-problems">40.2.2. Statement of  Leader’s and Follower’s Problems</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#firms-problems">40.2.3. Firms’ Problems</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stackelberg-problem">40.3. Stackelberg Problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#interpretation-of-second-block-of-equations">40.3.1. Interpretation of  Second Block of Equations</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#more-mechanical-details">40.3.2. More Mechanical Details</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#two-subproblems">40.3.3. Two Subproblems</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#two-bellman-equations">40.4. Two Bellman Equations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stackelberg-plan-for-duopoly">40.5. Stackelberg Plan for Duopoly</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#calculations-to-prepare-duopoly-model">40.5.1. Calculations to Prepare Duopoly Model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#firm-1s-problem">40.5.2. Firm 1’s Problem</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-representation-of-stackelberg-plan">40.6. Recursive Representation of Stackelberg Plan</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#comments-and-interpretations">40.6.1. Comments and Interpretations</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#dynamic-programming-and-time-consistency-of-followers-problem">40.7. Dynamic Programming and Time Consistency of Follower’s Problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-formulation-of-a-followers-problem">40.7.1. Recursive Formulation of a Follower’s Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#time-consistency-of-followers-plan">40.7.2. Time Consistency of Follower’s Plan</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#computing-stackelberg-plan">40.8. Computing  Stackelberg Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-series-for-price-and-quantities">40.9. Time Series for Price and Quantities</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#value-of-stackelberg-leader">40.9.1. Value of Stackelberg Leader</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#time-inconsistency-of-stackelberg-plan">40.10. Time Inconsistency of Stackelberg Plan</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#recursive-formulation-of-followers-problem">40.11. Recursive Formulation of Follower’s Problem</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#explanation-of-alignment">40.11.1. Explanation of Alignment</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#markov-perfect-equilibrium">40.12. Markov Perfect Equilibrium</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-markov-perfect-equilibrium-and-stackelberg-outcome">40.13. Comparing Markov Perfect Equilibrium and  Stackelberg Outcome</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo" alt="logo"></a>
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Advanced Quantitative Economics with Python</a></p>

                        <p class="qe-page__header-subheading">Stackelberg Plans</p>

                    </div>

                    <p class="qe-page__header-authors">Thomas J. Sargent & John Stachurski</p>

                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <div id="qe-notebook-header" align="right" style="text-align:right;">
        <a href="https://quantecon.org/" title="quantecon.org">
                <img style="width:250px;display:inline;" width="250px" src="https://assets.quantecon.org/img/qe-menubar-logo.svg" alt="QuantEcon">
        </a>
</div><section class="tex2jax_ignore mathjax_ignore" id="stackelberg-plans">
<h1><a class="toc-backref" href="#id4" role="doc-backlink"><span class="section-number">40. </span>Stackelberg Plans</a><a class="headerlink" href="#stackelberg-plans" title="Permalink to this heading">#</a></h1>
<nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#stackelberg-plans" id="id4">Stackelberg Plans</a></p>
<ul>
<li><p><a class="reference internal" href="#overview" id="id5">Overview</a></p></li>
<li><p><a class="reference internal" href="#duopoly" id="id6">Duopoly</a></p></li>
<li><p><a class="reference internal" href="#stackelberg-problem" id="id7">Stackelberg Problem</a></p></li>
<li><p><a class="reference internal" href="#two-bellman-equations" id="id8">Two Bellman Equations</a></p></li>
<li><p><a class="reference internal" href="#stackelberg-plan-for-duopoly" id="id9">Stackelberg Plan for Duopoly</a></p></li>
<li><p><a class="reference internal" href="#recursive-representation-of-stackelberg-plan" id="id10">Recursive Representation of Stackelberg Plan</a></p></li>
<li><p><a class="reference internal" href="#dynamic-programming-and-time-consistency-of-followers-problem" id="id11">Dynamic Programming and Time Consistency of Follower’s Problem</a></p></li>
<li><p><a class="reference internal" href="#computing-stackelberg-plan" id="id12">Computing  Stackelberg Plan</a></p></li>
<li><p><a class="reference internal" href="#time-series-for-price-and-quantities" id="id13">Time Series for Price and Quantities</a></p></li>
<li><p><a class="reference internal" href="#time-inconsistency-of-stackelberg-plan" id="id14">Time Inconsistency of Stackelberg Plan</a></p></li>
<li><p><a class="reference internal" href="#recursive-formulation-of-followers-problem" id="id15">Recursive Formulation of Follower’s Problem</a></p></li>
<li><p><a class="reference internal" href="#markov-perfect-equilibrium" id="id16">Markov Perfect Equilibrium</a></p></li>
<li><p><a class="reference internal" href="#comparing-markov-perfect-equilibrium-and-stackelberg-outcome" id="id17">Comparing Markov Perfect Equilibrium and  Stackelberg Outcome</a></p></li>
</ul>
</li>
</ul>
</nav>
<p>In addition to what’s in Anaconda, this lecture will need the following libraries:</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install --upgrade quantecon
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: quantecon in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (0.7.1)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: requests in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from quantecon) (2.28.1)
Requirement already satisfied: sympy in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from quantecon) (1.11.1)
Requirement already satisfied: numpy&gt;=1.17.0 in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from quantecon) (1.23.5)
Requirement already satisfied: scipy&gt;=1.5.0 in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from quantecon) (1.10.0)
Requirement already satisfied: numba&gt;=0.49.0 in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from quantecon) (0.56.4)
Requirement already satisfied: llvmlite&lt;0.40,&gt;=0.39.0dev0 in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from numba&gt;=0.49.0-&gt;quantecon) (0.39.1)
Requirement already satisfied: setuptools in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from numba&gt;=0.49.0-&gt;quantecon) (65.6.3)
Requirement already satisfied: urllib3&lt;1.27,&gt;=1.21.1 in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from requests-&gt;quantecon) (1.26.14)
Requirement already satisfied: certifi&gt;=2017.4.17 in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from requests-&gt;quantecon) (2022.12.7)
Requirement already satisfied: charset-normalizer&lt;3,&gt;=2 in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from requests-&gt;quantecon) (2.0.4)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages (from requests-&gt;quantecon) (3.4)
Requirement already satisfied: mpmath&gt;=0.19 in /usr/share/miniconda3/envs/quantecon/lib/python3.10/site-packages/mpmath-1.2.1-py3.10.egg (from sympy-&gt;quantecon) (1.2.1)
</pre></div>
</div>
</div>
</details>
</div>
<section id="overview">
<h2><a class="toc-backref" href="#id5" role="doc-backlink"><span class="section-number">40.1. </span>Overview</a><a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>This lecture formulates and computes a plan that a <strong>Stackelberg
leader</strong> uses to manipulate forward-looking decisions of a <strong>Stackelberg
follower</strong> that depend on continuation sequences of decisions made once
and for all by the Stackelberg leader at time <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>To facilitate computation and interpretation, we formulate things in a
context that allows us to apply dynamic programming for linear-quadratic models.</p>
<p>Technically, our calculations are closely related to ones described <a class="reference external" href="https://python.quantecon.org/lagrangian_lqdp.html">this lecture</a>.</p>
<p>From the beginning, we carry along a linear-quadratic model of duopoly in
which firms face adjustment costs that make them want to forecast
actions of other firms that influence future prices.</p>
<p>Let’s start with some standard imports:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">numpy.linalg</span> <span class="k">as</span> <span class="nn">la</span>
<span class="kn">import</span> <span class="nn">quantecon</span> <span class="k">as</span> <span class="nn">qe</span>
<span class="kn">from</span> <span class="nn">quantecon</span> <span class="kn">import</span> <span class="n">LQ</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
</pre></div>
</div>
</div>
</div>
</section>
<section id="duopoly">
<h2><a class="toc-backref" href="#id6" role="doc-backlink"><span class="section-number">40.2. </span>Duopoly</a><a class="headerlink" href="#duopoly" title="Permalink to this heading">#</a></h2>
<p>Time is discrete and is indexed by <span class="math notranslate nohighlight">\(t = 0, 1, \ldots\)</span>.</p>
<p>Two firms produce a single good whose demand is governed by the linear
inverse demand curve</p>
<div class="math notranslate nohighlight">
\[
p_t = a_0 - a_1 (q_{1t}+ q_{2t} )
\]</div>
<p>where <span class="math notranslate nohighlight">\(q_{it}\)</span> is output of firm <span class="math notranslate nohighlight">\(i\)</span> at time <span class="math notranslate nohighlight">\(t\)</span> and
<span class="math notranslate nohighlight">\(a_0\)</span> and <span class="math notranslate nohighlight">\(a_1\)</span> are both positive.</p>
<p><span class="math notranslate nohighlight">\(q_{10}, q_{20}\)</span> are given numbers that serve as initial
conditions at time <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>By incurring a cost equal to</p>
<div class="math notranslate nohighlight">
\[
\gamma v_{it}^2, \quad \gamma &gt; 0 ,
\]</div>
<p>firm <span class="math notranslate nohighlight">\(i\)</span> can change its output according
to</p>
<div class="math notranslate nohighlight">
\[
q_{it+1} = q_{it} + v_{it}
\]</div>
<p>Firm <span class="math notranslate nohighlight">\(i\)</span>’s profits at time <span class="math notranslate nohighlight">\(t\)</span> equal</p>
<div class="math notranslate nohighlight">
\[
\pi_{it} = p_t q_{it} - \gamma v_{it}^2
\]</div>
<p>Firm <span class="math notranslate nohighlight">\(i\)</span> wants to maximize the present value of its profits</p>
<div class="math notranslate nohighlight">
\[
\sum_{t=0}^\infty \beta^t \pi_{it}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\beta \in (0,1)\)</span> is a time discount factor.</p>
<section id="stackelberg-leader-and-follower">
<h3><span class="section-number">40.2.1. </span>Stackelberg Leader and Follower<a class="headerlink" href="#stackelberg-leader-and-follower" title="Permalink to this heading">#</a></h3>
<p>Each firm <span class="math notranslate nohighlight">\(i=1,2\)</span> chooses a sequence
<span class="math notranslate nohighlight">\(\vec q_i \equiv \{q_{it+1}\}_{t=0}^\infty\)</span> once and for all at
time <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>We let firm 2 be a <strong>Stackelberg leader</strong> and firm 1 be a <strong>Stackelberg
follower</strong>.</p>
<p>The leader firm 2 goes first and chooses
<span class="math notranslate nohighlight">\(\{q_{2t+1}\}_{t=0}^\infty\)</span> once and for all at time <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>Knowing that firm 2 has chosen <span class="math notranslate nohighlight">\(\{q_{2t+1}\}_{t=0}^\infty\)</span>, the
follower firm 1 goes second and chooses
<span class="math notranslate nohighlight">\(\{q_{1t+1}\}_{t=0}^\infty\)</span> once and for all at time <span class="math notranslate nohighlight">\(0\)</span>.</p>
<p>In choosing <span class="math notranslate nohighlight">\(\vec q_2\)</span>, firm 2 takes into account that firm 1 will
base its choice of <span class="math notranslate nohighlight">\(\vec q_1\)</span> on firm 2’s choice of
<span class="math notranslate nohighlight">\(\vec q_2\)</span>.</p>
</section>
<section id="statement-of-leaders-and-followers-problems">
<h3><span class="section-number">40.2.2. </span>Statement of  Leader’s and Follower’s Problems<a class="headerlink" href="#statement-of-leaders-and-followers-problems" title="Permalink to this heading">#</a></h3>
<p>We can express firm 1’s problem as</p>
<div class="math notranslate nohighlight">
\[
\max_{\vec q_1} \Pi_1(\vec q_1; \vec q_2)
\]</div>
<p>where the appearance behind the semi-colon indicates that
<span class="math notranslate nohighlight">\(\vec q_2\)</span> is given.</p>
<p>Firm 1’s problem induces the best response mapping</p>
<div class="math notranslate nohighlight">
\[
\vec q_1 = B(\vec q_2)
\]</div>
<p>(Here <span class="math notranslate nohighlight">\(B\)</span> maps a sequence into a sequence)</p>
<p>The Stackelberg leader’s problem is</p>
<div class="math notranslate nohighlight">
\[
\max_{\vec q_2} \Pi_2 (B(\vec q_2), \vec q_2)
\]</div>
<p>whose maximizer is a sequence <span class="math notranslate nohighlight">\(\vec q_2\)</span> that depends on the
initial conditions <span class="math notranslate nohighlight">\(q_{10}, q_{20}\)</span> and the parameters of the
model <span class="math notranslate nohighlight">\(a_0, a_1, \gamma\)</span>.</p>
<p>This formulation captures key features of the model</p>
<ul class="simple">
<li><p>Both firms make once-and-for-all choices at time <span class="math notranslate nohighlight">\(0\)</span>.</p></li>
<li><p>This is true even though both firms are choosing sequences of
quantities that are indexed by <strong>time</strong>.</p></li>
<li><p>The Stackelberg leader chooses first <strong>within time</strong> <span class="math notranslate nohighlight">\(0\)</span>,
knowing that the Stackelberg follower will choose second <strong>within
time</strong> <span class="math notranslate nohighlight">\(0\)</span>.</p></li>
</ul>
<p>While our abstract formulation reveals the timing protocol and
equilibrium concept well, it obscures details that must be addressed
when we want to compute and interpret a Stackelberg plan and the
follower’s best response to it.</p>
<p>To gain insights about these things, we study them in more detail.</p>
</section>
<section id="firms-problems">
<h3><span class="section-number">40.2.3. </span>Firms’ Problems<a class="headerlink" href="#firms-problems" title="Permalink to this heading">#</a></h3>
<p>Firm 1 acts as if firm 2’s sequence <span class="math notranslate nohighlight">\(\{q_{2t+1}\}_{t=0}^\infty\)</span> is
given and beyond its control.</p>
<p>Firm 2 knows that firm 1 chooses second and takes this into account in
choosing <span class="math notranslate nohighlight">\(\{q_{2t+1}\}_{t=0}^\infty\)</span>.</p>
<p>In the spirit of <em>working backward</em>, we study firm 1’s problem first,
taking <span class="math notranslate nohighlight">\(\{q_{2t+1}\}_{t=0}^\infty\)</span> as given.</p>
<p>We can formulate firm 1’s optimum problem in terms of the Lagrangian</p>
<div class="math notranslate nohighlight">
\[
L=\sum_{t=0}^{\infty}\beta^{t}\{a_{0}q_{1t}-a_{1}q_{1t}^{2}-a_{1}q_{1t}q_{2t}-\gamma v_{1t}^{2}+\lambda_{t}[q_{1t}+v_{1t}-q_{1t+1}]\}
\]</div>
<p>Firm 1 seeks a maximum with respect to
<span class="math notranslate nohighlight">\(\{q_{1t+1}, v_{1t} \}_{t=0}^\infty\)</span> and a minimum with respect to
<span class="math notranslate nohighlight">\(\{ \lambda_t\}_{t=0}^\infty\)</span>.</p>
<p>We approach this problem using methods described in <span id="id1">[<a class="reference internal" href="zreferences.html#id173" title="L Ljungqvist and T J Sargent. Recursive Macroeconomic Theory. MIT Press, 4 edition, 2018.">LS18</a>]</span>, chapter 2, appendix A and <span id="id2">[<a class="reference internal" href="zreferences.html#id197" title="Thomas J Sargent. Macroeconomic Theory. Academic Press, New York, 2nd edition, 1987.">Sar87</a>]</span>, chapter IX.</p>
<p>First-order conditions for this problem are</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned} \frac{\partial L}{\partial q_{1t}} &amp; = a_0 - 2 a_1 q_{1t} - a_1 q_{2t} + \lambda_t - \beta^{-1}
             \lambda_{t-1} = 0 , \quad t \geq 1 \cr
             \frac{\partial L}{\partial v_{1t}} &amp; = -2 \gamma v_{1t} +  \lambda_t = 0 , \quad t \geq 0  \cr \end{aligned}
\]</div>
<p>These first-order conditions and the constraint <span class="math notranslate nohighlight">\(q_{1t+1} = q_{1t} + v_{1t}\)</span> can be rearranged to take the form</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned} v_{1t} &amp; = \beta v_{1t+1} + \frac{\beta a_0}{2 \gamma} - \frac{\beta a_1}{\gamma} q_{1t+1} -
                      \frac{\beta a_1}{2 \gamma} q_{2t+1} \cr
            q_{t+1} &amp; = q_{1t} + v_{1t} \end{aligned}
\]</div>
<p>We can substitute the second equation into the first equation to obtain</p>
<div class="math notranslate nohighlight">
\[
(q_{1t+1} - q_{1t} ) = \beta (q_{1t+2} - q_{1t+1}) + c_0 - c_1 q_{1t+1} - c_2 q_{2t+1}
\]</div>
<p>where
<span class="math notranslate nohighlight">\(c_0 = \frac{\beta a_0}{2 \gamma}, c_1 = \frac{\beta a_1}{\gamma}, c_2 = \frac{\beta a_1}{2 \gamma}\)</span>.</p>
<p>This equation can in turn be rearranged to become</p>
<div class="math notranslate nohighlight" id="equation-sstack1">
<span class="eqno">(40.1)<a class="headerlink" href="#equation-sstack1" title="Permalink to this equation">#</a></span>\[- q_{1t} + (1+\beta + c_1) q_{1t+1} - \beta q_{1t+2} = c_0 - c_2 q_{2t+1}\]</div>
<p>Equation <a class="reference internal" href="#equation-sstack1">(40.1)</a> is a second-order difference equation in the sequence
<span class="math notranslate nohighlight">\(\vec q_1\)</span> whose solution we want.</p>
<p>It satisfies <strong>two boundary conditions:</strong></p>
<ul class="simple">
<li><p>an initial condition that <span class="math notranslate nohighlight">\(q_{1,0}\)</span>, which is given</p></li>
<li><p>a terminal condition requiring that
<span class="math notranslate nohighlight">\(\lim_{T \rightarrow + \infty} \beta^T q_{1t}^2 &lt; + \infty\)</span></p></li>
</ul>
<p>Using the lag operators described in <span id="id3">[<a class="reference internal" href="zreferences.html#id197" title="Thomas J Sargent. Macroeconomic Theory. Academic Press, New York, 2nd edition, 1987.">Sar87</a>]</span>, chapter IX, difference equation
<a class="reference internal" href="#equation-sstack1">(40.1)</a> can be written as</p>
<div class="math notranslate nohighlight">
\[
\beta(1 - \frac{1+\beta + c_1}{\beta} L + \beta^{-1} L^2 ) q_{1t+2} = - c_0 + c_2 q_{2t+1}
\]</div>
<p>The polynomial in the lag operator on the left side can be <strong>factored</strong>
as</p>
<div class="math notranslate nohighlight" id="equation-sstack2">
<span class="eqno">(40.2)<a class="headerlink" href="#equation-sstack2" title="Permalink to this equation">#</a></span>\[(1 - \frac{1+\beta + c_1}{\beta} L + \beta^{-1} L^2 )  = ( 1 - \delta_1 L ) (1 - \delta_2 L)\]</div>
<p>where <span class="math notranslate nohighlight">\(0 &lt; \delta_1 &lt; 1 &lt; \frac{1}{\sqrt{\beta}} &lt; \delta_2\)</span>.</p>
<p>Because <span class="math notranslate nohighlight">\(\delta_2 &gt; \frac{1}{\sqrt{\beta}}\)</span> the operator
<span class="math notranslate nohighlight">\((1 - \delta_2 L)\)</span> contributes an <strong>unstable</strong> component if solved
<strong>backwards</strong> but a <strong>stable</strong> component if solved <strong>forwards</strong>.</p>
<p>Mechanically, write</p>
<div class="math notranslate nohighlight">
\[
(1- \delta_2 L) = -\delta_{2} L (1 - \delta_2^{-1} L^{-1} )
\]</div>
<p>and compute the following inverse operator</p>
<div class="math notranslate nohighlight">
\[
\left[-\delta_{2} L (1 - \delta_2^{-1} L^{-1} )\right]^{-1} = - \delta_2 (1 - {\delta_2}^{-1} )^{-1} L^{-1}
\]</div>
<p>Operating on both sides of equation <a class="reference internal" href="#equation-sstack2">(40.2)</a> with
<span class="math notranslate nohighlight">\(\beta^{-1}\)</span> times this inverse operator gives the follower’s
decision rule for setting <span class="math notranslate nohighlight">\(q_{1t+1}\)</span> in the
<strong>feedback-feedforward</strong> form</p>
<div class="math notranslate nohighlight" id="equation-sstack3">
<span class="eqno">(40.3)<a class="headerlink" href="#equation-sstack3" title="Permalink to this equation">#</a></span>\[q_{1t+1} = \delta_1 q_{1t} - c_0 \delta_2^{-1} \beta^{-1}  \frac{1}{1 -\delta_2^{-1}}  + c_2 \delta_2^{-1} \beta^{-1} \sum_{j=0}^\infty \delta_2^j q_{2t+j+1} ,  \quad t \geq 0\]</div>
<p>The problem of the Stackelberg leader firm 2 is to choose the sequence
<span class="math notranslate nohighlight">\(\{q_{2t+1}\}_{t=0}^\infty\)</span> to maximize its discounted profits</p>
<div class="math notranslate nohighlight">
\[
\sum_{t=0}^\infty \beta^t \{ (a_0 -  a_1 (q_{1t} + q_{2t}) ) q_{2t} - \gamma (q_{2t+1} - q_{2t})^2 \}
\]</div>
<p>subject to the sequence of constraints <a class="reference internal" href="#equation-sstack3">(40.3)</a> for <span class="math notranslate nohighlight">\(t \geq 0\)</span>.</p>
<p>We can put a sequence <span class="math notranslate nohighlight">\(\{\theta_t\}_{t=0}^\infty\)</span> of Lagrange
multipliers on the sequence of equations <a class="reference internal" href="#equation-sstack3">(40.3)</a>
and formulate the following Lagrangian for the Stackelberg leader firm
2’s problem</p>
<div class="math notranslate nohighlight" id="equation-sstack4">
<span class="eqno">(40.4)<a class="headerlink" href="#equation-sstack4" title="Permalink to this equation">#</a></span>\[\begin{aligned} \tilde L &amp; = \sum_{t=0}^\infty  \beta^t\{ (a_0 -  a_1 (q_{1t} + q_{2t}) ) q_{2t} - \gamma (q_{2t+1} - q_{2t})^2 \} \cr
 &amp;  + \sum_{t=0}^\infty \beta^t \theta_t \{ \delta_1 q_{1t} -  c_0 \delta_2^{-1} \beta^{-1}  \frac{1}{1 -\delta_2^{-1}} +  c_2 \delta_2^{-1} \beta^{-1}
   \sum_{j=0}^\infty \delta_2^{-j} q_{2t+j+1} - q_{1t+1} \} \end{aligned}\]</div>
<p>subject to initial conditions for <span class="math notranslate nohighlight">\(q_{1t}, q_{2t}\)</span> at <span class="math notranslate nohighlight">\(t=0\)</span>.</p>
<p><strong>Remarks:</strong> We have formulated the Stackelberg problem in a space of
sequences.</p>
<p>The max-min problem associated with firm 2’s Lagrangian
<a class="reference internal" href="#equation-sstack4">(40.4)</a> is unpleasant because the time <span class="math notranslate nohighlight">\(t\)</span>
component of firm <span class="math notranslate nohighlight">\(2\)</span>’s payoff function depends on the entire
future of its choices of <span class="math notranslate nohighlight">\(\{q_{2t+j}\}_{j=0}^\infty\)</span>.</p>
<p>This renders a direct attack on the problem in the space of sequences cumbersome.</p>
<p>Therefore, below we will  formulate the Stackelberg leader’s problem
recursively.</p>
<p>We’ll proceed by putting  our  duopoly model into a broader class of models with
the same  general structure.</p>
</section>
</section>
<section id="stackelberg-problem">
<h2><a class="toc-backref" href="#id7" role="doc-backlink"><span class="section-number">40.3. </span>Stackelberg Problem</a><a class="headerlink" href="#stackelberg-problem" title="Permalink to this heading">#</a></h2>
<p>We formulate a class of linear-quadratic Stackelberg leader-follower
problems of which our duopoly model is an instance.</p>
<p>We use the optimal linear regulator (a.k.a. the linear-quadratic dynamic
programming problem described in <a class="reference external" href="https://python-intro.quantecon.org/lqcontrol.html">LQ Dynamic Programming
problems</a>) to
represent a Stackelberg leader’s problem recursively.</p>
<p>Let <span class="math notranslate nohighlight">\(z_t\)</span> be an <span class="math notranslate nohighlight">\(n_z \times 1\)</span> vector of <strong>natural
state variables</strong>.</p>
<p>Let <span class="math notranslate nohighlight">\(x_t\)</span> be an <span class="math notranslate nohighlight">\(n_x \times 1\)</span> vector of endogenous
forward-looking variables that are physically free to jump at <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>In our duopoly example <span class="math notranslate nohighlight">\(x_t = v_{1t}\)</span>, the time <span class="math notranslate nohighlight">\(t\)</span> decision
of the Stackelberg <strong>follower</strong>.</p>
<p>Let <span class="math notranslate nohighlight">\(u_t\)</span> be a vector of decisions chosen by the Stackelberg leader
at <span class="math notranslate nohighlight">\(t\)</span>.</p>
<p>The <span class="math notranslate nohighlight">\(z_t\)</span> vector is inherited  from the past.</p>
<p>But <span class="math notranslate nohighlight">\(x_t\)</span> is a decision made by the Stackelberg follower at time
<span class="math notranslate nohighlight">\(t\)</span> that is the follower’s best response to the choice of an
entire sequence of decisions made by the Stackelberg leader at time
<span class="math notranslate nohighlight">\(t=0\)</span>.</p>
<p>Let</p>
<div class="math notranslate nohighlight">
\[\begin{split}
y_t = \begin{bmatrix} z_t \\ x_t \end{bmatrix}
\end{split}\]</div>
<p>Represent the Stackelberg leader’s one-period loss function as</p>
<div class="math notranslate nohighlight">
\[
r(y, u)  =  y' R y  + u' Q u
\]</div>
<p>Subject to an initial condition for <span class="math notranslate nohighlight">\(z_0\)</span>, but not for <span class="math notranslate nohighlight">\(x_0\)</span>, the
Stackelberg leader wants to maximize</p>
<div class="math notranslate nohighlight" id="equation-maxeq">
<span class="eqno">(40.5)<a class="headerlink" href="#equation-maxeq" title="Permalink to this equation">#</a></span>\[-\sum_{t=0}^\infty \beta^t r(y_t, u_t)\]</div>
<p>The Stackelberg leader faces the model</p>
<div class="math notranslate nohighlight" id="equation-new2">
<span class="eqno">(40.6)<a class="headerlink" href="#equation-new2" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{bmatrix} I &amp; 0 \\ G_{21} &amp; G_{22} \end{bmatrix}
\begin{bmatrix}    z_{t+1} \\  x_{t+1} \end{bmatrix}
= \begin{bmatrix}  \hat A_{11}  &amp;  \hat A_{12} \\ \hat A_{21} &amp; \hat A_{22}  \end{bmatrix} \begin{bmatrix}  z_t \\ x_t \end{bmatrix} + \hat B u_t\end{split}\]</div>
<p>We assume that the matrix
<span class="math notranslate nohighlight">\(\begin{bmatrix} I &amp; 0 \\ G_{21} &amp; G_{22} \end{bmatrix}\)</span> on the
left side of equation <a class="reference internal" href="#equation-new2">(40.6)</a> is invertible, so that we
can multiply both sides by its inverse to obtain</p>
<div class="math notranslate nohighlight" id="equation-new3">
<span class="eqno">(40.7)<a class="headerlink" href="#equation-new3" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{bmatrix}    z_{t+1} \\  x_{t+1} \end{bmatrix}
= \begin{bmatrix}  A_{11}  &amp;   A_{12} \\ A_{21} &amp;  A_{22}  \end{bmatrix}
\begin{bmatrix}  z_t \\ x_t \end{bmatrix} +  B u_t\end{split}\]</div>
<p>or</p>
<div class="math notranslate nohighlight" id="equation-constrainteq">
<span class="eqno">(40.8)<a class="headerlink" href="#equation-constrainteq" title="Permalink to this equation">#</a></span>\[y_{t+1} = A y_t + B u_t\]</div>
<section id="interpretation-of-second-block-of-equations">
<h3><span class="section-number">40.3.1. </span>Interpretation of  Second Block of Equations<a class="headerlink" href="#interpretation-of-second-block-of-equations" title="Permalink to this heading">#</a></h3>
<p>The Stackelberg follower’s best response mapping is summarized by the
second block of equations of <a class="reference internal" href="#equation-new3">(40.7)</a>.</p>
<p>In particular, these equations are the first-order conditions of the
Stackelberg follower’s optimization problem (i.e., its Euler equations).</p>
<p>These Euler equations summarize the forward-looking aspect of the
follower’s behavior and express how its time <span class="math notranslate nohighlight">\(t\)</span> decision depends on
the leader’s actions at times <span class="math notranslate nohighlight">\(s \geq t\)</span>.</p>
<p>When combined with a stability condition to be imposed below, the Euler
equations summarize the follower’s best response to the sequence of
actions by the leader.</p>
<p>The Stackelberg leader maximizes <a class="reference internal" href="#equation-maxeq">(40.5)</a> by
choosing sequences <span class="math notranslate nohighlight">\(\{u_t, x_t, z_{t+1}\}_{t=0}^{\infty}\)</span>
subject to <a class="reference internal" href="#equation-constrainteq">(40.8)</a> and an initial condition for <span class="math notranslate nohighlight">\(z_0\)</span>.</p>
<p>Note that we have an initial condition for <span class="math notranslate nohighlight">\(z_0\)</span> but not for <span class="math notranslate nohighlight">\(x_0\)</span>.</p>
<p><span class="math notranslate nohighlight">\(x_0\)</span> is among the variables to be chosen at time <span class="math notranslate nohighlight">\(0\)</span> by the
Stackelberg leader.</p>
<p>The Stackelberg leader uses its understanding of the responses
restricted by <a class="reference internal" href="#equation-constrainteq">(40.8)</a> to manipulate the follower’s
decisions.</p>
</section>
<section id="more-mechanical-details">
<h3><span class="section-number">40.3.2. </span>More Mechanical Details<a class="headerlink" href="#more-mechanical-details" title="Permalink to this heading">#</a></h3>
<p>For any vector <span class="math notranslate nohighlight">\(a_t\)</span>, define <span class="math notranslate nohighlight">\(\vec a_t = [a_t,
a_{t+1} \ldots ]\)</span>.</p>
<p>Define a feasible set of <span class="math notranslate nohighlight">\((\vec y_1, \vec u_0)\)</span> sequences</p>
<div class="math notranslate nohighlight">
\[
\Omega(y_0) = \left\{ (\vec y_1, \vec u_0) :  y_{t+1} = A y_t + B u_t, \forall t \geq 0 \right\}
\]</div>
<p>Please remember that the follower’s system of  Euler equations is embedded in the
system of dynamic equations <span class="math notranslate nohighlight">\(y_{t+1} = A y_t + B u_t\)</span>.</p>
<p>Note that  the definition of <span class="math notranslate nohighlight">\(\Omega(y_0)\)</span> treats  <span class="math notranslate nohighlight">\(y_0\)</span>
as given.</p>
<p>Although it is taken as given in <span class="math notranslate nohighlight">\(\Omega(y_0)\)</span>,
eventually, the <span class="math notranslate nohighlight">\(x_0\)</span> component of <span class="math notranslate nohighlight">\(y_0\)</span> is to  be chosen by the
Stackelberg leader.</p>
</section>
<section id="two-subproblems">
<h3><span class="section-number">40.3.3. </span>Two Subproblems<a class="headerlink" href="#two-subproblems" title="Permalink to this heading">#</a></h3>
<p>Once again we use backward induction.</p>
<p>We express the Stackelberg problem in terms of <strong>two subproblems</strong>.</p>
<p>Subproblem 1 is solved by a <strong>continuation Stackelberg leader</strong> at each
date <span class="math notranslate nohighlight">\(t \geq 0\)</span>.</p>
<p>Subproblem 2 is solved by the <strong>Stackelberg leader</strong> at <span class="math notranslate nohighlight">\(t=0\)</span>.</p>
<p>The two subproblems are designed</p>
<ul class="simple">
<li><p>to respect the timing protocol in which the follower chooses
<span class="math notranslate nohighlight">\(\vec q_1\)</span> after seeing <span class="math notranslate nohighlight">\(\vec q_2\)</span> chosen by the leader</p></li>
<li><p>to make the leader choose <span class="math notranslate nohighlight">\(\vec q_2\)</span> while respecting that
<span class="math notranslate nohighlight">\(\vec q_1\)</span> will be the follower’s best response to
<span class="math notranslate nohighlight">\(\vec q_2\)</span></p></li>
<li><p>to represent the leader’s problem recursively by artfully choosing
the leader’s state variables and the control variables available
to the leader</p></li>
</ul>
<p><strong>Subproblem 1</strong></p>
<div class="math notranslate nohighlight">
\[
v(y_0) = \max_{(\vec y_1, \vec u_0) \in \Omega(y_0)} - \sum_{t=0}^\infty \beta^t r(y_t, u_t)
\]</div>
<p><strong>Subproblem 2</strong></p>
<div class="math notranslate nohighlight">
\[
w(z_0) = \max_{x_0} v(y_0)
\]</div>
<p>Subproblem 1 takes the vector of forward-looking variables <span class="math notranslate nohighlight">\(x_0\)</span> as
given.</p>
<p>Subproblem 2 optimizes over <span class="math notranslate nohighlight">\(x_0\)</span>.</p>
<p>The value function <span class="math notranslate nohighlight">\(w(z_0)\)</span> tells the value of the Stackelberg plan
as a function of the vector of natural state variables <span class="math notranslate nohighlight">\(z_0\)</span> at time <span class="math notranslate nohighlight">\(0\)</span>.</p>
</section>
</section>
<section id="two-bellman-equations">
<h2><a class="toc-backref" href="#id8" role="doc-backlink"><span class="section-number">40.4. </span>Two Bellman Equations</a><a class="headerlink" href="#two-bellman-equations" title="Permalink to this heading">#</a></h2>
<p>We now describe Bellman equations for <span class="math notranslate nohighlight">\(v(y)\)</span> and <span class="math notranslate nohighlight">\(w(z_0)\)</span>.</p>
<p><strong>Subproblem 1</strong></p>
<p>The value function <span class="math notranslate nohighlight">\(v(y)\)</span> in subproblem 1 satisfies the Bellman
equation</p>
<div class="math notranslate nohighlight" id="equation-bellman-stack">
<span class="eqno">(40.9)<a class="headerlink" href="#equation-bellman-stack" title="Permalink to this equation">#</a></span>\[v(y) = \max_{u, y^*}  \left\{ - r(y,u) + \beta v(y^*) \right\}\]</div>
<p>where the maximization is subject to</p>
<div class="math notranslate nohighlight">
\[
y^* = A y + B u
\]</div>
<p>and <span class="math notranslate nohighlight">\(y^*\)</span> denotes next period’s value.</p>
<p>Substituting <span class="math notranslate nohighlight">\(v(y) = - y'P y\)</span> into Bellman equation <a class="reference internal" href="#equation-bellman-stack">(40.9)</a> gives</p>
<div class="math notranslate nohighlight">
\[
-y' P y = {\rm max}_{  u, y^*} \left\{ -  y' R y -   u'Q     u - \beta y^{* \prime} P y^* \right\}
\]</div>
<p>which as in lecture <a class="reference external" href="https://python-intro.quantecon.org/lqcontrol.html">linear regulator</a> gives
rise to the algebraic matrix Riccati equation</p>
<div class="math notranslate nohighlight">
\[
P = R + \beta A' P A - \beta^2 A' P   B (  Q  + \beta   B' P   B)^{-1}   B' P A
\]</div>
<p>and the optimal decision rule coefficient vector</p>
<div class="math notranslate nohighlight">
\[
F = \beta(   Q + \beta   B' P   B)^{-1}  B' P A
\]</div>
<p>where the optimal decision rule is</p>
<div class="math notranslate nohighlight">
\[
u_t = - F y_t
\]</div>
<p><strong>Subproblem 2</strong></p>
<p>We find an optimal <span class="math notranslate nohighlight">\(x_0\)</span> by equating to zero the gradient of <span class="math notranslate nohighlight">\(v(y_0)\)</span>
with respect to <span class="math notranslate nohighlight">\(x_0\)</span>:</p>
<div class="math notranslate nohighlight">
\[
-2 P_{21} z_0 - 2 P_{22} x_0 =0,
\]</div>
<p>which implies that</p>
<div class="math notranslate nohighlight" id="equation-eq-subprob2x0">
<span class="eqno">(40.10)<a class="headerlink" href="#equation-eq-subprob2x0" title="Permalink to this equation">#</a></span>\[
x_0 = - P_{22}^{-1} P_{21} z_0
\]</div>
</section>
<section id="stackelberg-plan-for-duopoly">
<h2><a class="toc-backref" href="#id9" role="doc-backlink"><span class="section-number">40.5. </span>Stackelberg Plan for Duopoly</a><a class="headerlink" href="#stackelberg-plan-for-duopoly" title="Permalink to this heading">#</a></h2>
<p>Now let’s map our duopoly model into the above setup.</p>
<p>We  formulate a state vector</p>
<div class="math notranslate nohighlight">
\[
y_t = \begin{bmatrix} z_t \cr x_t \end{bmatrix}
\]</div>
<p>where for our duopoly model</p>
<div class="math notranslate nohighlight">
\[
z_t = \begin{bmatrix} 1 \cr q_{2t} \cr q_{1t} \end{bmatrix} , \quad x_t = v_{1t},
\]</div>
<p>where  <span class="math notranslate nohighlight">\(x_t = v_{1t}\)</span> is  the time <span class="math notranslate nohighlight">\(t\)</span> decision
of the follower firm 1, <span class="math notranslate nohighlight">\(u_t\)</span> is the time <span class="math notranslate nohighlight">\(t\)</span> decision of the leader firm 2 and</p>
<div class="math notranslate nohighlight">
\[
v_{1t} = q_{1t+1} - q_{1t}, \quad u_t = q_{2t+1} - q_{2t} .
\]</div>
<p>For our duopoly model, initial conditions for the natural state variables in <span class="math notranslate nohighlight">\(z_t\)</span> are</p>
<div class="math notranslate nohighlight">
\[
z_0 =  \begin{bmatrix} 1 \cr q_{20} \cr q_{10} \end{bmatrix}
\]</div>
<p>while <span class="math notranslate nohighlight">\(x_0 = v_{10} = q_{11} - q_{10}\)</span>  is a choice variable for the Stackelberg leader firm 2, one that will ultimately be chosen according an optimal rule prescribed by  <a class="reference internal" href="#equation-eq-subprob2x0">(40.10)</a>
for subproblem 2 above.</p>
<p>That the Stackelberg leader firm 2 chooses <span class="math notranslate nohighlight">\(x_0 = v_{10}\)</span> is subtle.</p>
<p>Of course,  <span class="math notranslate nohighlight">\(x_0 = v_{10}\)</span> emerges from the feedback-feedforward solution <a class="reference internal" href="#equation-sstack3">(40.3)</a> of firm 1’s system of Euler equations, so that it is actually
firm 1 that sets <span class="math notranslate nohighlight">\(x_0\)</span>.</p>
<p>But firm 2 manipulates firm 1’s  choice through firm 2’s choice of the sequence <span class="math notranslate nohighlight">\(\vec q_{2,1} = \{q_{2t+1}\}_{t=0}^\infty\)</span>.</p>
<section id="calculations-to-prepare-duopoly-model">
<h3><span class="section-number">40.5.1. </span>Calculations to Prepare Duopoly Model<a class="headerlink" href="#calculations-to-prepare-duopoly-model" title="Permalink to this heading">#</a></h3>
<p>Now we’ll proceed to cast our duopoly model within the framework of the
more general linear-quadratic structure described above.</p>
<p>That will allow us to compute a Stackelberg plan simply by enlisting a
Riccati equation to solve a linear-quadratic dynamic program.</p>
<p>As emphasized above, firm 1 acts as if firm 2’s decisions
<span class="math notranslate nohighlight">\(\{q_{2t+1}, v_{2t}\}_{t=0}^\infty\)</span> are given and beyond its
control.</p>
</section>
<section id="firm-1s-problem">
<h3><span class="section-number">40.5.2. </span>Firm 1’s Problem<a class="headerlink" href="#firm-1s-problem" title="Permalink to this heading">#</a></h3>
<p>We again formulate firm 1’s optimum problem in terms of the Lagrangian</p>
<div class="math notranslate nohighlight">
\[
L=\sum_{t=0}^{\infty}\beta^{t}\{a_{0}q_{1t}-a_{1}q_{1t}^{2}-a_{1}q_{1t}q_{2t}-\gamma v_{1t}^{2}+\lambda_{t}[q_{1t}+v_{1t}-q_{1t+1}]\}
\]</div>
<p>Firm 1 seeks a maximum with respect to
<span class="math notranslate nohighlight">\(\{q_{1t+1}, v_{1t} \}_{t=0}^\infty\)</span> and a minimum with respect to
<span class="math notranslate nohighlight">\(\{ \lambda_t\}_{t=0}^\infty\)</span>.</p>
<p>First-order conditions for this problem are</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned} \frac{\partial L}{\partial q_{1t}} &amp; = a_0 - 2 a_1 q_{1t} - a_1 q_{2t} + \lambda_t - \beta^{-1}
             \lambda_{t-1} = 0 , \quad t \geq 1 \cr
             \frac{\partial L}{\partial v_{1t}} &amp; = -2 \gamma v_{1t} +  \lambda_t = 0 , \quad t \geq 0  \cr \end{aligned}
\]</div>
<p>These first-order order conditions and the constraint <span class="math notranslate nohighlight">\(q_{1t+1} =
q_{1t} + v_{1t}\)</span> can be rearranged to take the form</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned} v_{1t} &amp; = \beta v_{1t+1} + \frac{\beta a_0}{2 \gamma} - \frac{\beta a_1}{\gamma} q_{1t+1} -
                      \frac{\beta a_1}{2 \gamma} q_{2t+1} \cr
            q_{t+1} &amp; = q_{1t} + v_{1t} \end{aligned}
\]</div>
<p>We use these two equations as components of the following linear system
that confronts a Stackelberg continuation leader at time <span class="math notranslate nohighlight">\(t\)</span></p>
<div class="math notranslate nohighlight">
\[
\begin{bmatrix}       1 &amp; 0 &amp; 0 &amp; 0 \cr
                       0 &amp; 1 &amp; 0 &amp; 0 \cr
                       0 &amp; 0 &amp; 1 &amp; 0 \cr
       \frac{\beta a_0}{2 \gamma} &amp; - \frac{\beta a_1}{2 \gamma} &amp; -\frac{\beta a_1}{\gamma} &amp; \beta \end{bmatrix}
       \begin{bmatrix} 1 \cr q_{2t+1} \cr q_{1t+1} \cr v_{1t+1} \end{bmatrix}
       = \begin{bmatrix} 1 &amp; 0 &amp; 0 &amp; 0 \cr
                         0 &amp; 1 &amp; 0 &amp; 0 \cr
                          0 &amp; 0 &amp; 1 &amp; 1 \cr
                          0 &amp; 0 &amp; 0 &amp; 1 \end{bmatrix} \begin{bmatrix} 1 \cr q_{2t} \cr q_{1t} \cr v_{1t} \end{bmatrix}
       + \begin{bmatrix} 0 \cr 1 \cr 0 \cr 0 \end{bmatrix} v_{2t}
\]</div>
<p>Time <span class="math notranslate nohighlight">\(t\)</span> revenues of firm 2 are
<span class="math notranslate nohighlight">\(\pi_{2t} = a_0 q_{2t} - a_1 q_{2t}^2 - a_1 q_{1t} q_{2t}\)</span> which
evidently equal</p>
<div class="math notranslate nohighlight">
\[
z_t' R_1 z_t \equiv \begin{bmatrix} 1 \cr q_{2t} \cr q_{1t}  \end{bmatrix}'
   \begin{bmatrix} 0 &amp; \frac{a_0}{2}&amp; 0 \cr
                   \frac{a_0}{2} &amp; -a_1 &amp; -\frac{a_1}{2}\cr
                   0 &amp; -\frac{a_1}{2} &amp; 0 \end{bmatrix}
\begin{bmatrix} 1 \cr q_{2t} \cr q_{1t}  \end{bmatrix}
\]</div>
<p>If we set <span class="math notranslate nohighlight">\(Q = \gamma\)</span>, then firm 2’s period <span class="math notranslate nohighlight">\(t\)</span> profits can
then be written</p>
<div class="math notranslate nohighlight">
\[
y_t' R y_t - Q v_{2t}^2
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
y_t = \begin{bmatrix} z_t \cr x_t \end{bmatrix}
\]</div>
<p>with <span class="math notranslate nohighlight">\(x_t = v_{1t}\)</span> and</p>
<div class="math notranslate nohighlight">
\[
R =
\begin{bmatrix} R_1 &amp; 0 \cr 0 &amp; 0 \end{bmatrix}
\]</div>
<p>We’ll report results of implementing this code soon.</p>
<p>But first, we want to represent the Stackelberg leader’s optimal choices
recursively.</p>
<p>It is important to do this for several reasons:</p>
<ul class="simple">
<li><p>properly to interpret a representation of the Stackelberg leader’s
choice as a sequence of history-dependent functions</p></li>
<li><p>to formulate a recursive version of the follower’s choice problem</p></li>
</ul>
<p>First, let’s get a recursive representation of the Stackelberg leader’s
choice of <span class="math notranslate nohighlight">\(\vec q_2\)</span> for our duopoly model.</p>
</section>
</section>
<section id="recursive-representation-of-stackelberg-plan">
<h2><a class="toc-backref" href="#id10" role="doc-backlink"><span class="section-number">40.6. </span>Recursive Representation of Stackelberg Plan</a><a class="headerlink" href="#recursive-representation-of-stackelberg-plan" title="Permalink to this heading">#</a></h2>
<p>In order to attain an appropriate representation of the Stackelberg
leader’s history-dependent plan, we will employ what amounts to a
version of the <strong>Big K, little k</strong> device often used in
macroeconomics by distinguishing <span class="math notranslate nohighlight">\(z_t\)</span>, which depends partly on
decisions <span class="math notranslate nohighlight">\(x_t\)</span> of the followers, from another vector
<span class="math notranslate nohighlight">\(\check z_t\)</span>, which does not.</p>
<p>We will use <span class="math notranslate nohighlight">\(\check z_t\)</span> and its history <span class="math notranslate nohighlight">\(\check z^t
= [\check z_t, \check z_{t-1}, \ldots, \check z_0]\)</span> to describe the
sequence of the Stackelberg leader’s decisions that the Stackelberg
follower takes as given.</p>
<p>Thus, we let
<span class="math notranslate nohighlight">\(\check y_t' = \begin{bmatrix}\check z_t' &amp; \check x_t'\end{bmatrix}\)</span>
with initial condition <span class="math notranslate nohighlight">\(\check z_0 = z_0\)</span> given.</p>
<p>That we distinguish <span class="math notranslate nohighlight">\(\check z_t\)</span> from <span class="math notranslate nohighlight">\(z_t\)</span> is part and
parcel of the <strong>Big K, little k</strong> device in this
instance.</p>
<p>We have demonstrated that a Stackelberg plan for
<span class="math notranslate nohighlight">\(\{u_t\}_{t=0}^\infty\)</span> has a recursive representation</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned} \check x_0 &amp; = - P_{22}^{-1} P_{21} z_0 \cr
            u_t &amp; = - F \check y_t, \quad t \geq 0 \cr
            \check y_{t+1} &amp; = (A - BF) \check y_t, \quad t \geq 0 \end{aligned}
\]</div>
<p>From this representation, we can deduce the sequence of functions
<span class="math notranslate nohighlight">\(\sigma = \{\sigma_t(\check z^t)\}_{t=0}^\infty\)</span> that comprise a
Stackelberg plan.</p>
<p>For convenience, let <span class="math notranslate nohighlight">\(\check A \equiv A - BF\)</span> and partition
<span class="math notranslate nohighlight">\(\check A\)</span> conformably to the partition
<span class="math notranslate nohighlight">\(y_t = \begin{bmatrix}\check z_t \cr \check x_t \end{bmatrix}\)</span> as</p>
<div class="math notranslate nohighlight">
\[
\begin{bmatrix}\check A_{11} &amp; \check A_{12} \cr \check A_{21} &amp; \check A_{22} \end{bmatrix}
\]</div>
<p>Let <span class="math notranslate nohighlight">\(H^0_0 \equiv - P_{22}^{-1} P_{21}\)</span> so that
<span class="math notranslate nohighlight">\(\check x_0 = H^0_0 \check z_0\)</span>.</p>
<p>Then iterations on <span class="math notranslate nohighlight">\(\check y_{t+1} = \check A \check y_t\)</span> starting from initial
condition <span class="math notranslate nohighlight">\(\check y_0 = \begin{bmatrix}\check z_0 \cr H^0_0 \check z_0\end{bmatrix}\)</span>
imply that for <span class="math notranslate nohighlight">\(t \geq 1\)</span></p>
<div class="math notranslate nohighlight">
\[
\check x_t = \sum_{j=1}^t H_j^t \check z_{t-j}
\]</div>
<p>where</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned} H^t_1 &amp; = \check A_{21} \cr
            H^t_2 &amp; = \check A_{22} \check A_{21} \cr
           \ \   \vdots \  \  &amp;  \  \ \quad \vdots \cr
           H^t_{t-1} &amp; = \check A_{22}^{t-2} \check A_{21} \cr
            H^t_t &amp; = \check A_{22}^{t-1}(\check A_{21} + \check A_{22} H^0_0 ) \end{aligned}
\]</div>
<p>An optimal decision rule for the Stackelberg leader’s choice of <span class="math notranslate nohighlight">\(u_t\)</span> is</p>
<div class="math notranslate nohighlight">
\[
u_t  = - F \check y_t \equiv - \begin{bmatrix} F_z &amp; F_x \cr \end{bmatrix}
\begin{bmatrix}\check z_t \cr x_t \cr \end{bmatrix}
\]</div>
<p>or</p>
<div class="math notranslate nohighlight" id="equation-finalrule">
<span class="eqno">(40.11)<a class="headerlink" href="#equation-finalrule" title="Permalink to this equation">#</a></span>\[u_t  = - F_z \check z_t - F_x \sum_{j=1}^t H^t_j z_{t-j} = \sigma_t(\check z^t)\]</div>
<p>Representation <a class="reference internal" href="#equation-finalrule">(40.11)</a> confirms that whenever
<span class="math notranslate nohighlight">\(F_x \neq 0\)</span>, the typical situation, the time <span class="math notranslate nohighlight">\(t\)</span> component
<span class="math notranslate nohighlight">\(\sigma_t\)</span> of a Stackelberg plan is <strong>history-dependent</strong>, meaning
that the Stackelberg leader’s choice <span class="math notranslate nohighlight">\(u_t\)</span> depends not just on
<span class="math notranslate nohighlight">\(\check z_t\)</span> but on components of <span class="math notranslate nohighlight">\(\check z^{t-1}\)</span>.</p>
<section id="comments-and-interpretations">
<h3><span class="section-number">40.6.1. </span>Comments and Interpretations<a class="headerlink" href="#comments-and-interpretations" title="Permalink to this heading">#</a></h3>
<p>Because we set <span class="math notranslate nohighlight">\(\check z_0 = z_0\)</span>, it will turn out that <span class="math notranslate nohighlight">\(z_t = \check z_t\)</span>
for all <span class="math notranslate nohighlight">\(t \geq 0\)</span>.</p>
<p>Then why did we distinguish <span class="math notranslate nohighlight">\(\check z_t\)</span> from <span class="math notranslate nohighlight">\(z_t\)</span>?</p>
<p>The answer is that if we want to present to the Stackelberg <strong>follower</strong>
a history-dependent representation of the Stackelberg <strong>leader’s</strong>
sequence <span class="math notranslate nohighlight">\(\vec q_2\)</span>, we must use representation
<a class="reference internal" href="#equation-finalrule">(40.11)</a> cast in terms of the history
<span class="math notranslate nohighlight">\(\check z^t\)</span> and <strong>not</strong> a corresponding representation cast in
terms of <span class="math notranslate nohighlight">\(z^t\)</span>.</p>
</section>
</section>
<section id="dynamic-programming-and-time-consistency-of-followers-problem">
<h2><a class="toc-backref" href="#id11" role="doc-backlink"><span class="section-number">40.7. </span>Dynamic Programming and Time Consistency of Follower’s Problem</a><a class="headerlink" href="#dynamic-programming-and-time-consistency-of-followers-problem" title="Permalink to this heading">#</a></h2>
<p>Given the sequence <span class="math notranslate nohighlight">\(\vec q_2\)</span> chosen by the Stackelberg leader in
our duopoly model, it turns out that the Stackelberg <strong>follower’s</strong>
problem is recursive in the <em>natural</em> state variables that confront a
follower at any time <span class="math notranslate nohighlight">\(t \geq 0\)</span>.</p>
<p>This means that the follower’s plan is time consistent.</p>
<p>To verify these claims, we’ll formulate a recursive version of a
follower’s problem that builds on our recursive representation of the
Stackelberg leader’s plan and our use of the <strong>Big K, little k</strong> idea.</p>
<section id="recursive-formulation-of-a-followers-problem">
<h3><span class="section-number">40.7.1. </span>Recursive Formulation of a Follower’s Problem<a class="headerlink" href="#recursive-formulation-of-a-followers-problem" title="Permalink to this heading">#</a></h3>
<p>We now use what amounts to another “Big <span class="math notranslate nohighlight">\(K\)</span>, little <span class="math notranslate nohighlight">\(k\)</span>” trick (see
<a class="reference external" href="https://python-intro.quantecon.org/rational_expectations.html">rational expectations equilibrium</a>)
to formulate a recursive version of a follower’s problem cast in terms
of an ordinary Bellman equation.</p>
<p>Firm 1, the follower, faces <span class="math notranslate nohighlight">\(\{q_{2t}\}_{t=0}^\infty\)</span> as
a given quantity sequence chosen by the leader and believes that its
output price at <span class="math notranslate nohighlight">\(t\)</span> satisfies</p>
<div class="math notranslate nohighlight">
\[
p_t  = a_0 - a_1 ( q_{1t} + q_{2t})  , \quad t \geq 0
\]</div>
<p>Our challenge is to represent <span class="math notranslate nohighlight">\(\{q_{2t}\}_{t=0}^\infty\)</span> as
a given sequence.</p>
<p>To do so, recall that under the Stackelberg plan, firm 2 sets output
according to the <span class="math notranslate nohighlight">\(q_{2t}\)</span> component of</p>
<div class="math notranslate nohighlight">
\[
y_{t+1} = \begin{bmatrix}  1 \cr q_{2t} \cr q_{1t} \cr x_t \end{bmatrix}
\]</div>
<p>which is governed by</p>
<div class="math notranslate nohighlight">
\[
y_{t+1} = (A - BF) y_t
\]</div>
<p>To obtain a recursive representation of a <span class="math notranslate nohighlight">\(\{q_{2t}\}\)</span> sequence
that is exogenous to firm 1, we define a state <span class="math notranslate nohighlight">\(\tilde y_t\)</span></p>
<div class="math notranslate nohighlight">
\[
\tilde y_t = \begin{bmatrix}  1 \cr q_{2t} \cr \tilde q_{1t} \cr \tilde x_t \end{bmatrix}
\]</div>
<p>that evolves according to</p>
<div class="math notranslate nohighlight">
\[
\tilde y_{t+1} = (A - BF) \tilde y_t
\]</div>
<p>subject to the initial condition <span class="math notranslate nohighlight">\(\tilde q_{10} = q_{10}\)</span> and
<span class="math notranslate nohighlight">\(\tilde x_0 = x_0\)</span> where <span class="math notranslate nohighlight">\(x_0 = - P_{22}^{-1} P_{21}\)</span> as
stated above.</p>
<p>Firm 1’s state vector is</p>
<div class="math notranslate nohighlight">
\[
X_t = \begin{bmatrix} \tilde y_t \cr q_{1t}  \end{bmatrix}
\]</div>
<p>It follows that the follower firm 1 faces law of motion</p>
<div class="math notranslate nohighlight" id="equation-law-motion">
<span class="eqno">(40.12)<a class="headerlink" href="#equation-law-motion" title="Permalink to this equation">#</a></span>\[\begin{split}\begin{bmatrix} \tilde y_{t+1} \\
q_{1t+1} \end{bmatrix} = \begin{bmatrix} A - BF &amp; 0 \\
0  &amp; 1 \end{bmatrix}  \begin{bmatrix} \tilde y_{t} \\
q_{1t} \end{bmatrix} + \begin{bmatrix} 0 \cr 1 \end{bmatrix} x_t\end{split}\]</div>
<p>This specification assures that from the point of the view of  firm 1,
<span class="math notranslate nohighlight">\(q_{2t}\)</span> is an exogenous process.</p>
<p>Here</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\tilde q_{1t}, \tilde x_t\)</span> play the role of <strong>Big K</strong></p></li>
<li><p><span class="math notranslate nohighlight">\(q_{1t}, x_t\)</span> play the role of <strong>little k</strong></p></li>
</ul>
<p>The time <span class="math notranslate nohighlight">\(t\)</span> component of firm 1’s objective is</p>
<div class="math notranslate nohighlight">
\[
\tilde X_t' \tilde R x_t - x_t^2 \tilde Q = \begin{bmatrix} 1 \cr q_{2t} \cr \tilde q_{1t} \cr \tilde x_t \cr q_{1t} \end{bmatrix}'
 \begin{bmatrix} 0 &amp; 0 &amp; 0 &amp; 0 &amp; \frac{a_0}{2} \cr
                 0 &amp; 0 &amp; 0 &amp; 0 &amp; - \frac{a_1}{2} \cr
                 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \cr
                 0 &amp; 0 &amp; 0 &amp; 0 &amp; 0 \cr
                 \frac{a_0}{2} &amp;  -\frac{a_1}{2} &amp; 0 &amp; 0 &amp; - a_1 \end{bmatrix}
 \begin{bmatrix} 1 \cr q_{2t} \cr \tilde q_{1t} \cr \tilde x_t \cr q_{1t} \end{bmatrix} - \gamma
    x_t^2
\]</div>
<p>Firm 1’s optimal decision rule is</p>
<div class="math notranslate nohighlight">
\[
x_t = - \tilde F X_t
\]</div>
<p>and its state evolves according to</p>
<div class="math notranslate nohighlight">
\[
\tilde X_{t+1} = (\tilde A - \tilde B \tilde F) X_t
\]</div>
<p>under its optimal decision rule.</p>
<p>Later we shall compute <span class="math notranslate nohighlight">\(\tilde F\)</span> and verify that when we set</p>
<div class="math notranslate nohighlight">
\[
X_0 = \begin{bmatrix} 1 \cr q_{20} \cr  q_{10} \cr  x_0 \cr q_{10} \end{bmatrix}
\]</div>
<p>we recover</p>
<div class="math notranslate nohighlight">
\[
x_0 = - \tilde F \tilde X_0 ,
\]</div>
<p>which will verify that we have properly set up a recursive
representation of the follower’s problem facing the Stackelberg leader’s
<span class="math notranslate nohighlight">\(\vec q_2\)</span>.</p>
</section>
<section id="time-consistency-of-followers-plan">
<h3><span class="section-number">40.7.2. </span>Time Consistency of Follower’s Plan<a class="headerlink" href="#time-consistency-of-followers-plan" title="Permalink to this heading">#</a></h3>
<p>The follower can solve its problem using dynamic programming  because its
problem is recursive in what for it are the  <strong>natural state variables</strong>,
namely</p>
<div class="math notranslate nohighlight">
\[
\begin{bmatrix} 1 \cr q_{2t} \cr \tilde q_{1t} \cr \tilde x_t   \end{bmatrix}
\]</div>
<p>It follows that the follower’s plan is time consistent.</p>
</section>
</section>
<section id="computing-stackelberg-plan">
<h2><a class="toc-backref" href="#id12" role="doc-backlink"><span class="section-number">40.8. </span>Computing  Stackelberg Plan</a><a class="headerlink" href="#computing-stackelberg-plan" title="Permalink to this heading">#</a></h2>
<p>Here is our code to compute a Stackelberg plan via the linear-quadratic
dynamic program describe above.</p>
<p>Let’s use it to compute the Stackelberg plan.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Parameters</span>
<span class="n">a0</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">a1</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">β</span> <span class="o">=</span> <span class="mf">0.96</span>
<span class="n">γ</span> <span class="o">=</span> <span class="mi">120</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">300</span>
<span class="n">tol0</span> <span class="o">=</span> <span class="mf">1e-8</span>
<span class="n">tol1</span> <span class="o">=</span> <span class="mf">1e-16</span>
<span class="n">tol2</span> <span class="o">=</span> <span class="mf">1e-2</span>

<span class="n">βs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">βs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">=</span> <span class="n">β</span>
<span class="n">βs</span> <span class="o">=</span> <span class="n">βs</span><span class="o">.</span><span class="n">cumprod</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In LQ form</span>
<span class="n">Alhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

<span class="c1"># Euler equation coefficients</span>
<span class="n">Alhs</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">β</span> <span class="o">*</span> <span class="n">a0</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">γ</span><span class="p">),</span> <span class="o">-</span><span class="n">β</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">γ</span><span class="p">),</span> <span class="o">-</span><span class="n">β</span> <span class="o">*</span> <span class="n">a1</span> <span class="o">/</span> <span class="n">γ</span><span class="p">,</span> <span class="n">β</span>

<span class="n">Arhs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
<span class="n">Arhs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">Alhsinv</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Alhs</span><span class="p">)</span>

<span class="n">A</span> <span class="o">=</span> <span class="n">Alhsinv</span> <span class="o">@</span> <span class="n">Arhs</span>

<span class="n">B</span> <span class="o">=</span> <span class="n">Alhsinv</span> <span class="o">@</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>

<span class="n">R</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span>      <span class="o">-</span><span class="n">a0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
              <span class="p">[</span><span class="o">-</span><span class="n">a0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>     <span class="n">a1</span><span class="p">,</span> <span class="n">a1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">0</span><span class="p">,</span>       <span class="n">a1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
              <span class="p">[</span><span class="mi">0</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>

<span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">γ</span><span class="p">]])</span>

<span class="c1"># Solve using QE&#39;s LQ class</span>
<span class="c1"># LQ solves minimization problems which is why the sign of R and Q was changed</span>
<span class="n">lq</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">,</span> <span class="n">A</span><span class="p">,</span> <span class="n">B</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">)</span>
<span class="n">P</span><span class="p">,</span> <span class="n">F</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">stationary_values</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;doubling&#39;</span><span class="p">)</span>

<span class="n">P22</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="mi">3</span><span class="p">:]</span>
<span class="n">P21</span> <span class="o">=</span> <span class="n">P</span><span class="p">[</span><span class="mi">3</span><span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span>
<span class="n">P22inv</span> <span class="o">=</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">P22</span><span class="p">)</span>
<span class="n">H_0_0</span> <span class="o">=</span> <span class="o">-</span><span class="n">P22inv</span> <span class="o">@</span> <span class="n">P21</span>

<span class="c1"># Simulate forward</span>

<span class="n">π_leader</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="n">z0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">H_0_0</span> <span class="o">@</span> <span class="n">z0</span>
<span class="n">y0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">z0</span><span class="p">,</span> <span class="n">x0</span><span class="p">))</span>

<span class="n">yt</span><span class="p">,</span> <span class="n">ut</span> <span class="o">=</span> <span class="n">lq</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="n">ts_length</span><span class="o">=</span><span class="n">n</span><span class="p">)[:</span><span class="mi">2</span><span class="p">]</span>

<span class="n">π_matrix</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">+</span> <span class="n">F</span><span class="o">.</span> <span class="n">T</span> <span class="o">@</span> <span class="n">Q</span> <span class="o">@</span> <span class="n">F</span><span class="p">)</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">π_leader</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="p">(</span><span class="n">yt</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">π_matrix</span> <span class="o">@</span> <span class="n">yt</span><span class="p">[:,</span> <span class="n">t</span><span class="p">])</span>

<span class="c1"># Display policies</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computed policy for Continuation Stackelberg leader</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F = </span><span class="si">{</span><span class="n">F</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computed policy for Continuation Stackelberg leader

F = [[-1.58004454  0.29461313  0.67480938  6.53970594]]
</pre></div>
</div>
</div>
</div>
</section>
<section id="time-series-for-price-and-quantities">
<h2><a class="toc-backref" href="#id13" role="doc-backlink"><span class="section-number">40.9. </span>Time Series for Price and Quantities</a><a class="headerlink" href="#time-series-for-price-and-quantities" title="Permalink to this heading">#</a></h2>
<p>Now let’s use the code to compute and display outcomes as a Stackelberg plan unfolds.</p>
<p>The following code plots  quantities chosen by the Stackelberg leader and follower, together with the equilibrium output price.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q_leader</span> <span class="o">=</span> <span class="n">yt</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">q_follower</span> <span class="o">=</span> <span class="n">yt</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q_leader</span> <span class="o">+</span> <span class="n">q_follower</span>       <span class="c1"># Total output, Stackelberg</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">q</span>                 <span class="c1"># Price, Stackelberg</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">q_leader</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;leader output&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">q_follower</span><span class="p">,</span> <span class="s1">&#39;r-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;follower output&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Output and prices, Stackelberg duopoly&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bb94c783c0c825b1c7b3edef599232e78dab9ed409699d5dcaa5090f9962d942.png" src="_images/bb94c783c0c825b1c7b3edef599232e78dab9ed409699d5dcaa5090f9962d942.png" />
</div>
</div>
<section id="value-of-stackelberg-leader">
<h3><span class="section-number">40.9.1. </span>Value of Stackelberg Leader<a class="headerlink" href="#value-of-stackelberg-leader" title="Permalink to this heading">#</a></h3>
<p>We’ll compute the  value <span class="math notranslate nohighlight">\(w(x_0)\)</span> attained  by the Stackelberg leader, where <span class="math notranslate nohighlight">\(x_0\)</span> is given by the maximizer <a class="reference internal" href="#equation-eq-subprob2x0">(40.10)</a> of subproblem 2.</p>
<p>We’ll compute it two ways and get the same answer.</p>
<p>In addition to being a useful check on the accuracy of our coding, computing things in these two ways helps us think about the structure of the problem.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">v_leader_forward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">βs</span> <span class="o">*</span> <span class="n">π_leader</span><span class="p">)</span>
<span class="n">v_leader_direct</span> <span class="o">=</span> <span class="o">-</span><span class="n">yt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="n">yt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span>

<span class="c1"># Display values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computed values for the Stackelberg leader at t=0:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;v_leader_forward(forward sim) = </span><span class="si">{</span><span class="n">v_leader_forward</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;v_leader_direct (direct) = </span><span class="si">{</span><span class="n">v_leader_direct</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computed values for the Stackelberg leader at t=0:

v_leader_forward(forward sim) = 150.0316
v_leader_direct (direct) = 150.0324
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Manually checks whether P is approximately a fixed point</span>
<span class="n">P_next</span> <span class="o">=</span> <span class="p">(</span><span class="n">R</span> <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Q</span> <span class="o">@</span> <span class="n">F</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">@</span> <span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">@</span> <span class="n">F</span><span class="p">))</span>
<span class="p">(</span><span class="n">P</span> <span class="o">-</span> <span class="n">P_next</span> <span class="o">&lt;</span> <span class="n">tol0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Manually checks whether two different ways of computing the</span>
<span class="c1"># value function give approximately the same answer</span>
<span class="n">v_expanded</span> <span class="o">=</span> <span class="o">-</span><span class="p">((</span><span class="n">y0</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">R</span> <span class="o">@</span> <span class="n">y0</span> <span class="o">+</span> <span class="n">ut</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Q</span> <span class="o">@</span> <span class="n">ut</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span>
               <span class="n">β</span> <span class="o">*</span> <span class="p">(</span><span class="n">y0</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">@</span> <span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">@</span> <span class="n">F</span><span class="p">)</span> <span class="o">@</span> <span class="n">y0</span><span class="p">)))</span>
<span class="p">(</span><span class="n">v_leader_direct</span> <span class="o">-</span> <span class="n">v_expanded</span> <span class="o">&lt;</span> <span class="n">tol0</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="time-inconsistency-of-stackelberg-plan">
<h2><a class="toc-backref" href="#id14" role="doc-backlink"><span class="section-number">40.10. </span>Time Inconsistency of Stackelberg Plan</a><a class="headerlink" href="#time-inconsistency-of-stackelberg-plan" title="Permalink to this heading">#</a></h2>
<p>In the code below we compare two values</p>
<ul class="simple">
<li><p>the continuation value <span class="math notranslate nohighlight">\(v(y_t) = - y_t' P y_t\)</span> earned by a <strong>continuation
Stackelberg leader</strong> who inherits state <span class="math notranslate nohighlight">\(y_t\)</span> at <span class="math notranslate nohighlight">\(t\)</span></p></li>
<li><p>the value <span class="math notranslate nohighlight">\(w(\hat x_t)\)</span> of a <strong>reborn Stackelberg leader</strong> who, at date <span class="math notranslate nohighlight">\(t\)</span> along the Stackelberg plan, inherits state
<span class="math notranslate nohighlight">\(z_t\)</span> at <span class="math notranslate nohighlight">\(t\)</span> but who discards <span class="math notranslate nohighlight">\(x_t\)</span> from the time <span class="math notranslate nohighlight">\(t\)</span> continuation of the original Stackelberg plan  and  <strong>resets</strong> it to <span class="math notranslate nohighlight">\( \hat x_t = - P_{22}^{-1} P_{21} z_t\)</span></p></li>
</ul>
<p>The difference between these two values is a tell-tale sign of the time
inconsistency of the Stackelberg plan</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute value function over time with a reset at time t</span>
<span class="n">vt_leader</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">vt_reset_leader</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty_like</span><span class="p">(</span><span class="n">vt_leader</span><span class="p">)</span>

<span class="n">yt_reset</span> <span class="o">=</span> <span class="n">yt</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">yt_reset</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">H_0_0</span> <span class="o">@</span> <span class="n">yt</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="p">:])</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">vt_leader</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">yt</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="n">yt</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span>
    <span class="n">vt_reset_leader</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">yt_reset</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="n">yt_reset</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">axes</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">7</span><span class="p">))</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">F</span> <span class="o">@</span> <span class="n">yt</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stackelberg leader&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span> <span class="n">F</span> <span class="o">@</span> <span class="n">yt_reset</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s1">&#39;reborn  at t Stackelberg leader&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39; $u_</span><span class="si">{t}</span><span class="s1"> = q_{2t+1} - q_t$&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">yt</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">),</span> <span class="n">yt_reset</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="p">:],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39; $x_</span><span class="si">{t}</span><span class="s1"> = q_{1t+1} - q_</span><span class="si">{1t}</span><span class="s1">$&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>

<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">vt_leader</span><span class="p">,</span> <span class="s1">&#39;bo&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">vt_reset_leader</span><span class="p">,</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">axes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$v(y_</span><span class="si">{t}</span><span class="s1">)$ and $w(\hat x_t)$&#39;</span><span class="p">,</span> <span class="n">xlabel</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/da7766484181b9596863c2acbca48b4b487815125dbd9c53328994cd67cf2638.png" src="_images/da7766484181b9596863c2acbca48b4b487815125dbd9c53328994cd67cf2638.png" />
</div>
</div>
<p>The figure above shows</p>
<ul class="simple">
<li><p>in the third panel that for <span class="math notranslate nohighlight">\(t \geq 1\)</span>  the <strong>reborn at <span class="math notranslate nohighlight">\(t\)</span></strong> Stackelberg leader’s’s value <span class="math notranslate nohighlight">\(w(\hat x_0)\)</span>  exceeds the continuation value <span class="math notranslate nohighlight">\(v(y_t)\)</span> of the time <span class="math notranslate nohighlight">\(0\)</span> Stackelberg leader</p></li>
<li><p>in the first panel that for <span class="math notranslate nohighlight">\(t \geq 1\)</span>  the <strong>reborn at <span class="math notranslate nohighlight">\(t\)</span></strong> Stackelberg leader wants to reduce his output below that prescribed by the time <span class="math notranslate nohighlight">\(0\)</span> Stackelberg leader</p></li>
<li><p>in the second panel that for <span class="math notranslate nohighlight">\(t \geq 1\)</span>  the <strong>reborn at <span class="math notranslate nohighlight">\(t\)</span></strong> Stackelberg leader wants to increase the output of the follower firm 2 below that prescribed by the time <span class="math notranslate nohighlight">\(0\)</span> Stackelberg leader</p></li>
</ul>
<p>Taken together, these outcomes express the time inconsistency of the original time <span class="math notranslate nohighlight">\(0\)</span> Stackelberg leaders’s plan.</p>
</section>
<section id="recursive-formulation-of-followers-problem">
<h2><a class="toc-backref" href="#id15" role="doc-backlink"><span class="section-number">40.11. </span>Recursive Formulation of Follower’s Problem</a><a class="headerlink" href="#recursive-formulation-of-followers-problem" title="Permalink to this heading">#</a></h2>
<p>We now formulate and compute the recursive version of the follower’s
problem.</p>
<p>We check that the recursive <strong>Big</strong> <span class="math notranslate nohighlight">\(K\)</span> <strong>, little</strong> <span class="math notranslate nohighlight">\(k\)</span> formulation of the follower’s problem produces the same output path
<span class="math notranslate nohighlight">\(\vec q_1\)</span> that we computed when we solved the Stackelberg problem</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A_tilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">A_tilde</span><span class="p">[:</span><span class="mi">4</span><span class="p">,</span> <span class="p">:</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">@</span> <span class="n">F</span>

<span class="n">R_tilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">a0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>  <span class="n">a1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="mi">0</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span><span class="o">-</span><span class="n">a0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>    <span class="mi">0</span><span class="p">,</span>      <span class="n">a1</span><span class="p">]])</span>

<span class="n">Q_tilde</span> <span class="o">=</span> <span class="n">Q</span>
<span class="n">B_tilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]])</span><span class="o">.</span><span class="n">T</span>

<span class="n">lq_tilde</span> <span class="o">=</span> <span class="n">LQ</span><span class="p">(</span><span class="n">Q_tilde</span><span class="p">,</span> <span class="n">R_tilde</span><span class="p">,</span> <span class="n">A_tilde</span><span class="p">,</span> <span class="n">B_tilde</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">)</span>
<span class="n">P_tilde</span><span class="p">,</span> <span class="n">F_tilde</span><span class="p">,</span> <span class="n">d_tilde</span> <span class="o">=</span> <span class="n">lq_tilde</span><span class="o">.</span><span class="n">stationary_values</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;doubling&#39;</span><span class="p">)</span>

<span class="n">y0_tilde</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">y0</span><span class="p">,</span> <span class="n">y0</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
<span class="n">yt_tilde</span> <span class="o">=</span> <span class="n">lq_tilde</span><span class="o">.</span><span class="n">compute_sequence</span><span class="p">(</span><span class="n">y0_tilde</span><span class="p">,</span> <span class="n">ts_length</span><span class="o">=</span><span class="n">n</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Checks that the recursive formulation of the follower&#39;s problem gives</span>
<span class="c1"># the same solution as the original Stackelberg problem</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yt_tilde</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;q_tilde&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yt_tilde</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b36c47765b45cf0e314a4e58806c97b40bc9db8a2c83589c354060b5ab0c2040.png" src="_images/b36c47765b45cf0e314a4e58806c97b40bc9db8a2c83589c354060b5ab0c2040.png" />
</div>
</div>
<p>Note: Variables with <code class="docutils literal notranslate"><span class="pre">_tilde</span></code> are obtained from solving the follower’s
problem – those without are from the Stackelberg problem</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Maximum absolute difference in quantities over time between</span>
<span class="c1"># the first and second solution methods</span>
<span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yt_tilde</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">yt_tilde</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6.661338147750939e-16
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># x0 == x0_tilde</span>
<span class="n">yt</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">yt_tilde</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">yt_tilde</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">tol0</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<section id="explanation-of-alignment">
<h3><span class="section-number">40.11.1. </span>Explanation of Alignment<a class="headerlink" href="#explanation-of-alignment" title="Permalink to this heading">#</a></h3>
<p>If we inspect  coefficients in the decision rule <span class="math notranslate nohighlight">\(- \tilde F\)</span>,
we should be able to  spot why the follower chooses to set <span class="math notranslate nohighlight">\(x_t =
\tilde x_t\)</span> when it sets <span class="math notranslate nohighlight">\(x_t = - \tilde F X_t\)</span> in
the recursive formulation of the follower problem.</p>
<p>Can you spot what features of <span class="math notranslate nohighlight">\(\tilde F\)</span> imply this?</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>Remember the components of <span class="math notranslate nohighlight">\(X_t\)</span></p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Policy function in the follower&#39;s problem</span>
<span class="n">F_tilde</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-0.    ,  0.    , -0.1032, -1.    ,  0.1032]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Value function in the Stackelberg problem</span>
<span class="n">P</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[  963.54083615,  -194.60534465,  -511.62197962, -5258.22585724],
       [ -194.60534465,    37.3535753 ,    81.97712513,   784.76471234],
       [ -511.62197962,    81.97712513,   247.34333344,  2517.05126111],
       [-5258.22585724,   784.76471234,  2517.05126111, 25556.16504097]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Value function in the follower&#39;s problem</span>
<span class="n">P_tilde</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([[-1.81991134e+01,  2.58003020e+00,  1.56048755e+01,
         1.51229815e+02, -5.00000000e+00],
       [ 2.58003020e+00, -9.69465925e-01, -5.26007958e+00,
        -5.09764310e+01,  1.00000000e+00],
       [ 1.56048755e+01, -5.26007958e+00, -3.22759027e+01,
        -3.12791908e+02, -1.23823802e+01],
       [ 1.51229815e+02, -5.09764310e+01, -3.12791908e+02,
        -3.03132584e+03, -1.20000000e+02],
       [-5.00000000e+00,  1.00000000e+00, -1.23823802e+01,
        -1.20000000e+02,  1.43823802e+01]])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Manually check that P is an approximate fixed point</span>
<span class="p">(</span><span class="n">P</span>  <span class="o">-</span> <span class="p">((</span><span class="n">R</span> <span class="o">+</span> <span class="n">F</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Q</span> <span class="o">@</span> <span class="n">F</span><span class="p">)</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">@</span> <span class="n">F</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P</span> <span class="o">@</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">B</span> <span class="o">@</span> <span class="n">F</span><span class="p">))</span> <span class="o">&lt;</span> <span class="n">tol0</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute `P_guess` using `F_tilde_star`</span>
<span class="n">F_tilde_star</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]])</span>
<span class="n">P_guess</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
    <span class="n">P_guess</span> <span class="o">=</span> <span class="p">((</span><span class="n">R_tilde</span> <span class="o">+</span> <span class="n">F_tilde_star</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Q</span> <span class="o">@</span> <span class="n">F_tilde_star</span><span class="p">)</span> <span class="o">+</span>
               <span class="n">β</span> <span class="o">*</span> <span class="p">(</span><span class="n">A_tilde</span> <span class="o">-</span> <span class="n">B_tilde</span> <span class="o">@</span> <span class="n">F_tilde_star</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_guess</span>
               <span class="o">@</span> <span class="p">(</span><span class="n">A_tilde</span> <span class="o">-</span> <span class="n">B_tilde</span> <span class="o">@</span> <span class="n">F_tilde_star</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Value function in the follower&#39;s problem</span>
<span class="o">-</span><span class="p">(</span><span class="n">y0_tilde</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_tilde</span> <span class="o">@</span> <span class="n">y0_tilde</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>112.65590740578058
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Value function with `P_guess`</span>
<span class="o">-</span><span class="p">(</span><span class="n">y0_tilde</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_guess</span> <span class="o">@</span> <span class="n">y0_tilde</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>112.6559074057807
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute policy using policy iteration algorithm</span>
<span class="n">F_iter</span> <span class="o">=</span> <span class="p">(</span><span class="n">β</span> <span class="o">*</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Q</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">B_tilde</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_guess</span> <span class="o">@</span> <span class="n">B_tilde</span><span class="p">)</span>
          <span class="o">@</span> <span class="n">B_tilde</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_guess</span> <span class="o">@</span> <span class="n">A_tilde</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="c1"># Compute P_iter</span>
    <span class="n">P_iter</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">):</span>
        <span class="n">P_iter</span> <span class="o">=</span> <span class="p">((</span><span class="n">R_tilde</span> <span class="o">+</span> <span class="n">F_iter</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Q</span> <span class="o">@</span> <span class="n">F_iter</span><span class="p">)</span> <span class="o">+</span> <span class="n">β</span>
                  <span class="o">*</span> <span class="p">(</span><span class="n">A_tilde</span> <span class="o">-</span> <span class="n">B_tilde</span> <span class="o">@</span> <span class="n">F_iter</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_iter</span>
                  <span class="o">@</span> <span class="p">(</span><span class="n">A_tilde</span> <span class="o">-</span> <span class="n">B_tilde</span> <span class="o">@</span> <span class="n">F_iter</span><span class="p">))</span>

    <span class="c1"># Update F_iter</span>
    <span class="n">F_iter</span> <span class="o">=</span> <span class="p">(</span><span class="n">β</span> <span class="o">*</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Q</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">B_tilde</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_iter</span> <span class="o">@</span> <span class="n">B_tilde</span><span class="p">)</span>
              <span class="o">@</span> <span class="n">B_tilde</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_iter</span> <span class="o">@</span> <span class="n">A_tilde</span><span class="p">)</span>

<span class="n">dist_vec</span> <span class="o">=</span> <span class="p">(</span><span class="n">P_iter</span> <span class="o">-</span> <span class="p">((</span><span class="n">R_tilde</span> <span class="o">+</span> <span class="n">F_iter</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">Q</span> <span class="o">@</span> <span class="n">F_iter</span><span class="p">)</span>
            <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="p">(</span><span class="n">A_tilde</span> <span class="o">-</span> <span class="n">B_tilde</span> <span class="o">@</span> <span class="n">F_iter</span><span class="p">)</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_iter</span>
            <span class="o">@</span> <span class="p">(</span><span class="n">A_tilde</span> <span class="o">-</span> <span class="n">B_tilde</span> <span class="o">@</span> <span class="n">F_iter</span><span class="p">)))</span>

<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dist_vec</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
    <span class="n">dist_vec2</span> <span class="o">=</span> <span class="p">(</span><span class="n">F_iter</span> <span class="o">-</span> <span class="p">(</span><span class="n">β</span> <span class="o">*</span> <span class="n">la</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">Q</span> <span class="o">+</span> <span class="n">β</span> <span class="o">*</span> <span class="n">B_tilde</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_iter</span> <span class="o">@</span> <span class="n">B_tilde</span><span class="p">)</span>
                 <span class="o">@</span> <span class="n">B_tilde</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_iter</span> <span class="o">@</span> <span class="n">A_tilde</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">dist_vec2</span><span class="p">))</span> <span class="o">&lt;</span> <span class="mf">1e-8</span><span class="p">:</span>
        <span class="n">F_iter</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The policy didn&#39;t converge: try increasing the number of </span><span class="se">\</span>
<span class="s2">            outer loop iterations&quot;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;`P_iter` didn&#39;t converge: try increasing the number of inner </span><span class="se">\</span>
<span class="s2">        loop iterations&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Simulate the system using `F_tilde_star` and check that it gives the</span>
<span class="c1"># same result as the original solution</span>

<span class="n">yt_tilde_star</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>
<span class="n">yt_tilde_star</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">y0_tilde</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">yt_tilde_star</span><span class="p">[</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="p">(</span><span class="n">A_tilde</span> <span class="o">-</span> <span class="n">B_tilde</span> <span class="o">@</span> <span class="n">F_tilde_star</span><span class="p">)</span> \
        <span class="o">@</span> <span class="n">yt_tilde_star</span><span class="p">[</span><span class="n">t</span><span class="p">,</span> <span class="p">:]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yt_tilde_star</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;q_tilde&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">yt_tilde</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;q&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/44027dbd6766ffbc6d116a39dfbbf1ebfa2d5319a856a27813f30d6264caf042.png" src="_images/44027dbd6766ffbc6d116a39dfbbf1ebfa2d5319a856a27813f30d6264caf042.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Maximum absolute difference</span>
<span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">yt_tilde_star</span><span class="p">[:,</span> <span class="mi">4</span><span class="p">]</span> <span class="o">-</span> <span class="n">yt_tilde</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="markov-perfect-equilibrium">
<h2><a class="toc-backref" href="#id16" role="doc-backlink"><span class="section-number">40.12. </span>Markov Perfect Equilibrium</a><a class="headerlink" href="#markov-perfect-equilibrium" title="Permalink to this heading">#</a></h2>
<p>The <strong>state</strong> vector is</p>
<div class="math notranslate nohighlight">
\[
z_t = \begin{bmatrix} 1 \cr q_{2t} \cr q_{1t} \end{bmatrix}
\]</div>
<p>and the state transition dynamics are</p>
<div class="math notranslate nohighlight">
\[
z_{t+1} = A z_t + B_1 v_{1t}  +  B_2 v_{2t}
\]</div>
<p>where <span class="math notranslate nohighlight">\(A\)</span> is a <span class="math notranslate nohighlight">\(3 \times 3\)</span> identity matrix and</p>
<div class="math notranslate nohighlight">
\[
B_1 = \begin{bmatrix} 0 \cr 0 \cr 1 \end{bmatrix} ,
\quad B_2 = \begin{bmatrix} 0 \cr 1 \cr 0 \end{bmatrix}
\]</div>
<p>The Markov perfect decision rules are</p>
<div class="math notranslate nohighlight">
\[
v_{1t} = - F_1 z_t , \quad v_{2t} = - F_2 z_t
\]</div>
<p>and in the Markov perfect equilibrium, the state evolves according to</p>
<div class="math notranslate nohighlight">
\[
z_{t+1} = (A - B_1 F_1 - B_2 F_2) z_t
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># In LQ form</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="n">B1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
<span class="n">B2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">]])</span>

<span class="n">R1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="n">a0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">0</span><span class="p">,</span>            <span class="mi">0</span><span class="p">,</span>  <span class="n">a1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
               <span class="p">[</span><span class="o">-</span><span class="n">a0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">a1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>      <span class="n">a1</span><span class="p">]])</span>

<span class="n">R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">,</span>       <span class="o">-</span><span class="n">a0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>      <span class="mi">0</span><span class="p">],</span>
               <span class="p">[</span><span class="o">-</span><span class="n">a0</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>      <span class="n">a1</span><span class="p">,</span> <span class="n">a1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">],</span>
               <span class="p">[</span><span class="mi">0</span><span class="p">,</span>        <span class="n">a1</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span>      <span class="mi">0</span><span class="p">]])</span>

<span class="n">Q1</span> <span class="o">=</span> <span class="n">Q2</span> <span class="o">=</span> <span class="n">γ</span>
<span class="n">S1</span> <span class="o">=</span> <span class="n">S2</span> <span class="o">=</span> <span class="n">W1</span> <span class="o">=</span> <span class="n">W2</span> <span class="o">=</span> <span class="n">M1</span> <span class="o">=</span> <span class="n">M2</span> <span class="o">=</span> <span class="mf">0.0</span>

<span class="c1"># Solve using QE&#39;s nnash function</span>
<span class="n">F1</span><span class="p">,</span> <span class="n">F2</span><span class="p">,</span> <span class="n">P1</span><span class="p">,</span> <span class="n">P2</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">nnash</span><span class="p">(</span><span class="n">A</span><span class="p">,</span> <span class="n">B1</span><span class="p">,</span> <span class="n">B2</span><span class="p">,</span> <span class="n">R1</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">Q1</span><span class="p">,</span>
                          <span class="n">Q2</span><span class="p">,</span> <span class="n">S1</span><span class="p">,</span> <span class="n">S2</span><span class="p">,</span> <span class="n">W1</span><span class="p">,</span> <span class="n">W2</span><span class="p">,</span> <span class="n">M1</span><span class="p">,</span>
                          <span class="n">M2</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">,</span> <span class="n">tol</span><span class="o">=</span><span class="n">tol1</span><span class="p">)</span>

<span class="c1"># Simulate forward</span>
<span class="n">AF</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">B1</span> <span class="o">@</span> <span class="n">F1</span> <span class="o">-</span> <span class="n">B2</span> <span class="o">@</span> <span class="n">F2</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">3</span><span class="p">,</span> <span class="n">n</span><span class="p">))</span>
<span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
    <span class="n">z</span><span class="p">[:,</span> <span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">AF</span> <span class="o">@</span> <span class="n">z</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span>

<span class="c1"># Display policies</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computed policies for firm 1 and firm 2:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 = </span><span class="si">{</span><span class="n">F1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F2 = </span><span class="si">{</span><span class="n">F2</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computed policies for firm 1 and firm 2:

F1 = [[-0.22701363  0.03129874  0.09447113]]
F2 = [[-0.22701363  0.09447113  0.03129874]]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">q1</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">q2</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="p">:]</span>
<span class="n">q</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">+</span> <span class="n">q2</span>       <span class="c1"># Total output, MPE</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">q</span>   <span class="c1"># Price, MPE</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mf">5.8</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">q</span><span class="p">,</span> <span class="s1">&#39;b-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;total output&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">),</span> <span class="n">p</span><span class="p">,</span> <span class="s1">&#39;g-&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;price&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Output and prices, duopoly MPE&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3483ca8efb2bd62e081bfb9b9b3cd1e2b0f761ce13c6b4f1ffdd6fcd3c89c61f.png" src="_images/3483ca8efb2bd62e081bfb9b9b3cd1e2b0f761ce13c6b4f1ffdd6fcd3c89c61f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Computes the maximum difference between the two quantities of the two firms</span>
<span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">q1</span> <span class="o">-</span> <span class="n">q2</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.771561172376096e-15
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute values</span>
<span class="n">u1</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span> <span class="n">F1</span> <span class="o">@</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
<span class="n">u2</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span> <span class="n">F2</span> <span class="o">@</span> <span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

<span class="n">π_1</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q1</span> <span class="o">-</span> <span class="n">γ</span> <span class="o">*</span> <span class="p">(</span><span class="n">u1</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
<span class="n">π_2</span> <span class="o">=</span> <span class="n">p</span> <span class="o">*</span> <span class="n">q2</span> <span class="o">-</span> <span class="n">γ</span> <span class="o">*</span> <span class="p">(</span><span class="n">u2</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>

<span class="n">v1_forward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">βs</span> <span class="o">*</span> <span class="n">π_1</span><span class="p">)</span>
<span class="n">v2_forward</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">βs</span> <span class="o">*</span> <span class="n">π_2</span><span class="p">)</span>

<span class="n">v1_direct</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P1</span> <span class="o">@</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">v2_direct</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P2</span> <span class="o">@</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span>

<span class="c1"># Display values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computed values for firm 1 and firm 2:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;v1(forward sim) = </span><span class="si">{</span><span class="n">v1_forward</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">; v1 (direct) = </span><span class="si">{</span><span class="n">v1_direct</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;v2 (forward sim) = </span><span class="si">{</span><span class="n">v2_forward</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">; v2 (direct) = </span><span class="si">{</span><span class="n">v2_direct</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computed values for firm 1 and firm 2:

v1(forward sim) = 133.3303; v1 (direct) = 133.3296
v2 (forward sim) = 133.3303; v2 (direct) = 133.3296
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Sanity check</span>
<span class="n">Λ1</span> <span class="o">=</span> <span class="n">A</span> <span class="o">-</span> <span class="n">B2</span> <span class="o">@</span> <span class="n">F2</span>
<span class="n">lq1</span> <span class="o">=</span> <span class="n">qe</span><span class="o">.</span><span class="n">LQ</span><span class="p">(</span><span class="n">Q1</span><span class="p">,</span> <span class="n">R1</span><span class="p">,</span> <span class="n">Λ1</span><span class="p">,</span> <span class="n">B1</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="n">β</span><span class="p">)</span>
<span class="n">P1_ih</span><span class="p">,</span> <span class="n">F1_ih</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">lq1</span><span class="o">.</span><span class="n">stationary_values</span><span class="p">()</span>

<span class="n">v2_direct_alt</span> <span class="o">=</span> <span class="o">-</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">lq1</span><span class="o">.</span><span class="n">P</span> <span class="o">@</span> <span class="n">z</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">lq1</span><span class="o">.</span><span class="n">d</span>

<span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">v2_direct</span> <span class="o">-</span> <span class="n">v2_direct_alt</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">tol2</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>True
</pre></div>
</div>
</div>
</div>
</section>
<section id="comparing-markov-perfect-equilibrium-and-stackelberg-outcome">
<h2><a class="toc-backref" href="#id17" role="doc-backlink"><span class="section-number">40.13. </span>Comparing Markov Perfect Equilibrium and  Stackelberg Outcome</a><a class="headerlink" href="#comparing-markov-perfect-equilibrium-and-stackelberg-outcome" title="Permalink to this heading">#</a></h2>
<p>It is enlightening to compare equilbrium values for firms 1 and 2 under two alternative
settings:</p>
<ul class="simple">
<li><p>A Markov perfect equilibrium like that described in <a class="reference external" href="https://python.quantecon.org/markov_perf.html">this lecture</a></p></li>
<li><p>A Stackelberg equilbrium</p></li>
</ul>
<p>The following code performs the required computations, then plots the continuation values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">vt_MPE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
<span class="n">vt_follower</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="n">vt_MPE</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">z</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P1</span> <span class="o">@</span> <span class="n">z</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span>
    <span class="n">vt_follower</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">yt_tilde</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span><span class="o">.</span><span class="n">T</span> <span class="o">@</span> <span class="n">P_tilde</span> <span class="o">@</span> <span class="n">yt_tilde</span><span class="p">[:,</span> <span class="n">t</span><span class="p">]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vt_MPE</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;MPE&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vt_leader</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stackelberg leader&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">vt_follower</span><span class="p">,</span> <span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Stackelberg follower&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Values for MPE duopolists and  Stackelberg firms&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="p">(</span><span class="mf">1.05</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/abb7e23b05c843924e5025d6ffd2a9c9a5c46bf6c94795338ecc9fe39c9dbbca.png" src="_images/abb7e23b05c843924e5025d6ffd2a9c9a5c46bf6c94795338ecc9fe39c9dbbca.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Display values</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Computed values:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vt_leader(y0) = </span><span class="si">{</span><span class="n">vt_leader</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vt_follower(y0) = </span><span class="si">{</span><span class="n">vt_follower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;vt_MPE(y0) = </span><span class="si">{</span><span class="n">vt_MPE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computed values:

vt_leader(y0) = 150.0324
vt_follower(y0) = 112.6559
vt_MPE(y0) = 133.3296
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute the difference in total value between the Stackelberg and the MPE</span>
<span class="n">vt_leader</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">vt_follower</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">vt_MPE</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-3.970942562087714
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="orth_proj.html">
   1. Orthogonal Projections and Their Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stationary_densities.html">
   2. Continuous State Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="muth_kalman.html">
   3. Reverse Engineering a la Muth
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="discrete_dp.html">
   4. Discrete State Dynamic Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cons_news.html">
   5. Information and Consumption Smoothing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing.html">
   6. Consumption Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing_tax.html">
   7. Tax Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_jump_lq.html">
   8. Markov Jump Linear Quadratic Dynamic Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_1.html">
   9. How to Pay for a War: Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_2.html">
   10. How to Pay for a War: Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_3.html">
   11. How to Pay for a War: Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lqramsey.html">
   12. Optimal Taxation in an LQ Economy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arellano.html">
   13. Default Risk and Income Fluctuations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="matsuyama.html">
   14. Globalization and Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coase.html">
   15. Coase’s Theory of the Firm
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Linear Economies
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="hs_recursive_models.html">
   16. Recursive Models of Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="growth_in_dles.html">
   17. Growth in Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_asset_pricing_dles.html">
   18. Lucas Asset Pricing Using DLE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irfs_in_hall_model.html">
   19. IRFs in Hall Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="permanent_income_dles.html">
   20. Permanent Income Model using the DLE Class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rosen_schooling_model.html">
   21. Rosen Schooling Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cattle_cycles.html">
   22. Cattle Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hs_invertibility_example.html">
   23. Shock Non Invertibility
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Risk, Model Uncertainty, and Robustness
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="five_preferences.html">
   24. Risk and Model Uncertainty
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="entropy.html">
   25. Etymology of Entropy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="robustness.html">
   26. Robustness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rob_markov_perf.html">
   27. Robust Markov Perfect Equilibrium
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time Series Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arma.html">
   28. Covariance Stationary Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="estspec.html">
   29. Estimation of Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="additive_functionals.html">
   30. Additive and Multiplicative Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lu_tricks.html">
   31. Classical Control with Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classical_filtering.html">
   32. Classical Prediction and Filtering With Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="knowing_forecasts_of_others.html">
   33. Knowing the Forecasts of Others
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_model.html">
   34. Asset Pricing II: The Lucas Asset Pricing Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="asset_pricing_lph.html">
   35. Elementary Asset Pricing Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="black_litterman.html">
   36. Two Modifications of Mean-Variance Portfolio Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_complete_mkts.html">
   37. Irrelevance of Capital Structures with Complete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_incomplete_mkts.html">
   38. Equilibrium Capital Structures with Incomplete Markets
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Programming Squared
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="un_insure.html">
   39. Optimal Unemployment Insurance
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   40. Stackelberg Plans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo.html">
   41. Ramsey Plans, Time Inconsistency, Sustainable Plans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="opt_tax_recur.html">
   42. Optimal Taxation with State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss.html">
   43. Optimal Taxation without State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss2.html">
   44. Fluctuating Interest Rates Deliver Fiscal Insurance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss3.html">
   45. Fiscal Risk and Government Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_ramsey.html">
   46. Competitive Equilibria of a Model of Chang
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_credible.html">
   47. Credible Government Policies in a Model of Chang
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   48. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   49. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   50. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                    <!-- <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off">
                            <i data-feather="search"></i>
                        </form>
                    </li> -->
                </ul>

                <ul class="qe-toolbar__links">
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/dyn_stack.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li class="download-pdf" id="downloadButton"><i data-feather="file"></i></li>
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-advanced.myst/tree/master/lectures/dyn_stack.md" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="/_pdf/quantecon-python-advanced.pdf" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://mybinder.org/v2/gh/QuantEcon/lecture-python-advanced.notebooks/master?urlpath=tree/dyn_stack.ipynb">BinderHub</option>
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python-advanced.notebooks/blob/master/dyn_stack.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python-advanced.notebooks" data-urlpath="tree/lecture-python-advanced.notebooks/dyn_stack.ipynb" data-branch=master>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://mybinder.org/v2/gh/QuantEcon/lecture-python-advanced.notebooks/master?urlpath=tree/dyn_stack.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "dyn_stack";
                const repoURL = "https://github.com/QuantEcon/lecture-python-advanced.notebooks";
                const urlPath = "tree/lecture-python-advanced.notebooks/dyn_stack.ipynb";
                const branch = "master"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>