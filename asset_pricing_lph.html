

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>36. Elementary Asset Pricing Theory &#8212; Advanced Quantitative Economics with Python</title>
    <script src="https://unpkg.com/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://unpkg.com/tippy.js@6.3.1/dist/tippy-bundle.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
    
        <script>
            MathJax = {
            loader: {load: ['[tex]/boldsymbol', '[tex]/textmacros']},
            tex: {
                packages: {'[+]': ['boldsymbol', 'textmacros']},
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                processEscapes: true,
                macros: {
                    "argmax" : "arg\\,max",
                    "argmin" : "arg\\,min",
                    "col"    : "col",
                    "Span"   :  "span",
                    "epsilon": "\\varepsilon",
                    "EE": "\\mathbb{E}",
                    "PP": "\\mathbb{P}",
                    "RR": "\\mathbb{R}",
                    "NN": "\\mathbb{N}",
                    "ZZ": "\\mathbb{Z}",
                    "aA": "\\mathcal{A}",
                    "bB": "\\mathcal{B}",
                    "cC": "\\mathcal{C}",
                    "dD": "\\mathcal{D}",
                    "eE": "\\mathcal{E}",
                    "fF": "\\mathcal{F}",
                    "gG": "\\mathcal{G}",
                    "hH": "\\mathcal{H}",
                }
            },
            svg: {
                fontCache: 'global',
                scale: 0.92,
                displayAlign: "center",
            },
            };
        </script>
    
    
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/quantecon-book-theme.css?digest=bd0785fbb14d8d2bd4d9ae501d79ed8d3bc089ec" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.8ecb98da25f57f5357bf6f572d296f466b2cfe2517ffebfabe82451661e28f02.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/exercise.css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>


    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/scripts/quantecon-book-theme.js?digest=d6d86bce9979111653c4c495e33499e1796e172a"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-KZLV7PM9LL"></script>
    <script>
                window.dataLayer = window.dataLayer || [];
                function gtag(){ dataLayer.push(arguments); }
                gtag('js', new Date());
                gtag('config', 'G-KZLV7PM9LL');
            </script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex": {"macros": {"argmax": "arg\\,max", "argmin": "arg\\,min", "col": "col", "Span": "span", "epsilon": "\\varepsilon", "EE": "\\mathbb{E}", "PP": "\\mathbb{P}", "RR": "\\mathbb{R}", "NN": "\\mathbb{N}", "ZZ": "\\mathbb{Z}", "aA": "\\mathcal{A}", "bB": "\\mathcal{B}", "cC": "\\mathcal{C}", "dD": "\\mathcal{D}", "eE": "\\mathcal{E}", "fF": "\\mathcal{F}", "gG": "\\mathcal{G}", "hH": "\\mathcal{H}"}}, "options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'asset_pricing_lph';</script>
    <link rel="canonical" href="https://python-advanced.quantecon.org/asset_pricing_lph.html" />
    <link rel="shortcut icon" href="_static/lectures-favicon.ico"/>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="37. Two Modifications of Mean-Variance Portfolio Theory" href="black_litterman.html" />
    <link rel="prev" title="35. Asset Pricing II: The Lucas Asset Pricing Model" href="lucas_model.html" />

<!-- Normal Meta Tags -->
<meta name="author" context="Thomas J. Sargent &amp; John Stachurski" />
<meta name="keywords" content="Python, QuantEcon, Quantitative Economics, Economics, Sloan, Alfred P. Sloan Foundation, Tom J. Sargent, John Stachurski" />
<meta name="description" content=This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski. />

<!-- Twitter tags -->
<meta name="twitter:card" content="summary" />
<meta name="twitter:site" content="@quantecon" />
<meta name="twitter:title" content="Elementary Asset Pricing Theory"/>
<meta name="twitter:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski.">
<meta name="twitter:creator" content="@quantecon">
<meta name="twitter:image" content="https://assets.quantecon.org/img/qe-twitter-logo.png">

<!-- Opengraph tags -->
<meta property="og:title" content="Elementary Asset Pricing Theory" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://python-advanced.quantecon.org/asset_pricing_lph.html" />
<meta property="og:image" content="https://assets.quantecon.org/img/qe-og-logo.png" />
<meta property="og:description" content="This website presents a set of lectures on advanced quantitative economic modeling, designed and written by Thomas J. Sargent and John Stachurski." />
<meta property="og:site_name" content="Advanced Quantitative Economics with Python" />
<meta name="theme-color" content="#ffffff" />

  </head>
<body>


    <span id="top"></span>

    <div class="qe-wrapper">

        <div class="qe-main">

            <div class="qe-page" id=asset_pricing_lph>

                <div class="qe-page__toc">

                    <div class="inner">

                        
                        <div class="qe-page__toc-header">
                            On this page
                        </div>


                        <nav id="bd-toc-nav" class="qe-page__toc-nav">
                            <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#overview">36.1. Overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#key-equation">36.2. Key equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#implications-of-key-equation">36.3. Implications of key equation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#expected-return-beta-representation">36.4. Expected return - beta representation</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mean-variance-frontier">36.5. Mean-variance frontier</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sharpe-ratios-and-the-price-of-risk">36.6. Sharpe ratios and the price of risk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#mathematical-structure-of-frontier">36.7. Mathematical structure of frontier</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multi-factor-models">36.8. Multi-factor models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#empirical-implementations">36.9. Empirical implementations</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercises">36.10. Exercises</a></li>
</ul>
                            <p class="logo">
                                
                                    
                                    <a href=https://quantecon.org><img src="_static/qe-logo-large.png" class="logo logo-img" alt="logo"></a>
                                    
                                    
                                
                            </p>

                            <p class="powered">Powered by <a href="https://jupyterbook.org/">Jupyter Book</a></p>

                        </nav>

                        <div class="qe-page__toc-footer">
                            
                            
                            <p><a href="#top"><strong>Back to top</strong></a></p>
                        </div>

                    </div>

                </div>

                <div class="qe-page__header">

                    <div class="qe-page__header-copy">

                        <p class="qe-page__header-heading"><a href="intro.html">Advanced Quantitative Economics with Python</a></p>

                        <p class="qe-page__header-subheading">Elementary Asset Pricing Theory</p>

                    </div>
                    <!-- length 2, since its a string and empty dict has length 2 - {} -->
                        <p class="qe-page__header-authors" font-size="18">
                            
                                
                                    <a href="http://www.tomsargent.com/" target="_blank"><span>Thomas J. Sargent</span></a>
                                
                            
                                
                                    and <a href="https://johnstachurski.net/" target="_blank"><span>John Stachurski</span></a>
                                
                            
                        </p>


                </div> <!-- .page__header -->



                
                <main class="qe-page__content" role="main">
                    
                    <div>
                        
  <section class="tex2jax_ignore mathjax_ignore" id="elementary-asset-pricing-theory">
<h1><span class="section-number">36. </span>Elementary Asset Pricing Theory<a class="headerlink" href="#elementary-asset-pricing-theory" title="Permalink to this heading">#</a></h1>
<section id="overview">
<span id="index-0"></span><h2><span class="section-number">36.1. </span>Overview<a class="headerlink" href="#overview" title="Permalink to this heading">#</a></h2>
<p>This lecture is about  some implications of  asset-pricing theories that are based on the equation
<span class="math notranslate nohighlight">\(E m R = 1,\)</span> where <span class="math notranslate nohighlight">\(R\)</span> is the gross return on an asset, <span class="math notranslate nohighlight">\(m\)</span> is  a stochastic discount factor, and <span class="math notranslate nohighlight">\(E\)</span> is a mathematical expectation with respect to a joint probability distribution of <span class="math notranslate nohighlight">\(R\)</span> and <span class="math notranslate nohighlight">\(m\)</span>.</p>
<p>Instances of this equation occur in  many models.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Chapter 1 of <span id="id1">[<a class="reference internal" href="zreferences.html#id176" title="L Ljungqvist and T J Sargent. Recursive Macroeconomic Theory. MIT Press, 4 edition, 2018.">Ljungqvist and Sargent, 2018</a>]</span> describes the role that this equation plays in a diverse set of
models in macroeconomics, monetary economics, and public finance.</p>
</div>
<p>We aim to convey insights about empirical implications of this equation brought out in the work of Lars Peter Hansen <span id="id2">[<a class="reference internal" href="zreferences.html#id118" title="Lars Peter Hansen and Scott F Richard. The Role of Conditioning Information in Deducing Testable. Econometrica, 55(3):587-613, May 1987.">Hansen and Richard, 1987</a>]</span> and Lars Peter Hansen and Ravi Jagannathan <span id="id3">[<a class="reference internal" href="zreferences.html#id23" title="Lars Peter Hansen and Ravi Jagannathan. Implications of Security Market Data for Models of Dynamic Economies. Journal of Political Economy, 99(2):225-262, April 1991. URL: https://ideas.repec.org/a/ucp/jpolec/v99y1991i2p225-62.html, doi:10.1086/261749.">Hansen and Jagannathan, 1991</a>]</span>.</p>
<p>By following their footsteps, from  that single equation  we’ll derive</p>
<ul class="simple">
<li><p>a mean-variance frontier</p></li>
<li><p>a single-factor model of  excess  returns</p></li>
</ul>
<p>To do this, we use two ideas:</p>
<ul class="simple">
<li><p>the equation <span class="math notranslate nohighlight">\(E m R =1 \)</span> that is  implied by an application of a <em>law of one price</em></p></li>
<li><p>a Cauchy-Schwartz inequality</p></li>
</ul>
<p>In particular, we’ll apply a Cauchy-Schwartz inequality to a population linear least squares regression equation that is
implied by <span class="math notranslate nohighlight">\(E m R =1\)</span>.</p>
<p>We’ll also describe how  practitioners have implemented the model using</p>
<ul class="simple">
<li><p>cross sections of returns on many assets</p></li>
<li><p>time series of returns on various assets</p></li>
</ul>
<p>For background and basic  concepts about linear least squares projections, see our lecture <a class="reference external" href="https://python-advanced.quantecon.org/orth_proj.html">orthogonal projections and their applications</a>.</p>
<p>As a sequel to the material here, please see our lecture <a class="reference external" href="https://python-advanced.quantecon.org/black_litterman.html">two modifications of mean-variance portfolio theory</a>.</p>
</section>
<section id="key-equation">
<h2><span class="section-number">36.2. </span>Key equation<a class="headerlink" href="#key-equation" title="Permalink to this heading">#</a></h2>
<p>We  begin with a <strong>key asset pricing equation</strong>:</p>
<div class="math notranslate nohighlight" id="equation-eq-emr1">
<span class="eqno">(36.1)<a class="headerlink" href="#equation-eq-emr1" title="Permalink to this equation">#</a></span>\[
E m R^i = 1
\]</div>
<p>for <span class="math notranslate nohighlight">\(i=1, \ldots, I\)</span> and where</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
m &amp;=\text { stochastic discount factor } \\
R^{i} &amp;= \text {random gross return  on asset }  i \\
E &amp;\sim \text { mathematical expectation }
\end{aligned}
\end{split}\]</div>
<p>The random gross return <span class="math notranslate nohighlight">\(R^i\)</span> for every asset <span class="math notranslate nohighlight">\(i\)</span> and the scalar stochastic discount factor <span class="math notranslate nohighlight">\(m\)</span>
live in a common probability space.</p>
<p><span id="id4">[<a class="reference internal" href="zreferences.html#id118" title="Lars Peter Hansen and Scott F Richard. The Role of Conditioning Information in Deducing Testable. Econometrica, 55(3):587-613, May 1987.">Hansen and Richard, 1987</a>]</span> and <span id="id5">[<a class="reference internal" href="zreferences.html#id23" title="Lars Peter Hansen and Ravi Jagannathan. Implications of Security Market Data for Models of Dynamic Economies. Journal of Political Economy, 99(2):225-262, April 1991. URL: https://ideas.repec.org/a/ucp/jpolec/v99y1991i2p225-62.html, doi:10.1086/261749.">Hansen and Jagannathan, 1991</a>]</span> explain how <strong>existence</strong> of a scalar stochastic discount factor that verifies  equation
<a class="reference internal" href="#equation-eq-emr1">(36.1)</a> is implied by a <strong>law of one price</strong> that requires that all portfolios of assets
that bring the  same payouts  have the same price.</p>
<p>They also explain how the <strong>absence of an arbitrage</strong> opportunity implies that the stochastic discount
factor <span class="math notranslate nohighlight">\(m \geq 0\)</span>.</p>
<p>In order to say something about the <strong>uniqueness</strong> of a stochastic discount factor, we  would have to impose more theoretical structure than we do in this
lecture.</p>
<p>For example, in <strong>complete markets</strong> models like those illustrated in this lecture <a class="reference external" href="https://python-advanced.quantecon.org/BCG_incomplete_mkts.html">equilibrium capital structures with incomplete markets</a>,
the stochastic discount factor is unique.</p>
<p>In <strong>incomplete markets</strong> models like those illustrated in this lecture <a class="reference external" href="https://python.quantecon.org/aiyagari.html">the Aiyagari model</a>, the stochastic discount factor is not unique.</p>
</section>
<section id="implications-of-key-equation">
<h2><span class="section-number">36.3. </span>Implications of key equation<a class="headerlink" href="#implications-of-key-equation" title="Permalink to this heading">#</a></h2>
<p>We combine  key equation <a class="reference internal" href="#equation-eq-emr1">(36.1)</a> with a  remark of Lars Peter Hansen that   “asset pricing theory is all about covariances”.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Lars Hansen’s remark is a concise summary of ideas in <span id="id6">[<a class="reference internal" href="zreferences.html#id118" title="Lars Peter Hansen and Scott F Richard. The Role of Conditioning Information in Deducing Testable. Econometrica, 55(3):587-613, May 1987.">Hansen and Richard, 1987</a>]</span> and
<span id="id7">[<a class="reference internal" href="zreferences.html#id23" title="Lars Peter Hansen and Ravi Jagannathan. Implications of Security Market Data for Models of Dynamic Economies. Journal of Political Economy, 99(2):225-262, April 1991. URL: https://ideas.repec.org/a/ucp/jpolec/v99y1991i2p225-62.html, doi:10.1086/261749.">Hansen and Jagannathan, 1991</a>]</span>. Important foundations of these ideas were set down by
<span id="id8">[<a class="reference internal" href="zreferences.html#id19" title="Stephen A. Ross. The arbitrage theory of capital asset pricing. Journal of Economic Theory, 13(3):341-360, December 1976. URL: https://ideas.repec.org/a/eee/jetheo/v13y1976i3p341-360.html, doi:.">Ross, 1976</a>]</span>, <span id="id9">[<a class="reference internal" href="zreferences.html#id18" title="Stephen A Ross. A Simple Approach to the Valuation of Risky Streams. The Journal of Business, 51(3):453-475, July 1978. URL: https://ideas.repec.org/a/ucp/jnlbus/v51y1978i3p453-75.html.">Ross, 1978</a>]</span>, <span id="id10">[<a class="reference internal" href="zreferences.html#id20" title="J. Michael Harrison and David M. Kreps. Martingales and arbitrage in multiperiod securities markets. Journal of Economic Theory, 20(3):381-408, June 1979. URL: https://ideas.repec.org/a/eee/jetheo/v20y1979i3p381-408.html, doi:.">Harrison and Kreps, 1979</a>]</span>, <span id="id11">[<a class="reference internal" href="zreferences.html#id21" title="David M. Kreps. Arbitrage and equilibrium in economies with infinitely many commodities. Journal of Mathematical Economics, 8(1):15-35, March 1981. URL: https://ideas.repec.org/a/eee/mateco/v8y1981i1p15-35.html, doi:.">Kreps, 1981</a>]</span>, and
<span id="id12">[<a class="reference internal" href="zreferences.html#id17" title="Gary Chamberlain and Michael Rothschild. Arbitrage, Factor Structure, and Mean-Variance Analysis on Large Asset Markets. Econometrica, 51(5):1281-1304, September 1983. URL: https://ideas.repec.org/a/ecm/emetrp/v51y1983i5p1281-304.html, doi:.">Chamberlain and Rothschild, 1983</a>]</span>.</p>
</div>
<p>This remark of Lars Hansen refers to the fact that interesting restrictions can be deduced by recognizing that <span class="math notranslate nohighlight">\(E m R^i\)</span> is a component of the covariance between <span class="math notranslate nohighlight">\(m \)</span> and <span class="math notranslate nohighlight">\(R^i\)</span> and then using that fact to rearrange  equation  <a class="reference internal" href="#equation-eq-emr1">(36.1)</a>.</p>
<p>Let’s do this step by step.</p>
<p>First note  that the definition of a
covariance
<span class="math notranslate nohighlight">\(\operatorname{cov}\left(m, R^{i}\right)  =  E (m - E m)(R^i - E R^i) \)</span>
implies that</p>
<div class="math notranslate nohighlight">
\[
E m R^i = E m E R^{i}+\operatorname{cov}\left(m, R^{i}\right)
\]</div>
<p>Substituting this result into
equation <a class="reference internal" href="#equation-eq-emr1">(36.1)</a> gives</p>
<div class="math notranslate nohighlight" id="equation-eq-emr2">
<span class="eqno">(36.2)<a class="headerlink" href="#equation-eq-emr2" title="Permalink to this equation">#</a></span>\[
1 = E m E R^{i}+\operatorname{cov}\left(m, R^{i}\right)
\]</div>
<p>Next note that for a risk-free asset with non-random gross return <span class="math notranslate nohighlight">\(R^f\)</span>, equation
<a class="reference internal" href="#equation-eq-emr1">(36.1)</a> becomes</p>
<div class="math notranslate nohighlight">
\[
1 = E R^f m = R^f E m.
\]</div>
<p>This is true because we can pull the constant <span class="math notranslate nohighlight">\(R^f\)</span> outside the mathematical expectation.</p>
<p>It follows that the  gross return on a risk-free asset is</p>
<div class="math notranslate nohighlight">
\[
R^{f}  = 1 / E(m)
\]</div>
<p>Using this formula for <span class="math notranslate nohighlight">\(R^f\)</span> in equation <a class="reference internal" href="#equation-eq-emr2">(36.2)</a> and rearranging, it follows that</p>
<div class="math notranslate nohighlight">
\[
R^{f} = E R^{i}+\operatorname{cov}\left(m, R^{i} \right) R^{f}
\]</div>
<p>which can be rearranged to become</p>
<div class="math notranslate nohighlight">
\[
E R^i = R^{f}-\operatorname{cov}\left(m, R^{i}\right) R^{f} .
\]</div>
<p>It follows that we can express an <strong>excess return</strong> <span class="math notranslate nohighlight">\(E R^{i}-R^{f}\)</span> on asset <span class="math notranslate nohighlight">\(i\)</span> relative to the risk-free rate as</p>
<div class="math notranslate nohighlight" id="equation-eq-emr3">
<span class="eqno">(36.3)<a class="headerlink" href="#equation-eq-emr3" title="Permalink to this equation">#</a></span>\[
E R^{i}-R^{f} = -\operatorname{cov}\left(m, R^{i}\right) R^{f}
\]</div>
<p>Equation <a class="reference internal" href="#equation-eq-emr3">(36.3)</a> can be rearranged to display important parts of asset pricing theory.</p>
</section>
<section id="expected-return-beta-representation">
<h2><span class="section-number">36.4. </span>Expected return - beta representation<a class="headerlink" href="#expected-return-beta-representation" title="Permalink to this heading">#</a></h2>
<p>We can obtain the celebrated <strong>expected-return-Beta -representation</strong> for gross return <span class="math notranslate nohighlight">\(R^i\)</span>  by simply  rearranging excess return equation <a class="reference internal" href="#equation-eq-emr3">(36.3)</a> to become</p>
<div class="math notranslate nohighlight">
\[
E R^{i}=R^{f}+\left(\underbrace{\frac{\operatorname{cov}\left(R^{i}, m\right)}{\operatorname{var}(m)}}_{\quad\quad\beta_{i,m} = \text{regression coefficient}}\right)\left(\underbrace{-\frac{\operatorname{var}(m)}{E(m)}}_{\quad\lambda_{m} = \text{price of risk}}\right)
\]</div>
<p>or</p>
<div class="math notranslate nohighlight" id="equation-eq-erbetarep">
<span class="eqno">(36.4)<a class="headerlink" href="#equation-eq-erbetarep" title="Permalink to this equation">#</a></span>\[
E R^{i}=R^{f}+\beta_{i, m} \lambda_{m}
\]</div>
<p>Here</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta_{i,m}\)</span> is a (population) least squares regression coefficient of gross return <span class="math notranslate nohighlight">\(R^i\)</span> on stochastic discount factor <span class="math notranslate nohighlight">\(m\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda_m\)</span> is minus the variance of <span class="math notranslate nohighlight">\(m\)</span> divided by the mean of <span class="math notranslate nohighlight">\(m\)</span>, an object that is sometimes called a <strong>price of risk</strong>.</p></li>
</ul>
<p>Because <span class="math notranslate nohighlight">\(\lambda_m &lt; 0\)</span>, equation <a class="reference internal" href="#equation-eq-erbetarep">(36.4)</a> asserts that</p>
<ul class="simple">
<li><p>assets whose returns are <strong>positively</strong> correlated with the stochastic discount factor (SDF) <span class="math notranslate nohighlight">\(m\)</span> have expected returns <strong>lower</strong> than the risk-free rate <span class="math notranslate nohighlight">\(R^f\)</span></p></li>
<li><p>assets whose returns are <strong>negatively</strong> correlated with the SDF <span class="math notranslate nohighlight">\(m\)</span> have expected returns <strong>higher</strong> than the risk-free rate <span class="math notranslate nohighlight">\(R^f\)</span></p></li>
</ul>
<p>These patterns will be discussed more below.</p>
<p>In particular, we’ll see that returns that are <strong>perfectly</strong> negatively correlated with the SDF <span class="math notranslate nohighlight">\(m\)</span> have a special
status:</p>
<ul class="simple">
<li><p>they are on a <strong>mean-variance frontier</strong></p></li>
</ul>
<p>Before we dive into that more, we’ll pause to look at an example of an SDF.</p>
<p>To interpret  representation <a class="reference internal" href="#equation-eq-erbetarep">(36.4)</a>, the following widely used example helps.</p>
<p><strong>Example</strong></p>
<p>Let <span class="math notranslate nohighlight">\(c_t\)</span> be the logarithm of the consumption of a <em>representative consumer</em> or just a single consumer for whom we have consumption data.</p>
<p>A popular model of <span class="math notranslate nohighlight">\(m\)</span> is</p>
<div class="math notranslate nohighlight">
\[
m_{t+1} = \beta \frac{U'(C_{t+1})}{U'(C_t)}
\]</div>
<p>where <span class="math notranslate nohighlight">\(C_t\)</span> is consumption at time <span class="math notranslate nohighlight">\(t\)</span>, <span class="math notranslate nohighlight">\(\beta = \exp(-\rho)\)</span> is a discount <strong>factor</strong> with <span class="math notranslate nohighlight">\(\rho\)</span> being
the discount <strong>rate</strong>, and <span class="math notranslate nohighlight">\(U(\cdot)\)</span> is a concave, twice-diffential utility function.</p>
<p>For a constant relative risk aversion (CRRA) utility function <span class="math notranslate nohighlight">\(U(C) = \frac{C^{1-\gamma}}{1-\gamma}\)</span> utility
function <span class="math notranslate nohighlight">\(U'(C) = C^{-\gamma}\)</span>.</p>
<p>In this case, letting <span class="math notranslate nohighlight">\(c_t = \log(C_t)\)</span>, we can write <span class="math notranslate nohighlight">\(m_{t+1}\)</span> as</p>
<div class="math notranslate nohighlight">
\[
m_{t+1} = \exp(-\rho) \exp(- \gamma(c_{t+1} - c_t))
\]</div>
<p>where <span class="math notranslate nohighlight">\( \rho &gt; 0\)</span>, <span class="math notranslate nohighlight">\(\gamma &gt; 0\)</span>.</p>
<p>A popular model  for the growth of  log of consumption  is</p>
<div class="math notranslate nohighlight">
\[
c_{t+1} - c_t = \mu + \sigma_c \epsilon_{t+1}
\]</div>
<p>where <span class="math notranslate nohighlight">\(\epsilon_{t+1} \sim {\mathcal N}(0,1)\)</span>.</p>
<p>Here <span class="math notranslate nohighlight">\(\{c_t\}\)</span> is a random walk with drift <span class="math notranslate nohighlight">\(\mu\)</span>, a good approximation to US per capital consumption growth.</p>
<p>Again here</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\gamma &gt;0\)</span> is a coefficient of relative risk aversion</p></li>
<li><p><span class="math notranslate nohighlight">\(\rho &gt;0 \)</span> is a fixed intertemporal discount rate</p></li>
</ul>
<p>So we have</p>
<div class="math notranslate nohighlight">
\[
m_{t+1} = \exp(-\rho) \exp( - \gamma \mu - \gamma \sigma_c \epsilon_{t+1})
\]</div>
<p>In this case</p>
<div class="math notranslate nohighlight">
\[
E m_{t+1} = \exp(-\rho) \exp \left( - \gamma \mu + \frac{\sigma_c^2 \gamma^2}{2} \right)
\]</div>
<p>and</p>
<div class="math notranslate nohighlight">
\[
\operatorname{var}(m_{t+1}) = E(m) [ \exp(\sigma_c^2 \gamma^2) - 1) ]
\]</div>
<p>When <span class="math notranslate nohighlight">\(\gamma &gt;0\)</span>, it is true that</p>
<ul class="simple">
<li><p>when consumption growth is <strong>high</strong>, <span class="math notranslate nohighlight">\(m\)</span> is <strong>low</strong></p></li>
<li><p>when consumption growth is <strong>low</strong>, <span class="math notranslate nohighlight">\(m\)</span> is <strong>high</strong></p></li>
</ul>
<p>According to representation <a class="reference internal" href="#equation-eq-erbetarep">(36.4)</a>, an asset with a gross return  <span class="math notranslate nohighlight">\(R^i\)</span> that is expected to be <strong>high</strong> when consumption growth is <strong>low</strong>  has <span class="math notranslate nohighlight">\(\beta_{i,m}\)</span> positive and a <strong>low</strong> expected return.</p>
<ul class="simple">
<li><p>because it has a high gross return when consumption growth is low, it is a good hedge against consumption risk. That justifies its low average return.</p></li>
</ul>
<p>An asset with an <span class="math notranslate nohighlight">\(R^i\)</span> that is <strong>low</strong> when consumption growth is <strong>low</strong> has <span class="math notranslate nohighlight">\(\beta_{i,m}\)</span> negative and a <strong>high</strong> expected return.</p>
<ul class="simple">
<li><p>because it has a low gross return when consumption growth is low, it is a poor hedge against consumption risk. That  justifies its high average return.</p></li>
</ul>
</section>
<section id="mean-variance-frontier">
<h2><span class="section-number">36.5. </span>Mean-variance frontier<a class="headerlink" href="#mean-variance-frontier" title="Permalink to this heading">#</a></h2>
<p>Now we’ll derive the celebrated <strong>mean-variance frontier</strong>.</p>
<p>We do this using a  method deployed by Lars Peter Hansen and Scott
Richard <span id="id13">[<a class="reference internal" href="zreferences.html#id118" title="Lars Peter Hansen and Scott F Richard. The Role of Conditioning Information in Deducing Testable. Econometrica, 55(3):587-613, May 1987.">Hansen and Richard, 1987</a>]</span>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Methods of Hansen and Richard are described and used extensively by <span id="id14">[<a class="reference internal" href="zreferences.html#id22" title="John H. Cochrane. Asset Pricing: revised edition. Princeton University Press, Princeton, New Jersey, 2005.">Cochrane, 2005</a>]</span>.</p>
</div>
<p>Their  idea was rearrange the key equation  <a class="reference internal" href="#equation-eq-emr1">(36.1)</a>, namely,  <span class="math notranslate nohighlight">\(E m R^i = 1\)</span>, and then  to  apply a Cauchy-Schwarz inequality.</p>
<p>A convenient way to remember the Cauchy-Schwartz inequality in our context is that it says that an  <span class="math notranslate nohighlight">\(R^2\)</span> in any regression has to be  less than or equal to <span class="math notranslate nohighlight">\(1\)</span>.</p>
<p>(Please note that here <span class="math notranslate nohighlight">\(R^2\)</span> denotes the coefficient of determination in a regression, not a return on an asset!)</p>
<p>Let’s apply that idea to deduce</p>
<div class="math notranslate nohighlight" id="equation-eq-emr5">
<span class="eqno">(36.5)<a class="headerlink" href="#equation-eq-emr5" title="Permalink to this equation">#</a></span>\[
1= E\left(m R^{i}\right)=E(m) E\left(R^{i}\right)+\rho_{m, R^{i}}\sigma(m) \sigma\left(R^{i}\right)
\]</div>
<p>where the correlation coefficient <span class="math notranslate nohighlight">\(\rho_{m, R^i}\)</span> is   defined as</p>
<div class="math notranslate nohighlight">
\[
\rho_{m, R^i} \equiv \frac{\operatorname{cov}\left(m, R^{i}\right)}{\sigma(m) \sigma\left(R^{i}\right)}
\]</div>
<p>and where <span class="math notranslate nohighlight">\(\sigma(\cdot)\)</span> denotes the standard deviation of the variable in parentheses</p>
<p>Equation <a class="reference internal" href="#equation-eq-emr5">(36.5)</a>  implies</p>
<div class="math notranslate nohighlight">
\[
E R^{i}=R^{f}-\rho_{m, R^i} \frac{\sigma(m)}{E(m)} \sigma\left(R^{i}\right)
\]</div>
<p>Because <span class="math notranslate nohighlight">\(\rho_{m, R^i} \in [-1,1]\)</span>, it follows that  <span class="math notranslate nohighlight">\(|\rho_{m, R^i}| \leq 1\)</span> and that</p>
<div class="math notranslate nohighlight" id="equation-eq-erm6">
<span class="eqno">(36.6)<a class="headerlink" href="#equation-eq-erm6" title="Permalink to this equation">#</a></span>\[
\left|E R^i-R^{f}\right| \leqslant \frac{\sigma(m)}{E(m)} \sigma\left(R^{i}\right)
\]</div>
<p>Inequality <a class="reference internal" href="#equation-eq-erm6">(36.6)</a> delineates a <strong>mean-variance frontier</strong></p>
<p>(Actually, it looks more like a <strong>mean-standard-deviation frontier</strong>)</p>
<p>Evidently, points on the frontier correspond to gross returns that are perfectly correlated
(either positively or negatively) with the stochastic discount factor <span class="math notranslate nohighlight">\(m\)</span>.</p>
<p>We summarize this observation  as</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\rho_{m, R^{i}}=\left\{\begin{array}{ll}
+1 &amp; \implies R^i \text { is on  lower frontier } \\
-1 &amp; \implies R^i \text { is on  an upper frontier }
\end{array}\right.
\end{split}\]</div>
<p>Now let’s use matplotlib to draw a mean variance frontier.</p>
<p>In drawing a frontier, we’ll set <span class="math notranslate nohighlight">\(\sigma(m) = .25\)</span> and <span class="math notranslate nohighlight">\(E m = .99\)</span>, values roughly consistent with what many studies calibrate from quarterly US data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Define the function to plot</span>
<span class="k">def</span> <span class="nf">y</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">alpha</span> <span class="o">+</span> <span class="n">beta</span><span class="o">*</span><span class="n">x</span>
<span class="k">def</span> <span class="nf">z</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">alpha</span> <span class="o">-</span> <span class="n">beta</span><span class="o">*</span><span class="n">x</span>

<span class="n">sigmam</span> <span class="o">=</span> <span class="mf">.25</span>
<span class="n">Em</span> <span class="o">=</span> <span class="mf">.99</span>

<span class="c1"># Set the values of alpha and beta</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">Em</span>
<span class="n">beta</span> <span class="o">=</span> <span class="n">sigmam</span><span class="o">/</span><span class="n">Em</span>

<span class="c1"># Create a range of values for x</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">.15</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>

<span class="c1"># Calculate the values of y and z</span>
<span class="n">y_values</span> <span class="o">=</span> <span class="n">y</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>
<span class="n">z_values</span> <span class="o">=</span> <span class="n">z</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">beta</span><span class="p">)</span>

<span class="c1"># Create a figure and axes object</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>

<span class="c1"># Plot y</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$R^f + \frac{\sigma(m)}{E(m)} \sigma(R^i)$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">z_values</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$R^f - \frac{\sigma(m)}{E(m)} \sigma(R^i)$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;mean standard deviation frontier&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$\sigma(R^i)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;$E (R^i) $&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">.053</span><span class="p">,</span> <span class="mf">1.015</span><span class="p">,</span> <span class="s2">&quot;(.05,1.015)&quot;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mf">.05</span><span class="p">,</span> <span class="mf">1.015</span><span class="p">,</span> <span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$(\sigma(R^j), E R^j)$&quot;</span><span class="p">)</span>
<span class="c1"># Add a legend and show the plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c96361a260bf42c192636986256c4cfe9eeb27ba5350d99567e59e4b3283b0bd.png" src="_images/c96361a260bf42c192636986256c4cfe9eeb27ba5350d99567e59e4b3283b0bd.png" />
</div>
</div>
<p>The figure shows two straight lines, the blue upper one being the locus of <span class="math notranslate nohighlight">\(( \sigma(R^i), E(R^i)\)</span> pairs that are on
the <strong>mean-variance frontier</strong> or <strong>mean-standard-deviation frontier</strong>.</p>
<p>The green dot refers to a return  <span class="math notranslate nohighlight">\(R^j\)</span> that is <strong>not</strong> on the frontier and that has moments
<span class="math notranslate nohighlight">\((\sigma(R^j), E R^j) =  (.05, 1.015)\)</span>.</p>
<p>It is described by the statistical model</p>
<div class="math notranslate nohighlight">
\[
 R^j = R^i +  \epsilon^j
\]</div>
<p>where <span class="math notranslate nohighlight">\(R^i\)</span> is a return that is on the frontier and  <span class="math notranslate nohighlight">\(\epsilon^j\)</span> is a random variable that has mean zero and that is orthogonal to <span class="math notranslate nohighlight">\(R^i\)</span>.</p>
<p>Then <span class="math notranslate nohighlight">\( E R^j = E R^i\)</span> and, as a consequence of <span class="math notranslate nohighlight">\(R^j\)</span> not being on the frontier,</p>
<div class="math notranslate nohighlight">
\[
\sigma^2(R^j) = \sigma^2(R^i) + \sigma^2(\epsilon^j)
\]</div>
<p>The length of a horizontal line from the point <span class="math notranslate nohighlight">\(\sigma(R^j), E (R^j) = .05, 1.015\)</span> to
the frontier   equals</p>
<div class="math notranslate nohighlight">
\[
\sqrt{ \sigma^2(R^i) + \sigma^2( \epsilon^j)} - \sigma(R^i)
\]</div>
<p>This is a measure of the part of the risk in <span class="math notranslate nohighlight">\(R^j\)</span> that is not priced because it is  uncorrelated with the stochastic discount factor and so can be diversified away (i.e., averaged out to zero by holding a diversified portfolio).</p>
</section>
<section id="sharpe-ratios-and-the-price-of-risk">
<h2><span class="section-number">36.6. </span>Sharpe ratios and the price of risk<a class="headerlink" href="#sharpe-ratios-and-the-price-of-risk" title="Permalink to this heading">#</a></h2>
<p>An asset’s <strong>Sharpe ratio</strong> is defined as</p>
<div class="math notranslate nohighlight">
\[
 \frac{E(R^i) - R^f}{\sigma(R^i)}
\]</div>
<p>The above figure reminds us that all assets <span class="math notranslate nohighlight">\(R^i\)</span> whose returns are on the mean-standard deviation frontier
satisfy</p>
<div class="math notranslate nohighlight">
\[
\frac{E(R^i) - R^f}{\sigma(R^i)}  = \frac{\sigma(m)}{E m}
\]</div>
<p>The ratio <span class="math notranslate nohighlight">\(\frac{\sigma(m)}{E m} \)</span> is often called the <strong>market price of risk</strong>.</p>
<p>Evidently it equals the maximum Sharpe ratio for any asset or portfolio of assets.</p>
</section>
<section id="mathematical-structure-of-frontier">
<h2><span class="section-number">36.7. </span>Mathematical structure of frontier<a class="headerlink" href="#mathematical-structure-of-frontier" title="Permalink to this heading">#</a></h2>
<p>The mathematical  structure of the mean-variance frontier described by inequality <a class="reference internal" href="#equation-eq-erm6">(36.6)</a> implies
that</p>
<ul>
<li><p>all returns on the frontier are perfectly correlated.</p>
<p>Thus,</p>
<ul class="simple">
<li><p>Let <span class="math notranslate nohighlight">\(R^m, R^{mv}\)</span> be two returns on the frontier.</p></li>
<li><p>Then for some scalar <span class="math notranslate nohighlight">\(a\)</span>, a return <span class="math notranslate nohighlight">\(R^{m v}\)</span> on the mean-variance frontier satisfies the affine equation
<span class="math notranslate nohighlight">\(R^{m v}=R^{f}+a\left(R^{m}-R^{f}\right)\)</span> .  This is an <strong>exact</strong> equation with no <strong>residual</strong>.</p></li>
</ul>
</li>
<li><p>each return <span class="math notranslate nohighlight">\(R^{mv}\)</span> that is on the mean-variance frontier is perfectly (negatively) correlated with <span class="math notranslate nohighlight">\(m\)</span></p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\left(\rho_{m, R^{mv}}=-1\right) \Rightarrow \begin{cases} m=a+b R^{m v} \\ R^{m v}=e+d  m  \end{cases}\)</span> for some scalars <span class="math notranslate nohighlight">\(a, b, e, d\)</span>,</p></li>
</ul>
<p>Therefore, <strong>any return on the mean-variance frontier is a legitimate stochastic discount factor</strong></p>
</li>
<li><p>for any mean-variance-efficient return <span class="math notranslate nohighlight">\(R^{m v}\)</span> that is on the frontier but that is  <strong>not</strong> <span class="math notranslate nohighlight">\(R^{f}\)</span>, there exists  a <strong>single-beta representation</strong> for any return <span class="math notranslate nohighlight">\(R^i\)</span> that takes the form:</p></li>
</ul>
<div class="math notranslate nohighlight" id="equation-eq-emr7">
<span class="eqno">(36.7)<a class="headerlink" href="#equation-eq-emr7" title="Permalink to this equation">#</a></span>\[
E R^{i}=R^{f}+\beta_{i, R^{m v}}\left[E\left(R^{m v}\right)-R^{f}\right]
\]</div>
<ul>
<li><p>the regression coefficient <span class="math notranslate nohighlight">\(\beta_{i, R^{m v}}\)</span> is often called asset <span class="math notranslate nohighlight">\(i\)</span>’s <strong>beta</strong></p></li>
<li><p>The special case of a single-beta representation <a class="reference internal" href="#equation-eq-emr7">(36.7)</a> with <span class="math notranslate nohighlight">\( R^{i}=R^{m v}\)</span>   is</p>
<p><span class="math notranslate nohighlight">\(E R^{m v}=R^{f}+1 \cdot\left[E\left(R^{m v}\right)-R^{f}\right] \)</span></p>
</li>
</ul>
</section>
<section id="multi-factor-models">
<h2><span class="section-number">36.8. </span>Multi-factor models<a class="headerlink" href="#multi-factor-models" title="Permalink to this heading">#</a></h2>
<p>The single-beta representation  <a class="reference internal" href="#equation-eq-emr7">(36.7)</a> is a special case of the multi-factor model</p>
<div class="math notranslate nohighlight">
\[
E R^{i}   =\gamma+\beta_{i, a} \lambda_{a}+\beta_{i, b} \lambda_{b}+\cdots
\]</div>
<p>where <span class="math notranslate nohighlight">\(\lambda_j\)</span> is the price of being exposed to risk factor <span class="math notranslate nohighlight">\(f_t^j\)</span>  and <span class="math notranslate nohighlight">\(\beta_{i,j}\)</span> is asset <span class="math notranslate nohighlight">\(i\)</span>’s exposure to that
risk factor.</p>
<p>To uncover the <span class="math notranslate nohighlight">\(\beta_{i,j}\)</span>’s, one  takes data on time series of the risk factors <span class="math notranslate nohighlight">\(f_t^j\)</span> that are being priced
and specifies the following least squares regression</p>
<div class="math notranslate nohighlight" id="equation-eq-timeseriesrep">
<span class="eqno">(36.8)<a class="headerlink" href="#equation-eq-timeseriesrep" title="Permalink to this equation">#</a></span>\[\begin{split}
R_{t}^{i}=a_{i}+\beta_{i, a} f_{t}^{a}+\beta_{i, b} f_{t}^{b}+\ldots+\epsilon_{t}^{i}, \quad t=1,2, \ldots, T\\
\epsilon_{t}^{i} \perp f_{t}^{j}, i=1,2, \ldots, I; j = a, b, \ldots
\end{split}\]</div>
<p>Special cases are:</p>
<ul class="simple">
<li><p>a popular <strong>single-factor</strong> model specifies the single factor  <span class="math notranslate nohighlight">\(f_t\)</span> to be the return on the market portfolio</p></li>
<li><p>another popular <strong>single-factor</strong> model called the <strong>consumption-based model</strong> specifies the factor to be  <span class="math notranslate nohighlight">\( m_{t+1} = \beta \frac{u^{\prime}\left(c_{t+1}\right)}{u^{\prime}\left(c_{t}\right)}\)</span>, where <span class="math notranslate nohighlight">\(c_t\)</span> is a representative consumer’s time <span class="math notranslate nohighlight">\(t\)</span> consumption.</p></li>
</ul>
<p>As a reminder, model objects are interpreted as follows:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\beta_{i,a}\)</span> is the  exposure of return <span class="math notranslate nohighlight">\(R^i\)</span> to risk factor <span class="math notranslate nohighlight">\(f_a\)</span></p></li>
<li><p><span class="math notranslate nohighlight">\(\lambda_{a}\)</span> is the  price of exposure to risk factor <span class="math notranslate nohighlight">\(f_a\)</span></p></li>
</ul>
</section>
<section id="empirical-implementations">
<h2><span class="section-number">36.9. </span>Empirical implementations<a class="headerlink" href="#empirical-implementations" title="Permalink to this heading">#</a></h2>
<p>We briefly describe empirical implementations of multi-factor generalizations of the single-factor model described above.</p>
<p>Two representations of a multi-factor model play importnt roles in empirical applications.</p>
<p>One is the time series regression <a class="reference internal" href="#equation-eq-timeseriesrep">(36.8)</a></p>
<p>The other representation entails  a <strong>cross-section regression</strong>  of <strong>average returns</strong> <span class="math notranslate nohighlight">\(E R^i\)</span> for  assets
<span class="math notranslate nohighlight">\(i =1, 2, \ldots, I\)</span> on <strong>prices of risk</strong> <span class="math notranslate nohighlight">\(\lambda_j\)</span> for <span class="math notranslate nohighlight">\(j =a, b, c, \ldots\)</span></p>
<p>Here is the cross-section regression specification for a multi-factor model:</p>
<div class="math notranslate nohighlight">
\[
E R^{i}   =\gamma+\beta_{i, a} \lambda_{a}+\beta_{i, b} \lambda_{b}+\cdots
 \]</div>
<p><strong>Testing strategies:</strong></p>
<p>Time-series and cross-section regressions play roles in both  <strong>estimating</strong> and <strong>testing</strong> beta representation
models.</p>
<p>The basic idea is to implement the following two steps.</p>
<p><strong>Step 1:</strong></p>
<ul class="simple">
<li><p>Estimate <span class="math notranslate nohighlight">\(a_{i}, \beta_{i, a}, \beta_{i, b}, \cdots\)</span> by running a <strong>time series regression:</strong> <span class="math notranslate nohighlight">\(R_{t}^{i}\)</span> on a constant and <span class="math notranslate nohighlight">\(f_{t}^{a}, f_{t}^{b}, \ldots\)</span></p></li>
</ul>
<p><strong>Step 2:</strong></p>
<ul class="simple">
<li><p>take the <span class="math notranslate nohighlight">\(\beta_{i, j}\)</span>’s estimated in step one as regressors together with data on average returns
<span class="math notranslate nohighlight">\(E R^i\)</span> over some period and then  estimate the  <strong>cross-section regression</strong></p></li>
</ul>
<div class="math notranslate nohighlight">
\[
\underbrace{E\left(R^{i}\right)}_{\text{average return over time series}}=\gamma+\underbrace{\beta_{i, a}}_{\text{regressor}\quad} \underbrace{\lambda_{a}}_{\text{regression}\text{coefficient}}+\underbrace{\beta_{i, b}}_{\text{regressor}\quad} \underbrace{\lambda_{b}}_{\text{regression}\text{coefficient}}+\cdots+\underbrace{\alpha_{i}}_{\text{pricing errors}}, i=1, \ldots, I; \quad \underbrace{\alpha_i \perp \beta_{i,j},j = a, b, \ldots}_{\text{least squares orthogonality condition}}
\]</div>
<ul class="simple">
<li><p>Here <span class="math notranslate nohighlight">\(\perp\)</span> means <strong>orthogonal to</strong></p></li>
<li><p>estimate <span class="math notranslate nohighlight">\(\gamma, \lambda_{a}, \lambda_{b}, \ldots\)</span> by an appropriate regression technique,  recognizing that the regressors have been generated by a step 1 regression.</p></li>
</ul>
<p>Note that presumably  the risk-free return <span class="math notranslate nohighlight">\(E R^{f}=\gamma\)</span>.</p>
<p>For excess returns <span class="math notranslate nohighlight">\(R^{ei} = R^i - R^f\)</span> we have</p>
<div class="math notranslate nohighlight">
\[
E R^{e i}=\beta_{i, a} \lambda_{a}+\beta_{i, b} \lambda_{b}+\cdots+\alpha_{i}, i=1, \ldots, I
\]</div>
<p>In the  following exercises, we illustrate aspects of these empirical strategies on artificial data.</p>
<p>Our basic tools are random number generator that we shall use to create artificial samples that conform to the theory and
least squares regressions that let us watch aspects of the theory at work.</p>
<p>These exercises will further convince us that asset pricing theory is mostly about covariances and least squares regressions.</p>
</section>
<section id="exercises">
<h2><span class="section-number">36.10. </span>Exercises<a class="headerlink" href="#exercises" title="Permalink to this heading">#</a></h2>
<p>Let’s start with some imports.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="k">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>
</div>
</div>
</div>
<p>Lots of our calculations will involve computing population and sample OLS regressions.</p>
<p>So we define a function for simple univariate OLS regression that calls the <code class="docutils literal notranslate"><span class="pre">OLS</span></code> routine from <code class="docutils literal notranslate"><span class="pre">statsmodels</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">simple_ols</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">Y</span><span class="p">,</span> <span class="n">constant</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>

    <span class="k">if</span> <span class="n">constant</span><span class="p">:</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">add_constant</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">Y</span><span class="p">,</span> <span class="n">X</span><span class="p">)</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

    <span class="n">β_hat</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">σ_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">res</span><span class="o">.</span><span class="n">resid</span> <span class="o">@</span> <span class="n">res</span><span class="o">.</span><span class="n">resid</span> <span class="o">/</span> <span class="n">res</span><span class="o">.</span><span class="n">df_resid</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">β_hat</span><span class="p">,</span> <span class="n">σ_hat</span>
</pre></div>
</div>
</div>
</div>
<div class="exercise admonition" id="apl_ex1">

<p class="admonition-title"><span class="caption-number">Exercise 36.1 </span></p>
<section id="exercise-content">
<p>Look at the equation,</p>
<div class="math notranslate nohighlight">
\[
R^i_t - R^f = \beta_{i, R^m} (R^m_t - R^f) + \sigma_i \varepsilon_{i, t}.
\]</div>
<p>Verify that this equation is a regression equation.</p>
</section>
</div>
<div class="solution dropdown admonition" id="asset_pricing_lph-solution-1">

<p class="admonition-title">Solution to<a class="reference internal" href="#apl_ex1"> Exercise 36.1</a></p>
<section id="solution-content">
<p>To verify that it is a <strong>regression equation</strong> we must show that the residual is orthogonal to the regressor.</p>
<p>Our assumptions about mutual orthogonality imply that</p>
<div class="math notranslate nohighlight">
\[
E\left[\epsilon_{i,t}\right]=0,\quad E\left[\epsilon_{i,t}u_{t}\right]=0
\]</div>
<p>It follows that</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
E\left[\sigma_{i}\epsilon_{i,t}\left(R_{t}^{m}-R^{f}\right)\right]&amp;=E\left[\sigma_{i}\epsilon_{i,t}\left(\xi+\lambda u_{t}\right)\right] \\
	&amp;=\sigma_{i}\xi E\left[\epsilon_{i,t}\right]+\sigma_{i}\lambda E\left[\epsilon_{i,t}u_{t}\right] \\
	&amp;=0
\end{aligned}
\end{split}\]</div>
</section>
</div>
<div class="exercise admonition" id="apl_ex2">

<p class="admonition-title"><span class="caption-number">Exercise 36.2 </span></p>
<section id="exercise-content">
<p>Give a formula for the regression coefficient <span class="math notranslate nohighlight">\(\beta_{i, R^m}\)</span>.</p>
</section>
</div>
<div class="solution dropdown admonition" id="asset_pricing_lph-solution-3">

<p class="admonition-title">Solution to<a class="reference internal" href="#apl_ex2"> Exercise 36.2</a></p>
<section id="solution-content">
<p>The regression coefficient <span class="math notranslate nohighlight">\(\beta_{i, R^m}\)</span> is</p>
<div class="math notranslate nohighlight">
\[
\beta_{i,R^{m}}=\frac{Cov\left(R_{t}^{i}-R^{f},R_{t}^{m}-R^{f}\right)}{Var\left(R_{t}^{m}-R^{f}\right)}
\]</div>
</section>
</div>
<div class="exercise admonition" id="apl_ex3">

<p class="admonition-title"><span class="caption-number">Exercise 36.3 </span></p>
<section id="exercise-content">
<p>As in many sciences, it is useful to distinguish a  <strong>direct problem</strong> from  an <strong>inverse problem</strong>.</p>
<ul class="simple">
<li><p>A direct problem involves simulating a particular model with known parameter values.</p></li>
<li><p>An inverse problem involves using data to <strong>estimate</strong> or <strong>choose</strong> a particular  parameter vector  from a manifold of models indexed by a set of parameter vectors.</p></li>
</ul>
<p>Please assume the parameter values provided below and then simulate 2000 observations from the theory specified
above for 5 assets, <span class="math notranslate nohighlight">\(i = 1, \ldots, 5\)</span>.</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
E\left[R^f\right] &amp;= 0.02 \\
\sigma_f &amp;= 0.00 \\
\xi &amp;= 0.06 \\
\lambda &amp;= 0.04 \\
\beta_{1, R^m} &amp;= 0.2 \\
\sigma_1 &amp;= 0.04 \\
\beta_{2, R^m} &amp;= .4 \\
\sigma_2 &amp;= 0.04 \\
\beta_{3, R^m} &amp;= .6 \\
\sigma_3 &amp;= 0.04 \\
\beta_{4, R^m} &amp;= .8 \\
\sigma_4 &amp;= 0.04 \\
\beta_{5, R^m} &amp;= 1.0 \\
\sigma_5 &amp;= 0.04
\end{align*}\]</div>
<p><strong>More Exercises</strong></p>
<p>Now come some even more fun parts!</p>
<p>Our theory implies that there exist values of  two scalars, <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span>, such that  a legitimate stochastic discount factor is:</p>
<div class="math notranslate nohighlight">
\[
m_t = a + b R^m_t
\]</div>
<p>The parameters <span class="math notranslate nohighlight">\(a, b\)</span> must satisfy the following equations:</p>
<div class="amsmath math notranslate nohighlight">
\[\begin{align*}
E[(a + b R_t^m) R^m_t)] &amp;= 1 \\
E[(a + b R_t^m) R^f_t)] &amp;= 1
\end{align*}\]</div>
</section>
</div>
<div class="solution dropdown admonition" id="asset_pricing_lph-solution-5">

<p class="admonition-title">Solution to<a class="reference internal" href="#apl_ex3"> Exercise 36.3</a></p>
<section id="solution-content">
<p><strong>Direct Problem:</strong></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code for the direct problem</span>

<span class="c1"># assign the parameter values</span>
<span class="n">ERf</span> <span class="o">=</span> <span class="mf">0.02</span>
<span class="n">σf</span> <span class="o">=</span> <span class="mf">0.00</span> <span class="c1"># Zejin: Hi tom, here is where you manipulate σf</span>
<span class="n">ξ</span> <span class="o">=</span> <span class="mf">0.06</span>
<span class="n">λ</span> <span class="o">=</span> <span class="mf">0.08</span>
<span class="n">βi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">.4</span><span class="p">,</span> <span class="mf">.6</span><span class="p">,</span> <span class="mf">.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>
<span class="n">σi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">,</span> <span class="mf">0.04</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># in this cell we set the number of assets and number of observations</span>
<span class="c1"># we first set T to a large number to verify our computation results</span>
<span class="n">T</span> <span class="o">=</span> <span class="mi">2000</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulate i.i.d. random shocks</span>
<span class="n">e</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">u</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">T</span><span class="p">)</span>
<span class="n">ϵ</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulate the return on a risk-free asset</span>
<span class="n">Rf</span> <span class="o">=</span> <span class="n">ERf</span> <span class="o">+</span> <span class="n">σf</span> <span class="o">*</span> <span class="n">e</span>

<span class="c1"># simulate the return on the market portfolio</span>
<span class="n">excess_Rm</span> <span class="o">=</span> <span class="n">ξ</span> <span class="o">+</span> <span class="n">λ</span> <span class="o">*</span> <span class="n">u</span>
<span class="n">Rm</span> <span class="o">=</span> <span class="n">Rf</span> <span class="o">+</span> <span class="n">excess_Rm</span>

<span class="c1"># simulate the return on asset i</span>
<span class="n">Ri</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="n">N</span><span class="p">,</span> <span class="n">T</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">Ri</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">=</span> <span class="n">Rf</span> <span class="o">+</span> <span class="n">βi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">excess_Rm</span> <span class="o">+</span> <span class="n">σi</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">ϵ</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span>
</pre></div>
</div>
</div>
</div>
<p>Now that we have a panel of data, we’d like to solve the inverse problem by assuming the theory specified above and estimating the coefficients given above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code for the inverse problem</span>
</pre></div>
</div>
</div>
</div>
<p><strong>Inverse Problem:</strong></p>
<p>We will solve the inverse problem by simple OLS regressions.</p>
<ol class="arabic simple">
<li><p>estimate <span class="math notranslate nohighlight">\(E\left[R^f\right]\)</span> and <span class="math notranslate nohighlight">\(\sigma_f\)</span></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ERf_hat</span><span class="p">,</span> <span class="n">σf_hat</span> <span class="o">=</span> <span class="n">simple_ols</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">Rf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ERf_hat</span><span class="p">,</span> <span class="n">σf_hat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.020000000000000046, 4.5114090308141905e-17)
</pre></div>
</div>
</div>
</div>
<p>Let’s  compare these with the <em>true</em> population parameter values.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ERf</span><span class="p">,</span> <span class="n">σf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.02, 0.0)
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p><span class="math notranslate nohighlight">\(\xi\)</span> and <span class="math notranslate nohighlight">\(\lambda\)</span></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ξ_hat</span><span class="p">,</span> <span class="n">λ_hat</span> <span class="o">=</span> <span class="n">simple_ols</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">T</span><span class="p">),</span> <span class="n">Rm</span> <span class="o">-</span> <span class="n">Rf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ξ_hat</span><span class="p">,</span> <span class="n">λ_hat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0645551429241219, 0.08228751331067806)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ξ</span><span class="p">,</span> <span class="n">λ</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.06, 0.08)
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p><span class="math notranslate nohighlight">\(\beta_{i, R^m}\)</span> and <span class="math notranslate nohighlight">\(\sigma_i\)</span></p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">βi_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>
<span class="n">σi_hat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">(</span><span class="n">N</span><span class="p">)</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">βi_hat</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">σi_hat</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_ols</span><span class="p">(</span><span class="n">Rm</span> <span class="o">-</span> <span class="n">Rf</span><span class="p">,</span> <span class="n">Ri</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">Rf</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">βi_hat</span><span class="p">,</span> <span class="n">σi_hat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([0.20119954, 0.39712334, 0.6019592 , 0.79353802, 0.99452605]),
 array([0.03958674, 0.03964956, 0.04096193, 0.03996479, 0.0399302 ]))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">βi</span><span class="p">,</span> <span class="n">σi</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([0.2, 0.4, 0.6, 0.8, 1. ]), array([0.04, 0.04, 0.04, 0.04, 0.04]))
</pre></div>
</div>
</div>
</div>
<p>Q: How close did your estimates come to the parameters we specified?</p>
</section>
</div>
<div class="exercise admonition" id="apl_ex4">

<p class="admonition-title"><span class="caption-number">Exercise 36.4 </span></p>
<section id="exercise-content">
<p>Using the equations above, find a system of two <strong>linear</strong> equations that you can solve for <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> as functions of the parameters <span class="math notranslate nohighlight">\((\lambda, \xi, E[R_f])\)</span>.</p>
<p>Write a function that can solve these equations.</p>
<p>Please check the <strong>condition number</strong> of a key matrix that must be inverted to determine a, b</p>
</section>
</div>
<div class="solution dropdown admonition" id="asset_pricing_lph-solution-7">

<p class="admonition-title">Solution to<a class="reference internal" href="#apl_ex4"> Exercise 36.4</a></p>
<section id="solution-content">
<p>The system of two linear equations is shown below:</p>
<div class="math notranslate nohighlight">
\[
\begin{aligned}
a ((E(R^f) + \xi) + b ((E(R^f) + \xi)^2 + \lambda^2 + \sigma_f^2) &amp; =1 \cr
a E(R^f) + b (E(R^f)^2 + \xi E(R^f) + \sigma_f ^ 2) &amp; = 1
\end{aligned}
\]</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Code here</span>
<span class="k">def</span> <span class="nf">solve_ab</span><span class="p">(</span><span class="n">ERf</span><span class="p">,</span> <span class="n">σf</span><span class="p">,</span> <span class="n">λ</span><span class="p">,</span> <span class="n">ξ</span><span class="p">):</span>

    <span class="n">M</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">empty</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ERf</span> <span class="o">+</span> <span class="n">ξ</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ERf</span> <span class="o">+</span> <span class="n">ξ</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">λ</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">σf</span> <span class="o">**</span> <span class="mi">2</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ERf</span>
    <span class="n">M</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">ERf</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">ξ</span> <span class="o">*</span> <span class="n">ERf</span> <span class="o">+</span> <span class="n">σf</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">condM</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span><span class="n">M</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">condM</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s try to solve <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> using the actual model parameters.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">condM</span> <span class="o">=</span> <span class="n">solve_ab</span><span class="p">(</span><span class="n">ERf</span><span class="p">,</span> <span class="n">σf</span><span class="p">,</span> <span class="n">λ</span><span class="p">,</span> <span class="n">ξ</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">condM</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(87.49999999999999, -468.7499999999999, 54.406619883717504)
</pre></div>
</div>
</div>
</div>
</section>
</div>
<div class="exercise admonition" id="apl_ex5">

<p class="admonition-title"><span class="caption-number">Exercise 36.5 </span></p>
<section id="exercise-content">
<p>Using the estimates of the parameters that you generated above, compute the implied stochastic discount factor.</p>
</section>
</div>
<div class="solution dropdown admonition" id="asset_pricing_lph-solution-9">

<p class="admonition-title">Solution to<a class="reference internal" href="#apl_ex5"> Exercise 36.5</a></p>
<section id="solution-content">
<p>Now let’s pass <span class="math notranslate nohighlight">\(\hat{E}(R^f), \hat{\sigma}^f, \hat{\lambda}, \hat{\xi}\)</span> to the function <code class="docutils literal notranslate"><span class="pre">solve_ab</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a_hat</span><span class="p">,</span> <span class="n">b_hat</span><span class="p">,</span> <span class="n">M_hat</span> <span class="o">=</span> <span class="n">solve_ab</span><span class="p">(</span><span class="n">ERf_hat</span><span class="p">,</span> <span class="n">σf_hat</span><span class="p">,</span> <span class="n">λ_hat</span><span class="p">,</span> <span class="n">ξ_hat</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a_hat</span><span class="p">,</span> <span class="n">b_hat</span><span class="p">,</span> <span class="n">M_hat</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(90.30630645584144, -476.6866338575242, 57.18198199430199)
</pre></div>
</div>
</div>
</div>
</section>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                    </div>
                    
                </main> <!-- .page__content -->
                


                <footer class="qe-page__footer">

                    <p><a href="https://creativecommons.org/licenses/by-sa/4.0/"><img src="https://licensebuttons.net/l/by-sa/4.0/80x15.png"></a></p>

                    <p>Creative Commons License &ndash; This work is licensed under a Creative Commons Attribution-ShareAlike 4.0 International.</p>

                </footer> <!-- .page__footer -->

            </div> <!-- .page -->

            

            
            <div class="qe-sidebar bd-sidebar inactive" id="site-navigation">

                <div class="qe-sidebar__header">


                    Contents

                </div>

                <nav class="qe-sidebar__nav" id="qe-sidebar-nav" aria-label="Main navigation">
                    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Tools and Techniques
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="orth_proj.html">
   1. Orthogonal Projections and Their Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="stationary_densities.html">
   2. Continuous State Markov Chains
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="muth_kalman.html">
   3. Reverse Engineering a la Muth
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="discrete_dp.html">
   4. Discrete State Dynamic Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  LQ Control
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="cons_news.html">
   5. Information and Consumption Smoothing
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing.html">
   6. Consumption Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="smoothing_tax.html">
   7. Tax Smoothing with Complete and Incomplete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="markov_jump_lq.html">
   8. Markov Jump Linear Quadratic Dynamic Programming
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_1.html">
   9. How to Pay for a War: Part 1
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_2.html">
   10. How to Pay for a War: Part 2
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tax_smoothing_3.html">
   11. How to Pay for a War: Part 3
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lqramsey.html">
   12. Optimal Taxation in an LQ Economy
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Multiple Agent Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arellano.html">
   13. Default Risk and Income Fluctuations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="matsuyama.html">
   14. Globalization and Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="coase.html">
   15. Coase’s Theory of the Firm
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="match_transport.html">
   16. Composite Sorting
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Linear Economies
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="hs_recursive_models.html">
   17. Recursive Models of Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="growth_in_dles.html">
   18. Growth in Dynamic Linear Economies
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_asset_pricing_dles.html">
   19. Lucas Asset Pricing Using DLE
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="irfs_in_hall_model.html">
   20. IRFs in Hall Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="permanent_income_dles.html">
   21. Permanent Income Model using the DLE Class
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rosen_schooling_model.html">
   22. Rosen Schooling Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="cattle_cycles.html">
   23. Cattle Cycles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="hs_invertibility_example.html">
   24. Shock Non Invertibility
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Risk, Model Uncertainty, and Robustness
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="five_preferences.html">
   25. Risk and Model Uncertainty
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="entropy.html">
   26. Etymology of Entropy
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="robustness.html">
   27. Robustness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="rob_markov_perf.html">
   28. Robust Markov Perfect Equilibrium
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Time Series Models
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="arma.html">
   29. Covariance Stationary Processes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="estspec.html">
   30. Estimation of Spectra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="additive_functionals.html">
   31. Additive and Multiplicative Functionals
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="lu_tricks.html">
   32. Classical Control with Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="classical_filtering.html">
   33. Classical Prediction and Filtering With Linear Algebra
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="knowing_forecasts_of_others.html">
   34. Knowing the Forecasts of Others
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Asset Pricing and Finance
 </span>
</p>
<ul class="current nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="lucas_model.html">
   35. Asset Pricing II: The Lucas Asset Pricing Model
  </a>
 </li>
 <li class="toctree-l1 current active active">
  <a class="current reference internal" href="#">
   36. Elementary Asset Pricing Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="black_litterman.html">
   37. Two Modifications of Mean-Variance Portfolio Theory
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_complete_mkts.html">
   38. Irrelevance of Capital Structures with Complete Markets
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="BCG_incomplete_mkts.html">
   39. Equilibrium Capital Structures with Incomplete Markets
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Dynamic Programming Squared
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="un_insure.html">
   40. Optimal Unemployment Insurance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dyn_stack.html">
   41. Stackelberg Plans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo_machine_learn.html">
   42. Machine Learning a Ramsey Plan
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo.html">
   43. Time Inconsistency of Ramsey Plans
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="calvo_abreu.html">
   44. Sustainable Plans for a Calvo Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="opt_tax_recur.html">
   45. Optimal Taxation with State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss.html">
   46. Optimal Taxation without State-Contingent Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss2.html">
   47. Fluctuating Interest Rates Deliver Fiscal Insurance
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="amss3.html">
   48. Fiscal Risk and Government Debt
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_ramsey.html">
   49. Competitive Equilibria of a Model of Chang
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="chang_credible.html">
   50. Credible Government Policies in a Model of Chang
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Other
 </span>
</p>
<ul class="nav bd-sidenav nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="troubleshooting.html">
   51. Troubleshooting
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="zreferences.html">
   52. References
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="status.html">
   53. Execution Statistics
  </a>
 </li>
</ul>

                </nav>

                <div class="qe-sidebar__footer">

                </div>

            </div> <!-- .sidebar -->
            
        </div> <!-- .main -->

        <div class="qe-toolbar">

            <div class="qe-toolbar__inner">

                <ul class="qe-toolbar__main">
                    <li data-tippy-content="Table of Contents" class="btn__sidebar"><i data-feather="menu"></i></li>
                    <li data-tippy-content="Home"><a href="intro.html"><i data-feather="home"></i></a></li>
                    <li class="btn__qelogo"><a href="https://quantecon.org" title=""><span class="show-for-sr">QuantEcon</span></a></li>
                </ul>

                <ul class="qe-toolbar__links">
                    <li class="btn__search">
                        <form action="search.html" method="get">
                            <input type="search" class="form-control" name="q" id="search-input" placeholder="Search..." aria-label="Search..." autocomplete="off" accesskey="k">
                            <i data-feather="search" id="search-icon"></i>
                        </form>
                    </li>
                    <li data-tippy-content="Fullscreen" class="btn__fullscreen"><i data-feather="maximize"></i></li>
                    <li data-tippy-content="Increase font size" class="btn__plus"><i data-feather="plus-circle"></i></li>
                    <li data-tippy-content="Decrease font size" class="btn__minus"><i data-feather="minus-circle"></i></li>
                    <li data-tippy-content="Change contrast" class="btn__contrast"><i data-feather="sunset"></i></li>
                    <li data-tippy-content="Download Notebook"><a href="/_notebooks/asset_pricing_lph.ipynb" download><i data-feather="download-cloud"></i></a></li>
                    <li class="settings-button" id="settingsButton"><div data-tippy-content="Launch Notebook"><i data-feather="play-circle"></i></div></li>
                        <li class="download-pdf" id="downloadButton"><i data-feather="file"></i></li>
                    <!--
                    # Enable if looking for link to specific document hosted on GitHub
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-advanced.myst/blob/main/lectures/asset_pricing_lph.md" download><i data-feather="github"></i></a></li>
                    -->
                    <li data-tippy-content="View Source"><a target="_blank" href="https://github.com/QuantEcon/lecture-python-advanced.myst" download><i data-feather="github"></i></a></li>
                </ul>

            </div>

        </div> <!-- .toolbar -->
        <div id="downloadPDFModal" style="display: none;">
            <ul class="pdf-options" style="display: block;">
                <li class="download-pdf-book" onClick="window.print()">
                    <p>Lecture (PDF)</p>
                </li>
                <li class="download-pdf-file">
                    <a href="/_pdf/quantecon-python-advanced.pdf" download><p>Book (PDF)</p></a>
                </li>
            </ul>
        </div>
        <div id="settingsModal" style="display: none;">
            <p class="modal-title"> Notebook Launcher </p>
            <div class="modal-desc">
            <p>
                Choose public or private cloud service for "Launch" button.
            </p>
            </div>
            <p class="modal-subtitle">Select a server</p>
            <ul class="modal-servers">
            <li class="active launcher-public">
                <span class="label">Public</span>
                <select id="launcher-public-input">
                
                    <option value="https://colab.research.google.com/github/QuantEcon/lecture-python-advanced.notebooks/blob/main/asset_pricing_lph.ipynb">Colab</option>
                
                </select>
                <i class="fas fa-check-circle"></i>
            </li>
            <li class="launcher-private">
                <span class="label">Private</span>
                <input type="text" id="launcher-private-input" data-repourl="https://github.com/QuantEcon/lecture-python-advanced.notebooks" data-urlpath="tree/lecture-python-advanced.notebooks/asset_pricing_lph.ipynb" data-branch=main>
                <i class="fas fa-check-circle"></i>
            </li>
            </ul>
            <p class="launch"><a href="https://colab.research.google.com/github/QuantEcon/lecture-python-advanced.notebooks/blob/main/asset_pricing_lph.ipynb" id="advancedLaunchButton" target="_blank">Launch Notebook</a></p>
            <script>
                // QuantEcon Notebook Launcher
                const launcherTypeElements = document.querySelectorAll('#settingsModal .modal-servers li');
                // Highlight the server type if previous selection exists
                if (typeof localStorage.launcherType !== 'undefined') {
                  for (var i = 0; i < launcherTypeElements.length; i++) {
                    launcherTypeElements[i].classList.remove('active');
                    if ( launcherTypeElements[i].classList.contains(localStorage.launcherType) ) {
                      launcherTypeElements[i].classList.add('active');
                    }
                  }
                }
                // Highlight server type on click and set local storage value
                for (var i = 0; i < launcherTypeElements.length; i++) {
                  launcherTypeElements[i].addEventListener('click', function() {
                    for (var j = 0; j < launcherTypeElements.length; j++) {
                      launcherTypeElements[j].classList.remove('active');
                    }
                    this.classList.add('active');
                    if ( this.classList.contains('launcher-private') ) {
                      localStorage.launcherType = 'launcher-private';
                    } else if ( this.classList.contains('launcher-public') ) {
                      localStorage.launcherType = 'launcher-public';
                    }
                    setLaunchServer();
                  })
                }
                const launcherPublic = document.getElementById('launcher-public-input');
                const launcherPrivate = document.getElementById('launcher-private-input');
                const pageName = "asset_pricing_lph";
                const repoURL = "https://github.com/QuantEcon/lecture-python-advanced.notebooks";
                const urlPath = "tree/lecture-python-advanced.notebooks/asset_pricing_lph.ipynb";
                const branch = "main"
                const launchNotebookLink = document.getElementById('advancedLaunchButton');

                // Highlight public server option if previous selection exists
                if (typeof localStorage.launcherPublic !== 'undefined') {
                  launcherPublic.value = localStorage.launcherPublic;
                }
                // Update local storage upon public server selection
                launcherPublic.addEventListener('change', (event) => {
                  setLaunchServer();
                });
                // Populate private server input if previous entry exists
                if (typeof localStorage.launcherPrivate !== 'undefined') {
                  launcherPrivate.value = localStorage.launcherPrivate;
                }
                // Update local storage when a private server is entered
                launcherPrivate.addEventListener('input', (event) => {
                  setLaunchServer();
                });

                // Function to update the "Launch Notebook" link href
                function setLaunchServer() {
                  launchNotebookLink.removeAttribute("style")
                  if ( localStorage.launcherType == 'launcher-private' ) {
                    let repoPrefix = "/jupyter/hub/user-redirect/git-pull?repo=" + repoURL + "&branch=" + branch + "&urlpath=" + urlPath;
                    launcherPrivateValue = launcherPrivate.value
                    if (!launcherPrivateValue) {
                        launchNotebookLink.removeAttribute("href")
                        launchNotebookLink.style.background = "grey"
                        return
                    }
                    localStorage.launcherPrivate = launcherPrivateValue;
                    privateServer = localStorage.launcherPrivate.replace(/\/$/, "")
                    if (!privateServer.includes("http")) {
                        privateServer = "http://" + privateServer
                    }
                    launchNotebookLinkURL = privateServer + repoPrefix;
                  } else if ( localStorage.launcherType == 'launcher-public' ) {
                    launcherPublicValue = launcherPublic.options[launcherPublic.selectedIndex].value;
                    localStorage.launcherPublic = launcherPublicValue;
                    launchNotebookLinkURL = localStorage.launcherPublic;
                  }
                  if (launchNotebookLinkURL) launchNotebookLink.href = launchNotebookLinkURL;
                }
                // Check if user has previously selected a server
                if ( (typeof localStorage.launcherPrivate !== 'undefined') || (typeof localStorage.launcherPublic !== 'undefined') ) {
                  setLaunchServer();
                }
                </script>

        </div>

    </div> <!-- .wrapper-->
  </body>
</html>